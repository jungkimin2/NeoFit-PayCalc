<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoFit PayCalc - ÎÑ§Ïò§Ìïè Í∏âÏó¨ Í≥ÑÏÇ∞Í∏∞</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" crossorigin="anonymous"></script>

    <!-- Firebase SDK Ï∂îÍ∞Ä -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        * {
            font-family: 'Pretendard', sans-serif;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .glow-green {
            box-shadow:
                0 0 30px rgba(0, 255, 136, 0.4),
                0 0 60px rgba(0, 255, 136, 0.2),
                0 0 90px rgba(0, 255, 136, 0.1);
        }

        .hover-glow:hover {
            box-shadow:
                0 0 30px rgba(0, 255, 136, 0.5),
                0 0 50px rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            z-index: 1;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .glass-effect:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.12);
            box-shadow:
                0 12px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }


        .gradient-border {
            position: relative;
            background: transparent;
            border: 1px solid rgba(0, 255, 136, 0.4);
            border-radius: 1.5rem;
            overflow: hidden;
        }

        .gradient-border>div {
            background: transparent;
            padding: 2rem;
        }

        .gradient-border.glow-green {
            box-shadow:
                inset 0 0 30px rgba(0, 255, 136, 0.1),
                0 4px 20px rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, rgba(0, 255, 136, 0.4), rgba(0, 198, 110, 0.4));
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, rgba(0, 255, 136, 0.6), rgba(0, 198, 110, 0.6));
            background-clip: padding-box;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 136, 0.5);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 136, 0.8);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* ===== Í≥†Í∏â Ïï†ÎãàÎ©îÏù¥ÏÖò Ï∂îÍ∞Ä ===== */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes progressFill {
            from {
                width: 0%;
            }

            to {
                width: var(--progress-width, 100%);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) scale(1);
            }

            50% {
                transform: translateY(-15px) scale(1.02);
            }
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            }

            50% {
                box-shadow: 0 0 40px rgba(0, 255, 136, 0.5), 0 0 60px rgba(0, 255, 136, 0.3);
            }
        }

        .slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }

        .shimmer-effect {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        .count-up {
            animation: countUp 0.6s ease-out;
        }

        .float-animation {
            animation: float 6s ease-in-out infinite;
        }

        .glow-animation {
            animation: glow 3s ease-in-out infinite;
        }

        /* ===== 3D Ïπ¥Îìú Ìö®Í≥º ===== */
        .card-3d {
            transform-style: preserve-3d;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-3d:hover {
            transform: translateY(-8px) rotateX(2deg);
            box-shadow:
                0 25px 50px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* ===== Í∞ïÌôîÎêú Glass Morphism ===== */
        .glass-premium {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow:
                0 8px 32px 0 rgba(0, 0, 0, 0.37),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        /* ===== ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î ===== */
        .progress-bar {
            position: relative;
            height: 6px;
            background: rgba(31, 41, 55, 0.8);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 999px;
            animation: progressFill 1.5s ease-out forwards;
        }

        /* ===== Î≤ÑÌäº Î¶¨Ìîå Ìö®Í≥º ===== */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }

        .btn-ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-ripple:active::after {
            width: 300px;
            height: 300px;
            transition: width 0s, height 0s;
        }

        /* ===== Í∑∏ÎùºÎîîÏñ∏Ìä∏ ÌÖçÏä§Ìä∏ ===== */
        .gradient-text-green {
            background: linear-gradient(135deg, #00FF88, #00C66E, #00FF88);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }

        .gradient-text-blue {
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #60a5fa);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .gradient-text-gold {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #fbbf24);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes gradient {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* ===== Ìò∏Î≤Ñ Ìö®Í≥º Í∞ïÌôî ===== */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        /* ===== ÏïÑÏù¥ÏΩò Ïª®ÌÖåÏù¥ÎÑà ===== */
        .icon-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
        }

        .icon-container:hover {
            transform: scale(1.1);
        }

        /* ===== ÎÑ§Ïò® Î≥¥Îçî ===== */
        .neon-border-green {
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow:
                0 0 10px rgba(0, 255, 136, 0.1),
                inset 0 0 10px rgba(0, 255, 136, 0.05);
        }

        .neon-border-green:hover {
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow:
                0 0 20px rgba(0, 255, 136, 0.2),
                inset 0 0 20px rgba(0, 255, 136, 0.1);
        }

        /* Î™®Î∞îÏùº/Îç∞Ïä§ÌÅ¨ÌÜ± Î∂ÑÎ¶¨ */
        .mobile-only {
            display: flex !important;
        }

        .desktop-only {
            display: none !important;
        }

        @media (min-width: 640px) {
            .mobile-only {
                display: none !important;
            }

            .desktop-only {
                display: flex !important;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes neonGreenPulse {

            0%,
            100% {
                text-shadow: 0 0 10px #00FF88, 0 0 20px #00FF88, 0 0 30px #00FF88, 0 0 40px #00FF88;
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.5), inset 0 0 20px rgba(0, 255, 136, 0.1);
            }

            50% {
                text-shadow: 0 0 15px #00FF88, 0 0 25px #00FF88, 0 0 35px #00FF88, 0 0 50px #00FF88;
                box-shadow: 0 0 30px rgba(0, 255, 136, 0.7), inset 0 0 30px rgba(0, 255, 136, 0.2);
            }
        }

        @keyframes neonBluePulse {

            0%,
            100% {
                text-shadow: 0 0 10px #00C6FF, 0 0 20px #00C6FF, 0 0 30px #00C6FF, 0 0 40px #00C6FF;
                box-shadow: 0 0 20px rgba(0, 198, 255, 0.5), inset 0 0 20px rgba(0, 198, 255, 0.1);
            }

            50% {
                text-shadow: 0 0 15px #00C6FF, 0 0 25px #00C6FF, 0 0 35px #00C6FF, 0 0 50px #00C6FF;
                box-shadow: 0 0 30px rgba(0, 198, 255, 0.7), inset 0 0 30px rgba(0, 198, 255, 0.2);
            }
        }

        /* ÎìúÎ°≠Îã§Ïö¥ optgroup Í∑∏Î¶∞ ÎÑ§Ïò® Ìö®Í≥º Ïä§ÌÉÄÏùº - Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ ÎùºÎ≤®Ïóê Ï†ÅÏö© */
        select optgroup {
            color: #00FF88 !important;
            font-weight: 700 !important;
            text-shadow: 0 0 5px #00FF88,
                0 0 10px #00FF88,
                0 0 15px #00FF88,
                0 0 20px #00FF88,
                0 0 30px #00FF88 !important;
            background: rgba(0, 255, 136, 0.1) !important;
        }

        /* Î™®Îì† optgroup ÎùºÎ≤®Ïóê ÎÑ§Ïò® Ìö®Í≥º Í∞ïÏ†ú Ï†ÅÏö© */
        optgroup[label] {
            color: #00FF88 !important;
            text-shadow: 0 0 8px #00FF88,
                0 0 16px #00FF88,
                0 0 24px #00FF88 !important;
            font-weight: bold !important;
        }

        /* Webkit Î∏åÎùºÏö∞Ï†ÄÏö© ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº */
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            select optgroup {
                color: #00FF88 !important;
                -webkit-text-fill-color: #00FF88 !important;
                font-weight: bold !important;
                text-shadow: 0 0 10px #00FF88 !important;
            }
        }

        /* FirefoxÏö© Ïä§ÌÉÄÏùº */
        @-moz-document url-prefix() {
            select optgroup {
                color: #00FF88 !important;
                font-weight: bold !important;
                text-shadow: 0 0 10px #00FF88 !important;
            }
        }

        /* Ï≤´Î≤àÏß∏ optgroupÏùÄ ÏÉÅÎã® border Ï†úÍ±∞ */
        select optgroup:first-of-type {
            border-top: none !important;
        }

        /* ÎìúÎ°≠Îã§Ïö¥ Ï†ÑÏ≤¥ Ïä§ÌÉÄÏùº Í∞úÏÑ† */
        select.glass-effect {
            background: rgba(10, 14, 26, 0.95) !important;
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #fff;
        }

        /* disabled optionÏùÑ Ïπ¥ÌÖåÍ≥†Î¶¨ ÎùºÎ≤®Î°ú Ïä§ÌÉÄÏùºÎßÅ */
        select option:disabled {
            color: #00FF88 !important;
            font-weight: bold !important;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.05)) !important;
            text-align: center !important;
            padding: 10px !important;
            font-size: 0.95em !important;
        }

        select.glass-effect:focus {
            border-color: #00FF88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            outline: none;
        }

        select option {
            background: rgba(10, 14, 26, 0.98);
            color: #fff;
            padding: 8px;
        }

        select option:hover {
            background: rgba(0, 255, 136, 0.2);
        }

        .fixed {
            position: fixed;
        }

        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        .z-50 {
            z-index: 50;
        }

        /* Tailwind-like utility classes */
        .min-h-screen {
            min-height: 100vh;
        }

        .bg-gradient-to-br {
            background:
                radial-gradient(ellipse at 20% 20%, rgba(0, 255, 136, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(59, 130, 246, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),
                linear-gradient(135deg, #0a0e1a 0%, #111827 50%, #0a0e1a 100%);
            background-attachment: fixed;
        }

        .text-gray-100 {
            color: #f3f4f6;
        }

        .text-gray-400 {
            color: #9ca3af;
        }

        .text-gray-300 {
            color: #d1d5db;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-white {
            color: #ffffff;
        }

        .text-pink-400 {
            color: #f472b6;
        }

        .text-green-400 {
            color: #4ade80;
        }

        .text-red-400 {
            color: #f87171;
        }

        .text-red-300 {
            color: #fca5a5;
        }

        .p-4 {
            padding: 1rem;
        }

        .p-2 {
            padding: 0.5rem;
        }

        .p-3 {
            padding: 0.75rem;
        }

        .p-5 {
            padding: 1.25rem;
        }

        .p-6 {
            padding: 1.5rem;
        }

        .px-2 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .px-8 {
            padding-left: 2rem;
            padding-right: 2rem;
        }

        .py-1 {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }

        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .py-6 {
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }

        .mb-1 {
            margin-bottom: 0.25rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mb-10 {
            margin-bottom: 2.5rem;
        }

        .mt-1 {
            margin-top: 0.25rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-6 {
            margin-top: 1.5rem;
        }

        .ml-3 {
            margin-left: 0.75rem;
        }

        .ml-5 {
            margin-left: 1.25rem;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .max-w-7xl {
            max-width: 80rem;
        }

        .text-center {
            text-align: center;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-base {
            font-size: 1rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .text-5xl {
            font-size: 3rem;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-black {
            font-weight: 900;
        }

        .rounded {
            border-radius: 0.25rem;
        }

        .rounded-lg {
            border-radius: 0.5rem;
        }

        .rounded-xl {
            border-radius: 0.75rem;
        }

        .rounded-2xl {
            border-radius: 1rem;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .flex {
            display: flex;
        }

        .grid {
            display: grid;
        }

        .gap-1 {
            gap: 0.25rem;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .gap-6 {
            gap: 1.5rem;
        }

        .space-y-2>*+* {
            margin-top: 0.5rem;
        }

        .space-y-3>*+* {
            margin-top: 0.75rem;
        }

        .space-y-4>*+* {
            margin-top: 1rem;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .flex-1 {
            flex: 1 1 0%;
        }

        .w-full {
            width: 100%;
        }

        .max-h-40 {
            max-height: 10rem;
        }

        .overflow-y-auto {
            overflow-y: auto;
        }

        .overflow-x-hidden {
            overflow-x: hidden;
        }

        .bg-gray-800 {
            background-color: rgba(31, 41, 55, 0.7);
        }

        .bg-gray-700 {
            background-color: rgba(55, 65, 81, 0.7);
        }

        .bg-gray-800\/50 {
            background-color: rgba(31, 41, 55, 0.5);
        }

        .bg-green-500\/20 {
            background-color: rgba(34, 197, 94, 0.2);
        }

        .bg-blue-500\/20 {
            background-color: rgba(59, 130, 246, 0.2);
        }

        .bg-pink-500\/20 {
            background-color: rgba(236, 72, 153, 0.2);
        }

        .bg-red-500\/10 {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .bg-red-500\/20 {
            background-color: rgba(239, 68, 68, 0.2);
        }

        .bg-gradient-to-r {
            background: linear-gradient(to right, var(--tw-gradient-stops));
        }

        .from-green-500 {
            --tw-gradient-from: #22c55e;
        }

        .from-green-600 {
            --tw-gradient-from: #16a34a;
        }

        .from-green-700 {
            --tw-gradient-from: #15803d;
        }

        .from-blue-600 {
            --tw-gradient-from: #2563eb;
        }

        .from-blue-700 {
            --tw-gradient-from: #1d4ed8;
        }

        .from-orange-600 {
            --tw-gradient-from: #ea580c;
        }

        .from-orange-700 {
            --tw-gradient-from: #c2410c;
        }

        .to-green-600 {
            --tw-gradient-to: #16a34a;
        }

        .to-green-700 {
            --tw-gradient-to: #15803d;
        }

        .to-blue-700 {
            --tw-gradient-to: #1d4ed8;
        }

        .to-orange-700 {
            --tw-gradient-to: #c2410c;
        }

        .from-green-500\/10 {
            --tw-gradient-from: rgba(34, 197, 94, 0.1);
        }

        .to-blue-500\/10 {
            --tw-gradient-to: rgba(59, 130, 246, 0.1);
        }

        .hover\:from-green-500:hover {
            --tw-gradient-from: #22c55e;
        }

        .hover\:from-blue-500:hover {
            --tw-gradient-from: #2563eb;
        }

        .hover\:from-orange-500:hover {
            --tw-gradient-from: #f97316;
        }

        .hover\:to-green-600:hover {
            --tw-gradient-to: #16a34a;
        }

        .hover\:to-blue-600:hover {
            --tw-gradient-to: #2563eb;
        }

        .hover\:to-orange-600:hover {
            --tw-gradient-to: #ea580c;
        }

        .hover\:bg-gray-700:hover {
            background-color: #374151;
        }

        .hover\:bg-red-500\/20:hover {
            background-color: rgba(239, 68, 68, 0.2);
        }

        .hover\:text-red-300:hover {
            color: #fca5a5;
        }

        .hover\:scale-105:hover {
            transform: scale(1.05);
        }

        .hover\:scale-\[1\.02\]:hover {
            transform: scale(1.02);
        }

        .scale-105 {
            transform: scale(1.05);
        }

        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        .transition-transform {
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        .duration-300 {
            transition-duration: 300ms;
        }

        .opacity-30 {
            opacity: 0.3;
        }

        .opacity-80 {
            opacity: 0.8;
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .shadow-xl {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .hover\:shadow-xl:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .cursor-default {
            cursor: default;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .whitespace-nowrap {
            white-space: nowrap;
        }

        .chart-category-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 9999px;
            padding: 0.35rem 0.9rem;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(71, 85, 105, 0.6);
            background: rgba(15, 23, 42, 0.8);
            color: rgba(148, 163, 184, 0.9);
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35), 0 4px 12px rgba(15, 23, 42, 0.45);
        }

        .chart-category-btn:hover {
            border-color: rgba(16, 185, 129, 0.35);
            color: rgba(226, 232, 240, 0.95);
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.45), 0 6px 18px rgba(16, 185, 129, 0.15);
        }

        .chart-category-btn.active {
            border-color: rgba(16, 185, 129, 0.6);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(6, 95, 70, 0.35));
            color: rgba(240, 253, 244, 0.95);
            box-shadow: inset 0 0 0 1px rgba(16, 185, 129, 0.35), 0 10px 24px rgba(16, 185, 129, 0.25);
        }

        .chart-category-dot {
            display: inline-flex;
            height: 0.5rem;
            width: 0.5rem;
            border-radius: 9999px;
            box-shadow: 0 0 8px currentColor;
        }

        .chart-mode-btn {
            border-radius: 9999px;
            padding: 0.35rem 0.9rem;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(71, 85, 105, 0.6);
            background: rgba(15, 23, 42, 0.8);
            color: rgba(148, 163, 184, 0.9);
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35), 0 4px 12px rgba(15, 23, 42, 0.45);
        }

        .chart-mode-btn:hover {
            border-color: rgba(96, 165, 250, 0.35);
            color: rgba(226, 232, 240, 0.95);
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.45), 0 6px 18px rgba(59, 130, 246, 0.15);
        }

        .chart-mode-btn.active {
            border-color: rgba(96, 165, 250, 0.6);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(37, 99, 235, 0.35));
            color: rgba(239, 246, 255, 0.95);
            box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.35), 0 10px 24px rgba(59, 130, 246, 0.25);
        }

        .chart-reset-btn {
            margin-left: auto;
            border-radius: 9999px;
            border: 1px solid rgba(71, 85, 105, 0.6);
            background: rgba(15, 23, 42, 0.8);
            padding: 0.35rem 0.9rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(203, 213, 225, 0.9);
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35), 0 4px 12px rgba(15, 23, 42, 0.45);
        }

        .chart-reset-btn:hover {
            border-color: rgba(16, 185, 129, 0.45);
            color: rgba(236, 253, 245, 0.95);
            box-shadow: inset 0 0 0 1px rgba(16, 185, 129, 0.3), 0 6px 18px rgba(16, 185, 129, 0.18);
        }

        .transform {
            transform: translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));
        }

        .rotate-180 {
            --tw-rotate: 180deg;
        }

        .block {
            display: block;
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
        }

        .focus\:border-green-400:focus {
            border-color: #4ade80;
        }

        .focus\:border-orange-400:focus {
            border-color: #fb923c;
        }

        .border-pink-500\/30 {
            border-color: rgba(236, 72, 153, 0.3);
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        @media (min-width: 640px) {
            .sm\:mb-3 {
                margin-bottom: 0.75rem;
            }

            .sm\:mb-4 {
                margin-bottom: 1rem;
            }

            .sm\:mb-8 {
                margin-bottom: 2rem;
            }

            .sm\:mb-10 {
                margin-bottom: 2.5rem;
            }

            .sm\:p-3 {
                padding: 0.75rem;
            }

            .sm\:p-4 {
                padding: 1rem;
            }

            .sm\:p-5 {
                padding: 1.25rem;
            }

            .sm\:p-6 {
                padding: 1.5rem;
            }

            .sm\:px-6 {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }

            .sm\:px-8 {
                padding-left: 2rem;
                padding-right: 2rem;
            }

            .sm\:gap-3 {
                gap: 0.75rem;
            }

            .sm\:gap-6 {
                gap: 1.5rem;
            }

            .sm\:text-sm {
                font-size: 0.875rem;
            }

            .sm\:text-base {
                font-size: 1rem;
            }

            .sm\:text-lg {
                font-size: 1.125rem;
            }

            .sm\:text-2xl {
                font-size: 1.5rem;
            }

            .sm\:text-3xl {
                font-size: 1.875rem;
            }

            .sm\:text-5xl {
                font-size: 3rem;
            }

            .sm\:flex-row {
                flex-direction: row;
            }

            .sm\:flex-initial {
                flex: 0 1 auto;
            }

            .sm\:w-auto {
                width: auto;
            }
        }

        @media (min-width: 768px) {
            .md\:grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .md\:grid-cols-4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .lg\:grid-cols-4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }

        select,
        input {
            background-color: transparent;
            color: #f3f4f6;
        }

        select option {
            background-color: #1f2937;
            color: #f3f4f6;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .max-h-\[650px\] {
            max-height: 650px;
        }

        .bg-gradient-to-br.from-gray-800\/50.to-gray-900\/50 {
            background: linear-gradient(to bottom right, rgba(31, 41, 55, 0.5), rgba(17, 24, 39, 0.5));
        }

        .group {
            position: relative;
        }

        .group:hover .group-hover\:opacity-100 {
            opacity: 1;
        }

        .pointer-events-none {
            pointer-events: none;
        }

        .relative {
            position: relative;
        }

        .absolute {
            position: absolute;
        }

        .top-full {
            top: 100%;
        }

        .right-0 {
            right: 0;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .opacity-0 {
            opacity: 0;
        }

        /* ÏõêÌòï Ï∞®Ìä∏ & Ïπ¥ÌÖåÍ≥†Î¶¨ Ïπ¥Îìú Î∞òÏùëÌòï Î†àÏù¥ÏïÑÏõÉ */
        .category-chart-container {
            display: flex;
            gap: 32px;
            align-items: center;
            justify-content: space-between;
        }

        .chart-wrapper {
            flex-shrink: 0;
        }

        .chart-canvas-wrapper {
            width: 480px;
            height: 480px;
            position: relative;
        }

        .category-cards-wrapper {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-end;
        }

        .category-card {
            width: 450px;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï (768px Ïù¥Ìïò) */
        @media (max-width: 768px) {
            .category-chart-container {
                flex-direction: column;
                gap: 24px;
                align-items: center;
            }

            .chart-wrapper {
                width: 100%;
                display: flex;
                justify-content: center;
            }

            .chart-canvas-wrapper {
                width: 320px;
                height: 320px;
            }

            .category-cards-wrapper {
                width: 100%;
                align-items: stretch;
                gap: 8px;
            }

            .category-card {
                width: 100%;
                max-width: 100%;
            }
        }

        /* ÏûëÏùÄ Î™®Î∞îÏùº (480px Ïù¥Ìïò) */
        @media (max-width: 480px) {
            .chart-canvas-wrapper {
                width: 280px;
                height: 280px;
            }

            .category-card {
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const useState = React.useState;
        const useRef = React.useRef;
        const Calendar = "calendar";
        const DollarSign = "dollar-sign";
        const Check = "check";
        const TrendingUp = "trending-up";
        const Edit = "edit";
        const Plus = "plus";
        const Trash2 = "trash-2";
        const User = "user";
        const Package = "package";
        const CreditCard = "credit-card";
        const X = "x";
        const Info = "info";
        const Clock = "clock";

        // Firebase Ï¥àÍ∏∞Ìôî
        const firebaseConfig = {
            apiKey: "AIzaSyC9Nqji4jQe8po0BFfMo8czGSkXLuI2H3U",
            authDomain: "neofit-paycalc.firebaseapp.com",
            projectId: "neofit-paycalc",
            storageBucket: "neofit-paycalc.firebasestorage.app",
            messagingSenderId: "1072136228278",
            appId: "1:1072136228278:web:5d3be856d357b273900517",
            measurementId: "G-YWWC4R2EP4"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Ïù∏Ï¶ù ÏÑúÎπÑÏä§
        const authService = {
            loginWithEmail: async (email, password) => {
                try {
                    const result = await auth.signInWithEmailAndPassword(email, password);
                    return { success: true, user: result.user };
                } catch (error) {
                    console.error('Login error:', error);
                    return { success: false, error: error.message };
                }
            },

            signUpWithEmail: async (email, password) => {
                try {
                    const result = await auth.createUserWithEmailAndPassword(email, password);
                    return { success: true, user: result.user };
                } catch (error) {
                    console.error('SignUp error:', error);
                    return { success: false, error: error.message };
                }
            },

            logout: async () => {
                try {
                    await auth.signOut();
                    return { success: true };
                } catch (error) {
                    console.error('Logout error:', error);
                    return { success: false, error: error.message };
                }
            },

            subscribeToAuthChanges: (callback) => {
                return auth.onAuthStateChanged(callback);
            }
        };

        // Îß§Ï∂ú ÏÑúÎπÑÏä§
        const salesService = {
            saveSalesData: async (dateKey, data) => {
                try {
                    await db.collection('sales').doc(dateKey).set({
                        ...data,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    console.error('Save error:', error);
                    return { success: false, error: error.message };
                }
            },

            loadSalesData: async (dateKey) => {
                try {
                    const doc = await db.collection('sales').doc(dateKey).get();
                    if (doc.exists) {
                        return doc.data();
                    }
                    return null;
                } catch (error) {
                    console.error('Load error:', error);
                    return null;
                }
            },

            subscribeToMonthData: (year, month, callback) => {
                const startDate = `${year}-${String(month + 1).padStart(2, '0')}-01`;
                const endDate = `${year}-${String(month + 1).padStart(2, '0')}-31`;

                return db.collection('sales')
                    .where('date', '>=', startDate)
                    .where('date', '<=', endDate)
                    .onSnapshot((snapshot) => {
                        const data = {};
                        snapshot.forEach(doc => {
                            data[doc.id] = doc.data();
                        });
                        callback(data);
                    });
            },

            searchCustomerInAllData: async (customerName) => {
                try {
                    const snapshot = await db.collection('sales').get();
                    const results = [];

                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.details && Array.isArray(data.details)) {
                            data.details.forEach(detail => {
                                if (detail.customerName && detail.customerName.toLowerCase().includes(customerName.toLowerCase())) {
                                    results.push({
                                        ...detail,
                                        date: doc.id
                                    });
                                }
                            });
                        }
                    });

                    return { success: true, data: results };
                } catch (error) {
                    console.error('ÌöåÏõê Í≤ÄÏÉâ Ïò§Î•ò:', error);
                    return { success: false, error: error.message };
                }
            }
        };

        const hexToRgb = (hex) => {
            if (!hex) return { r: 255, g: 255, b: 255 };
            let normalized = hex.replace('#', '');
            if (normalized.length === 3) {
                normalized = normalized.split('').map(char => char + char).join('');
            }
            const intVal = parseInt(normalized, 16);
            return {
                r: (intVal >> 16) & 255,
                g: (intVal >> 8) & 255,
                b: intVal & 255
            };
        };

        const withAlpha = (hex, alpha) => {
            const { r, g, b } = hexToRgb(hex);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        };

        const getClothingAmount = (productName) => {
            if (!productName) return null;
            const normalized = productName.toString();

            const matchNamed = normalized.match(/ÎùΩÏª§\s*:?\s*(\d+)Í∞úÏõî|Ïö¥ÎèôÎ≥µ\s*:?\s*(\d+)Í∞úÏõî/);
            if (matchNamed) {
                const months = parseInt(matchNamed[1] || matchNamed[2], 10);
                if (Number.isFinite(months) && months > 0) {
                    return months * 10000;
                }
            }

            const general = normalized.match(/(ÎùΩÏª§|Ïö¥ÎèôÎ≥µ)[^0-9]*([0-9]{1,3})\s*Í∞úÏõî/);
            if (general) {
                const months = parseInt(general[2], 10);
                if (Number.isFinite(months) && months > 0) {
                    return months * 10000;
                }
            }

            return null;
        };

        const MONTH_CHART_OFFSETS = [-5, -4, -3, -2, -1, 0];
        const CATEGORY_KEYS = ['health', 'neofit', 'pt', 'pilates', 'clothing', 'etc'];
        const DISCOUNT_ELIGIBLE_CATEGORIES = new Set(['health', 'neofit', 'pt', 'pilates', 'etc']);
        const DISCOUNT_PALETTE = {
            health: {
                accent: '#34d399',
                cardBg: 'linear-gradient(135deg, rgba(16,185,129,0.22), rgba(6,182,212,0.10))',
                cardBorder: 'rgba(52,211,153,0.45)',
                cardShadow: '0 10px 26px rgba(16,185,129,0.18)',
                inputBg: 'rgba(16,185,129,0.15)',
                inputBorder: 'rgba(52,211,153,0.35)',
            },
            neofit: {
                accent: '#60a5fa',
                cardBg: 'linear-gradient(135deg, rgba(96,165,250,0.22), rgba(59,130,246,0.12))',
                cardBorder: 'rgba(96,165,250,0.45)',
                cardShadow: '0 10px 26px rgba(37,99,235,0.18)',
                inputBg: 'rgba(96,165,250,0.15)',
                inputBorder: 'rgba(59,130,246,0.35)',
            },
            pt: {
                accent: '#fbbf24',
                cardBg: 'linear-gradient(135deg, rgba(251,191,36,0.22), rgba(245,158,11,0.12))',
                cardBorder: 'rgba(251,191,36,0.45)',
                cardShadow: '0 10px 26px rgba(251,191,36,0.18)',
                inputBg: 'rgba(251,191,36,0.18)',
                inputBorder: 'rgba(245,158,11,0.35)',
            },
            pilates: {
                accent: '#fb7185',
                cardBg: 'linear-gradient(135deg, rgba(251,113,133,0.20), rgba(244,114,182,0.12))',
                cardBorder: 'rgba(251,113,133,0.35)',
                cardShadow: '0 10px 26px rgba(244,114,182,0.16)',
                inputBg: 'rgba(251,113,133,0.12)',
                inputBorder: 'rgba(251,113,133,0.28)',
            },
            clothing: {
                accent: '#a855f7',
                cardBg: 'linear-gradient(135deg, rgba(168,85,247,0.20), rgba(139,92,246,0.12))',
                cardBorder: 'rgba(168,85,247,0.35)',
                cardShadow: '0 10px 26px rgba(139,92,246,0.16)',
                inputBg: 'rgba(168,85,247,0.10)',
                inputBorder: 'rgba(168,85,247,0.25)',
            },
            etc: {
                accent: '#94a3b8',
                cardBg: 'linear-gradient(135deg, rgba(148,163,184,0.20), rgba(100,116,139,0.12))',
                cardBorder: 'rgba(148,163,184,0.35)',
                cardShadow: '0 10px 26px rgba(100,116,139,0.16)',
                inputBg: 'rgba(148,163,184,0.12)',
                inputBorder: 'rgba(148,163,184,0.25)',
            },
            default: {
                accent: '#a5b4fc',
                cardBg: 'linear-gradient(135deg, rgba(129,140,248,0.18), rgba(165,180,252,0.12))',
                cardBorder: 'rgba(129,140,248,0.35)',
                cardShadow: '0 10px 26px rgba(99,102,241,0.16)',
                inputBg: 'rgba(129,140,248,0.12)',
                inputBorder: 'rgba(129,140,248,0.25)',
            },
        };
        const CHART_CATEGORY_META = [
            { key: 'health', label: 'Ìó¨Ïä§', icon: 'üèÉ‚Äç‚ôÇÔ∏è', color: '#34d399' },
            { key: 'neofit', label: 'ÎÑ§Ïò§Ìïè', icon: 'üî•', color: '#60a5fa' },
            { key: 'pt', label: 'PT', icon: 'üèãÔ∏è', color: '#fbbf24' },
            { key: 'pilates', label: 'ÌïÑÎùºÌÖåÏä§', icon: 'üßò‚Äç‚ôÄÔ∏è', color: '#fb7185' },
            { key: 'etc', label: 'Í∏∞ÌÉÄ', icon: 'üßæ', color: '#94a3b8' }
        ];

        const MonthlyRevenueChart = React.memo(({ selectedYear, selectedMonth, calculateMonthlyCategorySales }) => {
            const canvasRef = React.useRef(null);
            const chartRef = React.useRef(null);
            const [chartMode, setChartMode] = React.useState('area');
            const [activeKeys, setActiveKeys] = React.useState(CHART_CATEGORY_META.map(category => category.key));

            const chartData = React.useMemo(() => {
                const safeYear = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
                const safeMonth = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
                const baseDate = new Date(safeYear, safeMonth, 1);

                const labels = [];
                const datasets = {};
                CHART_CATEGORY_META.forEach(category => {
                    datasets[category.key] = [];
                });
                const totalsPerMonth = [];

                MONTH_CHART_OFFSETS.forEach(offset => {
                    const targetDate = new Date(baseDate.getFullYear(), baseDate.getMonth() + offset, 1);
                    const year = targetDate.getFullYear();
                    const monthNumber = targetDate.getMonth() + 1;
                    labels.push(`${monthNumber}Ïõî`);

                    let monthSum = 0;
                    CHART_CATEGORY_META.forEach(category => {
                        const value = Math.max(0, Number(calculateMonthlyCategorySales(year, monthNumber, category.key, true)) || 0);
                        datasets[category.key].push(value);
                        monthSum += value;
                    });
                    totalsPerMonth.push(monthSum);
                });

                const rawMax = Math.max(...Object.values(datasets).flat(), 0);

                return { labels, datasets, totalsPerMonth, maxValue: rawMax };
            }, [selectedYear, selectedMonth, calculateMonthlyCategorySales]);

            React.useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas || !(window.Chart || window.ChartJS)) {
                    return;
                }
                const ctx = canvas.getContext('2d');

                if (chartRef.current) {
                    chartRef.current.destroy();
                }

                const activeSet = new Set(activeKeys);
                const includedCategories = chartMode === 'stacked'
                    ? CHART_CATEGORY_META
                    : CHART_CATEGORY_META.filter(category => activeSet.has(category.key));

                if (includedCategories.length === 0 || chartData.labels.length === 0) {
                    chartRef.current = null;
                    return () => { };
                }

                const maxVisibleValue = includedCategories.reduce((max, category) => {
                    const series = chartData.datasets[category.key] || [];
                    const adjustedSeries = (chartMode === 'stacked' && !activeSet.has(category.key))
                        ? series.map(() => 0)
                        : series;
                    const seriesMax = adjustedSeries.length > 0 ? Math.max(...adjustedSeries) : 0;
                    return Math.max(max, seriesMax);
                }, 0);

                const suggestedMax = maxVisibleValue > 0
                    ? Math.max(Math.ceil((maxVisibleValue * 1.1) / 500000) * 500000, 500000)
                    : 500000;

                const buildGradient = (color, hidden) => {
                    const height = canvas.parentElement?.clientHeight || 280;
                    const gradient = ctx.createLinearGradient(0, 0, 0, height);
                    gradient.addColorStop(0, withAlpha(color, hidden ? 0.15 : 0.3));
                    gradient.addColorStop(1, withAlpha(color, 0));
                    return gradient;
                };

                const visibleTotalsPerMonth = chartData.labels.map((_, index) =>
                    includedCategories.reduce((sum, category) => {
                        const series = chartData.datasets[category.key] || [];
                        const value = series[index] || 0;
                        if (chartMode === 'stacked') {
                            return activeSet.has(category.key) ? sum + value : sum;
                        }
                        return sum + value;
                    }, 0)
                );

                const datasets = CHART_CATEGORY_META.map(category => {
                    const baseSeries = chartData.datasets[category.key] || [];
                    const isActive = activeSet.has(category.key);

                    if (chartMode === 'stacked') {
                        const data = isActive ? baseSeries : baseSeries.map(() => 0);
                        return {
                            type: 'bar',
                            stack: 'total',
                            label: `${category.icon} ${category.label}`,
                            data,
                            backgroundColor: withAlpha(category.color, isActive ? 0.75 : 0.18),
                            borderColor: 'transparent',
                            borderWidth: 0,
                            hidden: false
                        };
                    }

                    if (!isActive) {
                        return null;
                    }

                    return {
                        type: 'line',
                        label: `${category.icon} ${category.label}`,
                        data: baseSeries,
                        borderColor: withAlpha(category.color, 1),
                        borderWidth: 2.6,
                        tension: 0.35,
                        pointRadius: chartMode === 'area' ? 3.5 : 4,
                        pointHoverRadius: 6,
                        fill: chartMode === 'area',
                        backgroundColor: chartMode === 'area' ? buildGradient(category.color, false) : withAlpha(category.color, 0.12),
                        spanGaps: true
                    };
                }).filter(Boolean);

                const config = {
                    type: chartMode === 'stacked' ? 'bar' : 'line',
                    data: {
                        labels: chartData.labels,
                        datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#F9FAFB',
                                bodyColor: '#E5E7EB',
                                borderColor: '#374151',
                                borderWidth: 1,
                                displayColors: false,
                                callbacks: {
                                    title: (items) => {
                                        if (!items.length) return '';
                                        const monthLabel = items[0].label;
                                        const total = visibleTotalsPerMonth[items[0].dataIndex] || 0;
                                        return `${monthLabel} Ï¥ùÌï© ${total.toLocaleString()}Ïõê`;
                                    },
                                    label: (context) => {
                                        const value = context.parsed.y || 0;
                                        const dataIndex = context.dataIndex;

                                        // Ï†ÑÏõî Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                                        const prevValue = dataIndex > 0 ? (context.dataset.data[dataIndex - 1] || 0) : 0;

                                        // Ï†ÑÏõîÎåÄÎπÑ Ï¶ùÍ∞êÎ•† Í≥ÑÏÇ∞
                                        let changeText = '';
                                        if (dataIndex === 0) {
                                            changeText = ''; // Ï≤´ Îã¨ÏùÄ ÎπÑÍµê Î∂àÍ∞Ä
                                        } else if (prevValue === 0 && value > 0) {
                                            changeText = ' ¬∑ Ï†ÑÏõîÎåÄÎπÑ Ïã†Í∑ú';
                                        } else if (prevValue === 0 && value === 0) {
                                            changeText = ' ¬∑ Ï†ÑÏõîÎåÄÎπÑ 0%';
                                        } else {
                                            const change = ((value - prevValue) / prevValue * 100);
                                            const sign = change > 0 ? '+' : '';
                                            changeText = ` ¬∑ Ï†ÑÏõîÎåÄÎπÑ ${sign}${change.toFixed(1)}%`;
                                        }

                                        return `${context.dataset.label}: ${value.toLocaleString()}Ïõê${changeText}`;
                                    },
                                    labelTextColor: (context) => {
                                        const datasetLabel = context.dataset?.label || '';
                                        const matched = CHART_CATEGORY_META.find(meta => `${meta.icon} ${meta.label}` === datasetLabel);
                                        return matched ? matched.color : '#E5E7EB';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(100, 116, 139, 0.14)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#cbd5f5',
                                    font: {
                                        family: 'Pretendard, sans-serif',
                                        size: 12,
                                        weight: '500'
                                    }
                                },
                                stacked: chartMode === 'stacked'
                            },
                            y: {
                                beginAtZero: true,
                                suggestedMax,
                                grid: {
                                    color: 'rgba(100, 116, 139, 0.14)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#cbd5f5',
                                    font: {
                                        family: 'Pretendard, sans-serif',
                                        size: 12,
                                        weight: '500'
                                    },
                                    callback: (value) => {
                                        if (!Number.isFinite(value)) {
                                            return value;
                                        }

                                        if (value >= 100000000) {
                                            const billions = Math.floor(value / 100000000);
                                            const remainder = value % 100000000;
                                            if (remainder === 0) {
                                                return `${billions.toLocaleString()}Ïñµ`;
                                            }
                                            return `${billions.toLocaleString()}Ïñµ ${(remainder / 10000).toLocaleString()}Îßå`;
                                        }

                                        if (value >= 10000000) {
                                            const tenMillions = Math.floor(value / 10000000);
                                            const remainder = value % 10000000;
                                            if (remainder === 0) {
                                                return `${tenMillions}Ï≤úÎßå`;
                                            }
                                            if (remainder >= 1000000 && remainder % 1000000 === 0) {
                                                return `${tenMillions}Ï≤úÎßå ${remainder / 1000000}Î∞±Îßå`;
                                            }
                                            return `${(value / 10000).toLocaleString()}Îßå`;
                                        }

                                        if (value >= 1000000) {
                                            const millions = Math.floor(value / 1000000);
                                            const remainder = value % 1000000;
                                            if (remainder === 0) {
                                                return `${millions}Î∞±Îßå`;
                                            }
                                            return `${(value / 10000).toLocaleString()}Îßå`;
                                        }

                                        if (value >= 10000) {
                                            const tenThousands = value / 10000;
                                            return `${Number.isInteger(tenThousands) ? tenThousands.toLocaleString() : tenThousands.toFixed(1)}Îßå`;
                                        }

                                        return value.toLocaleString();
                                    }
                                },
                                stacked: chartMode === 'stacked'
                            }
                        }
                    }
                };

                const ChartCtor = window.Chart || window.ChartJS;
                chartRef.current = new ChartCtor(ctx, config);

                return () => {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                        chartRef.current = null;
                    }
                };
            }, [activeKeys, chartData, chartMode]);

            const toggleCategory = (key) => {
                setActiveKeys(prev => {
                    if (prev.includes(key)) {
                        const next = prev.filter(item => item !== key);
                        return next.length === 0 ? prev : next;
                    }
                    return [...prev, key];
                });
            };

            return (
                <div className="relative bg-gradient-to-br from-slate-950/80 via-slate-900/70 to-slate-950/80 rounded-xl border border-slate-800/60 p-6">
                    <div className="flex flex-wrap items-center gap-2 mb-4">
                        {CHART_CATEGORY_META.map(category => {
                            const isActive = activeKeys.includes(category.key);
                            return (
                                <button
                                    key={category.key}
                                    type="button"
                                    onClick={() => toggleCategory(category.key)}
                                    className={`chart-category-btn${isActive ? ' active' : ''}`}
                                >
                                    <span className="chart-category-dot" style={{ backgroundColor: category.color }}></span>
                                    <span>{category.icon} {category.label}</span>
                                </button>
                            );
                        })}
                        <button
                            type="button"
                            onClick={() => setActiveKeys(CHART_CATEGORY_META.map(category => category.key))}
                            className="chart-reset-btn"
                        >
                            Ï†ÑÏ≤¥ Î≥¥Í∏∞
                        </button>
                    </div>
                    <div className="flex flex-wrap items-center gap-2 mb-4 text-xs text-slate-400">
                        <span>Ï∞®Ìä∏ Ïú†Ìòï:</span>
                        {[
                            { value: 'area', label: 'ÏóêÏñ¥Î¶¨Ïñ¥' },
                            { value: 'line', label: 'ÎùºÏù∏' },
                            { value: 'stacked', label: 'Ïä§ÌÉù' }
                        ].map(mode => (
                            <button
                                key={mode.value}
                                type="button"
                                onClick={() => setChartMode(mode.value)}
                                className={`chart-mode-btn${chartMode === mode.value ? ' active' : ''}`}
                            >
                                {mode.label}
                            </button>
                        ))}
                    </div>
                    <div className="relative h-72">
                        <canvas ref={canvasRef}></canvas>
                    </div>
                </div>
            );
        });

        // ÌôòÍ≤Ω Î≥ÄÏàò ÎòêÎäî ÏÑ§Ï†ï
        const CONFIG = {
            ADMIN_PASSWORD: '4405', // Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏
            INCENTIVE_RATES: {
                full: {
                    40000000: 8,   // 4,000Îßå Ïõê Ïù¥ÏÉÅ: 8%
                    35000000: 7,   // 3,500Îßå Ïõê Ïù¥ÏÉÅ ~ 4,000Îßå Ïõê ÎØ∏Îßå: 7%
                    30000000: 6,   // 3,000Îßå Ïõê Ïù¥ÏÉÅ ~ 3,500Îßå Ïõê ÎØ∏Îßå: 6%
                    25000000: 5,   // 2,500Îßå Ïõê Ïù¥ÏÉÅ ~ 3,000Îßå Ïõê ÎØ∏Îßå: 5%
                    22000000: 4,   // 2,200Îßå Ïõê Ïù¥ÏÉÅ ~ 2,500Îßå Ïõê ÎØ∏Îßå: 4%
                    18000000: 3,   // 1,800Îßå Ïõê Ïù¥ÏÉÅ ~ 2,200Îßå Ïõê ÎØ∏Îßå: 3%
                    15000000: 2,   // 1,500Îßå Ïõê Ïù¥ÏÉÅ ~ 1,800Îßå Ïõê ÎØ∏Îßå: 2%
                    0: 0           // 1,500Îßå Ïõê ÎØ∏Îßå: 0%
                },
                part: {
                    40000000: 4,   // 4,000Îßå Ïõê Ïù¥ÏÉÅ: 4%
                    35000000: 3.5, // 3,500Îßå Ïõê Ïù¥ÏÉÅ ~ 4,000Îßå Ïõê ÎØ∏Îßå: 3.5%
                    30000000: 3,   // 3,000Îßå Ïõê Ïù¥ÏÉÅ ~ 3,500Îßå Ïõê ÎØ∏Îßå: 3%
                    25000000: 2.5, // 2,500Îßå Ïõê Ïù¥ÏÉÅ ~ 3,000Îßå Ïõê ÎØ∏Îßå: 2.5%
                    22000000: 2,   // 2,200Îßå Ïõê Ïù¥ÏÉÅ ~ 2,500Îßå Ïõê ÎØ∏Îßå: 2%
                    18000000: 1.5, // 1,800Îßå Ïõê Ïù¥ÏÉÅ ~ 2,200Îßå Ïõê ÎØ∏Îßå: 1.5%
                    15000000: 1,   // 1,500Îßå Ïõê Ïù¥ÏÉÅ ~ 1,800Îßå Ïõê ÎØ∏Îßå: 1%
                    0: 0           // 1,500Îßå Ïõê ÎØ∏Îßå: 0%
                }
            }
        };

        const NeoFitPayCalc = () => {
            const [salesData, setSalesData] = useState({});
            const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
            const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
            const [approvalPasswords, setApprovalPasswords] = useState({});
            const [editPasswords, setEditPasswords] = useState({});
            const [employeeType, setEmployeeType] = useState('full');
            const [customerName, setCustomerName] = useState({});
            const [selectedProducts, setSelectedProducts] = useState({});
            const [customPrices, setCustomPrices] = useState({});
            const [expandedDays, setExpandedDays] = useState({});
            const [checkedDetails, setCheckedDetails] = useState({});
            const [showAddSaleModal, setShowAddSaleModal] = useState(false);
            const [selectedModalDay, setSelectedModalDay] = useState(null);
            const [editingDetailContext, setEditingDetailContext] = useState(null);
            const [viewMode, setViewMode] = useState('daily'); // 'daily', 'weekly', 'monthly'
            const dailyViewRef = React.useRef(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [showSearchResultModal, setShowSearchResultModal] = useState(false);
            const [searchResults, setSearchResults] = useState([]);
            const [showCalendarModal, setShowCalendarModal] = useState(false);
            const [showPilatesModal, setShowPilatesModal] = useState(false);
            const [showHealthModal, setShowHealthModal] = useState(false);
            const [showNeofitModal, setShowNeofitModal] = useState(false);
            const [showClothingLockerModal, setShowClothingLockerModal] = useState(false);
            const [showPtModal, setShowPtModal] = useState(false);
            const [showOtherModal, setShowOtherModal] = useState(false);
            const [showDetailModal, setShowDetailModal] = useState(false);
            const [selectedDetailEntry, setSelectedDetailEntry] = useState(null);

            // Î™®Î∞îÏùº ÏùºÎ≥Ñ ÏÉÅÏÑ∏ Î™®Îã¨ ÏÉÅÌÉú
            const [mobileExpandedDay, setMobileExpandedDay] = useState(null);
            const [isMobile, setIsMobile] = useState(window.innerWidth < 640);

            // Î™®Î∞îÏùº Í∞êÏßÄ Ïù¥Î≤§Ìä∏
            React.useEffect(() => {
                const handleResize = () => {
                    setIsMobile(window.innerWidth < 640);
                };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            // Firebase Ïù∏Ï¶ù ÏÉÅÌÉú
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            // dailySales ÏÉÅÌÉú Ï∂îÍ∞Ä - ÏõîÎ≥Ñ Î¶¨Ìè¨Ìä∏ Ï∞®Ìä∏Î•º ÏúÑÌïú Îç∞Ïù¥ÌÑ∞
            const [dailySales, setDailySales] = useState([]);

            // Ï†ÑÏ≤¥ Ïó∞ÎèÑ Îç∞Ïù¥ÌÑ∞ (ÏõîÎ≥Ñ Î¶¨Ìè¨Ìä∏ Ï∞®Ìä∏Ïö©)
            const [yearlyDailySales, setYearlyDailySales] = useState([]);

            const [dataRefreshToken, setDataRefreshToken] = useState(0);

            const normalizeAmount = (value) => {
                try {
                    if (typeof value === 'number') {
                        return Number.isFinite(value) ? value : 0;
                    }

                    if (typeof value === 'string') {
                        const cleaned = value.replace(/[^0-9.-]/g, '');
                        if (!cleaned) return 0;
                        const numeric = Number(cleaned);
                        return Number.isFinite(numeric) ? numeric : 0;
                    }

                    if (value && typeof value.toString === 'function') {
                        const cleaned = value.toString().replace(/[^0-9.-]/g, '');
                        if (!cleaned) return 0;
                        const numeric = Number(cleaned);
                        return Number.isFinite(numeric) ? numeric : 0;
                    }

                    return 0;
                } catch (error) {
                    console.error('normalizeAmount error:', error);
                    return 0;
                }
            };

            const EMPTY_DAY_TEMPLATE = {
                amount: 0,
                approved: false,
                details: [],
            };

            const normalizeDetailList = (details) => {
                if (!Array.isArray(details)) {
                    return [];
                }

                return details.map(detail => {
                    const hasOriginalTotal = detail.originalTotal !== undefined && detail.originalTotal !== null;
                    const hasDiscountTotal = detail.discountTotal !== undefined && detail.discountTotal !== null;

                    const normalizedLineItems = Array.isArray(detail.lineItems)
                        ? detail.lineItems.map(item => {
                            const originalPrice = item.originalPrice !== undefined && item.originalPrice !== null
                                ? normalizeAmount(item.originalPrice)
                                : normalizeAmount(item.displayPrice ?? item.price);
                            const finalPrice = item.finalPrice !== undefined && item.finalPrice !== null
                                ? normalizeAmount(item.finalPrice)
                                : normalizeAmount(item.price ?? originalPrice);
                            const discountAmount = item.discountAmount !== undefined && item.discountAmount !== null
                                ? normalizeAmount(item.discountAmount)
                                : Math.max(0, originalPrice - finalPrice);

                            return {
                                ...item,
                                product: item.product || item.displayName || item.name || '',
                                categoryKey: item.categoryKey || item.category || '',
                                originalPrice,
                                finalPrice,
                                discountAmount,
                                discountEligible: item.discountEligible ?? DISCOUNT_ELIGIBLE_CATEGORIES.has(item.categoryKey || item.category || '')
                            };
                        })
                        : undefined;

                    const normalizedOriginalTotal = hasOriginalTotal
                        ? normalizeAmount(detail.originalTotal)
                        : (normalizedLineItems ? normalizedLineItems.reduce((sum, item) => sum + (item.originalPrice || 0), 0) : undefined);

                    const normalizedDiscountTotal = hasDiscountTotal
                        ? normalizeAmount(detail.discountTotal)
                        : (normalizedLineItems ? normalizedLineItems.reduce((sum, item) => sum + (item.discountAmount || 0), 0) : undefined);

                    const normalizedDetail = {
                        ...detail,
                        price: normalizeAmount(detail?.price)
                    };

                    if (normalizedLineItems && normalizedLineItems.length > 0) {
                        normalizedDetail.lineItems = normalizedLineItems;
                    } else {
                        delete normalizedDetail.lineItems;
                    }

                    if (normalizedOriginalTotal !== undefined && normalizedOriginalTotal !== null) {
                        normalizedDetail.originalTotal = normalizedOriginalTotal;
                    } else {
                        delete normalizedDetail.originalTotal;
                    }

                    if (normalizedDiscountTotal !== undefined && normalizedDiscountTotal !== null) {
                        normalizedDetail.discountTotal = normalizedDiscountTotal;
                    } else {
                        delete normalizedDetail.discountTotal;
                    }

                    return normalizedDetail;
                });
            };

            const normalizeSalesEntry = (entry = {}) => {
                const details = normalizeDetailList(entry.details);
                const detailsTotal = details.reduce((sum, detail) => sum + (detail.price || 0), 0);
                const amount = detailsTotal > 0 ? detailsTotal : normalizeAmount(entry.amount);

                return {
                    ...EMPTY_DAY_TEMPLATE,
                    ...entry,
                    amount,
                    details,
                };
            };

            const normalizeSalesMap = (data = {}) => Object.entries(data || {}).reduce((acc, [dateKey, rawEntry]) => {
                const normalizedEntry = normalizeSalesEntry(rawEntry);
                acc[dateKey] = {
                    ...normalizedEntry,
                    date: normalizedEntry.date || dateKey,
                };
                return acc;
            }, {});

            function calculateIndividualProductPrice(productName) {
                if (!productName) {
                    return 0;
                }

                if (productPrices && productPrices[productName]) {
                    return productPrices[productName];
                }

                const clothingRegex = /(Ïö¥ÎèôÎ≥µ|ÎùΩÏª§)[^0-9]*([0-9]{1,3})\s*Í∞úÏõî/;
                const clothingMatchGeneral = productName.match(clothingRegex);
                if (clothingMatchGeneral) {
                    const months = parseInt(clothingMatchGeneral[2], 10);
                    if (Number.isFinite(months) && months > 0) {
                        return months * 10000;
                    }
                }

                const lockerMatch = productName.match(/ÎùΩÏª§\s*:?\s*(\d+)Í∞úÏõî/);
                if (lockerMatch) {
                    const lockerKey = `ÎùΩÏª§ ${lockerMatch[1]}Í∞úÏõî`;
                    return productPrices?.[lockerKey] || 0;
                }

                const clothingMatch = productName.match(/Ïö¥ÎèôÎ≥µ\s*:?\s*(\d+)Í∞úÏõî/);
                if (clothingMatch) {
                    const clothingKey = `Ïö¥ÎèôÎ≥µ ${clothingMatch[1]}Í∞úÏõî`;
                    return productPrices?.[clothingKey] || 0;
                }

                if (productName.includes('ÌïÑÎùºÌÖåÏä§:')) {
                    const cleanName = productName.replace('ÌïÑÎùºÌÖåÏä§:', '').trim();
                    return productPrices?.[cleanName] || 0;
                }

                if (productName.includes('ÎÑ§Ïò§Ìïè:')) {
                    const cleanName = productName.replace('ÎÑ§Ïò§Ìïè:', '').trim();
                    return productPrices?.[`ÎÑ§Ïò§Ìïè ${cleanName}`] || productPrices?.[cleanName] || 0;
                }

                if (productName.includes('Ìó¨Ïä§:')) {
                    const cleanName = productName.replace('Ìó¨Ïä§:', '').trim();
                    return productPrices?.[cleanName] || 0;
                }

                if (productName.includes('PT:')) {
                    const cleanName = productName.replace('PT:', '').trim();
                    return productPrices?.[cleanName] || 0;
                }

                if (productName.includes('Ï≤¥Ìóò') && !productName.includes('ÎÑ§Ïò§Ìïè')) {
                    const direct = productPrices?.[productName];
                    if (direct) return direct;

                    const match = productName.match(/(\d+Ìöå)\s*Ï≤¥Ìóò|Ï≤¥Ìóò(\d+Ìöå)/);
                    if (match) {
                        const key = `${match[1] || match[2]} Ï≤¥Ìóò`;
                        return productPrices?.[key] || 0;
                    }
                }

                if (productName.includes('Í∑ºÏù∏ÏùºÏùºÍ∂å')) {
                    return productPrices?.['Í∑ºÏù∏ÏùºÏùºÍ∂å'] || 10000;
                }

                if (productName.includes('ÏùºÏùºÍ∂å')) {
                    return productPrices?.['ÏùºÏùºÍ∂å'] || 10000;
                }

                const numberMatch = productName.match(/(\d+)/);
                if (numberMatch && numberMatch[1]) {
                    const extracted = parseInt(numberMatch[1], 10);
                    if (Number.isFinite(extracted) && extracted >= 1000 && extracted <= 5000000) {
                        return extracted;
                    }
                }

                return 0;
            }

            function splitProductEntries(detail, dayData, dateKey) {
                if (!detail) {
                    return [];
                }

                const rawProduct = (detail.product || '').toString().trim();
                if (!rawProduct) {
                    return [];
                }

                const clothingAmountOverride = getClothingAmount(rawProduct);
                const normalizedDetailPrice = normalizeAmount(detail.price);
                const baseEntry = {
                    date: dateKey,
                    category: detail.category || '',
                    type: detail.type || '',
                    customerName:
                        detail.customerName ||
                        detail.name ||
                        detail.customer ||
                        (dayData && (dayData.customerName || dayData.customer)) ||
                        '',
                    name:
                        detail.customerName ||
                        detail.name ||
                        detail.customer ||
                        (dayData && (dayData.customerName || dayData.customer)) ||
                        '',
                    approved: dayData.approved || false,
                    timestamp: detail.timestamp || dayData.timestamp || ''
                };

                if (Array.isArray(detail.lineItems) && detail.lineItems.length > 0) {
                    return detail.lineItems.map(item => {
                        const productName = (item.product || item.displayName || item.productName || rawProduct || '').toString();
                        const originalPrice = item.originalPrice !== undefined && item.originalPrice !== null
                            ? normalizeAmount(item.originalPrice)
                            : normalizeAmount(item.displayPrice ?? item.price);
                        const finalPrice = item.finalPrice !== undefined && item.finalPrice !== null
                            ? normalizeAmount(item.finalPrice)
                            : normalizeAmount(item.price ?? originalPrice);
                        const discountAmount = item.discountAmount !== undefined && item.discountAmount !== null
                            ? normalizeAmount(item.discountAmount)
                            : Math.max(0, originalPrice - finalPrice);
                        const categoryKey = item.categoryKey || deriveCategoryKey({ product: productName });

                        return {
                            ...baseEntry,
                            product: productName,
                            category: categoryKey || baseEntry.category,
                            price: finalPrice > 0 ? finalPrice : 0,
                            displayPrice: originalPrice > 0 ? originalPrice : (finalPrice > 0 ? finalPrice : 0),
                            originalPrice,
                            discountAmount,
                            discountEligible: item.discountEligible ?? DISCOUNT_ELIGIBLE_CATEGORIES.has(categoryKey || ''),
                            source: 'line-item'
                        };
                    });
                }

                const productParts = rawProduct
                    .split(',')
                    .flatMap(part => part.split('+'))
                    .map(part => part.trim())
                    .filter(Boolean);

                if (productParts.length <= 1) {
                    const basePrice = clothingAmountOverride !== null
                        ? clothingAmountOverride
                        : normalizeAmount(calculateIndividualProductPrice(rawProduct));
                    const effectivePrice = normalizedDetailPrice > 0 ? normalizedDetailPrice : basePrice;
                    const price = effectivePrice > 0 ? effectivePrice : 0;
                    const originalPrice = basePrice > 0 ? basePrice : price;
                    return [{
                        ...baseEntry,
                        product: rawProduct,
                        price,
                        originalPrice,
                        displayPrice: originalPrice,
                        source: 'detail'
                    }];
                }

                const components = productParts.map(part => {
                    const clothingComponentAmount = getClothingAmount(part);
                    const basePrice = clothingComponentAmount !== null
                        ? clothingComponentAmount
                        : normalizeAmount(calculateIndividualProductPrice(part));
                    return {
                        name: part,
                        basePrice,
                    };
                });

                const baseSum = components.reduce((sum, component) => sum + (component.basePrice > 0 ? component.basePrice : 0), 0);
                const targetTotal = normalizedDetailPrice > 0 ? normalizedDetailPrice : baseSum;

                let prices;
                if (baseSum > 0 && targetTotal > 0) {
                    const factor = targetTotal / baseSum;
                    let accumulated = 0;
                    prices = components.map((component, index) => {
                        if (index === components.length - 1) {
                            return Math.max(0, targetTotal - accumulated);
                        }
                        const adjusted = Math.max(0, Math.round(component.basePrice * factor));
                        accumulated += adjusted;
                        return adjusted;
                    });
                } else if (targetTotal > 0) {
                    const equalShare = Math.floor(targetTotal / components.length);
                    let remainder = targetTotal - equalShare * components.length;
                    prices = components.map((_, index) => {
                        const value = equalShare + (index === components.length - 1 ? remainder : 0);
                        return value > 0 ? value : 0;
                    });
                } else {
                    prices = components.map(() => 0);
                }

                return components.map((component, index) => {
                    const price = prices[index] > 0 ? prices[index] : 0;
                    const originalPrice = component.basePrice > 0 ? component.basePrice : price;
                    return {
                        ...baseEntry,
                        product: component.name,
                        price,
                        originalPrice,
                        displayPrice: originalPrice,
                        source: 'component'
                    };
                });
            }

            const ensureNumeric = (value, fallback) => (typeof value === 'number' && Number.isFinite(value) ? value : fallback);
            const getActiveYearMonth = () => {
                const today = new Date();
                const year = ensureNumeric(selectedYear, today.getFullYear());
                const monthIndex = ensureNumeric(selectedMonth, today.getMonth());
                return { year, monthIndex };
            };

            const extractSaleYearMonth = (sale) => {
                if (!sale) {
                    return null;
                }
                const rawDate = sale.date || sale.dateKey || sale.dateString || sale.createdAt;
                if (!rawDate) {
                    return null;
                }
                if (rawDate instanceof Date && !Number.isNaN(rawDate.getTime())) {
                    return {
                        year: rawDate.getFullYear(),
                        monthIndex: rawDate.getMonth(),
                    };
                }
                if (typeof rawDate === 'string') {
                    const normalized = rawDate.trim();
                    const match = normalized.match(/(\d{4})[-\/.](\d{1,2})/);
                    if (match) {
                        const year = parseInt(match[1], 10);
                        const monthIndex = parseInt(match[2], 10) - 1;
                        if (Number.isFinite(year) && Number.isFinite(monthIndex)) {
                            return { year, monthIndex };
                        }
                    }
                    const parsed = new Date(normalized);
                    const time = parsed.getTime();
                    if (!Number.isNaN(time)) {
                        return {
                            year: parsed.getFullYear(),
                            monthIndex: parsed.getMonth(),
                        };
                    }
                }
                return null;
            };

            const saleMatchesMonth = (sale, year, monthIndex) => {
                const parsed = extractSaleYearMonth(sale);
                return parsed ? (parsed.year === year && parsed.monthIndex === monthIndex) : false;
            };

            const FALLBACK_CATEGORY_KEY = 'etc';
            const CATEGORY_KEY_LOOKUP = {
                health: 'health',
                'Ìó¨Ïä§': 'health',
                'Ìó¨Ïä§Ïû•': 'health',
                'Ìó¨Ïä§Í∂å': 'health',
                gym: 'health',
                fitness: 'health',
                membership: 'health',
                neofit: 'neofit',
                'ÎÑ§Ïò§Ìïè': 'neofit',
                neo: 'neofit',
                pt: 'pt',
                'ÌîºÌã∞': 'pt',
                'ptÍ∂å': 'pt',
                personal: 'pt',
                trainer: 'pt',
                training: 'pt',
                pilates: 'pilates',
                'ÌïÑÎùºÌÖåÏä§': 'pilates',
                etc: 'etc',
                misc: 'etc',
                Í∏∞ÌÉÄ: 'etc',
                clothing: 'etc',
                locker: 'etc',
                storage: 'etc'
            };

            const deriveCategoryKey = (detail) => {
                if (!detail) {
                    return FALLBACK_CATEGORY_KEY;
                }

                const explicit = (detail.category || detail.type || '').toString().trim().toLowerCase();
                if (explicit) {
                    const mapped = CATEGORY_KEY_LOOKUP[explicit];
                    if (mapped) {
                        return mapped;
                    }
                    if (explicit.includes('pilates')) return 'pilates';
                    if (explicit.includes('neo')) return 'neofit';
                    if (explicit.includes('pt') || explicit.includes('trainer')) return 'pt';
                    if (explicit.includes('health') || explicit.includes('fitness')) return 'health';
                }

                const product = (detail.product || '').toString().trim().toLowerCase();
                if (!product) {
                    return FALLBACK_CATEGORY_KEY;
                }

                if (product.includes('ÌïÑÎùºÌÖåÏä§')) {
                    return 'pilates';
                }

                if (product.includes('ÎÑ§Ïò§Ìïè') || product.includes('neofit') || product.includes('neo-fit')) {
                    return 'neofit';
                }

                if (
                    product.includes('pt') ||
                    product.includes('ÌîºÌã∞') ||
                    product.includes('personal') ||
                    product.includes('Ìä∏Î†àÏù¥Îãù') ||
                    product.includes('Í∞úÏù∏') ||
                    product.includes('trainer')
                ) {
                    return 'pt';
                }

                if (product.includes('Ïö¥ÎèôÎ≥µ') || product.includes('ÎùΩÏª§') || product.includes('Î≥¥Í¥ÄÌï®')) {
                    return 'clothing';
                }

                if (product.includes('Í∏∞ÌÉÄ Ï°∞Ï†ï') || product.includes('Ï°∞Ï†ï') || product.includes('adjust') || product.includes('Ï°∞Ï†ïÎ∂Ñ')) {
                    return 'etc';
                }

                if (product.includes('Ìó¨Ïä§')) {
                    return 'health';
                }

                if (product.includes('Í∞úÏõî')) {
                    return 'etc';
                }

                return FALLBACK_CATEGORY_KEY;
            };

            // FirebaseÏóêÏÑú Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Íµ¨ÎèÖ
            React.useEffect(() => {
                if (!user) return;

                // ÏõîÏù¥ Î≥ÄÍ≤ΩÎê† Îïå Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
                setSalesData({});

                // ÌòÑÏû¨ Ïõî Îç∞Ïù¥ÌÑ∞ Ïã§ÏãúÍ∞Ñ Íµ¨ÎèÖ
                const unsubscribe = salesService.subscribeToMonthData(
                    selectedYear,
                    selectedMonth,
                    (data) => {
                        const normalized = normalizeSalesMap(data);
                        setSalesData(prevData => ({
                            ...prevData,
                            ...normalized
                        }));
                    }
                );

                // Ï†ÑÏõî Îç∞Ïù¥ÌÑ∞ Íµ¨ÎèÖ Ï†úÍ±∞ - ÏõîÎ≥Ñ Îß§Ï∂ú Ï§ëÎ≥µ Í≥ÑÏÇ∞ Î∞©ÏßÄ

                return () => {
                    // Íµ¨ÎèÖ Ìï¥Ï†ú
                    setSalesData({});
                    if (unsubscribe) unsubscribe();
                };
            }, [user, selectedYear, selectedMonth]);
            const [loginError, setLoginError] = useState('');
            const [isSignUpMode, setIsSignUpMode] = useState(false);

            // Firebase Ïù∏Ï¶ù ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ
            React.useEffect(() => {
                const unsubscribe = authService.subscribeToAuthChanges((user) => {
                    setUser(user);
                    setIsLoading(false);
                });

                return () => unsubscribe();
            }, []);

            // salesDataÏóêÏÑú dailySales Î∞∞Ïó¥ ÏÉùÏÑ± (ÏõîÎ≥Ñ Î¶¨Ìè¨Ìä∏ Ï∞®Ìä∏Ïö©)
            React.useEffect(() => {
                const newDailySales = [];

                Object.keys(salesData).forEach(dateKey => {
                    const dayData = normalizeSalesEntry(salesData[dateKey]);
                    if (!dayData) return;

                    const dayEntries = [];
                    let detailSum = 0;

                    if (Array.isArray(dayData.details)) {
                        dayData.details.forEach(detail => {
                            const entries = splitProductEntries(detail, dayData, dateKey);
                            entries.forEach(entry => {
                                const priceValue = normalizeAmount(entry.price);
                                detailSum += priceValue;
                                dayEntries.push(entry);
                            });
                        });
                    }

                    const recordedAmount = normalizeAmount(dayData.amount);
                    const difference = recordedAmount - detailSum;

                    // if (Math.abs(difference) > 0.1) {
                    //     console.log('[NeoFit] Îã§Î•∏ Í∏àÏï°Í≥ºÏùò Ï∞®Ïù¥ Î∞úÍ≤¨', {
                    //         dateKey,
                    //         recordedAmount,
                    //         calculatedSum: detailSum,
                    //         difference,
                    //         entries: dayEntries
                    //     });
                    // }

                    newDailySales.push(...dayEntries);
                });

                setDailySales(newDailySales);
                console.log('dailySales ÏóÖÎç∞Ïù¥Ìä∏Îê®:', newDailySales.length, 'Í∞ú Ìï≠Î™©');
            }, [salesData]);

            // Ï†ÑÏ≤¥ Ïó∞ÎèÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (ÏõîÎ≥Ñ Î¶¨Ìè¨Ìä∏ Ï∞®Ìä∏Ïö©)
            React.useEffect(() => {
                if (!user) return;

                const anchorDate = new Date(
                    isNaN(selectedYear) ? new Date().getFullYear() : selectedYear,
                    isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth,
                    1
                );
                const unsubscribes = [];

                // Ïõî Î≥ÄÍ≤Ω Ïãú Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
                setYearlyDailySales([]);

                // ÏÑ†ÌÉùÎêú Ïõî Í∏∞Ï§ÄÏúºÎ°ú Ïù¥Ï†Ñ 5Í∞úÏõîÎ∂ÄÌÑ∞ Ïù¥ÌõÑ 4Í∞úÏõîÍπåÏßÄ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                const loadYearlyData = () => {

                    for (let i = -5; i <= 4; i++) {
                        const targetDate = new Date(anchorDate.getFullYear(), anchorDate.getMonth() + i, 1);
                        const year = targetDate.getFullYear();
                        const month = targetDate.getMonth();

                        try {
                            // Ìï¥Îãπ ÏõîÏùò Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ïã§ÏãúÍ∞Ñ Íµ¨ÎèÖ
                            const unsubscribe = salesService.subscribeToMonthData(
                                year,
                                month,
                                (monthData) => {
                                    const normalizedMonthData = normalizeSalesMap(monthData);

                                    // ÏõîÎ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º dailySales ÌòïÌÉúÎ°ú Î≥ÄÌôò
                                    const monthDailySales = [];
                                    const monthPrefix = `${year}-${String(month + 1).padStart(2, '0')}`;
                                    Object.keys(normalizedMonthData).forEach(dateKey => {
                                        const dayData = normalizedMonthData[dateKey];
                                        if (dayData && dayData.details && Array.isArray(dayData.details)) {
                                            dayData.details.forEach(detail => {
                                                const entries = splitProductEntries(detail, dayData, dateKey);
                                                entries.forEach(entry => {
                                                    monthDailySales.push(entry);
                                                });
                                            });
                                        }
                                    });
                                    // FirestoreÏóê Í∏∞Î°ùÎêú amount Í∏∞Ï§ÄÏúºÎ°ú ÏÉÅÏÑ∏ Ìï©Í≥ÑÏôÄ Ï∞®Ïù¥Í∞Ä ÎÇòÎ©¥ Î≥¥Ï†ï
                                    const firestoreTotal = Object.values(normalizedMonthData).reduce((sum, day) => {
                                        return sum + normalizeAmount(day?.amount);
                                    }, 0);
                                    const detailSum = monthDailySales.reduce((sum, sale) => sum + normalizeAmount(sale.price), 0);
                                    if (firestoreTotal > detailSum) {
                                        monthDailySales.push({
                                            date: `${monthPrefix}-01`,
                                            product: 'Í∏∞ÌÉÄ Ï°∞Ï†ï',
                                            price: firestoreTotal - detailSum,
                                            category: 'etc',
                                            type: '',
                                            customerName: '',
                                            approved: true
                                        });
                                    }

                                    // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ìï¥Îãπ Ïõî Îç∞Ïù¥ÌÑ∞ Ï†úÍ±∞ ÌõÑ ÏÉà Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
                                    setYearlyDailySales(prevData => {
                                        const filteredData = prevData.filter(sale => !sale.date.startsWith(monthPrefix));
                                        return [...filteredData, ...monthDailySales];
                                    });
                                }
                            );

                            if (unsubscribe) unsubscribes.push(unsubscribe);
                        } catch (error) {
                            console.error(`${year}ÎÖÑ ${month + 1}Ïõî Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:`, error);
                        }
                    }
                };

                loadYearlyData();

                // cleanup Ìï®Ïàò
                return () => {
                    unsubscribes.forEach(unsubscribe => {
                        if (unsubscribe) unsubscribe();
                    });
                };
            }, [user, selectedYear, selectedMonth]);

            // Firebase Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî
            React.useEffect(() => {
                if (user) {
                    const unsubscribe = salesService.subscribeToMonthData(
                        selectedYear,
                        selectedMonth,
                        (data) => {
                            const normalized = normalizeSalesMap(data);
                            setSalesData(prevData => ({
                                ...prevData,
                                ...normalized
                            }));
                        }
                    );

                    return () => unsubscribe();
                }
            }, [user, selectedYear, selectedMonth]);

            // ÏÉÅÌíà Î™©Î°ù
            const healthProducts = ['1Í∞úÏõî', '3Í∞úÏõî', '6Í∞úÏõî', '12Í∞úÏõî'];
            const ptProducts = ['1Ìöå Ï≤¥Ìóò', '5Ìöå Ï≤¥Ìóò'];
            const pilatesProducts = [
                '3Í∞úÏõî (24Ìöå Ï£º 2Ìöå)',
                '6Í∞úÏõî (48Ìöå Ï£º 2Ìöå)',
                '12Í∞úÏõî (96Ìöå Ï£º 2Ìöå)',
                '3Í∞úÏõî (36Ìöå Ï£º 3Ìöå)',
                '6Í∞úÏõî (72Ìöå Ï£º 3Ìöå)',
                '12Í∞úÏõî (144Ìöå Ï£º 3Ìöå)'
            ];
            const neofitProducts = [
                'ÎÑ§Ïò§Ìïè 12Ìöå Îã®ÎèÖ ÏÉÅÌíà',
                'ÎÑ§Ïò§ Ïã±ÌÅ¨ 1:1 5ÌöåÍ∂å',
                'ÎÑ§Ïò§ Ïã±ÌÅ¨ 2:1 5ÌöåÍ∂å',
                '30Ïùº Í∏∞Í∞ÑÍ∂å',
                '90Ïùº Í∏∞Í∞ÑÍ∂å',
                '180Ïùº Í∏∞Í∞ÑÍ∂å',
                '8Ìöå Ï£º 2Ìöå',
                '24Ìöå Ï£º 2Ìöå',
                '48Ìöå Ï£º 2Ìöå',
                '12Ìöå Ï£º 3Ìöå',
                '36Ìöå Ï£º 3Ìöå',
                '72Ìöå Ï£º 3Ìöå'
            ];
            const lockerProducts = ['Ïö¥ÎèôÎ≥µ', 'ÎùΩÏª§'];
            const lockerPeriods = ['1Í∞úÏõî', '2Í∞úÏõî', '3Í∞úÏõî', '4Í∞úÏõî', '5Í∞úÏõî', '6Í∞úÏõî', '7Í∞úÏõî', '8Í∞úÏõî', '9Í∞úÏõî', '10Í∞úÏõî', '11Í∞úÏõî', '12Í∞úÏõî'];

            // ÏÉÅÌíà Í∞ÄÍ≤©Ìëú
            const productPrices = {
                // Ìó¨Ïä§ Ïù¥Ïö©Í∂å
                '1Í∞úÏõî': 110000,
                '3Í∞úÏõî': 270000,
                '6Í∞úÏõî': 420000,
                '12Í∞úÏõî': 600000,
                // 1:1 PT Ïù¥Ïö©Í∂å
                '1Ìöå Ï≤¥Ìóò': 45000,
                '5Ìöå Ï≤¥Ìóò': 225000,
                // ÏùºÏùºÍ∂å
                'ÏùºÏùºÍ∂å': 10000,
                'Í∑ºÏù∏ÏùºÏùºÍ∂å': 10000,
                // ÎÑ§Ïò§Ìïè Ïù¥Ïö©Í∂å
                'ÎÑ§Ïò§ Ïã±ÌÅ¨ 1:1 5ÌöåÍ∂å': 250000,
                'ÎÑ§Ïò§ Ïã±ÌÅ¨ 2:1 5ÌöåÍ∂å': 200000,
                'ÎÑ§Ïò§Ìïè 12Ìöå Îã®ÎèÖ ÏÉÅÌíà': 264000,
                '30Ïùº Í∏∞Í∞ÑÍ∂å': 390000,
                '180Ïùº Í∏∞Í∞ÑÍ∂å': 1980000,
                '90Ïùº Í∏∞Í∞ÑÍ∂å': 1080000,
                '8Ìöå Ï£º 2Ìöå': 264000,
                '24Ìöå Ï£º 2Ìöå': 744000,
                '48Ìöå Ï£º 2Ìöå': 1392000,
                '12Ìöå Ï£º 3Ìöå': 348000,
                '36Ìöå Ï£º 3Ìöå': 972000,
                '72Ìöå Ï£º 3Ìöå': 1800000,
                '3Í∞úÏõî (24Ìöå Ï£º 2Ìöå)': 384000,
                '6Í∞úÏõî (48Ìöå Ï£º 2Ìöå)': 624000,
                '12Í∞úÏõî (96Ìöå Ï£º 2Ìöå)': 960000,
                '3Í∞úÏõî (36Ìöå Ï£º 3Ìöå)': 540000,
                '6Í∞úÏõî (72Ìöå Ï£º 3Ìöå)': 864000,
                '12Í∞úÏõî (144Ìöå Ï£º 3Ìöå)': 1296000,
                // Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Í∞ÄÍ≤© (1Í∞úÏõîÎ∂ÄÌÑ∞ 12Í∞úÏõîÍπåÏßÄ)
                'Ïö¥ÎèôÎ≥µ 1Í∞úÏõî': 10000,
                'Ïö¥ÎèôÎ≥µ 2Í∞úÏõî': 20000,
                'Ïö¥ÎèôÎ≥µ 3Í∞úÏõî': 30000,
                'Ïö¥ÎèôÎ≥µ 4Í∞úÏõî': 40000,
                'Ïö¥ÎèôÎ≥µ 5Í∞úÏõî': 50000,
                'Ïö¥ÎèôÎ≥µ 6Í∞úÏõî': 60000,
                'Ïö¥ÎèôÎ≥µ 7Í∞úÏõî': 70000,
                'Ïö¥ÎèôÎ≥µ 8Í∞úÏõî': 80000,
                'Ïö¥ÎèôÎ≥µ 9Í∞úÏõî': 90000,
                'Ïö¥ÎèôÎ≥µ 10Í∞úÏõî': 100000,
                'Ïö¥ÎèôÎ≥µ 11Í∞úÏõî': 110000,
                'Ïö¥ÎèôÎ≥µ 12Í∞úÏõî': 120000,
                'ÎùΩÏª§ 1Í∞úÏõî': 10000,
                'ÎùΩÏª§ 2Í∞úÏõî': 20000,
                'ÎùΩÏª§ 3Í∞úÏõî': 30000,
                'ÎùΩÏª§ 4Í∞úÏõî': 40000,
                'ÎùΩÏª§ 5Í∞úÏõî': 50000,
                'ÎùΩÏª§ 6Í∞úÏõî': 60000,
                'ÎùΩÏª§ 7Í∞úÏõî': 70000,
                'ÎùΩÏª§ 8Í∞úÏõî': 80000,
                'ÎùΩÏª§ 9Í∞úÏõî': 90000,
                'ÎùΩÏª§ 10Í∞úÏõî': 100000,
                'ÎùΩÏª§ 11Í∞úÏõî': 110000,
                'ÎùΩÏª§ 12Í∞úÏõî': 120000
            };

            // ÎÇ†Ïßú ÌÇ§ ÏÉùÏÑ±
            const getDateKey = (day) => {
                // NaN Ï≤¥ÌÅ¨ Î∞è Í∏∞Î≥∏Í∞í Ï≤òÎ¶¨
                const year = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
                const month = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
                const dayNum = isNaN(day) ? 1 : day;

                // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                if (year < 2000 || year > 3000 || month < 0 || month > 11 || dayNum < 1 || dayNum > 31) {
                    console.error('Invalid date values:', { year, month, dayNum });
                    // Í∏∞Î≥∏Í∞í Î∞òÌôò
                    const today = new Date();
                    return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                }

                return `${year}-${String(month + 1).padStart(2, '0')}-${String(dayNum).padStart(2, '0')}`;
            };

            // ÎÇ†ÏßúÎ≥Ñ ÏûÖÎ†• Ìèº ÌÜ†Í∏Ä
            const toggleDayExpansion = (day) => {
                setExpandedDays(prev => ({
                    ...prev,
                    [day]: !prev[day]
                }));
            };

            const openSaleDetail = (day, dateKey, detail, dayData) => {
                if (!detail) {
                    return;
                }

                setSelectedDetailEntry({
                    day,
                    dateKey,
                    detail,
                    approved: dayData?.approved || false,
                    dayLabel: `${selectedMonth + 1}Ïõî ${day}Ïùº`,
                    amount: normalizeAmount(detail.price)
                });
                setShowDetailModal(true);
            };

            const closeSaleDetail = () => {
                setShowDetailModal(false);
                setSelectedDetailEntry(null);
            };

            // Îß§Ï∂ú ÏûÖÎ†• Î™®Îã¨ Ïó¥Í∏∞
            const openAddSaleModal = (day, detail = null, explicitDateKey = null) => {
                setSelectedModalDay(day);

                if (detail) {
                    const resolvedDateKey = explicitDateKey || getDateKey(day);
                    setEditingDetailContext({
                        day,
                        dateKey: resolvedDateKey,
                        detailId: detail.id,
                        detail
                    });
                } else {
                    setEditingDetailContext(null);
                }

                setShowAddSaleModal(true);
            };

            const closeSaleModal = () => {
                setShowAddSaleModal(false);
                setEditingDetailContext(null);
            };

            // Îß§Ï∂ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
            const addSaleDetail = async (day) => {
                const dayCustomerName = customerName[day] || '';
                const daySelectedProduct = selectedProducts[day] || '';
                const dayCustomPrice = customPrices[day] || 0;

                if (!dayCustomerName.trim() || !daySelectedProduct || !dayCustomPrice) {
                    alert('ÌöåÏõêÎ™Ö, ÏÉÅÌíà, Í∞ÄÍ≤©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const dateKey = getDateKey(day);
                const newDetail = {
                    id: Date.now() + Math.random(),
                    customerName: dayCustomerName.trim(),
                    product: daySelectedProduct,
                    price: normalizeAmount(dayCustomPrice),
                    timestamp: new Date().toLocaleTimeString('ko-KR', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    })
                };

                // FirebaseÏóê Ï†ÄÏû•
                const currentData = normalizeSalesEntry(salesData[dateKey]);
                const newDetails = [...currentData.details, newDetail];
                const newTotalAmount = newDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);

                const updatedData = {
                    ...currentData,
                    details: normalizeDetailList(newDetails),
                    amount: newTotalAmount,
                    date: dateKey
                };

                await salesService.saveSalesData(dateKey, updatedData);

                // Ìï¥Îãπ ÎÇ†Ïßú ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
                setCustomerName(prev => ({ ...prev, [day]: '' }));
                setSelectedProducts(prev => ({ ...prev, [day]: '' }));
                setCustomPrices(prev => ({ ...prev, [day]: '' }));

                alert('Îß§Ï∂úÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!');
            };

            // Îß§Ï∂ú ÏÉÅÏÑ∏ ÏÇ≠Ï†ú
            const removeSaleDetail = async (day, detailId) => {
                const dateKey = getDateKey(day);
                const currentData = normalizeSalesEntry(salesData[dateKey]);
                const newDetails = currentData.details.filter(detail => detail.id !== detailId);
                const newTotalAmount = newDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);

                const updatedData = {
                    ...currentData,
                    details: normalizeDetailList(newDetails),
                    amount: newTotalAmount,
                    date: dateKey
                };

                await salesService.saveSalesData(dateKey, updatedData);
            };

            // Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ Ï≤òÎ¶¨
            const handleAdminApproval = async (day) => {
                const dateKey = getDateKey(day);
                const password = approvalPasswords[dateKey] || '';

                if (password === CONFIG.ADMIN_PASSWORD) {
                    const currentData = salesData[dateKey] || {};
                    const updatedData = {
                        ...currentData,
                        approved: true,
                        date: dateKey
                    };

                    await salesService.saveSalesData(dateKey, updatedData);

                    setApprovalPasswords(prev => ({
                        ...prev,
                        [dateKey]: ''
                    }));
                } else {
                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }
            };

            // ÏàòÏ†ï Î™®Îìú Ï≤òÎ¶¨
            const handleEditMode = async (day) => {
                const dateKey = getDateKey(day);
                const password = editPasswords[dateKey] || '';

                if (password === CONFIG.ADMIN_PASSWORD) {
                    const currentData = salesData[dateKey] || {};
                    const updatedData = {
                        ...currentData,
                        approved: false,
                        date: dateKey
                    };

                    // FirebaseÏóê Ï†ÄÏû•
                    await salesService.saveSalesData(dateKey, updatedData);

                    setEditPasswords(prev => ({
                        ...prev,
                        [dateKey]: ''
                    }));
                } else {
                    alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }
            };

            // ÏõîÏùò ÏùºÏàò Í≥ÑÏÇ∞
            const getDaysInMonth = () => {
                try {
                    // Í∏∞Î≥∏Í∞í Ï≤òÎ¶¨
                    const year = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
                    const month = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;

                    // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                    if (year < 2000 || year > 3000 || month < 0 || month > 11) {
                        console.error('Invalid year or month:', { year, month });
                        return 31; // Í∏∞Î≥∏Í∞í Î∞òÌôò
                    }

                    const days = new Date(year, month + 1, 0).getDate();
                    return isNaN(days) ? 31 : days;
                } catch (error) {
                    console.error('Error in getDaysInMonth:', error);
                    return 31;
                }
            };

            // Ï£ºÍ∞Ñ Îß§Ï∂ú Í≥ÑÏÇ∞ (ÏäπÏù∏Îêú Îß§Ï∂úÎßå Í≥ÑÏÇ∞)
            const calculateWeeklySales = () => {
                try {
                    const weeks = [];

                    // selectedYearÍ≥º selectedMonth Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                    if (isNaN(selectedYear) || isNaN(selectedMonth) || selectedYear < 2000 || selectedYear > 3000 || selectedMonth < 0 || selectedMonth > 11) {
                        console.warn('Invalid year or month for weekly calculation:', { selectedYear, selectedMonth });
                        return [];
                    }

                    const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();

                    if (!daysInMonth || daysInMonth <= 0 || isNaN(daysInMonth)) {
                        return [];
                    }

                    let currentWeek = [];
                    let weekTotal = 0;

                    for (let day = 1; day <= daysInMonth; day++) {
                        // ÏïàÏ†ÑÌïú dateKey ÏÉùÏÑ±
                        const dateKey = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

                        if (salesData && salesData[dateKey]) {
                            const dayData = salesData[dateKey];
                            // ÏäπÏù∏Îêú Îß§Ï∂úÎßå Í≥ÑÏÇ∞
                            if (dayData.approved) {
                                const amountValue = normalizeAmount(dayData.amount);
                                if (amountValue > 0) {
                                    weekTotal += amountValue;
                                }
                            }
                        }

                        currentWeek.push(day);

                        // Ï£º ÎßàÍ∞ê ÎòêÎäî Ïõî ÎßàÏßÄÎßâ ÎÇ†
                        if (currentWeek.length === 7 || day === daysInMonth) {
                            if (currentWeek.length > 0) {
                                weeks.push({
                                    days: [...currentWeek],
                                    total: weekTotal
                                });
                            }
                            currentWeek = [];
                            weekTotal = 0;
                        }
                    }

                    return weeks;
                } catch (error) {
                    console.error('Error in calculateWeeklySales:', error);
                    return [];
                }
            };

            const matchSnapshotCategory = (value) => {
                if (!value) {
                    return null;
                }

                const lower = value.toString().trim().toLowerCase();
                if (!lower) {
                    return null;
                }

                if (
                    lower === 'health' ||
                    lower === 'Ìó¨Ïä§' ||
                    lower === 'Ìó¨Ïä§Ïû•' ||
                    lower === 'Ìó¨Ïä§Í∂å' ||
                    lower === 'gym' ||
                    lower === 'fitness' ||
                    lower === 'membership'
                ) {
                    return 'health';
                }

                if (lower === 'neofit' || lower === 'ÎÑ§Ïò§Ìïè' || lower === 'neo-fit') {
                    return 'neofit';
                }

                if (lower === 'pt' || lower === 'ÌîºÌã∞' || lower === 'personal' || lower === 'trainer' || lower === 'training') {
                    return 'pt';
                }

                if (lower === 'pilates' || lower === 'ÌïÑÎùºÌÖåÏä§') {
                    return 'pilates';
                }

                if (lower === 'clothing' || lower === 'Ïö¥ÎèôÎ≥µ' || lower === 'ÎùΩÏª§' || lower === 'Î≥¥Í¥ÄÌï®') {
                    return 'clothing';
                }

                if (lower === 'etc' || lower === 'Í∏∞ÌÉÄ' || lower === 'misc') {
                    return 'etc';
                }

                if (lower.includes('Ïö¥ÎèôÎ≥µ') || lower.includes('ÎùΩÏª§') || lower.includes('Î≥¥Í¥ÄÌï®')) {
                    return 'clothing';
                }

                if (lower.includes('Ï≤¥Ìóò')) {
                    if (lower.includes('ÎÑ§Ïò§Ìïè')) {
                        return 'neofit';
                    }
                    if (lower.includes('ÌïÑÎùºÌÖåÏä§')) {
                        return 'pilates';
                    }
                    return 'pt';
                }

                if (lower.includes('ÌïÑÎùºÌÖåÏä§')) {
                    return 'pilates';
                }

                if (lower.includes('ÎÑ§Ïò§Ìïè') || lower.includes('neofit') || lower.includes('neo-fit') || lower.includes('neo fit')) {
                    return 'neofit';
                }

                if (
                    lower.includes('pt') ||
                    lower.includes('ÌîºÌã∞') ||
                    lower.includes('personal') ||
                    lower.includes('Ìä∏Î†àÏù¥Îãù') ||
                    lower.includes('Í∞úÏù∏') ||
                    lower.includes('trainer')
                ) {
                    return 'pt';
                }

                if (lower.includes('Ìó¨Ïä§')) {
                    return 'health';
                }

                if (lower.includes('Í∞úÏõî') && !lower.includes('ÌïÑÎùºÌÖåÏä§') && !lower.includes('Ïö¥ÎèôÎ≥µ') && !lower.includes('ÎùΩÏª§')) {
                    return 'health';
                }

                if (lower.includes('Í∏∞ÌÉÄ') || lower.includes('Ï°∞Ï†ï') || lower.includes('adjust') || lower.includes('Ï°∞Ï†ïÎ∂Ñ')) {
                    return 'etc';
                }

                return null;
            };

            const resolveSnapshotCategory = (sale) => {
                if (!sale) {
                    return 'etc';
                }

                const candidates = [sale.category, sale.type, sale.product];
                for (const candidate of candidates) {
                    const matched = matchSnapshotCategory(candidate);
                    if (matched) {
                        return matched;
                    }
                }

                return 'etc';
            };

            const isDateInActiveMonth = React.useCallback((dateString) => {
                if (!dateString) {
                    return false;
                }

                const { year, monthIndex } = getActiveYearMonth();
                const [saleYearStr, saleMonthStr] = dateString.split('-');
                const saleYear = Number(saleYearStr);
                const saleMonth = Number(saleMonthStr);

                if (!Number.isFinite(saleYear) || !Number.isFinite(saleMonth)) {
                    return false;
                }

                return saleYear === year && saleMonth === monthIndex + 1;
            }, [selectedYear, selectedMonth]);

            const snapshotSalesEntries = React.useMemo(() => {
                const activeMonthSales = Array.isArray(dailySales)
                    ? dailySales.filter(sale => sale && sale.approved && isDateInActiveMonth(sale.date))
                    : [];

                if (activeMonthSales.length > 0) {
                    return activeMonthSales;
                }

                const aggregated = [];

                Object.entries(salesData || {}).forEach(([dateKey, rawEntry]) => {
                    if (!isDateInActiveMonth(dateKey)) {
                        return;
                    }

                    const dayData = normalizeSalesEntry(rawEntry);
                    if (!dayData || !dayData.approved) {
                        return;
                    }

                    let detailTotal = 0;

                    if (Array.isArray(dayData.details) && dayData.details.length > 0) {
                        dayData.details.forEach(detail => {
                            const entries = splitProductEntries(detail, dayData, dateKey);
                            entries.forEach(entry => {
                                detailTotal += normalizeAmount(entry.price);
                                aggregated.push(entry);
                            });
                        });
                    }

                    const dayAmount = normalizeAmount(dayData.amount);
                    if (dayAmount > detailTotal) {
                        aggregated.push({
                            date: dateKey,
                            product: 'Í∏∞ÌÉÄ Ï°∞Ï†ï',
                            category: 'Í∏∞ÌÉÄ',
                            type: '',
                            price: dayAmount - detailTotal,
                            approved: true,
                            source: 'adjustment'
                        });
                    }
                });

                return aggregated.filter(sale => sale && isDateInActiveMonth(sale.date));
            }, [dailySales, salesData, isDateInActiveMonth]);

            const snapshotCategoryTotals = React.useMemo(() => {
                const totals = {
                    health: 0,
                    neofit: 0,
                    pt: 0,
                    pilates: 0,
                    clothing: 0,
                    etc: 0,
                    total: 0,
                };

                if (!Array.isArray(snapshotSalesEntries) || snapshotSalesEntries.length === 0) {
                    return totals;
                }

                snapshotSalesEntries.forEach(sale => {
                    if (!sale || !sale.approved) {
                        return;
                    }

                    if (!isDateInActiveMonth(sale.date)) {
                        return;
                    }

                    const amount = normalizeAmount(sale.price);
                    if (!Number.isFinite(amount) || amount <= 0) {
                        return;
                    }

                    const categoryKey = resolveSnapshotCategory(sale);
                    if (totals[categoryKey] === undefined) {
                        totals.etc += amount;
                    } else {
                        totals[categoryKey] += amount;
                    }

                    totals.total += amount;
                });

                return totals;
            }, [snapshotSalesEntries]);

            const formatDateKey = (dateKey) => {
                if (!dateKey || typeof dateKey !== 'string') {
                    return dateKey || '';
                }

                const parts = dateKey.split('-').map(Number);
                if (parts.length < 3 || parts.some(part => !Number.isFinite(part))) {
                    return dateKey;
                }

                const [, month, day] = parts;
                return `${month}Ïõî ${day}Ïùº`;
            };

            const normalizeDateKeyString = (input) => {
                if (!input) return '';

                if (input instanceof Date && !Number.isNaN(input.getTime())) {
                    return `${input.getFullYear()}-${String(input.getMonth() + 1).padStart(2, '0')}-${String(input.getDate()).padStart(2, '0')}`;
                }

                if (typeof input === 'string') {
                    const trimmed = input.trim();
                    const simpleMatch = trimmed.match(/^(\d{4})[-\/.]?(\d{1,2})[-\/.]?(\d{1,2})$/);
                    if (simpleMatch) {
                        const [, y, m, d] = simpleMatch;
                        const year = Number(y);
                        const month = Number(m);
                        const day = Number(d);
                        if (
                            Number.isFinite(year) &&
                            Number.isFinite(month) &&
                            Number.isFinite(day) &&
                            month >= 1 && month <= 12 &&
                            day >= 1 && day <= 31
                        ) {
                            return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        }
                    }

                    const parsed = new Date(trimmed);
                    if (!Number.isNaN(parsed.getTime())) {
                        return `${parsed.getFullYear()}-${String(parsed.getMonth() + 1).padStart(2, '0')}-${String(parsed.getDate()).padStart(2, '0')}`;
                    }
                }

                return '';
            };

            const getCategoryDetailEntries = (categoryKey) => {
                if (!Array.isArray(snapshotSalesEntries) || snapshotSalesEntries.length === 0) {
                    return [];
                }

                return snapshotSalesEntries
                    .filter(entry => entry && entry.approved && resolveSnapshotCategory(entry) === categoryKey)
                    .map(entry => {
                        const actualPrice = normalizeAmount(entry.price);
                        const originalPrice = normalizeAmount(
                            entry.originalPrice !== undefined
                                ? entry.originalPrice
                                : (entry.displayPrice !== undefined ? entry.displayPrice : entry.price)
                        );
                        const discountAllowed = DISCOUNT_ELIGIBLE_CATEGORIES.has(categoryKey);
                        const discountAmount = discountAllowed ? Math.max(0, originalPrice - actualPrice) : 0;
                        return {
                            ...entry,
                            price: actualPrice,
                            displayPrice: originalPrice,
                            originalPrice,
                            discountAmount,
                            discountEligible: discountAllowed,
                            dateKey: entry.date,
                            date: formatDateKey(entry.date),
                        };
                    })
                    .sort((a, b) => (b.dateKey || '').localeCompare(a.dateKey || ''));
            };

            const categoryDetailsCache = React.useMemo(() => {
                const cache = {};
                CATEGORY_KEYS.forEach(key => {
                    cache[key] = getCategoryDetailEntries(key);
                });
                return cache;
            }, [snapshotSalesEntries, selectedYear, selectedMonth]);

            const categoryTotals = React.useMemo(() => {
                const totals = { total: 0 };
                CATEGORY_KEYS.forEach(key => {
                    const entries = categoryDetailsCache[key] || [];
                    const sum = entries.reduce((sum, item) => sum + ((item.price || 0)), 0);
                    totals[key] = sum;
                    totals.total += sum;
                });
                return totals;
            }, [categoryDetailsCache]);

            React.useEffect(() => {
                if (Array.isArray(snapshotSalesEntries) && snapshotSalesEntries.length > 0) {
                    const mixedEntries = snapshotSalesEntries
                        .filter(sale => {
                            const product = (sale?.product || '').toString();
                            return product.includes(',') || /\b(Ïö¥ÎèôÎ≥µ|ÎùΩÏª§|Ìó¨Ïä§|ÎÑ§Ïò§Ìïè|ÌïÑÎùºÌÖåÏä§|PT)\b/i.test(product) && product.split(',').length > 1;
                        })
                        .slice(0, 20)
                        .map(sale => ({
                            date: sale.date,
                            product: sale.product,
                            price: sale.price,
                            category: resolveSnapshotCategory(sale),
                        }));

                    console.log('[NeoFit] Î≥µÌï© ÏÉÅÌíà ÏÉòÌîå', mixedEntries);
                }
            }, [snapshotSalesEntries]);

            React.useEffect(() => {
                if (!snapshotCategoryTotals) {
                    return;
                }

                const categorySum =
                    (snapshotCategoryTotals.health || 0) +
                    (snapshotCategoryTotals.neofit || 0) +
                    (snapshotCategoryTotals.pt || 0) +
                    (snapshotCategoryTotals.pilates || 0) +
                    (snapshotCategoryTotals.clothing || 0) +
                    (snapshotCategoryTotals.etc || 0);

                console.log('[NeoFit] Ïπ¥ÌÖåÍ≥†Î¶¨ Ìï©Í≥Ñ ÎîîÎ≤ÑÍ∑∏', {
                    selectedYear,
                    selectedMonth,
                    totals: snapshotCategoryTotals,
                    categorySum,
                    difference: (snapshotCategoryTotals.total || 0) - categorySum,
                    entryCount: Array.isArray(snapshotSalesEntries) ? snapshotSalesEntries.length : 0,
                });

                if (Array.isArray(snapshotSalesEntries) && snapshotSalesEntries.length > 0) {
                    const debugSummary = snapshotSalesEntries.reduce((acc, sale) => {
                        const amount = normalizeAmount(sale.price);
                        const key = resolveSnapshotCategory(sale);

                        acc.all.byCategory[key] = (acc.all.byCategory[key] || 0) + amount;
                        acc.all.total += amount;

                        if (sale.approved) {
                            acc.approved.byCategory[key] = (acc.approved.byCategory[key] || 0) + amount;
                            acc.approved.total += amount;
                        } else {
                            acc.unapproved.byCategory[key] = (acc.unapproved.byCategory[key] || 0) + amount;
                            acc.unapproved.total += amount;
                        }

                        return acc;
                    }, {
                        all: { total: 0, byCategory: {} },
                        approved: { total: 0, byCategory: {} },
                        unapproved: { total: 0, byCategory: {} },
                    });

                    console.log('[NeoFit] Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ∏Î∂Ä ÎîîÎ≤ÑÍ∑∏', debugSummary);
                }
            }, [snapshotCategoryTotals, selectedYear, selectedMonth, snapshotSalesEntries]);
            // ÏõîÎ≥Ñ Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ï∂ú Í≥ÑÏÇ∞ Ìï®ÏàòÎì§ (ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ)
            const calculateMonthlyCategorySales = (year, month, categoryType, useYearlyData = false) => {
                try {
                    const isSelectedMonth = year === selectedYear && month === (selectedMonth + 1);

                    if (isSelectedMonth) {
                        if (categoryType === 'total') {
                            return categoryTotals.total || 0;
                        }

                        if (CATEGORY_KEYS.includes(categoryType)) {
                            return categoryTotals[categoryType] || 0;
                        }
                    }

                    const dataSource = useYearlyData ? yearlyDailySales : dailySales;

                    if (!dataSource || !Array.isArray(dataSource) || dataSource.length === 0) {
                        return 0;
                    }

                    const targetMonth = `${year}-${String(month).padStart(2, '0')}`;
                    let total = 0;

                    dataSource.forEach(sale => {
                        try {
                            if (!sale || !sale.date || !sale.price) {
                                return;
                            }

                            const saleDateParts = sale.date.split('-');
                            if (saleDateParts.length < 2) {
                                return;
                            }

                            const saleYear = parseInt(saleDateParts[0]);
                            const saleMonth = parseInt(saleDateParts[1]);
                            if (saleYear !== year || saleMonth !== month) {
                                return;
                            }

                            if (!sale.approved) {
                                return;
                            }

                            const derivedCategory = deriveCategoryKey(sale);
                            const targetCategory = categoryType === 'etc' ? 'etc' : categoryType;

                            if (targetCategory === 'total') {
                                const price = normalizeAmount(sale.price);
                                total += price;
                                return;
                            }

                            if (derivedCategory === targetCategory) {
                                const price = normalizeAmount(sale.price);
                                total += price;
                            }
                        } catch (e) {
                            // Í∞úÎ≥Ñ Ìï≠Î™© Ïò§Î•òÎäî Î¨¥ÏãúÌïòÍ≥† Í≥ÑÏÜç
                            console.warn('Í∞úÎ≥Ñ Îß§Ï∂ú Ìï≠Î™© Ï≤òÎ¶¨ Ïò§Î•ò:', e);
                        }
                    });

                    return total;
                } catch (error) {
                    console.error('ÏõîÎ≥Ñ Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ï∂ú Í≥ÑÏÇ∞ Ïò§Î•ò:', error);
                    return 0;
                }
            };

            const CATEGORY_TREND_OFFSETS = [-5, -4, -3, -2, -1, 0];

            const buildCategoryMonthlySeries = (categoryType, offsets = CATEGORY_TREND_OFFSETS) => {
                try {
                    const anchorDate = new Date(
                        isNaN(selectedYear) ? new Date().getFullYear() : selectedYear,
                        isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth,
                        1
                    );

                    return offsets.map(offset => {
                        const targetDate = new Date(anchorDate.getFullYear(), anchorDate.getMonth() + offset, 1);
                        const year = targetDate.getFullYear();
                        const monthNumber = targetDate.getMonth() + 1;
                        const total = calculateMonthlyCategorySales(year, monthNumber, categoryType, true);
                        return { year, month: monthNumber, total, offset };
                    });
                } catch (error) {
                    console.error('Ïπ¥ÌÖåÍ≥†Î¶¨ ÏõîÎ≥Ñ ÏãúÍ≥ÑÏó¥ Í≥ÑÏÇ∞ Ïò§Î•ò:', error);
                    return [];
                }
            };

            const getCategorySixMonthTrend = (categoryType) => {
                const series = buildCategoryMonthlySeries(categoryType);
                if (series.length === 0) {
                    return {
                        series,
                        currentTotal: 0,
                        average: 0,
                        percentChange: null,
                        changeText: 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå',
                        toneClass: 'text-gray-500',
                        rangeLabel: ''
                    };
                }

                const currentEntry = series.find(entry => entry.offset === 0) || series[series.length - 1];
                const currentTotal = currentEntry ? currentEntry.total || 0 : 0;

                // Ï†ÑÏõî Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (offset -1)
                const previousMonthEntry = series.find(entry => entry.offset === -1);
                const previousMonthTotal = previousMonthEntry ? previousMonthEntry.total || 0 : 0;

                let percentChange = null;
                let changeText = 'Ï†ÑÏõîÎåÄÎπÑ ÎèôÏùº';
                let toneClass = 'text-gray-400';

                // Ï†ÑÏõîÎåÄÎπÑ Ï¶ùÍ∞êÎ•† Í≥ÑÏÇ∞
                if (previousMonthTotal === 0 && currentTotal === 0) {
                    changeText = 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå';
                    toneClass = 'text-gray-500';
                } else if (previousMonthTotal === 0 && currentTotal > 0) {
                    changeText = 'Ï†ÑÏõîÎåÄÎπÑ Ïã†Í∑ú';
                    toneClass = 'text-emerald-400';
                } else if (previousMonthTotal > 0 && currentTotal === 0) {
                    changeText = 'Ï†ÑÏõîÎåÄÎπÑ -100%';
                    toneClass = 'text-rose-400';
                    percentChange = -100;
                } else {
                    const rawChange = ((currentTotal - previousMonthTotal) / previousMonthTotal) * 100;
                    percentChange = Number(rawChange.toFixed(1));

                    if (Math.abs(percentChange) < 0.1) {
                        changeText = 'Ï†ÑÏõîÎåÄÎπÑ ÎèôÏùº';
                    } else if (percentChange > 0) {
                        changeText = `Ï†ÑÏõîÎåÄÎπÑ +${percentChange}%`;
                        toneClass = 'text-emerald-400';
                    } else {
                        changeText = `Ï†ÑÏõîÎåÄÎπÑ ${percentChange}%`;
                        toneClass = 'text-rose-400';
                    }
                }

                return {
                    series,
                    currentTotal,
                    average: previousMonthTotal, // Ï†ÑÏõî Îß§Ï∂úÏùÑ averageÎ°ú Ï†ÄÏû•
                    percentChange,
                    changeText,
                    toneClass,
                    rangeLabel: '' // rangeLabelÏùÄ Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå
                };
            };

            // ÎÑ§Ïò§Ìïè Îß§Ï∂úÎßå Í≥ÑÏÇ∞ (ÏïàÏ†ÑÌïú Î∞©Ïãù)

            const getPilatesDetails = () => categoryDetailsCache.pilates || [];
            const getHealthDetails = () => categoryDetailsCache.health || [];
            const getNeofitDetails = () => categoryDetailsCache.neofit || [];
            const getClothingLockerDetails = () => categoryDetailsCache.clothing || [];
            const getPtDetails = () => categoryDetailsCache.pt || [];
            const getOtherDetails = () => categoryDetailsCache.etc || [];

            // Ïù∏ÏÑºÌã∞Î∏å ÎπÑÏú® Í≥ÑÏÇ∞ (ÏßÅÏõê ÌÉÄÏûÖÎ≥Ñ)
            const getIncentiveRate = (totalSales, type = null) => {
                const employeeTypeToUse = type || employeeType;
                const rates = CONFIG.INCENTIVE_RATES;

                const thresholds = Object.keys(rates[employeeTypeToUse])
                    .map(Number)
                    .sort((a, b) => b - a);

                for (const threshold of thresholds) {
                    if (totalSales >= threshold) {
                        return rates[employeeTypeToUse][threshold];
                    }
                }

                return rates[employeeTypeToUse][0];
            };

            // ÌòÑÏû¨ Îß§Ï∂úÏóê Îî∞Î•∏ Ïù∏ÏÑºÌã∞Î∏å Ìã∞Ïñ¥ ÌôúÏÑ±Ìôî Ïó¨Î∂Ä ÌôïÏù∏
            const isTierActive = (threshold) => {
                const rates = CONFIG.INCENTIVE_RATES[employeeType];
                const sortedThresholds = Object.keys(rates).map(Number).sort((a, b) => b - a);
                for (const t of sortedThresholds) {
                    if ((monthlyTotal || 0) >= t) return t === threshold;
                }
                return threshold === 0;
            };

            const activeTierStyle = {
                backgroundColor: 'rgba(0, 255, 136, 0.15)',
                border: '2px solid #00FF88',
                boxShadow: '0 0 20px rgba(0, 255, 136, 0.4), inset 0 0 10px rgba(0, 255, 136, 0.1)',
                transform: 'scale(1.05)',
                zIndex: 10
            };

            const headlineMonthIndex = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
            const headlineYear = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
            const headlineLabel = `${headlineMonthIndex + 1}Ïõî`;
            const headlineTotal = categoryTotals.total || 0;
            const previousMonthLabel = (() => {
                const prevMonthDate = new Date(headlineYear, headlineMonthIndex - 1, 1);
                const prevMonth = prevMonthDate.getMonth();
                return `${prevMonth + 1}Ïõî`;
            })();

            const previousMonthTotal = (() => {
                const prevMonthDate = new Date(headlineYear, headlineMonthIndex - 1, 1);
                const prevYear = prevMonthDate.getFullYear();
                const prevMonth = prevMonthDate.getMonth() + 1;
                return calculateMonthlyCategorySales(prevYear, prevMonth, 'total', true) || 0;
            })();

            const headlineDelta = (() => {
                if (previousMonthTotal <= 0) {
                    return { isIncrease: true, percentage: null, difference: headlineTotal };
                }
                const diff = headlineTotal - previousMonthTotal;
                const percentage = (diff / previousMonthTotal) * 100;
                return {
                    isIncrease: diff >= 0,
                    percentage,
                    difference: diff
                };
            })();
            const monthlyTotal = headlineTotal;
            const incentiveRate = getIncentiveRate(monthlyTotal);
            const incentiveAmount = isNaN(monthlyTotal * (incentiveRate / 100)) ? 0 : monthlyTotal * (incentiveRate / 100);
            const weeklySales = calculateWeeklySales();

            const categoryMeta = [
                {
                    key: 'health',
                    label: 'Ìó¨Ïä§ Ïù¥Ïö©Í∂å',
                    icon: 'üèÉ‚Äç‚ôÇÔ∏è',
                    color: '#34d399',
                    accent: 'from-emerald-400 to-emerald-500'
                },
                {
                    key: 'neofit',
                    label: 'ÎÑ§Ïò§Ìïè',
                    icon: 'üî•',
                    color: '#60a5fa',
                    accent: 'from-sky-400 to-blue-500'
                },
                {
                    key: 'pt',
                    label: '1:1 PT',
                    icon: 'üèãÔ∏è',
                    color: '#fbbf24',
                    accent: 'from-amber-400 to-amber-500'
                },
                {
                    key: 'pilates',
                    label: 'ÌïÑÎùºÌÖåÏä§',
                    icon: 'üßò‚Äç‚ôÄÔ∏è',
                    color: '#fb7185',
                    accent: 'from-rose-400 to-pink-500'
                },
                {
                    key: 'clothing',
                    label: 'Ïö¥ÎèôÎ≥µ/ÎùΩÏª§',
                    icon: 'üëï',
                    color: '#a855f7',
                    accent: 'from-violet-400 to-fuchsia-500'
                },
                {
                    key: 'etc',
                    label: 'Í∏∞ÌÉÄ',
                    icon: 'üßæ',
                    color: '#94a3b8',
                    accent: 'from-slate-400 to-slate-500'
                }
            ];

            const categorySnapshots = categoryMeta.map((category) => {
                const total = Math.max(0, Number(categoryTotals[category.key] || 0));
                const trend = getCategorySixMonthTrend(category.key);
                const averageAmount = Math.round(trend.average || 0);
                const share = monthlyTotal > 0 ? Math.round((total / monthlyTotal) * 1000) / 10 : 0;

                return {
                    ...category,
                    total,
                    trend,
                    averageAmount,
                    averageLabel: `${averageAmount.toLocaleString()}Ïõê`,
                    share,
                    rangeLabel: trend.rangeLabel
                };
            });

            React.useEffect(() => {
                console.log('[NeoFit] Ïπ¥Îìú Ïä§ÎÉÖÏÉ∑ ÎîîÎ≤ÑÍ∑∏', categorySnapshots.map(snapshot => ({
                    key: snapshot.key,
                    total: snapshot.total,
                    share: snapshot.share,
                })), 'monthlyTotal:', monthlyTotal);
            }, [JSON.stringify(categorySnapshots), monthlyTotal]);

            const today = new Date();
            const benchmarkLabel = `${String(today.getMonth() + 1).padStart(2, '0')}.${String(today.getDate()).padStart(2, '0')}Ïùº Í∏∞Ï§Ä`;

            // Ïò§Îäò Îß§Ï∂ú Í≥ÑÏÇ∞
            const [todaySales, setTodaySales] = React.useState(0);

            const getTodaySales = React.useCallback(() => todaySales, [todaySales]);

            React.useEffect(() => {
                const today = new Date();
                if (today.getMonth() !== selectedMonth || today.getFullYear() !== selectedYear) {
                    setTodaySales(0);
                    return;
                }

                const todayKey = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

                let total = 0;
                CATEGORY_KEYS.forEach(key => {
                    const details = categoryDetailsCache[key] || [];
                    total += details
                        .filter(entry => entry && entry.dateKey === todayKey)
                        .reduce((sum, item) => sum + (item.price || 0), 0);
                });

                if (total > 0) {
                    setTodaySales(total);
                    return;
                }

                total = (snapshotSalesEntries || [])
                    .filter(entry => entry && entry.date === todayKey)
                    .reduce((sum, entry) => sum + normalizeAmount(entry.price), 0);

                if (total > 0) {
                    setTodaySales(total);
                    return;
                }

                let todayData = salesData[todayKey];

                if (!todayData) {
                    const matchedEntry = Object.entries(salesData).find(([key, value]) => {
                        const normalizedKey = normalizeDateKeyString(key);
                        if (normalizedKey === todayKey) return true;
                        if (value && typeof value === 'object') {
                            const candidate = normalizeDateKeyString(value.date || value.dateKey || value.dateString);
                            if (candidate === todayKey) return true;
                        }
                        return false;
                    });
                    if (matchedEntry) {
                        todayData = matchedEntry[1];
                    }
                }

                if (!todayData && Array.isArray(dailySales) && dailySales.length > 0) {
                    const dailyMatches = dailySales.filter(entry => {
                        const normalized = normalizeDateKeyString(entry?.date || entry?.dateKey);
                        return normalized === todayKey;
                    });
                    if (dailyMatches.length > 0) {
                        const sum = dailyMatches.reduce((sum, entry) => sum + normalizeAmount(entry.price), 0);
                        if (sum > 0) {
                            setTodaySales(sum);
                            return;
                        }
                    }
                }

                if (todayData) {
                    const normalizedToday = normalizeSalesEntry(todayData);
                    const detailSum = (normalizedToday.details || []).reduce((sum, detail) => sum + (detail.price || 0), 0);
                    const fallbackAmount = normalizeAmount(normalizedToday.amount);
                    setTodaySales(detailSum > 0 ? detailSum : fallbackAmount);
                } else {
                    setTodaySales(0);
                }
            }, [categoryDetailsCache, snapshotSalesEntries, dailySales, salesData, selectedMonth, selectedYear]);

            // Ïù¥Î≤àÏ£º Îß§Ï∂ú Í≥ÑÏÇ∞
            const getThisWeekSales = React.useCallback(() => {
                const today = new Date();
                // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎÖÑÏõîÏù¥ Ïò§ÎäòÍ≥º Í∞ôÏùÄÏßÄ ÌôïÏù∏
                if (today.getMonth() === selectedMonth && today.getFullYear() === selectedYear) {
                    const currentWeek = weeklySales.find(week => {
                        return week && week.days && Array.isArray(week.days) && week.days.includes(today.getDate());
                    });
                    return currentWeek && !isNaN(currentWeek.total) ? currentWeek.total : 0;
                }
                return 0;
            }, [weeklySales, selectedMonth, selectedYear]);

            // ÌååÏù¥ Ï∞®Ìä∏ Î†åÎçîÎßÅ
            React.useEffect(() => {
                const canvas = document.getElementById('categoryPieChart');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
                if (window.categoryPieChartInstance) {
                    window.categoryPieChartInstance.destroy();
                }

                // 0Ïù¥ ÏïÑÎãå Ïπ¥ÌÖåÍ≥†Î¶¨Îßå ÌïÑÌÑ∞ÎßÅ
                const validCategories = categorySnapshots.filter(cat => cat.total > 0);

                // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Îïå Îπà Ï∞®Ìä∏ ÌëúÏãú
                const hasData = validCategories.length > 0;
                const displayCategories = hasData ? validCategories : [{
                    key: 'empty',
                    label: 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå',
                    icon: 'üìä',
                    color: '#64748b',
                    total: 1
                }];

                // Í∏ÄÎûòÏä§Î™®ÌîºÏ¶ò Í∑∏ÎùºÎç∞Ïù¥ÏÖò ÏÉùÏÑ±
                const createGlassGradient = (ctx, color) => {
                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    // ÏÉâÏÉÅÏùÑ rgbaÎ°ú Î≥ÄÌôòÌïòÏó¨ Ìà¨Î™ÖÎèÑ Ï†ÅÏö©
                    const hexToRgba = (hex, alpha) => {
                        const r = parseInt(hex.slice(1, 3), 16);
                        const g = parseInt(hex.slice(3, 5), 16);
                        const b = parseInt(hex.slice(5, 7), 16);
                        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                    };
                    gradient.addColorStop(0, hexToRgba(color, 0.85));
                    gradient.addColorStop(0.5, hexToRgba(color, 0.65));
                    gradient.addColorStop(1, hexToRgba(color, 0.85));
                    return gradient;
                };

                const glassColors = displayCategories.map(cat => createGlassGradient(ctx, cat.color));

                // Î≤îÎ°Ä ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ Ïª§Ïä§ÌÑ∞ÎßàÏù¥Ïßï ÌîåÎü¨Í∑∏Ïù∏
                const legendColorPlugin = {
                    id: 'legendColor',
                    afterUpdate(chart) {
                        const legend = chart.legend;
                        if (legend && legend.legendItems) {
                            legend.legendItems.forEach((item, i) => {
                                if (displayCategories[i]) {
                                    item.fontColor = displayCategories[i].color;
                                }
                            });
                        }
                    },
                    afterDraw(chart) {
                        const legend = chart.legend;
                        if (!legend) return;

                        const ctx = chart.ctx;
                        legend.legendItems.forEach((item, i) => {
                            if (displayCategories[i]) {
                                const legendItem = legend.legendHitBoxes[i];
                                if (legendItem) {
                                    ctx.save();
                                    ctx.fillStyle = displayCategories[i].color;
                                    ctx.restore();
                                }
                            }
                        });
                    }
                };

                // Ï∞®Ìä∏ Ï§ëÏïôÏóê Ï¥ùÎß§Ï∂ú ÌëúÏãú ÌîåÎü¨Í∑∏Ïù∏
                const centerTextPlugin = {
                    id: 'centerText',
                    afterDatasetsDraw(chart) {
                        if (!chart || !chart.ctx || !chart.chartArea) return;

                        const { ctx, chartArea } = chart;
                        const { left, top, right, bottom } = chartArea;

                        ctx.save();

                        try {
                            // Ï¥ùÎß§Ï∂ú Í≥ÑÏÇ∞
                            const total = hasData ? validCategories.reduce((sum, cat) => sum + (cat.total || 0), 0) : 0;
                            const totalText = total.toLocaleString() + 'Ïõê';

                            // Ï§ëÏïô Ï¢åÌëú Î∞è Í∞ÄÏö© Î∞òÍ≤Ω Í≥ÑÏÇ∞
                            const centerX = (left + right) / 2;
                            const centerY = (top + bottom) / 2;

                            // Ï∞®Ìä∏Ïùò ÏïàÏ™Ω Î∞òÏßÄÎ¶Ñ(innerRadius)ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Í∞ÄÏö© ÎÑàÎπÑ Í≥ÑÏÇ∞ (Ï¢åÏö∞ Ïó¨Î∞± 10% Ï†úÏô∏)
                            const innerRadius = chart.innerRadius || 0;
                            const maxTextWidth = innerRadius * 1.8; // ÏßÄÎ¶ÑÏùò ÏïΩ 90%

                            const isMobileView = window.innerWidth < 768;

                            // 1. ÎùºÎ≤® ÌÖçÏä§Ìä∏ (XXÏõî Ï¥ù Îß§Ï∂ú) - ÎèôÏ†ÅÏúºÎ°ú ÌÅ¨Í∏∞ Ï°∞Ï†à
                            let labelFontSize = isMobileView ? 11 : 16;
                            ctx.font = `bold ${labelFontSize}px Pretendard, sans-serif`;
                            const monthText = `${selectedMonth + 1}Ïõî Ï¥ù Îß§Ï∂ú`;

                            // ÎÑàÎ¨¥ Í∏∏Î©¥ Ï§ÑÏù¥Í∏∞
                            let labelWidth = ctx.measureText(monthText).width;
                            if (labelWidth > maxTextWidth) {
                                labelFontSize = Math.floor(labelFontSize * (maxTextWidth / labelWidth));
                                ctx.font = `bold ${labelFontSize}px Pretendard, sans-serif`;
                            }

                            ctx.fillStyle = '#9ca3af';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.shadowBlur = 0;
                            ctx.fillText(monthText, centerX, centerY - (isMobileView ? 15 : 25));

                            // 2. Í∏àÏï° ÌÖçÏä§Ìä∏ - ÎèôÏ†ÅÏúºÎ°ú ÌÅ¨Í∏∞ Ï°∞Ï†à
                            let amountFontSize = isMobileView ? 18 : 32;
                            ctx.font = `bold ${amountFontSize}px Pretendard, sans-serif`;

                            // ÌÖçÏä§Ìä∏ ÎÑàÎπÑ Ï∏°Ï†ï ÌõÑ Í∞ÄÏö© ÎÑàÎπÑÎ•º ÎÑòÏúºÎ©¥ Ìè∞Ìä∏ ÌÅ¨Í∏∞ Ï∂ïÏÜå
                            let textWidth = ctx.measureText(totalText).width;
                            if (textWidth > maxTextWidth) {
                                amountFontSize = Math.floor(amountFontSize * (maxTextWidth / textWidth));
                                ctx.font = `bold ${amountFontSize}px Pretendard, sans-serif`;
                            }

                            ctx.fillStyle = '#FF6B35';
                            ctx.shadowColor = 'rgba(255, 107, 53, 0.6)';
                            ctx.shadowBlur = isMobileView ? 5 : 15;

                            ctx.fillText(totalText, centerX, centerY + (isMobileView ? 10 : 12));
                        } catch (error) {
                            console.error('Center text plugin error:', error);
                        }

                        ctx.restore();
                    }
                };

                const ChartCtor = window.Chart || window.ChartJS;
                window.categoryPieChartInstance = new ChartCtor(ctx, {
                    type: 'doughnut',
                    plugins: [legendColorPlugin, centerTextPlugin],
                    data: {
                        labels: displayCategories.map(cat => cat.label),
                        datasets: [{
                            data: displayCategories.map(cat => cat.total),
                            backgroundColor: glassColors,
                            borderColor: displayCategories.map(cat => cat.color),
                            borderWidth: hasData ? 3 : 2,
                            hoverBorderWidth: hasData ? 4 : 2,
                            hoverBorderColor: hasData ? '#ffffff' : '#64748b'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        cutout: '65%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: 'Pretendard, sans-serif',
                                        size: 12,
                                        weight: '600'
                                    },
                                    padding: 16,
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    generateLabels: (chart) => {
                                        const data = chart.data;
                                        return data.labels.map((label, i) => {
                                            const value = data.datasets[0].data[i];
                                            const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                            const percentage = hasData ? ((value / total) * 100).toFixed(1) : '0.0';
                                            return {
                                                text: `${displayCategories[i].icon} ${label}: ${percentage}%`,
                                                fillStyle: displayCategories[i].color,
                                                strokeStyle: displayCategories[i].color,
                                                fontColor: displayCategories[i].color,
                                                hidden: false,
                                                index: i
                                            };
                                        });
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                titleColor: '#F9FAFB',
                                bodyColor: '#E5E7EB',
                                borderColor: 'rgba(148, 163, 184, 0.3)',
                                borderWidth: 1,
                                padding: 16,
                                displayColors: true,
                                boxPadding: 6,
                                usePointStyle: true,
                                callbacks: {
                                    label: (context) => {
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: ${value.toLocaleString()}Ïõê (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });

                return () => {
                    if (window.categoryPieChartInstance) {
                        window.categoryPieChartInstance.destroy();
                        window.categoryPieChartInstance = null;
                    }
                };
            }, [JSON.stringify(categorySnapshots.map(c => ({ key: c.key, total: c.total })))]);

            // SVG ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏
            const Icon = ({ icon: iconName, size = 24, style = {}, className = "" }) => {
                const svgIcons = {
                    "calendar": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    ),
                    "dollar-sign": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    ),
                    "check": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    ),
                    "trending-up": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                    ),
                    "edit": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    ),
                    "plus": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    ),
                    "trash-2": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    ),
                    "user": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    ),
                    "package": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                        </svg>
                    ),
                    "credit-card": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                    ),
                    "search": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    ),
                    "x": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    ),
                    "info": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12" y2="8"></line>
                        </svg>
                    ),
                    "clock": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    )
                };

                return svgIcons[iconName] || <span>‚Ä¢</span>;
            };

            // Ïà´ÏûêÏóê Ï≤ú Îã®ÏúÑ ÏΩ§Îßà Ï∂îÍ∞Ä Ìï®Ïàò
            const formatNumberWithCommas = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            };

            // ÏΩ§ÎßàÍ∞Ä ÏûàÎäî Ïà´ÏûêÏóêÏÑú ÏΩ§Îßà Ï†úÍ±∞ Ìï®Ïàò
            const removeCommas = (str) => {
                return str.replace(/,/g, '');
            };

            // Í∏àÏï°Ïóê Îî∞Î•∏ ÏÉâÏÉÅ Î∞òÌôò Ìï®Ïàò
            const getPriceColor = (price) => {
                if (price >= 1000000) return '#FF6B6B'; // 100ÎßåÏõê Ïù¥ÏÉÅ: Îπ®Í∞ÑÏÉâ
                if (price >= 500000) return '#FFD93D'; // 50ÎßåÏõê Ïù¥ÏÉÅ: ÎÖ∏ÎûÄÏÉâ
                if (price >= 300000) return '#6BCF7F'; // 30ÎßåÏõê Ïù¥ÏÉÅ: Ï¥àÎ°ùÏÉâ
                if (price >= 100000) return '#4ECDC4'; // 10ÎßåÏõê Ïù¥ÏÉÅ: Ï≤≠Î°ùÏÉâ
                return '#95E1D3'; // 10ÎßåÏõê ÎØ∏Îßå: Ïó∞Ìïú ÎØºÌä∏ÏÉâ
            };

            // Ïò§Îäò ÎÇ†ÏßúÎ°ú Ïä§ÌÅ¨Î°§ÌïòÎäî Ìï®Ïàò
            const scrollToToday = () => {
                const today = new Date();
                if (today.getMonth() === selectedMonth && today.getFullYear() === selectedYear) {
                    const todayDay = today.getDate();
                    const todayElement = document.getElementById(`day-${todayDay}`);
                    if (todayElement) {
                        todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                    // ÌòÑÏû¨ ÏõîÏù¥ ÏïÑÎãàÎ©¥ ÌòÑÏû¨ ÏõîÎ°ú Î≥ÄÍ≤Ω
                    setSelectedMonth(today.getMonth());
                    setSelectedYear(today.getFullYear());
                    setTimeout(() => {
                        const todayDay = today.getDate();
                        const todayElement = document.getElementById(`day-${todayDay}`);
                        if (todayElement) {
                            todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 500);
                }
            };

            // ÌöåÏõê Í≤ÄÏÉâ Ìï®Ïàò (Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Í≤ÄÏÉâ)
            const searchCustomer = async () => {
                if (!searchQuery.trim()) {
                    alert('Í≤ÄÏÉâÌï† ÌöåÏõêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    // FirebaseÏóêÏÑú Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Í≤ÄÏÉâ
                    const response = await salesService.searchCustomerInAllData(searchQuery);

                    if (!response.success) {
                        alert('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        return;
                    }

                    if (response.data.length === 0) {
                        alert('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                        return;
                    }

                    setSearchResults(response.data);
                    setShowSearchResultModal(true);
                } catch (error) {
                    console.error('Í≤ÄÏÉâ Ïò§Î•ò:', error);
                    alert('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            };

            // Îß§Ï∂ú ÏûÖÎ†• Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const createEmptyModalState = () => ({
                customerName: '',
                healthProduct: '',
                ptProduct: '',
                pilatesProduct: '',
                neofitProduct: '',
                lockerProduct: '',
                lockerType: '',
                lockerPeriod: '',
                price: '',
                discounts: {},
                manualPriceEdit: false,
                otherItemName: '',
                otherItemPrice: ''
            });

            const deriveModalStateFromDetail = (detail) => {
                const state = createEmptyModalState();

                if (!detail) {
                    return state;
                }

                state.customerName = detail.customerName || '';

                const normalizedPrice = normalizeAmount(detail.price);
                state.price = normalizedPrice > 0 ? formatNumberWithCommas(normalizedPrice) : '';
                state.manualPriceEdit = true;

                let recognizedLineItem = false;
                const discounts = {};

                if (Array.isArray(detail.lineItems) && detail.lineItems.length > 0) {
                    detail.lineItems.forEach(item => {
                        if (!item) return;

                        const itemKey = item.key || item.categoryKey;
                        const productName = item.productName || item.product || '';
                        const discountAmount = normalizeAmount(item.discountAmount);

                        if (discountAmount > 0 && itemKey) {
                            discounts[itemKey] = formatNumberWithCommas(discountAmount);
                        }

                        switch (itemKey) {
                            case 'health':
                                if (productPrices[productName] !== undefined) {
                                    state.healthProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'pt':
                                if (productPrices[productName] !== undefined) {
                                    state.ptProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'pilates':
                                if (productPrices[productName] !== undefined) {
                                    state.pilatesProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'neofit':
                                if (productPrices[productName] !== undefined) {
                                    state.neofitProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'locker':
                            case 'clothing': {
                                if (productName) {
                                    const [type, period] = productName.split(' ');
                                    if (type && period) {
                                        state.lockerType = type;
                                        state.lockerPeriod = period;
                                        recognizedLineItem = true;
                                    }
                                }
                                break;
                            }
                            default:
                                break;
                        }
                    });

                    if (recognizedLineItem) {
                        state.manualPriceEdit = false;
                        state.price = normalizedPrice > 0 ? formatNumberWithCommas(normalizedPrice) : '';
                    }
                }

                if (Object.keys(discounts).length > 0) {
                    state.discounts = discounts;
                }

                if (!recognizedLineItem) {
                    state.manualPriceEdit = true;
                    state.otherItemName = detail.product || '';
                    state.otherItemPrice = normalizedPrice > 0 ? formatNumberWithCommas(normalizedPrice) : '';
                    state.discounts = {};
                }

                return state;
            };

            const AddSaleModal = () => {
                const isEditing = Boolean(editingDetailContext);

                const [modalData, setModalData] = useState(() => (
                    isEditing && editingDetailContext
                        ? deriveModalStateFromDetail(editingDetailContext.detail)
                        : createEmptyModalState()
                ));

                React.useEffect(() => {
                    if (!showAddSaleModal) {
                        return;
                    }

                    if (isEditing && editingDetailContext) {
                        setModalData(deriveModalStateFromDetail(editingDetailContext.detail));
                    } else {
                        setModalData(createEmptyModalState());
                    }
                }, [showAddSaleModal, isEditing, editingDetailContext]);

                const selectedLineItems = React.useMemo(() => {
                    const discounts = modalData.discounts || {};
                    const items = [];

                    const buildItem = ({ key, label, productName, categoryKey, originalPrice, discountEligible = false, displayName }) => {
                        if (!productName || !Number.isFinite(originalPrice)) {
                            return;
                        }

                        const rawDiscount = discounts[key] ? parseInt(removeCommas(discounts[key])) || 0 : 0;
                        const sanitizedDiscount = discountEligible
                            ? Math.min(originalPrice, Math.max(0, rawDiscount))
                            : 0;

                        items.push({
                            key,
                            label,
                            productName,
                            categoryKey,
                            originalPrice,
                            discountAmount: sanitizedDiscount,
                            finalPrice: Math.max(0, originalPrice - sanitizedDiscount),
                            displayName,
                            discountInput: discounts[key] || '',
                            discountEligible
                        });
                    };

                    if (modalData.healthProduct) {
                        const productName = modalData.healthProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'health',
                            label: 'Ìó¨Ïä§ Ïù¥Ïö©Í∂å',
                            productName,
                            categoryKey: 'health',
                            originalPrice,
                            discountEligible: true,
                            displayName: `Ìó¨Ïä§: ${productName}`
                        });
                    }

                    if (modalData.ptProduct) {
                        const productName = modalData.ptProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'pt',
                            label: '1:1 PT Ïù¥Ïö©Í∂å',
                            productName,
                            categoryKey: 'pt',
                            originalPrice,
                            discountEligible: true,
                            displayName: `PT: ${productName}`
                        });
                    }

                    if (modalData.pilatesProduct) {
                        const productName = modalData.pilatesProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'pilates',
                            label: 'ÌïÑÎùºÌÖåÏä§ Ïù¥Ïö©Í∂å',
                            productName,
                            categoryKey: 'pilates',
                            originalPrice,
                            discountEligible: true,
                            displayName: `ÌïÑÎùºÌÖåÏä§: ${productName}`
                        });
                    }

                    if (modalData.neofitProduct) {
                        const productName = modalData.neofitProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'neofit',
                            label: 'ÎÑ§Ïò§Ìïè Ïù¥Ïö©Í∂å',
                            productName,
                            categoryKey: 'neofit',
                            originalPrice,
                            discountEligible: true,
                            displayName: `ÎÑ§Ïò§Ìïè: ${productName}`
                        });
                    }

                    if (modalData.lockerType && modalData.lockerPeriod) {
                        const lockerKey = `${modalData.lockerType} ${modalData.lockerPeriod}`;
                        const originalPrice = productPrices[lockerKey] || 0;
                        buildItem({
                            key: 'locker',
                            label: `${modalData.lockerType}`,
                            productName: `${modalData.lockerType} ${modalData.lockerPeriod}`,
                            categoryKey: 'clothing',
                            originalPrice,
                            discountEligible: false,
                            displayName: `${modalData.lockerType}: ${modalData.lockerPeriod}`
                        });
                    }

                    return items;
                }, [modalData.healthProduct, modalData.ptProduct, modalData.pilatesProduct, modalData.neofitProduct, modalData.lockerType, modalData.lockerPeriod, modalData.discounts]);

                const lineItemTotals = React.useMemo(() => {
                    const originalSum = selectedLineItems.reduce((sum, item) => sum + (item.originalPrice || 0), 0);
                    const discountSum = selectedLineItems.reduce((sum, item) => sum + (item.discountEligible ? item.discountAmount : 0), 0);
                    const finalSum = selectedLineItems.reduce((sum, item) => sum + (item.finalPrice || 0), 0);
                    return { originalSum, discountSum, finalSum };
                }, [selectedLineItems]);

                React.useEffect(() => {
                    if (selectedLineItems.length > 0 && modalData.manualPriceEdit) {
                        setModalData(prev => ({ ...prev, manualPriceEdit: false }));
                    }
                }, [selectedLineItems.length]);

                React.useEffect(() => {
                    if (!modalData.manualPriceEdit) {
                        const formatted = selectedLineItems.length > 0
                            ? formatNumberWithCommas(lineItemTotals.finalSum)
                            : (lineItemTotals.finalSum > 0 ? formatNumberWithCommas(lineItemTotals.finalSum) : '');
                        setModalData(prev => (prev.price === formatted ? prev : { ...prev, price: formatted }));
                    }
                }, [lineItemTotals.finalSum, modalData.manualPriceEdit, selectedLineItems.length]);

                React.useEffect(() => {
                    const activeKeys = new Set(selectedLineItems.map(item => item.key));
                    setModalData(prev => {
                        const nextDiscounts = Object.entries(prev.discounts || {}).reduce((acc, [key, value]) => {
                            if (activeKeys.has(key) && value !== '') {
                                acc[key] = value;
                            }
                            return acc;
                        }, {});

                        if (JSON.stringify(nextDiscounts) === JSON.stringify(prev.discounts || {})) {
                            return prev;
                        }

                        return { ...prev, discounts: nextDiscounts };
                    });
                }, [selectedLineItems]);

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    const selectedProducts = [];
                    if (selectedLineItems.length > 0) {
                        selectedLineItems.forEach(item => {
                            const discountText = item.discountEligible && item.discountAmount > 0
                                ? ` (Ìï†Ïù∏ ${item.discountAmount.toLocaleString()}Ïõê)`
                                : '';
                            selectedProducts.push(`${item.displayName}${discountText}`);
                        });
                    }
                    const manualProductLabel = (modalData.otherItemName || '').trim();
                    if (selectedLineItems.length === 0 && manualProductLabel) {
                        selectedProducts.push(manualProductLabel);
                    }

                    const finalAmount = selectedLineItems.length > 0
                        ? lineItemTotals.finalSum
                        : normalizeAmount(removeCommas(modalData.price));
                    const hasPrice = finalAmount > 0;
                    let finalCustomerName = (modalData.customerName || '').trim();

                    // ÏùºÎ∞ò Îß§Ï∂úÏùÄ ÌöåÏõêÎ™ÖÍ≥º ÏÉÅÌíàÏù¥ ÌïÑÏöîÌïòÏßÄÎßå, Í∞ÄÍ≤©Îßå ÏûàÏñ¥ÎèÑ Îì±Î°ù Í∞ÄÎä•
                    if (!finalCustomerName && selectedProducts.length === 0 && !hasPrice) {
                        alert('Îß§Ï∂ú Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }

                    if (!finalCustomerName && hasPrice) {
                        finalCustomerName = 'ÏßÅÏ†ëÏûÖÎ†•';
                    }

                    if (!finalCustomerName) {
                        alert('ÌöåÏõêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }

                    if (selectedLineItems.length === 0 && !hasPrice) {
                        alert('Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }

                    if (selectedProducts.length === 0) {
                        if (hasPrice) {
                            selectedProducts.push(manualProductLabel || 'ÏßÅÏ†ëÏûÖÎ†•');
                        } else {
                            alert('ÏÉÅÌíà ÎòêÎäî Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                            return;
                        }
                    }

                    const dateKey = (isEditing && editingDetailContext?.dateKey)
                        ? editingDetailContext.dateKey
                        : getDateKey(selectedModalDay);

                    const detailLineItems = selectedLineItems.map(item => ({
                        key: item.key,
                        categoryKey: item.categoryKey,
                        product: item.displayName,
                        productName: item.productName,
                        originalPrice: item.originalPrice,
                        finalPrice: item.finalPrice,
                        discountAmount: item.discountEligible ? item.discountAmount : 0,
                        discountEligible: item.discountEligible
                    }));

                    const baseDetail = isEditing && editingDetailContext?.detail ? editingDetailContext.detail : {};
                    const targetDetailId = isEditing && editingDetailContext?.detailId
                        ? editingDetailContext.detailId
                        : Date.now() + Math.random();

                    const timestamp = baseDetail.timestamp
                        ? baseDetail.timestamp
                        : new Date().toLocaleTimeString('ko-KR', {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });

                    const updatedDetail = {
                        ...baseDetail,
                        id: targetDetailId,
                        customerName: finalCustomerName,
                        product: selectedProducts.join(', '),
                        price: finalAmount,
                        timestamp
                    };

                    if (detailLineItems.length > 0) {
                        const originalTotal = detailLineItems.reduce((sum, item) => sum + (item.originalPrice || 0), 0);
                        const discountTotal = detailLineItems.reduce((sum, item) => sum + (item.discountAmount || 0), 0);
                        updatedDetail.lineItems = detailLineItems;
                        updatedDetail.originalTotal = originalTotal;
                        updatedDetail.discountTotal = discountTotal;
                    } else {
                        delete updatedDetail.lineItems;
                        delete updatedDetail.originalTotal;
                        updatedDetail.discountTotal = 0;
                    }

                    // FirebaseÏóê Ï†ÄÏû•
                    const currentData = normalizeSalesEntry(salesData[dateKey]);
                    let newDetails;

                    if (isEditing) {
                        let replaced = false;
                        newDetails = currentData.details.map(detail => {
                            if (!replaced && detail.id === targetDetailId) {
                                replaced = true;
                                return updatedDetail;
                            }
                            return detail;
                        });

                        if (!replaced) {
                            newDetails = [...newDetails, updatedDetail];
                        }
                    } else {
                        newDetails = [...currentData.details, updatedDetail];
                    }

                    const normalizedDetails = normalizeDetailList(newDetails);
                    const newTotalAmount = normalizedDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);

                    const updatedData = {
                        ...currentData,
                        details: normalizedDetails,
                        amount: newTotalAmount,
                        date: dateKey
                    };

                    try {
                        await salesService.saveSalesData(dateKey, updatedData);
                        console.log('Îß§Ï∂ú Îç∞Ïù¥ÌÑ∞ Firebase Ï†ÄÏû• ÏôÑÎ£å:', dateKey);
                    } catch (error) {
                        console.error('Firebase Ï†ÄÏû• Ïã§Ìå®:', error);
                        alert('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }

                    closeSaleModal();
                    setModalData(createEmptyModalState());

                    // Ïò§Îäò ÎÇ†ÏßúÎ°ú Ïä§ÌÅ¨Î°§
                    setTimeout(() => {
                        const dayElement = document.getElementById(`day-${selectedModalDay}`);
                        if (dayElement && dailyViewRef.current) {
                            dayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 100);
                };

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={closeSaleModal}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '500px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#00FF88' }}>
                                {selectedMonth + 1}Ïõî {selectedModalDay}Ïùº {isEditing ? 'Îß§Ï∂ú ÏàòÏ†ï' : 'Îß§Ï∂ú ÏûÖÎ†•'}
                            </h3>

                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">ÌöåÏõêÎ™Ö</label>
                                    <input
                                        type="text"
                                        value={modalData.customerName}
                                        onChange={(e) => setModalData({ ...modalData, customerName: e.target.value })}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                        placeholder="ÌöåÏõêÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                        autoFocus
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">Ìó¨Ïä§ Ïù¥Ïö©Í∂å</label>
                                    <select
                                        value={modalData.healthProduct}
                                        onChange={(e) => setModalData({ ...modalData, healthProduct: e.target.value })}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">Ìó¨Ïä§ Ïù¥Ïö©Í∂å ÏÑ†ÌÉù</option>
                                        {healthProducts.map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">1:1 PT Ïù¥Ïö©Í∂å</label>
                                    <select
                                        value={modalData.ptProduct}
                                        onChange={(e) => setModalData({ ...modalData, ptProduct: e.target.value })}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">1:1 PT Ïù¥Ïö©Í∂å ÏÑ†ÌÉù</option>
                                        {ptProducts.map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">ÌïÑÎùºÌÖåÏä§ Ïù¥Ïö©Í∂å</label>
                                    <select
                                        value={modalData.pilatesProduct}
                                        onChange={(e) => setModalData({ ...modalData, pilatesProduct: e.target.value })}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">ÌïÑÎùºÌÖåÏä§ Ïù¥Ïö©Í∂å ÏÑ†ÌÉù</option>
                                        <option disabled style={{ color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)' }}>
                                            ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ï£º 2Ìöå ÏÉÅÌíà ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                        </option>
                                        {pilatesProducts.slice(0, 3).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                        <option disabled style={{ color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)' }}>
                                            ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ï£º 3Ìöå ÏÉÅÌíà ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                        </option>
                                        {pilatesProducts.slice(3, 6).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">ÎÑ§Ïò§Ìïè Ïù¥Ïö©Í∂å</label>
                                    <select
                                        value={modalData.neofitProduct}
                                        onChange={(e) => setModalData({ ...modalData, neofitProduct: e.target.value })}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">ÎÑ§Ïò§Ìïè Ïù¥Ïö©Í∂å ÏÑ†ÌÉù</option>
                                        <option value={neofitProducts[0]}>
                                            {neofitProducts[0]} - {productPrices[neofitProducts[0]].toLocaleString()}Ïõê
                                        </option>
                                        <option value={neofitProducts[1]}>
                                            {neofitProducts[1]} - {productPrices[neofitProducts[1]].toLocaleString()}Ïõê
                                        </option>
                                        <option value={neofitProducts[2]}>
                                            {neofitProducts[2]} - {productPrices[neofitProducts[2]].toLocaleString()}Ïõê
                                        </option>
                                        <option disabled style={{ color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)' }}>
                                            ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ÎÑ§Ïò§Ìïè Î¨¥Ï†úÌïúÍ∂å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                        </option>
                                        {neofitProducts.slice(3, 6).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                        <option disabled style={{ color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)' }}>
                                            ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ÎÑ§Ïò§Ìïè Ï£º 2Ìöå ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                        </option>
                                        {neofitProducts.slice(6, 9).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                        <option disabled style={{ color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)' }}>
                                            ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ÎÑ§Ïò§Ìïè Ï£º 3Ìöå ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                                        </option>
                                        {neofitProducts.slice(9, 12).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}Ïõê
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ ÏÑ†ÌÉù</label>
                                    <select
                                        value={modalData.lockerType}
                                        onChange={(e) => setModalData({ ...modalData, lockerType: e.target.value, lockerPeriod: '' })}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ ÏÑ†ÌÉù</option>
                                        {lockerProducts.map(product => (
                                            <option key={product} value={product}>{product}</option>
                                        ))}
                                    </select>
                                </div>

                                {modalData.lockerType && (
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-300">{modalData.lockerType} Ïù¥Ïö© Í∏∞Í∞Ñ</label>
                                        <select
                                            value={modalData.lockerPeriod}
                                            onChange={(e) => setModalData({ ...modalData, lockerPeriod: e.target.value })}
                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                        >
                                            <option value="">Í∏∞Í∞Ñ ÏÑ†ÌÉù</option>
                                            {lockerPeriods.map(period => {
                                                const priceKey = `${modalData.lockerType} ${period}`;
                                                const price = productPrices[priceKey] || 0;
                                                return (
                                                    <option key={period} value={period}>
                                                        {period} - {price.toLocaleString()}Ïõê
                                                    </option>
                                                );
                                            })}
                                        </select>
                                    </div>
                                )}

                                {/* Í∏∞ÌÉÄ Îß§Ï∂ú ÏûÖÎ†• ÏÑπÏÖò */}
                                <div style={{ borderTop: '1px solid rgba(139, 92, 246, 0.3)', paddingTop: '1rem', marginTop: '1rem' }}>
                                    <label className="block text-sm font-semibold mb-2" style={{ color: '#c084fc' }}>Í∏∞ÌÉÄ Îß§Ï∂ú</label>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                        <input
                                            type="text"
                                            value={modalData.otherItemName || ''}
                                            onChange={(e) => setModalData({ ...modalData, otherItemName: e.target.value })}
                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-purple-400 focus:outline-none"
                                            placeholder="Ìï≠Î™©Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: PTÏàòÏóÖ, Í∞úÏù∏Î†àÏä®)"
                                            style={{ fontSize: '16px' }}
                                        />
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={modalData.otherItemPrice || ''}
                                            onChange={(e) => {
                                                const value = e.target.value.replace(/[^0-9]/g, '');
                                                if (value === '') {
                                                    setModalData({ ...modalData, otherItemPrice: '' });
                                                } else {
                                                    setModalData({ ...modalData, otherItemPrice: formatNumberWithCommas(value) });
                                                }
                                            }}
                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-purple-400 focus:outline-none"
                                            placeholder="Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                            style={{ fontSize: '16px' }}
                                        />
                                        <button
                                            type="button"
                                            onClick={async () => {
                                                if (isEditing) {
                                                    alert('ÏàòÏ†ï Î™®ÎìúÏóêÏÑúÎäî Í∏∞ÌÉÄ Îß§Ï∂ú Ï∂îÍ∞Ä Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                                                    return;
                                                }
                                                if (modalData.otherItemName && modalData.otherItemPrice) {
                                                    const otherPrice = normalizeAmount(modalData.otherItemPrice);
                                                    const dateKey = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(selectedModalDay).padStart(2, '0')}`;

                                                    const newDetail = {
                                                        id: Date.now() + Math.random(),
                                                        customerName: 'Í∏∞ÌÉÄ',
                                                        product: modalData.otherItemName,
                                                        price: otherPrice,
                                                        timestamp: new Date().toLocaleTimeString('ko-KR', {
                                                            hour: '2-digit',
                                                            minute: '2-digit',
                                                            second: '2-digit'
                                                        })
                                                    };

                                                    // ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                                                    const currentData = normalizeSalesEntry(salesData[dateKey]);
                                                    const newDetails = [...currentData.details, newDetail];
                                                    const newTotalAmount = newDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);

                                                    const updatedData = {
                                                        ...currentData,
                                                        date: dateKey,
                                                        amount: newTotalAmount,
                                                        details: normalizeDetailList(newDetails),
                                                        approved: false
                                                    };

                                                    // FirebaseÏóê Ï†ÄÏû•
                                                    const result = await salesService.saveSalesData(dateKey, updatedData);

                                                    if (!result.success) {
                                                        console.error('[NeoFit] Í∏∞ÌÉÄ Îß§Ï∂ú Ï†ÄÏû• Ïã§Ìå®', result.error);
                                                        console.warn('FirebaseÏóê Ï†ÄÏû•ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Îßå ÏóÖÎç∞Ïù¥Ìä∏Ìï©ÎãàÎã§.');
                                                    }

                                                    // Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Firebase Ïã§Ìå® ÏãúÏóêÎèÑ Î∞òÏòÅ)
                                                    setSalesData(prev => ({
                                                        ...prev,
                                                        [dateKey]: normalizeSalesEntry(updatedData)
                                                    }));

                                                    // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
                                                    setModalData({
                                                        ...modalData,
                                                        otherItemName: '',
                                                        otherItemPrice: ''
                                                    });

                                                    // Î™®Îã¨ Îã´Í∏∞
                                                    closeSaleModal();
                                                    alert('Í∏∞ÌÉÄ Îß§Ï∂úÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!');
                                                } else {
                                                    alert('Ìï≠Î™©Î™ÖÍ≥º Í∏àÏï°ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                                                }
                                            }}
                                            disabled={isEditing}
                                            className={`glass-effect border-purple-500 hover:border-purple-400 rounded-lg py-3 font-semibold transition-all hover:shadow-lg text-white ${isEditing ? 'opacity-60 cursor-not-allowed' : ''}`}
                                            style={{ background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(168, 85, 247, 0.3))' }}
                                        >
                                            Í∏∞ÌÉÄ Îß§Ï∂ú Ï∂îÍ∞Ä
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">ÏÉÅÌíàÎ≥Ñ Ìï†Ïù∏</label>
                                    {selectedLineItems.length === 0 ? (
                                        <div className="glass-effect rounded-lg px-4 py-3 text-sm text-gray-400">
                                            ÏÉÅÌíàÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Ï†ÅÏö© Í∞ÄÎä•Ìïú Ìï†Ïù∏ Í∏àÏï°ÏùÑ ÏûÖÎ†•Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {selectedLineItems.map((item) => {
                                                const palette = DISCOUNT_PALETTE[item.key] || DISCOUNT_PALETTE[item.categoryKey] || DISCOUNT_PALETTE.default;
                                                const discountPresets = [5, 10, 15, 20, 25];
                                                const activeDiscountAmount = normalizeAmount(modalData.discounts?.[item.key] || 0);
                                                return (
                                                    <div
                                                        key={item.key}
                                                        className="relative rounded-xl px-4 py-3 flex flex-col gap-2"
                                                        style={{
                                                            background: palette.cardBg,
                                                            border: `1px solid ${palette.cardBorder}`,
                                                            boxShadow: palette.cardShadow
                                                        }}
                                                    >
                                                        <button
                                                            type="button"
                                                            onClick={() => {
                                                                setModalData(prev => {
                                                                    const next = { ...prev };
                                                                    const updates = {};
                                                                    if (item.key === 'health') updates.healthProduct = '';
                                                                    if (item.key === 'pt') updates.ptProduct = '';
                                                                    if (item.key === 'pilates') updates.pilatesProduct = '';
                                                                    if (item.key === 'neofit') updates.neofitProduct = '';
                                                                    if (item.key === 'locker') {
                                                                        updates.lockerType = '';
                                                                        updates.lockerPeriod = '';
                                                                    }

                                                                    const nextDiscounts = { ...(next.discounts || {}) };
                                                                    delete nextDiscounts[item.key];

                                                                    return {
                                                                        ...next,
                                                                        ...updates,
                                                                        discounts: nextDiscounts,
                                                                        manualPriceEdit: false
                                                                    };
                                                                });
                                                            }}
                                                            className="absolute w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold transition-all"
                                                            style={{
                                                                bottom: '12px',
                                                                right: '12px',
                                                                background: palette.accent,
                                                                color: '#0f172a',
                                                                boxShadow: '0 0 12px rgba(15,23,42,0.35)',
                                                                border: '1px solid rgba(15,23,42,0.35)',
                                                                cursor: 'pointer'
                                                            }}
                                                        >
                                                            √ó
                                                        </button>
                                                        <div className="flex items-center justify-between gap-3">
                                                            <div>
                                                                <p className="font-semibold text-sm" style={{ color: palette.accent }}>{item.displayName}</p>
                                                                <p className="text-xs" style={{ color: 'rgba(226,232,240,0.65)' }}>
                                                                    Ï†ïÍ∞Ä {item.originalPrice.toLocaleString()}Ïõê ¬∑ Ìï†Ïù∏ ÌõÑ <span style={{ color: palette.accent }}>{item.finalPrice.toLocaleString()}Ïõê</span>
                                                                </p>
                                                            </div>
                                                            {item.discountEligible ? (
                                                                <div className="flex flex-col gap-2" style={{ width: '180px' }}>
                                                                    <input
                                                                        type="text"
                                                                        inputMode="numeric"
                                                                        value={modalData.discounts?.[item.key] || ''}
                                                                        onChange={(e) => {
                                                                            const digits = e.target.value.replace(/[^0-9]/g, '');
                                                                            const formatted = digits ? formatNumberWithCommas(digits) : '';
                                                                            setModalData((prev) => ({
                                                                                ...prev,
                                                                                discounts: {
                                                                                    ...(prev.discounts || {}),
                                                                                    [item.key]: formatted
                                                                                },
                                                                                manualPriceEdit: false
                                                                            }));
                                                                        }}
                                                                        placeholder="0"
                                                                        className="rounded-lg px-3 py-2 w-full text-right text-sm focus:outline-none"
                                                                        style={{
                                                                            background: palette.inputBg,
                                                                            border: `1px solid ${palette.inputBorder}`,
                                                                            color: palette.accent
                                                                        }}
                                                                    />
                                                                    <div className="flex flex-wrap gap-1.5">
                                                                        {discountPresets.map((percent) => {
                                                                            const presetAmount = Math.min(item.originalPrice, Math.round(item.originalPrice * (percent / 100)));
                                                                            const isActive = presetAmount === activeDiscountAmount && activeDiscountAmount > 0;

                                                                            return (
                                                                                <button
                                                                                    type="button"
                                                                                    key={`${item.key}-preset-${percent}`}
                                                                                    onClick={() => {
                                                                                        const formatted = presetAmount > 0 ? formatNumberWithCommas(presetAmount) : '';
                                                                                        setModalData((prev) => ({
                                                                                            ...prev,
                                                                                            discounts: {
                                                                                                ...(prev.discounts || {}),
                                                                                                [item.key]: formatted
                                                                                            },
                                                                                            manualPriceEdit: false
                                                                                        }));
                                                                                    }}
                                                                                    className={`px-2 py-1 rounded-full text-[11px] transition-colors ${isActive ? 'text-slate-900 font-semibold' : ''}`}
                                                                                    style={{
                                                                                        background: isActive ? palette.accent : 'rgba(15,23,42,0.35)',
                                                                                        border: `1px solid ${palette.inputBorder}`,
                                                                                        color: isActive ? '#0f172a' : palette.accent
                                                                                    }}
                                                                                >
                                                                                    {percent}%
                                                                                </button>
                                                                            );
                                                                        })}
                                                                        <button
                                                                            type="button"
                                                                            onClick={() => {
                                                                                setModalData((prev) => ({
                                                                                    ...prev,
                                                                                    discounts: {
                                                                                        ...(prev.discounts || {}),
                                                                                        [item.key]: ''
                                                                                    },
                                                                                    manualPriceEdit: false
                                                                                }));
                                                                            }}
                                                                            className="px-2 py-1 rounded-full text-[11px] transition-colors"
                                                                            style={{
                                                                                background: 'rgba(15,23,42,0.25)',
                                                                                border: `1px dashed ${palette.inputBorder}`,
                                                                                color: 'rgba(203,213,225,0.8)'
                                                                            }}
                                                                        >
                                                                            Ìï†Ïù∏ ÎØ∏Ï†ÅÏö©
                                                                        </button>
                                                                    </div>
                                                                    <p className="text-[10px] mt-1" style={{ color: 'rgba(226,232,240,0.45)' }}>ÏµúÎåÄ {item.originalPrice.toLocaleString()}Ïõê</p>
                                                                </div>
                                                            ) : (
                                                                <span className="text-[11px] px-2 py-1 rounded-full border" style={{ borderColor: palette.cardBorder, color: palette.accent }}>Ìï†Ïù∏ Ï†ÅÏö© Î∂àÍ∞Ä</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            <div className="flex items-center justify-between text-xs text-gray-400 px-1">
                                                <span>Ï¥ù Ìï†Ïù∏ Í∏àÏï°</span>
                                                <span className="text-emerald-300 font-semibold">
                                                    {lineItemTotals.discountSum > 0
                                                        ? `-${lineItemTotals.discountSum.toLocaleString()}Ïõê`
                                                        : '0Ïõê'}
                                                </span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">ÏµúÏ¢Ö Í∞ÄÍ≤©</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        value={modalData.price}
                                        readOnly={selectedLineItems.length > 0}
                                        onChange={(e) => {
                                            if (selectedLineItems.length > 0) {
                                                return;
                                            }
                                            const value = e.target.value.replace(/[^0-9]/g, '');
                                            if (value === '') {
                                                setModalData(prev => ({ ...prev, price: '', manualPriceEdit: true }));
                                            } else {
                                                setModalData(prev => ({ ...prev, price: formatNumberWithCommas(value), manualPriceEdit: true }));
                                            }
                                        }}
                                        className={`glass-effect rounded-lg px-4 py-3 w-full font-bold text-lg focus:border-green-400 focus:outline-none ${selectedLineItems.length > 0 ? 'text-emerald-200 cursor-not-allowed opacity-90' : 'text-green-400'}`}
                                        placeholder="ÏÉÅÌíàÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏßÅÏ†ë ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                        style={{ fontSize: '16px' }}
                                    />
                                    {selectedLineItems.length > 0 && (
                                        <p className="text-xs text-gray-500 mt-2">
                                            ÏÑ†ÌÉùÌïú ÏÉÅÌíà Ï†ïÍ∞ÄÏôÄ Ìï†Ïù∏ Í∏àÏï°ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÏûêÎèô Í≥ÑÏÇ∞Îê©ÎãàÎã§.
                                        </p>
                                    )}
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={closeSaleModal}
                                        className="flex-1 glass-effect hover:border-gray-400 rounded-lg py-3 font-semibold transition-all text-gray-300 hover:text-white"
                                    >
                                        Ï∑®ÏÜå
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 glass-effect border-green-500 hover:border-green-400 rounded-lg py-3 font-semibold transition-all hover:shadow-lg text-white"
                                    >
                                        {isEditing ? 'ÏàòÏ†ï ÏôÑÎ£å' : 'Îì±Î°ù'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Í≤ÄÏÉâ Í≤∞Í≥º Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const SearchResultModal = () => {
                const totalAmount = searchResults.reduce((sum, item) => sum + ((item.price || 0)), 0);
                const groupedByDate = searchResults.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowSearchResultModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#00FF88' }}>
                                '{searchQuery}' Í≤ÄÏÉâ Í≤∞Í≥º
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{searchResults.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Í≤∞Ï†ú Í∏àÏï°</p>
                                    <p className="text-3xl font-bold" style={{ color: '#00FF88' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                    <div key={date} className="glass-effect rounded-xl p-4">
                                        <div className="font-semibold text-gray-300 mb-3">{date}</div>
                                        <div className="space-y-2">
                                            {items.map((item, index) => {
                                                const amount = item.price || 0;
                                                const originalAmount = item.originalPrice || amount;
                                                const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                const discountAmount = discountAllowed
                                                    ? (item.discountAmount !== undefined
                                                        ? item.discountAmount
                                                        : Math.max(0, originalAmount - amount))
                                                    : 0;
                                                const hasDiscount = discountAllowed && discountAmount > 0;
                                                return (
                                                    <div key={index} className="flex justify-between items-start p-3 bg-gray-800/50 rounded-lg">
                                                        <div className="flex-1 pr-3">
                                                            <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                            <div className="text-xs text-gray-500 mt-1">{item.product}</div>
                                                            {hasDiscount && (
                                                                <div className="text-xs text-rose-300 mt-1">
                                                                    Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="text-right">
                                                            {hasDiscount && (
                                                                <div className="text-[11px] text-gray-500 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                            )}
                                                            <div className="font-bold" style={{ color: getPriceColor(amount) }}>
                                                                {amount.toLocaleString()}Ïõê
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowSearchResultModal(false)}
                                    className="w-full glass-effect hover:border-gray-400 rounded-lg py-3 font-semibold transition-all text-white"
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const SaleDetailModal = () => {
                if (!selectedDetailEntry) {
                    return null;
                }

                const { detail, dayLabel, amount, dateKey, approved } = selectedDetailEntry;
                const lineItems = Array.isArray(detail.lineItems) ? detail.lineItems : [];

                const originalTotal = detail.originalTotal !== undefined && detail.originalTotal !== null
                    ? normalizeAmount(detail.originalTotal)
                    : (lineItems.length > 0 ? lineItems.reduce((sum, item) => sum + normalizeAmount(item.originalPrice), 0) : normalizeAmount(amount));

                const discountTotal = detail.discountTotal !== undefined && detail.discountTotal !== null
                    ? normalizeAmount(detail.discountTotal)
                    : (lineItems.length > 0 ? lineItems.reduce((sum, item) => sum + normalizeAmount(item.discountAmount), 0) : 0);

                const finalTotal = normalizeAmount(amount);
                const discountRate = originalTotal > 0 ? Math.round((discountTotal / originalTotal) * 1000) / 10 : 0;
                const productList = (() => {
                    if (Array.isArray(lineItems) && lineItems.length > 0) {
                        return lineItems
                            .map(item => (item?.product || item?.productName || item?.name || '').toString().trim())
                            .filter(Boolean);
                    }

                    const fallbackLabel = (detail.product || '').toString().trim();
                    return fallbackLabel ? [fallbackLabel] : [];
                })();

                const renderLineItem = (item, index) => {
                    const originalPrice = normalizeAmount(item.originalPrice);
                    const discountAmount = normalizeAmount(item.discountAmount);
                    const finalPrice = normalizeAmount(item.finalPrice);
                    const discountEligible = item.discountEligible ?? DISCOUNT_ELIGIBLE_CATEGORIES.has(item.categoryKey || '');

                    return (
                        <div
                            key={`${item.categoryKey || 'item'}-${index}`}
                            style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                padding: '12px 16px',
                                borderRadius: '18px',
                                border: '1px solid rgba(255, 255, 255, 0.12)',
                                background: 'rgba(255, 255, 255, 0.06)',
                                backdropFilter: 'blur(18px)'
                            }}
                        >
                            <div style={{ color: 'rgba(240, 245, 255, 0.88)' }}>
                                <p style={{ fontSize: '14px', fontWeight: 600 }}>{item.product || item.productName || 'ÏÉÅÌíà'}</p>
                                <p style={{ fontSize: '11px', color: 'rgba(148, 163, 184, 0.8)' }}>{item.categoryKey || 'Í∏∞ÌÉÄ'} ¬∑ Ï†ïÍ∞Ä {originalPrice.toLocaleString()}Ïõê</p>
                            </div>
                            <div style={{ textAlign: 'right', fontSize: '13px' }}>
                                {discountEligible && discountAmount > 0 ? (
                                    <div>
                                        <p style={{ fontSize: '11px', color: 'rgba(148, 163, 184, 0.6)', textDecoration: 'line-through' }}>{originalPrice.toLocaleString()}Ïõê</p>
                                        <p style={{ color: 'rgba(110, 231, 183, 0.9)', fontWeight: 600 }}>-{discountAmount.toLocaleString()}Ïõê</p>
                                        <p style={{ color: '#ffffff', fontWeight: 700 }}>{finalPrice.toLocaleString()}Ïõê</p>
                                    </div>
                                ) : (
                                    <p style={{ color: '#ffffff', fontWeight: 600 }}>{finalPrice.toLocaleString()}Ïõê</p>
                                )}
                            </div>
                        </div>
                    );
                };

                const summaryCards = [
                    {
                        title: 'Ï†ïÍ∞Ä Ï¥ùÏï°',
                        value: originalTotal.toLocaleString() + 'Ïõê',
                        accent: 'rgba(129, 140, 248, 0.8)',
                        background: 'linear-gradient(135deg, rgba(99,102,241,0.35), rgba(56,189,248,0.25))'
                    },
                    {
                        title: 'Ìï†Ïù∏ Í∏àÏï°',
                        value: '-' + discountTotal.toLocaleString() + 'Ïõê',
                        accent: 'rgba(16, 185, 129, 0.85)',
                        background: 'linear-gradient(135deg, rgba(16,185,129,0.35), rgba(20,184,166,0.2))',
                        subtitle: discountTotal > 0 ? `(${discountRate.toFixed(1)}%)` : 'Ìï†Ïù∏ ÏóÜÏùå'
                    },
                    {
                        title: 'ÏµúÏ¢Ö Í≤∞Ï†ú',
                        value: finalTotal.toLocaleString() + 'Ïõê',
                        accent: 'rgba(96, 165, 250, 0.85)',
                        background: 'linear-gradient(135deg, rgba(59,130,246,0.35), rgba(14,165,233,0.2))'
                    }
                ];

                return (
                    <div
                        style={{
                            position: 'fixed',
                            inset: 0,
                            zIndex: 120,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            padding: '40px 16px'
                        }}
                    >

                        <div
                            style={{
                                position: 'absolute',
                                inset: 0,
                                background: 'transparent'
                            }}
                            onClick={closeSaleDetail}
                        ></div>
                        <div
                            style={{ position: 'relative', width: '100%', maxWidth: '420px' }}
                            onClick={(e) => e.stopPropagation()}
                        >
                            <div
                                style={{
                                    position: 'absolute',
                                    inset: 0,
                                    borderRadius: '28px',
                                    background: 'linear-gradient(135deg, rgba(16,185,129,0.35), rgba(59,130,246,0.25))',
                                    filter: 'blur(35px)',
                                    opacity: 0.85,
                                    pointerEvents: 'none'
                                }}
                            ></div>
                            <div
                                style={{
                                    position: 'relative',
                                    borderRadius: '28px',
                                    border: '1px solid rgba(255,255,255,0.12)',
                                    background: 'rgba(10, 19, 41, 0.92)',
                                    boxShadow: '0 40px 120px rgba(2,6,23,0.75)',
                                    overflow: 'hidden'
                                }}
                            >
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '28px 28px 16px 28px', gap: '16px' }}>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                        <span style={{ display: 'inline-flex', alignItems: 'center', gap: '8px', fontSize: '11px', letterSpacing: '0.24em', textTransform: 'uppercase', color: 'rgba(167, 243, 208, 0.8)' }}>
                                            <Icon icon={Info} size={14} /> Sale Detail
                                        </span>
                                        <h3 style={{ fontSize: '24px', fontWeight: 700, color: '#ffffff' }}>{detail.customerName || 'Í≥†Í∞ù'}</h3>
                                        <p style={{ fontSize: '12px', color: 'rgba(148, 163, 184, 0.75)' }}>{dayLabel} ¬∑ {detail.timestamp || 'ÏãúÍ∞Ñ Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
                                        <p style={{ fontSize: '11px', color: 'rgba(100, 116, 139, 0.7)' }}>Î¨∏ÏÑú ID: {dateKey}</p>
                                        <div
                                            style={{
                                                display: 'grid',
                                                gridTemplateColumns: '24px auto',
                                                alignItems: 'center',
                                                columnGap: '8px',
                                                padding: '10px 12px',
                                                borderRadius: '14px',
                                                border: approved
                                                    ? '1px solid rgba(110, 231, 183, 0.45)'
                                                    : '1px solid rgba(251, 191, 36, 0.45)',
                                                background: approved
                                                    ? 'linear-gradient(135deg, rgba(16,185,129,0.28), rgba(5,150,105,0.18))'
                                                    : 'linear-gradient(135deg, rgba(251,191,36,0.28), rgba(217,119,6,0.18))',
                                                color: approved ? 'rgba(187, 247, 208, 0.95)' : 'rgba(255,237,213,0.95)',
                                                fontWeight: 600,
                                                width: 'fit-content'
                                            }}
                                        >
                                            <div
                                                style={{
                                                    height: '24px',
                                                    width: '24px',
                                                    borderRadius: '8px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    background: approved
                                                        ? 'linear-gradient(135deg, rgba(16,185,129,0.45), rgba(5,150,105,0.35))'
                                                        : 'linear-gradient(135deg, rgba(251,191,36,0.45), rgba(217,119,6,0.35))',
                                                    boxShadow: '0 6px 12px rgba(15,23,42,0.35)'
                                                }}
                                            >
                                                <Icon icon={approved ? Check : Clock} size={14} />
                                            </div>
                                            <div>
                                                <p style={{ fontSize: '13px' }}>{approved ? 'ÏäπÏù∏ ÏôÑÎ£å' : 'ÏäπÏù∏ ÎåÄÍ∏∞'}</p>
                                                <p style={{ fontSize: '11px', color: 'rgba(226, 232, 240, 0.7)', marginTop: '2px' }}>
                                                    {approved ? 'ÌôïÏ†ïÎêú Í±∞ÎûòÏûÖÎãàÎã§.' : 'ÏäπÏù∏ ÌõÑ Ï†ïÏÇ∞Ïóê Î∞òÏòÅÎê©ÎãàÎã§.'}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <button
                                        onClick={closeSaleDetail}
                                        style={{
                                            display: 'inline-flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            border: '1px solid rgba(255,255,255,0.16)',
                                            color: 'rgba(226,232,240,0.88)',
                                            borderRadius: '999px',
                                            padding: '6px 18px',
                                            fontSize: '12px',
                                            fontWeight: 600,
                                            background: 'linear-gradient(135deg, rgba(67,56,202,0.42), rgba(79,70,229,0.32))',
                                            boxShadow: '0 10px 24px rgba(15,23,42,0.45)',
                                            letterSpacing: '0.16em',
                                            textTransform: 'uppercase',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        Îã´Í∏∞
                                    </button>
                                </div>

                                <div style={{ padding: '0 28px 28px 28px', display: 'flex', flexDirection: 'column', gap: '18px' }}>
                                    <div
                                        style={{
                                            borderRadius: '22px',
                                            border: '1px solid rgba(255,255,255,0.08)',
                                            background: 'linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02))',
                                            padding: '20px'
                                        }}
                                    >
                                        <p style={{ fontSize: '12px', color: 'rgba(226, 232, 240, 0.7)', marginBottom: '12px' }}>ÏÉÅÌíà ÏöîÏïΩ</p>
                                        {productList.length > 0 ? (
                                            <div
                                                style={{
                                                    display: 'flex',
                                                    flexWrap: 'wrap',
                                                    gap: '8px'
                                                }}
                                            >
                                                {productList.map((item, index) => (
                                                    <span
                                                        key={index}
                                                        style={{
                                                            padding: '6px 12px',
                                                            borderRadius: '999px',
                                                            border: '1px solid rgba(129, 230, 217, 0.35)',
                                                            background: 'rgba(45, 212, 191, 0.12)',
                                                            color: 'rgba(167, 255, 235, 0.9)',
                                                            fontSize: '12px',
                                                            whiteSpace: 'nowrap',
                                                            wordBreak: 'keep-all'
                                                        }}
                                                    >
                                                        {item}
                                                    </span>
                                                ))}
                                            </div>
                                        ) : (
                                            <p style={{ fontSize: '13px', color: 'rgba(148, 163, 184, 0.65)' }}>{detail.product || 'ÏÉÅÌíà Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
                                        )}
                                    </div>

                                    <div style={{ display: 'grid', gap: '12px' }}>
                                        {summaryCards.map((card, index) => (
                                            <div
                                                key={index}
                                                style={{
                                                    borderRadius: '18px',
                                                    border: '1px solid rgba(255,255,255,0.08)',
                                                    background: card.background,
                                                    padding: '16px 18px'
                                                }}
                                            >
                                                <p style={{ fontSize: '11px', letterSpacing: '0.15em', textTransform: 'uppercase', color: 'rgba(226,232,240,0.7)' }}>{card.title}</p>
                                                <p style={{ marginTop: '6px', fontSize: '20px', fontWeight: 700, color: '#ffffff' }}>{card.value}</p>
                                                {card.subtitle && (
                                                    <p style={{ fontSize: '11px', color: 'rgba(226,232,240,0.75)' }}>{card.subtitle}</p>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    {lineItems.length > 0 && (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                                            <p style={{ fontSize: '12px', color: 'rgba(226,232,240,0.7)' }}>ÏÑ∏Î∂Ä Íµ¨ÏÑ±</p>
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', maxHeight: '220px', overflowY: 'auto', paddingRight: '4px' }}>
                                                {lineItems.map(renderLineItem)}
                                            </div>
                                        </div>
                                    )}

                                    {discountTotal <= 0 && (
                                        <p style={{ fontSize: '11px', color: 'rgba(148, 163, 184, 0.65)' }}>Ìï†Ïù∏Ïù¥ Ï†ÅÏö©ÎêòÏßÄ ÏïäÏùÄ Í±∞ÎûòÏûÖÎãàÎã§.</p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };
            ;

            // ÌïÑÎùºÌÖåÏä§ Îß§Ï∂ú Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const PilatesModal = () => {
                const pilatesData = getPilatesDetails();
                const totalAmount = pilatesData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = pilatesData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowPilatesModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#FF69B4' }}>
                                üìä ÌïÑÎùºÌÖåÏä§ Îß§Ï∂ú ÌòÑÌô© ({selectedMonth + 1}Ïõî)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù ÌïÑÎùºÌÖåÏä§ Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{pilatesData.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù ÌïÑÎùºÌÖåÏä§ Îß§Ï∂ú</p>
                                    <p className="text-3xl font-bold" style={{ color: '#FF69B4' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            {pilatesData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">üèÉ‚Äç‚ôÄÔ∏è</div>
                                    <p className="text-gray-400 text-lg">Ïù¥Î≤à Îã¨ ÌïÑÎùºÌÖåÏä§ Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <p className="text-gray-500 text-sm mt-2">ÌïÑÎùºÌÖåÏä§ Ïù¥Ïö©Í∂å ÌåêÎß§ Ïãú Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                üóìÔ∏è {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-pink-900/20 rounded-lg border border-pink-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-pink-300 mt-1">üßò‚Äç‚ôÄÔ∏è {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-rose-200 mt-1">
                                                                        Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-pink-200/70 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#FF69B4' }}>
                                                                    {amount.toLocaleString()}Ïõê
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowPilatesModal(false)}
                                    className="w-full glass-effect hover:border-pink-400 rounded-lg py-3 font-semibold transition-all text-white border border-pink-500/50"
                                    style={{ borderColor: '#FF69B4' }}
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Ìó¨Ïä§ Ïù¥Ïö©Í∂å Îß§Ï∂ú Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const HealthModal = () => {
                const healthData = getHealthDetails();
                const totalAmount = healthData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = healthData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowHealthModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#22C55E' }}>
                                üí™ Ìó¨Ïä§ Ïù¥Ïö©Í∂å Îß§Ï∂ú ÌòÑÌô© ({selectedMonth + 1}Ïõî)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Ìó¨Ïä§ Ïù¥Ïö©Í∂å Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{healthData.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Ìó¨Ïä§ Ïù¥Ïö©Í∂å Îß§Ï∂ú</p>
                                    <p className="text-3xl font-bold" style={{ color: '#22C55E' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            {healthData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">üí™</div>
                                    <p className="text-gray-400 text-lg">Ïù¥Î≤à Îã¨ Ìó¨Ïä§ Ïù¥Ïö©Í∂å Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <p className="text-gray-500 text-sm mt-2">Ìó¨Ïä§ Ïù¥Ïö©Í∂å ÌåêÎß§ Ïãú Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                üóìÔ∏è {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-green-900/20 rounded-lg border border-green-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-green-300 mt-1">üí™ {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-emerald-200 mt-1">
                                                                        Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-emerald-200/70 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#22C55E' }}>
                                                                    {amount.toLocaleString()}Ïõê
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowHealthModal(false)}
                                    className="w-full glass-effect hover:border-green-400 rounded-lg py-3 font-semibold transition-all text-white border border-green-500/50"
                                    style={{ borderColor: '#22C55E' }}
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // ÎÑ§Ïò§Ìïè Îß§Ï∂ú Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const NeofitModal = () => {
                const neofitData = getNeofitDetails();
                const totalAmount = neofitData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = neofitData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowNeofitModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#4ECDC4' }}>
                                üî• ÎÑ§Ïò§Ìïè Îß§Ï∂ú ÌòÑÌô© ({selectedMonth + 1}Ïõî)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù ÎÑ§Ïò§Ìïè Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{neofitData.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù ÎÑ§Ïò§Ìïè Îß§Ï∂ú</p>
                                    <p className="text-3xl font-bold" style={{ color: '#4ECDC4' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            {neofitData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">üî•</div>
                                    <p className="text-gray-400 text-lg">Ïù¥Î≤à Îã¨ ÎÑ§Ïò§Ìïè Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <p className="text-gray-500 text-sm mt-2">ÎÑ§Ïò§Ìïè ÏÑúÎπÑÏä§ ÌåêÎß§ Ïãú Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                üóìÔ∏è {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-teal-900/20 rounded-lg border border-teal-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-teal-300 mt-1">üî• {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-cyan-200 mt-1">
                                                                        Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-cyan-200/70 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#4ECDC4' }}>
                                                                    {amount.toLocaleString()}Ïõê
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowNeofitModal(false)}
                                    className="w-full glass-effect hover:border-teal-400 rounded-lg py-3 font-semibold transition-all text-white border border-teal-500/50"
                                    style={{ borderColor: '#4ECDC4' }}
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Îß§Ï∂ú Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const ClothingLockerModal = () => {
                const clothingLockerData = getClothingLockerDetails();
                const totalAmount = clothingLockerData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = clothingLockerData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowClothingLockerModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#A855F7' }}>
                                üëï Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Îß§Ï∂ú ÌòÑÌô© ({selectedMonth + 1}Ïõî)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{clothingLockerData.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Îß§Ï∂ú</p>
                                    <p className="text-3xl font-bold" style={{ color: '#A855F7' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            {clothingLockerData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">üëï</div>
                                    <p className="text-gray-400 text-lg">Ïù¥Î≤à Îã¨ Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <p className="text-gray-500 text-sm mt-2">Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ ÌåêÎß§ Ïãú Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                üóìÔ∏è {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-purple-900/20 rounded-lg border border-purple-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-purple-300 mt-1">üëï {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-fuchsia-200 mt-1">
                                                                        Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-fuchsia-200/70 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#A855F7' }}>
                                                                    {amount.toLocaleString()}Ïõê
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowClothingLockerModal(false)}
                                    className="w-full glass-effect hover:border-purple-400 rounded-lg py-3 font-semibold transition-all text-white border border-purple-500/50"
                                    style={{ borderColor: '#A855F7' }}
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 1:1 PT Îß§Ï∂ú Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const PtModal = () => {
                const ptData = getPtDetails();
                const totalAmount = ptData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = ptData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowPtModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#F59E0B' }}>
                                üèãÔ∏è 1:1 PT Îß§Ï∂ú ÌòÑÌô© ({selectedMonth + 1}Ïõî)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù 1:1 PT Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{ptData.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù 1:1 PT Îß§Ï∂ú</p>
                                    <p className="text-3xl font-bold" style={{ color: '#F59E0B' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            {ptData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">üèãÔ∏è</div>
                                    <p className="text-gray-400 text-lg">Ïù¥Î≤à Îã¨ 1:1 PT Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <p className="text-gray-500 text-sm mt-2">1:1 PT ÏÑúÎπÑÏä§ ÌåêÎß§ Ïãú Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                                </div>
                            ) : (
                                <div className="max-h-96 overflow-y-auto">
                                    {Object.entries(groupedByDate).map(([date, items]) => (
                                        <div key={date} className="mb-6">
                                            <h4 className="text-lg font-semibold mb-3 text-center" style={{ color: '#F59E0B' }}>
                                                {date}
                                            </h4>
                                            <div className="space-y-3">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="glass-effect rounded-lg p-4 border border-orange-500/30">
                                                            <div className="flex justify-between items-start mb-2">
                                                                <div className="text-white font-medium">{item.name}</div>
                                                                <div className="text-right">
                                                                    {hasDiscount && (
                                                                        <div className="text-[11px] text-amber-200/80 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                                    )}
                                                                    <div className="text-orange-400 font-bold text-lg">
                                                                        {amount.toLocaleString()}Ïõê
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="text-orange-300 text-sm font-medium mb-1">
                                                                {item.product}
                                                            </div>
                                                            {hasDiscount && (
                                                                <div className="text-xs text-amber-200 mb-1">
                                                                    Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                </div>
                                                            )}
                                                            {item.memo && (
                                                                <div className="text-gray-400 text-sm italic">
                                                                    Î©îÎ™®: {item.memo}
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowPtModal(false)}
                                    className="w-full glass-effect hover:border-orange-400 rounded-lg py-3 font-semibold transition-all text-white border border-orange-500/50"
                                    style={{ borderColor: '#F59E0B' }}
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Í∏∞ÌÉÄ Îß§Ï∂ú Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const OtherModal = () => {
                const otherData = getOtherDetails();
                const totalAmount = otherData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = otherData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowOtherModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#9CA3AF' }}>
                                üìä Í∏∞ÌÉÄ Îß§Ï∂ú ÌòÑÌô© ({selectedMonth + 1}Ïõî)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Í∏∞ÌÉÄ Í≤∞Ï†ú Í±¥Ïàò</p>
                                    <p className="text-3xl font-bold text-white">{otherData.length}Í±¥</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">Ï¥ù Í∏∞ÌÉÄ Îß§Ï∂ú</p>
                                    <p className="text-3xl font-bold" style={{ color: '#9CA3AF' }}>
                                        {totalAmount.toLocaleString()}Ïõê
                                    </p>
                                </div>
                            </div>

                            {otherData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">üìä</div>
                                    <p className="text-gray-400 text-lg">Ïù¥Î≤à Îã¨ Í∏∞ÌÉÄ Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <p className="text-gray-500 text-sm mt-2">Í∏∞ÌÉÄ ÏÉÅÌíà ÌåêÎß§ Ïãú Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                üóìÔ∏è {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-gray-800/50 rounded-lg border border-gray-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-gray-300 mt-1">üìä {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-gray-200 mt-1">
                                                                        Ìï†Ïù∏ {discountAmount.toLocaleString()}Ïõê Ï†ÅÏö© (Í∏∞Ï§Ä {originalAmount.toLocaleString()}Ïõê)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-gray-300/70 line-through">{originalAmount.toLocaleString()}Ïõê</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#9CA3AF' }}>
                                                                    {amount.toLocaleString()}Ïõê
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowOtherModal(false)}
                                    className="w-full glass-effect hover:border-gray-400 rounded-lg py-3 font-semibold transition-all text-white border border-gray-500/50"
                                    style={{ borderColor: '#9CA3AF' }}
                                >
                                    Îã´Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Îã¨Î†• Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
            const CalendarModal = () => {
                if (!showCalendarModal) return null;

                const [yearView, setYearView] = useState(selectedYear);
                const [searchDate, setSearchDate] = useState('');
                const [yearSalesData, setYearSalesData] = useState({});
                const [isLoading, setIsLoading] = useState(false);

                // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ Îïå ÌòÑÏû¨ Ïó∞ÎèÑÎ°ú Ï¥àÍ∏∞Ìôî
                React.useEffect(() => {
                    if (showCalendarModal) {
                        setYearView(selectedYear);
                        setYearSalesData({}); // Ï¥àÍ∏∞Ìôî
                        setIsLoading(true); // Î°úÎî© ÏãúÏûë
                    }
                }, [showCalendarModal]);

                // salesDataÍ∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ yearSalesData ÏóÖÎç∞Ïù¥Ìä∏
                React.useEffect(() => {
                    setYearSalesData(prevData => ({
                        ...prevData,
                        ...salesData
                    }));
                }, [salesData]);

                // Ï†ÑÏ≤¥ Ïó∞ÎèÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Ï†ÑÏõî Ìè¨Ìï®) - Firebase Íµ¨ÎèÖ ÏÇ¨Ïö©
                React.useEffect(() => {
                    if (!showCalendarModal || !user) return;

                    const unsubscribes = [];
                    setIsLoading(true);

                    // 12Í∞úÏõî Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Íµ¨ÎèÖ
                    for (let month = 0; month < 12; month++) {
                        // ÌòÑÏû¨ Ïõî Îç∞Ïù¥ÌÑ∞ Íµ¨ÎèÖ
                        const unsubscribe = salesService.subscribeToMonthData(
                            yearView,
                            month,
                            (data) => {
                                setYearSalesData(prevData => ({
                                    ...prevData,
                                    ...data
                                }));
                            }
                        );
                        if (unsubscribe) unsubscribes.push(unsubscribe);

                        // Ï†ÑÏõî Îç∞Ïù¥ÌÑ∞ Íµ¨ÎèÖ Ï†úÍ±∞ - ÏõîÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Ï§ëÎ≥µ Î∞©ÏßÄ
                    }

                    // Î°úÎî© ÏôÑÎ£å
                    setTimeout(() => setIsLoading(false), 1000);

                    // cleanup
                    return () => {
                        unsubscribes.forEach(unsubscribe => {
                            if (unsubscribe) unsubscribe();
                        });
                    };
                }, [yearView, showCalendarModal, user]);

                // Îß§Ï∂ú Í∏àÏï°Ïóê Îî∞Î•∏ ÏÉâÏÉÅ Í≤∞Ï†ï Ìï®Ïàò (Î∞∞Í≤ΩÏÉâ Ï†úÍ±∞)
                const getAmountColor = (amount) => {
                    return ''; // Î™®Îì† Î∞∞Í≤ΩÏÉâ Ï†úÍ±∞
                };

                const getAmountTextColor = (amount) => {
                    if (amount === 0) return '#6b7280'; // ÌöåÏÉâ
                    if (amount < 500000) return '#93c5fd'; // Ïó∞Ìïú ÌååÎûë
                    if (amount < 1000000) return '#6ee7b7'; // Ïó∞Ìïú Ï¥àÎ°ù
                    if (amount < 2000000) return '#fcd34d'; // ÎÖ∏Îûë
                    if (amount < 3000000) return '#fb923c'; // Ï£ºÌô©
                    return '#f87171'; // Îπ®Í∞ï
                };

                // 1ÎÖÑÏπò ÏõîÎ≥Ñ Ï∫òÎ¶∞Îçî ÏÉùÏÑ±
                const renderMonthCalendar = (month) => {
                    const firstDay = new Date(yearView, month, 1).getDay();
                    const daysInMonth = new Date(yearView, month + 1, 0).getDate();
                    const weeks = [];
                    let currentWeek = [];
                    let monthTotal = 0;
                    let prevMonthTotal = 0;

                    // Îç∞Ïù¥ÌÑ∞ ÏÜåÏä§ Í≤∞Ï†ï - yearSalesDataÍ∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ salesData
                    const dataSource = Object.keys(yearSalesData).length > 0 ? yearSalesData : salesData;

                    // Ïõî Ï¥ù Îß§Ï∂ú Í≥ÑÏÇ∞ (ÏäπÏù∏Îêú Í≤ÉÎßå)
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateKey = `${yearView}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const dayData = normalizeSalesEntry(dataSource[dateKey]);
                        if (dayData.approved) {
                            const amountValue = normalizeAmount(dayData.amount);
                            monthTotal += amountValue;
                        }
                    }

                    // Ï†ÑÏõî Ï¥ù Îß§Ï∂ú Í≥ÑÏÇ∞ (ÏäπÏù∏Îêú Í≤ÉÎßå)
                    const prevMonth = month === 0 ? 11 : month - 1;
                    const prevYear = month === 0 ? yearView - 1 : yearView;
                    const prevDaysInMonth = new Date(prevYear, prevMonth + 1, 0).getDate();
                    for (let day = 1; day <= prevDaysInMonth; day++) {
                        const dateKey = `${prevYear}-${String(prevMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const dayData = normalizeSalesEntry(dataSource[dateKey]);
                        if (dayData.approved) {
                            const amountValue = normalizeAmount(dayData.amount);
                            prevMonthTotal += amountValue;
                        }
                    }

                    // Ï†ÑÏõî ÎåÄÎπÑ Ï¶ùÍ∞êÎ•† Í≥ÑÏÇ∞
                    let changePercent = 0;
                    if (prevMonthTotal > 0) {
                        changePercent = ((monthTotal - prevMonthTotal) / prevMonthTotal * 100).toFixed(1);
                    } else if (prevMonthTotal === 0 && monthTotal > 0) {
                        changePercent = 100; // Ï†ÑÏõî Îß§Ï∂úÏù¥ 0Ïù¥Í≥† ÎãπÏõî Îß§Ï∂úÏù¥ ÏûàÏúºÎ©¥ 100% Ï¶ùÍ∞ÄÎ°ú ÌëúÏãú
                    }

                    // Ï≤´ Ï£ºÏùò Îπà Ïπ∏ Ï∂îÍ∞Ä
                    for (let i = 0; i < firstDay; i++) {
                        currentWeek.push(null);
                    }

                    // ÎÇ†ÏßúÎ•º Ï£º Îã®ÏúÑÎ°ú Í∑∏Î£πÌôî
                    for (let day = 1; day <= daysInMonth; day++) {
                        currentWeek.push(day);
                        if (currentWeek.length === 7) {
                            weeks.push(currentWeek);
                            currentWeek = [];
                        }
                    }

                    // ÎßàÏßÄÎßâ Ï£º Ï≤òÎ¶¨
                    if (currentWeek.length > 0) {
                        while (currentWeek.length < 7) {
                            currentWeek.push(null);
                        }
                        weeks.push(currentWeek);
                    }

                    return (
                        <div style={{ backgroundColor: 'rgba(30, 41, 59, 0.5)', backdropFilter: 'blur(10px)', borderRadius: '8px', padding: '10px', border: '1px solid rgba(255, 255, 255, 0.1)', position: 'relative' }}>
                            <h4 style={{ fontSize: '14px', fontWeight: 'bold', marginBottom: '4px', textAlign: 'center', color: '#00FF88' }}>
                                {String(month + 1).padStart(2, '0')}Ïõî
                            </h4>
                            <div style={{ fontSize: '11px', color: '#fbbf24', textAlign: 'center', marginBottom: '2px', fontWeight: 'bold' }}>
                                {monthTotal > 0 ? `${monthTotal.toLocaleString()}Ïõê` : '0Ïõê'}
                            </div>
                            {(month === 0 && monthTotal > 0) ? (
                                <div style={{
                                    fontSize: '10px',
                                    color: '#60a5fa',
                                    textAlign: 'center',
                                    marginBottom: '6px',
                                    fontWeight: 'bold'
                                }}>
                                    ÏãúÏûë
                                </div>
                            ) : (prevMonthTotal > 0 || monthTotal > 0) && month > 0 ? (
                                <div style={{
                                    fontSize: '10px',
                                    color: changePercent >= 0 ? '#10b981' : '#ef4444',
                                    textAlign: 'center',
                                    marginBottom: '6px',
                                    fontWeight: 'bold'
                                }}>
                                    {prevMonthTotal === 0 && monthTotal > 0 ? (
                                        <span style={{ color: '#10b981' }}>Ïã†Í∑ú</span>
                                    ) : monthTotal === 0 && prevMonthTotal > 0 ? (
                                        <span style={{ color: '#ef4444' }}>‚ñº -100%</span>
                                    ) : prevMonthTotal > 0 ? (
                                        <span>{changePercent >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(changePercent)}%</span>
                                    ) : null}
                                </div>
                            ) : <div style={{ height: '16px' }}></div>}
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '2px', fontSize: '10px', marginBottom: '4px' }}>
                                {['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'].map((d, i) => (
                                    <div key={d} style={{
                                        textAlign: 'center',
                                        fontWeight: '500',
                                        color: i === 0 ? '#f87171' : i === 6 ? '#60a5fa' : '#9ca3af'
                                    }}>{d}</div>
                                ))}
                            </div>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '2px' }}>
                                {weeks.map((week, weekIndex) => (
                                    week.map((day, dayIndex) => {
                                        if (day === null) {
                                            return <div key={`empty-${month}-${weekIndex}-${dayIndex}`} style={{ height: '35px' }} />;
                                        }

                                        const dateKey = `${yearView}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                        const currentDataSource = Object.keys(yearSalesData).length > 0 ? yearSalesData : salesData;
                                        const dayData = currentDataSource[dateKey] || { amount: 0, approved: false };
                                        const date = new Date(yearView, month, day);
                                        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                                        const isToday = new Date().toDateString() === date.toDateString();
                                        const dayAmount = dayData.approved ? normalizeAmount(dayData.amount) : 0;
                                        const hasApprovedData = dayAmount > 0;

                                        // Îß§Ï∂úÏï° Ìè¨Îß∑ÌåÖ (ÏùºÎ∞ò Ïà´Ïûê ÌòïÏãù)
                                        const formatAmount = (amount) => {
                                            const value = normalizeAmount(amount);
                                            if (value >= 100000) {
                                                // 10ÎßåÏõê Ïù¥ÏÉÅÏùÄ ÎßåÏõê Îã®ÏúÑÎ°ú ÌëúÏãú
                                                return Math.floor(value / 10000) + 'Îßå';
                                            }
                                            return value.toLocaleString();
                                        };

                                        const bgColor = getAmountColor(dayAmount);
                                        const textColor = getAmountTextColor(dayAmount);

                                        const dayStyle = {
                                            height: '35px',
                                            display: 'flex',
                                            flexDirection: 'column',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            cursor: 'pointer',
                                            borderRadius: '3px',
                                            transition: 'all 0.2s',
                                            padding: '2px',
                                            backgroundColor: '',
                                            outline: isToday ? '1px solid #10b981' : 'none'
                                        };

                                        return (
                                            <div
                                                key={`${month}-${day}`}
                                                style={dayStyle}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.transform = 'scale(1.1)';
                                                    e.currentTarget.style.zIndex = '10';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.transform = 'scale(1)';
                                                    e.currentTarget.style.zIndex = '1';
                                                }}
                                                onClick={() => {
                                                    setSelectedYear(yearView);
                                                    setSelectedMonth(month);
                                                    setShowCalendarModal(false);
                                                    setViewMode('daily');
                                                    setTimeout(() => {
                                                        const element = document.getElementById(`day-${day}`);
                                                        element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                                    }, 100);
                                                }}
                                                title={hasApprovedData ? `${dayAmount.toLocaleString()}Ïõê` : ''}
                                            >
                                                <div style={{
                                                    fontSize: '11px',
                                                    fontWeight: hasApprovedData ? 'bold' : 'normal',
                                                    color: hasApprovedData ? '#22c55e' : (isWeekend ? (date.getDay() === 0 ? '#f87171' : '#60a5fa') : '#9ca3af')
                                                }}>
                                                    {day}
                                                </div>
                                                {hasApprovedData && (
                                                    <div style={{
                                                        fontSize: '8px',
                                                        color: textColor,
                                                        fontWeight: 'bold',
                                                        marginTop: '1px'
                                                    }}>
                                                        {formatAmount(dayAmount)}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })
                                ))}
                            </div>
                        </div>
                    );
                };

                // Î™®Î∞îÏùºÏö© ÏõîÎ≥Ñ ÏöîÏïΩ Î†åÎçîÎßÅ (Ìïú ÎààÏóê Î≥¥Ïù¥Îäî UI)
                const renderMonthSummaryMobile = (month) => {
                    let monthTotal = 0;
                    const dataSource = Object.keys(yearSalesData).length > 0 ? yearSalesData : salesData;
                    const daysInMonth = new Date(yearView, month + 1, 0).getDate();

                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateKey = `${yearView}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const dayData = normalizeSalesEntry(dataSource[dateKey]);
                        if (dayData.approved) {
                            monthTotal += normalizeAmount(dayData.amount);
                        }
                    }

                    const isSelected = selectedMonth === month && selectedYear === yearView;

                    // Í∏àÏï°ÎåÄÎ≥Ñ ÏÉâÏÉÅ Ï†ïÏùò (ÏõîÎß§Ï∂ú Í∏∞Ï§Ä)
                    const getMonthColor = (total) => {
                        if (total >= 30000000) return '#FF4D94'; // 3000Îßå Ïù¥ÏÉÅ: ÌïëÌÅ¨
                        if (total >= 20000000) return '#FB923C'; // 2000Îßå Ïù¥ÏÉÅ: Ïò§Î†åÏßÄ
                        if (total >= 15000000) return '#00FF88'; // 1500Îßå Ïù¥ÏÉÅ: ÎÑ§Ïò§ Í∑∏Î¶∞
                        if (total >= 10000000) return '#60A5FA'; // 1000Îßå Ïù¥ÏÉÅ: Î∏îÎ£®
                        return '#9ca3af'; // Í∏∞Î≥∏ Í∑∏Î†àÏù¥
                    };

                    const statusColor = monthTotal > 0 ? getMonthColor(monthTotal) : '#4b5563';
                    const hasHighSales = monthTotal >= 15000000;

                    return (
                        <div
                            key={`mobile-month-${month}`}
                            onClick={() => {
                                setSelectedYear(yearView);
                                setSelectedMonth(month);
                                setShowCalendarModal(false);
                                setViewMode('monthly');
                            }}
                            className="glass-effect rounded-xl p-3 flex flex-col items-center justify-center transition-all active:scale-95"
                            style={{
                                border: isSelected ? `2px solid ${statusColor}` : '1px solid rgba(255,255,255,0.1)',
                                background: isSelected ? `${statusColor}1a` : 'rgba(255, 255, 255, 0.03)',
                                minHeight: '85px',
                                boxShadow: isSelected ? `0 0 15px ${statusColor}33` : (hasHighSales ? `0 0 10px ${statusColor}1a` : 'none')
                            }}
                        >
                            <span className="text-[10px] text-gray-400 mb-1">{month + 1}Ïõî</span>
                            <span className="text-base font-bold text-center" style={{ color: statusColor }}>
                                {monthTotal > 0 ? (monthTotal / 10000).toLocaleString() + 'Îßå' : '0'}
                            </span>
                            {monthTotal > 0 && (
                                <span className="text-[9px] text-gray-500 mt-1">{(monthTotal).toLocaleString()}Ïõê</span>
                            )}
                        </div>
                    );
                };

                // ÎÇ†Ïßú Í≤ÄÏÉâ Ï≤òÎ¶¨
                const handleDateSearch = () => {
                    if (!searchDate) return;

                    const parts = searchDate.split('-');
                    if (parts.length === 3) {
                        const [year, month, day] = parts.map(p => parseInt(p));
                        if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {
                            setSelectedYear(year);
                            setSelectedMonth(month - 1);
                            setShowCalendarModal(false);
                            setViewMode('daily');
                            setTimeout(() => {
                                const element = document.getElementById(`day-${day}`);
                                element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        }
                    }
                };

                return (
                    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowCalendarModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '100%', maxWidth: '1400px', maxHeight: '90vh', overflowY: 'auto', backgroundColor: 'rgba(17, 24, 39, 0.95)' }} onClick={(e) => e.stopPropagation()}>
                            {isLoading ? (
                                <div className="flex items-center justify-center py-20">
                                    <div className="text-green-400 text-xl">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>
                                </div>
                            ) : (
                                <>
                                    {/* Ìó§Îçî */}
                                    <div className="flex items-center justify-between mb-6 pb-4 border-b border-gray-700">
                                        <div className="flex items-center gap-4">
                                            <button
                                                onClick={() => setYearView(yearView - 1)}
                                                className="w-10 h-10 flex items-center justify-center glass-effect rounded-lg hover:border-green-400 transition-all text-gray-300"
                                            >
                                                ‚óÄ
                                            </button>
                                            <h3 className="text-3xl font-bold min-w-[100px] text-center" style={{ color: '#00FF88' }}>
                                                {yearView}
                                            </h3>
                                            <button
                                                onClick={() => setYearView(yearView + 1)}
                                                className="w-10 h-10 flex items-center justify-center glass-effect rounded-lg hover:border-green-400 transition-all text-gray-300"
                                            >
                                                ‚ñ∂
                                            </button>
                                        </div>

                                        <div className="flex items-center gap-4">
                                            <button
                                                onClick={() => setShowCalendarModal(false)}
                                                className="w-10 h-10 flex items-center justify-center hover:bg-white/12 rounded-lg transition-all"
                                            >
                                                <Icon icon={X} size={24} style={{ color: '#999' }} />
                                            </button>
                                        </div>
                                    </div>

                                    {/* 12Í∞úÏõî Í∑∏Î¶¨Îìú Î∞∞Ïó¥ (PC: 4x3 Îã¨Î†•Ìòï, Mobile: 3x4 ÏöîÏïΩÌòï) */}
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: isMobile ? 'repeat(3, 1fr)' : 'repeat(4, 1fr)',
                                        gap: isMobile ? '8px' : '16px'
                                    }}>
                                        {Array.from({ length: 12 }, (_, i) => isMobile ? renderMonthSummaryMobile(i) : renderMonthCalendar(i))}
                                    </div>

                                    {/* ÏÉâÏÉÅ Î≤îÎ°Ä (Î™®Î∞îÏùºÏóêÏÑúÎäî Ïà®ÍπÄ) */}
                                    {!isMobile && (
                                        <div style={{ marginTop: '20px', padding: '10px', backgroundColor: 'rgba(30, 41, 59, 0.5)', borderRadius: '8px' }}>
                                            <div style={{ fontSize: '12px', color: '#9ca3af', marginBottom: '8px' }}>Îß§Ï∂ú Í∏àÏï°Î≥Ñ ÏÉâÏÉÅ Î≤îÎ°Ä</div>
                                            <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap', justifyContent: 'center' }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(147, 197, 253, 0.3)', borderRadius: '3px' }}></div>
                                                    <span style={{ fontSize: '11px', color: '#93c5fd' }}>~50Îßå</span>
                                                </div>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(110, 231, 183, 0.3)', borderRadius: '3px' }}></div>
                                                    <span style={{ fontSize: '11px', color: '#6ee7b7' }}>50~100Îßå</span>
                                                </div>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(252, 211, 77, 0.3)', borderRadius: '3px' }}></div>
                                                    <span style={{ fontSize: '11px', color: '#fcd34d' }}>100~200Îßå</span>
                                                </div>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(251, 146, 60, 0.3)', borderRadius: '3px', border: '1px solid rgba(251, 146, 60, 0.5)' }}></div>
                                                    <span style={{ fontSize: '11px', color: '#fb923c' }}>200~300Îßå</span>
                                                </div>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                                    <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(248, 113, 113, 0.3)', borderRadius: '3px', border: '1px solid rgba(248, 113, 113, 0.5)' }}></div>
                                                    <span style={{ fontSize: '11px', color: '#f87171' }}>300Îßå~</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                );
            };

            // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br text-gray-100 flex items-center justify-center">
                        <div className="text-2xl">Î°úÎî© Ï§ë...</div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen" style={{ backgroundColor: '#1a1a1a' }}>
                        <div className="flex items-center justify-center min-h-screen p-4">
                            <div className="w-full" style={{ maxWidth: '440px' }}>
                                <div style={{
                                    backgroundColor: '#2d2d2d',
                                    borderRadius: '16px',
                                    padding: '40px',
                                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.5)'
                                }}>
                                    <div className="text-center mb-8">
                                        <h1 className="text-3xl font-bold mb-1">
                                            <span style={{ color: '#00FF88' }}>NeoFit</span>
                                            <span className="text-white ml-1">PayCalc</span>
                                        </h1>
                                        <p className="text-gray-400 text-sm">ÎÑ§Ïò§Ìïè Í∏âÏó¨ Í≥ÑÏÇ∞Í∏∞</p>
                                    </div>
                                    {!isSignUpMode ? (
                                        // Î°úÍ∑∏Ïù∏ Ìèº
                                        <>
                                            <form onSubmit={async (e) => {
                                                e.preventDefault();
                                                setLoginError('');
                                                const email = e.target.email.value;
                                                const password = e.target.password.value;

                                                const result = await authService.loginWithEmail(email, password);
                                                if (!result.success) {
                                                    let errorMsg = result.error;
                                                    if (result.error.includes('user-not-found')) {
                                                        errorMsg = 'Îì±Î°ùÎêòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùºÏûÖÎãàÎã§.';
                                                    } else if (result.error.includes('wrong-password')) {
                                                        errorMsg = 'ÏûòÎ™ªÎêú ÎπÑÎ∞ÄÎ≤àÌò∏ÏûÖÎãàÎã§.';
                                                    } else if (result.error.includes('invalid-login-credentials')) {
                                                        errorMsg = 'Ïù¥Î©îÏùº ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.';
                                                    }
                                                    setLoginError(errorMsg);
                                                }
                                            }} className="space-y-5">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2 text-gray-300">Ïù¥Î©îÏùº</label>
                                                    <input
                                                        type="email"
                                                        name="email"
                                                        className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                        style={{
                                                            backgroundColor: '#3d3d3d',
                                                            borderRadius: '12px',
                                                            border: '1px solid #4d4d4d',
                                                            fontSize: '16px'
                                                        }}
                                                        placeholder="gio7603@gmail.com"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2 text-gray-300">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                                                    <input
                                                        type="password"
                                                        name="password"
                                                        className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                        style={{
                                                            backgroundColor: '#3d3d3d',
                                                            borderRadius: '12px',
                                                            border: '1px solid #4d4d4d',
                                                            fontSize: '16px'
                                                        }}
                                                        placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•"
                                                        required
                                                    />
                                                </div>
                                                {loginError && (
                                                    <div className="text-red-400 text-sm text-center py-2">
                                                        {loginError}
                                                    </div>
                                                )}
                                                <button
                                                    type="submit"
                                                    className="w-full text-white font-medium py-3 px-4 transition-all duration-200 hover:opacity-90"
                                                    style={{
                                                        backgroundColor: '#00FF88',
                                                        borderRadius: '12px',
                                                        fontSize: '16px',
                                                        border: 'none',
                                                        color: '#000',
                                                        marginTop: '24px'
                                                    }}
                                                >
                                                    Î°úÍ∑∏Ïù∏
                                                </button>
                                            </form>
                                            <div className="mt-6 pt-6" style={{ borderTop: '1px solid #3d3d3d' }}>
                                                <button
                                                    onClick={() => setIsSignUpMode(true)}
                                                    className="w-full py-3 px-4 transition-all duration-200 hover:opacity-80"
                                                    style={{
                                                        backgroundColor: 'transparent',
                                                        border: '1px solid #4d4d4d',
                                                        borderRadius: '12px',
                                                        fontSize: '15px',
                                                        color: '#999'
                                                    }}
                                                >
                                                    ÌöåÏõêÍ∞ÄÏûÖ
                                                </button>
                                            </div>
                                        </>
                                    ) : (
                                        // ÌöåÏõêÍ∞ÄÏûÖ Ìèº
                                        <>
                                            <form onSubmit={async (e) => {
                                                e.preventDefault();
                                                setLoginError('');
                                                const email = e.target.email.value;
                                                const password = e.target.password.value;
                                                const confirmPassword = e.target.confirmPassword.value;

                                                if (password !== confirmPassword) {
                                                    setLoginError('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                                                    return;
                                                }

                                                if (password.length < 6) {
                                                    setLoginError('ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 6Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.');
                                                    return;
                                                }

                                                const result = await authService.signUpWithEmail(email, password);
                                                if (!result.success) {
                                                    let errorMsg = result.error;
                                                    if (result.error.includes('email-already-in-use')) {
                                                        errorMsg = 'Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î©îÏùºÏûÖÎãàÎã§.';
                                                    } else if (result.error.includes('weak-password')) {
                                                        errorMsg = 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÎÑàÎ¨¥ ÏïΩÌï©ÎãàÎã§.';
                                                    } else if (result.error.includes('invalid-email')) {
                                                        errorMsg = 'Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùº ÌòïÏãùÏûÖÎãàÎã§.';
                                                    }
                                                    setLoginError(errorMsg);
                                                } else {
                                                    alert('ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!');
                                                }
                                            }} className="space-y-5">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2 text-gray-300">Ïù¥Î©îÏùº</label>
                                                    <input
                                                        type="email"
                                                        name="email"
                                                        className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                        style={{
                                                            backgroundColor: '#3d3d3d',
                                                            borderRadius: '12px',
                                                            border: '1px solid #4d4d4d',
                                                            fontSize: '16px'
                                                        }}
                                                        placeholder="ÏÉà Ïù¥Î©îÏùº ÏûÖÎ†•"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2 text-gray-300">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                                                    <input
                                                        type="password"
                                                        name="password"
                                                        className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                        style={{
                                                            backgroundColor: '#3d3d3d',
                                                            borderRadius: '12px',
                                                            border: '1px solid #4d4d4d',
                                                            fontSize: '16px'
                                                        }}
                                                        placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ (6Ïûê Ïù¥ÏÉÅ)"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2 text-gray-300">ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</label>
                                                    <input
                                                        type="password"
                                                        name="confirmPassword"
                                                        className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                        style={{
                                                            backgroundColor: '#3d3d3d',
                                                            borderRadius: '12px',
                                                            border: '1px solid #4d4d4d',
                                                            fontSize: '16px'
                                                        }}
                                                        placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ Îã§Ïãú ÏûÖÎ†•"
                                                        required
                                                    />
                                                </div>
                                                {loginError && (
                                                    <div className="text-red-400 text-sm text-center py-2">
                                                        {loginError}
                                                    </div>
                                                )}
                                                <button
                                                    type="submit"
                                                    className="w-full text-white font-medium py-3 px-4 transition-all duration-200 hover:opacity-90"
                                                    style={{
                                                        backgroundColor: '#00FF88',
                                                        borderRadius: '12px',
                                                        fontSize: '16px',
                                                        border: 'none',
                                                        color: '#000',
                                                        marginTop: '24px'
                                                    }}
                                                >
                                                    ÌöåÏõêÍ∞ÄÏûÖ
                                                </button>
                                            </form>
                                            <div className="mt-6 pt-6" style={{ borderTop: '1px solid #3d3d3d' }}>
                                                <button
                                                    onClick={() => setIsSignUpMode(false)}
                                                    className="w-full py-3 px-4 transition-all duration-200 hover:opacity-80"
                                                    style={{
                                                        backgroundColor: 'transparent',
                                                        border: '1px solid #4d4d4d',
                                                        borderRadius: '12px',
                                                        fontSize: '15px',
                                                        color: '#999'
                                                    }}
                                                >
                                                    Î°úÍ∑∏Ïù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br text-gray-100 p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Îß§Ï∂ú ÏûÖÎ†• Î™®Îã¨ */}
                        {showAddSaleModal && <AddSaleModal />}
                        {/* Í≤ÄÏÉâ Í≤∞Í≥º Î™®Îã¨ */}
                        {showSearchResultModal && <SearchResultModal />}
                        {/* Îß§Ï∂ú ÏÉÅÏÑ∏ Î™®Îã¨ */}
                        {showDetailModal && selectedDetailEntry && <SaleDetailModal />}
                        {/* Îã¨Î†• Î™®Îã¨ */}
                        <CalendarModal />
                        {/* ÌïÑÎùºÌÖåÏä§ Îß§Ï∂ú Î™®Îã¨ */}
                        {showPilatesModal && <PilatesModal />}
                        {/* Ìó¨Ïä§ Ïù¥Ïö©Í∂å Îß§Ï∂ú Î™®Îã¨ */}
                        {showHealthModal && <HealthModal />}
                        {/* ÎÑ§Ïò§Ìïè Îß§Ï∂ú Î™®Îã¨ */}
                        {showNeofitModal && <NeofitModal />}
                        {/* 1:1 PT Îß§Ï∂ú Î™®Îã¨ */}
                        {showPtModal && <PtModal />}
                        {/* Ïö¥ÎèôÎ≥µ/ÎùΩÏª§ Îß§Ï∂ú Î™®Îã¨ */}
                        {showClothingLockerModal && <ClothingLockerModal />}
                        {/* Í∏∞ÌÉÄ Îß§Ï∂ú Î™®Îã¨ */}
                        {showOtherModal && <OtherModal />}
                        {/* Ìó§Îçî */}
                        <div className="text-center mb-8 sm:mb-10 relative">
                            <h1 className="text-3xl sm:text-5xl font-black mb-2 sm:mb-3" style={{ color: '#00FF88' }}>
                                NeoFit PayCalc
                            </h1>
                            <p className="text-gray-400 text-base sm:text-lg">ÎÑ§Ïò§Ìïè Í∏âÏó¨ Í≥ÑÏÇ∞Í∏∞</p>
                            <button
                                onClick={() => authService.logout()}
                                className="absolute top-0 right-0 glass-effect hover:border-red-400 rounded-lg px-4 py-2 text-sm transition-all text-white"
                            >
                                Î°úÍ∑∏ÏïÑÏõÉ
                            </button>
                        </div>

                        {/* ÌöåÏõê Í≤ÄÏÉâ */}
                        <div className="mb-6 flex justify-center">
                            <div className="flex gap-2" style={{ maxWidth: '400px', width: '100%' }}>
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && searchCustomer()}
                                    placeholder="ÌöåÏõêÎ™ÖÏùÑ Í≤ÄÏÉâÌïòÏÑ∏Ïöî"
                                    className="flex-1 glass-effect rounded-lg px-4 py-3 focus:border-green-400 focus:outline-none"
                                />
                                <button
                                    onClick={searchCustomer}
                                    className="glass-effect border-green-500 hover:border-green-400 rounded-lg px-6 py-3 font-semibold transition-all hover:shadow-lg text-white"
                                >
                                    <Icon icon="search" size={20} />
                                </button>
                            </div>
                        </div>

                        {/* Î∑∞ Î™®Îìú ÏÑ†ÌÉù */}
                        <div className="flex justify-center gap-2 mb-6">
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('daily');
                                }}
                                onTouchEnd={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('daily');
                                }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all glass-effect ${viewMode === 'daily'
                                    ? 'text-green-400 border-green-500 shadow-lg scale-105'
                                    : 'text-gray-400 hover:text-white hover:border-gray-400'
                                    }`}
                                style={viewMode === 'daily' ? {
                                    backgroundColor: '#0a4a2c',
                                    borderColor: '#00FF88',
                                    boxShadow: '0 0 15px rgba(0, 255, 136, 0.5)',
                                    WebkitTapHighlightColor: 'transparent'
                                } : { WebkitTapHighlightColor: 'transparent' }}
                            >
                                ÏùºÎ≥Ñ
                            </button>
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('weekly');
                                }}
                                onTouchEnd={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('weekly');
                                }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all glass-effect ${viewMode === 'weekly'
                                    ? 'text-green-400 border-green-500 shadow-lg scale-105'
                                    : 'text-gray-400 hover:text-white hover:border-gray-400'
                                    }`}
                                style={viewMode === 'weekly' ? {
                                    backgroundColor: '#0a4a2c',
                                    borderColor: '#00FF88',
                                    boxShadow: '0 0 15px rgba(0, 255, 136, 0.5)',
                                    WebkitTapHighlightColor: 'transparent'
                                } : { WebkitTapHighlightColor: 'transparent' }}
                            >
                                Ï£ºÎ≥Ñ
                            </button>
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('monthly');
                                }}
                                onTouchEnd={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('monthly');
                                }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all glass-effect ${viewMode === 'monthly'
                                    ? 'text-green-400 border-green-500 shadow-lg scale-105'
                                    : 'text-gray-400 hover:text-white hover:border-gray-400'
                                    }`}
                                style={viewMode === 'monthly' ? {
                                    backgroundColor: '#0a4a2c',
                                    borderColor: '#00FF88',
                                    boxShadow: '0 0 15px rgba(0, 255, 136, 0.5)',
                                    WebkitTapHighlightColor: 'transparent'
                                } : { WebkitTapHighlightColor: 'transparent' }}
                            >
                                ÏõîÎ≥Ñ
                            </button>
                        </div>

                        {/* ÏßÅÏõê Ïú†Ìòï ÏÑ†ÌÉù Î∞è Ïõî ÏÑ†ÌÉù */}
                        <div className="flex flex-col sm:flex-row justify-center gap-4 mb-10 flex-wrap">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setEmployeeType('full')}
                                    className={`px-6 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base glass-effect ${employeeType === 'full'
                                        ? 'text-white border-green-500 shadow-lg scale-105 bg-green-500/20'
                                        : 'text-gray-400 hover:text-white hover:border-gray-400'
                                        }`}
                                >
                                    Ï†ïÏßÅÏõê
                                </button>
                                <button
                                    onClick={() => setEmployeeType('part')}
                                    className={`px-6 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base glass-effect ${employeeType === 'part'
                                        ? 'text-white border-green-500 shadow-lg scale-105 bg-green-500/20'
                                        : 'text-gray-400 hover:text-white hover:border-gray-400'
                                        }`}
                                >
                                    ÌååÌä∏ÌÉÄÏûÑ
                                </button>
                            </div>

                            <div className="flex gap-3 w-full sm:w-auto items-center">
                                <select
                                    value={selectedMonth}
                                    onChange={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedMonth(value);
                                        }
                                    }}
                                    onInput={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedMonth(value);
                                        }
                                    }}
                                    className="glass-effect rounded-xl px-4 sm:px-6 py-3 focus:border-green-400 focus:outline-none font-medium transition-all hover:scale-105 text-sm sm:text-base flex-1 sm:flex-initial"
                                    style={{ borderColor: '#00C66E' }}
                                >
                                    {Array.from({ length: 12 }, (_, i) => (
                                        <option key={i} value={i}>
                                            {new Date(2024, i).toLocaleDateString('ko-KR', { month: 'long' })}
                                        </option>
                                    ))}
                                </select>
                                <select
                                    value={selectedYear}
                                    onChange={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedYear(value);
                                        }
                                    }}
                                    onInput={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedYear(value);
                                        }
                                    }}
                                    className="glass-effect rounded-xl px-4 sm:px-6 py-3 focus:border-green-400 focus:outline-none font-medium transition-all hover:scale-105 text-sm sm:text-base flex-1 sm:flex-initial"
                                    style={{ borderColor: '#00C66E' }}
                                >
                                    {[2024, 2025, 2026].map(year => (
                                        <option key={year} value={year}>{year}ÎÖÑ</option>
                                    ))}
                                </select>
                                <button
                                    onClick={() => setShowCalendarModal(true)}
                                    className="glass-effect rounded-xl p-3 border-green-500 hover:border-green-400 transition-all hover:shadow-lg"
                                    title="Ïó∞Í∞Ñ Îã¨Î†• Î≥¥Í∏∞"
                                >
                                    <Icon icon={Calendar} size={20} style={{ color: '#00FF88' }} />
                                </button>
                            </div>
                        </div>

                        {/* ÌÜµÍ≥Ñ ÏöîÏïΩ */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            {/* Ïò§Îäò Îß§Ï∂ú Ïπ¥Îìú */}
                            <div className="card-3d glass-premium rounded-2xl p-5 text-center neon-border-green" style={{ animationDelay: '0.1s' }}>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
                                    <p style={{ fontSize: '11px', letterSpacing: '0.1em', textTransform: 'uppercase', color: 'rgba(156, 163, 175, 1)', fontWeight: '600' }}>Ïò§Îäò Îß§Ï∂ú</p>
                                    <div className="icon-container" style={{ background: 'rgba(255,255,255,0.05)', padding: '8px', borderRadius: '8px' }}>
                                        <Icon icon={Calendar} size={16} style={{ color: '#9ca3af' }} />
                                    </div>
                                </div>
                                <p className="text-2xl sm:text-3xl font-black text-white count-up" style={{ marginBottom: '8px' }}>
                                    {getTodaySales().toLocaleString()}Ïõê
                                </p>
                                <div className="progress-bar" style={{ marginTop: '12px' }}>
                                    <div className="progress-fill" style={{ width: `${Math.min((getTodaySales() / 1000000) * 100, 100)}%`, background: 'linear-gradient(90deg, #6b7280, #9ca3af)' }}></div>
                                </div>
                            </div>

                            {/* Ïù¥Î≤àÏ£º Îß§Ï∂ú Ïπ¥Îìú */}
                            <div className="card-3d glass-premium rounded-2xl p-5 text-center" style={{ borderColor: 'rgba(0, 198, 255, 0.3)', animationDelay: '0.2s' }}>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
                                    <p style={{ fontSize: '11px', letterSpacing: '0.1em', textTransform: 'uppercase', color: 'rgba(156, 163, 175, 1)', fontWeight: '600' }}>Ïù¥Î≤àÏ£º Îß§Ï∂ú</p>
                                    <div className="icon-container" style={{ background: 'rgba(0, 198, 255, 0.1)', padding: '8px', borderRadius: '8px' }}>
                                        <Icon icon={TrendingUp} size={16} style={{ color: '#00C6FF' }} />
                                    </div>
                                </div>
                                <p className="text-2xl sm:text-3xl font-black count-up" style={{ color: '#00C6FF', marginBottom: '8px' }}>
                                    {getThisWeekSales().toLocaleString()}Ïõê
                                </p>
                                <div className="progress-bar" style={{ marginTop: '12px' }}>
                                    <div className="progress-fill shimmer-effect" style={{ width: `${Math.min((getThisWeekSales() / 5000000) * 100, 100)}%`, background: 'linear-gradient(90deg, #00C6FF, #0ea5e9)' }}></div>
                                </div>
                            </div>

                            {/* Ïõî Îß§Ï∂ú Ïπ¥Îìú */}
                            <div className="card-3d glass-premium rounded-2xl p-5 text-center" style={{ borderColor: 'rgba(255, 107, 53, 0.3)', animationDelay: '0.3s' }}>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
                                    <p style={{ fontSize: '11px', letterSpacing: '0.1em', textTransform: 'uppercase', color: 'rgba(156, 163, 175, 1)', fontWeight: '600' }}>Ïõî Îß§Ï∂ú</p>
                                    <div className="icon-container" style={{ background: 'rgba(255, 107, 53, 0.1)', padding: '8px', borderRadius: '8px' }}>
                                        <Icon icon={DollarSign} size={16} style={{ color: '#FF6B35' }} />
                                    </div>
                                </div>
                                <p className="text-2xl sm:text-3xl font-black count-up" style={{
                                    color: '#FF6B35',
                                    textShadow: '0 0 15px rgba(255, 107, 53, 0.5)',
                                    marginBottom: '8px'
                                }}>
                                    {monthlyTotal.toLocaleString()}Ïõê
                                </p>
                                <div className="progress-bar" style={{ marginTop: '12px' }}>
                                    <div className="progress-fill shimmer-effect" style={{ width: `${Math.min((monthlyTotal / 30000000) * 100, 100)}%`, background: 'linear-gradient(90deg, #FF6B35, #f97316)' }}></div>
                                </div>
                            </div>

                            {/* ÏòàÏÉÅ Ïù∏ÏÑºÌã∞Î∏å Ïπ¥Îìú */}
                            <div className="card-3d glass-premium rounded-2xl p-5 text-center glow-animation" style={{ borderColor: 'rgba(0, 255, 136, 0.3)', animationDelay: '0.4s' }}>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
                                    <p style={{ fontSize: '11px', letterSpacing: '0.1em', textTransform: 'uppercase', color: 'rgba(156, 163, 175, 1)', fontWeight: '600' }}>ÏòàÏÉÅ Ïù∏ÏÑºÌã∞Î∏å</p>
                                    <div className="icon-container" style={{ background: 'rgba(0, 255, 136, 0.1)', padding: '8px', borderRadius: '8px' }}>
                                        <Icon icon={Check} size={16} style={{ color: '#00FF88' }} />
                                    </div>
                                </div>
                                <p className="text-2xl sm:text-3xl font-black count-up" style={{
                                    color: '#00FF88',
                                    textShadow: '0 0 15px rgba(0, 255, 136, 0.6)',
                                    marginBottom: '8px'
                                }}>
                                    {Math.floor(incentiveAmount).toLocaleString()}Ïõê
                                </p>
                                <div className="progress-bar" style={{ marginTop: '12px' }}>
                                    <div className="progress-fill shimmer-effect" style={{ width: `${Math.min((incentiveAmount / 3000000) * 100, 100)}%`, background: 'linear-gradient(90deg, #00FF88, #10b981)' }}></div>
                                </div>
                            </div>
                        </div>

                        {/* Îß§Ï∂ú ÌòÑÌô© */}
                        <div className="gradient-border mb-8">
                            <div>
                                <div className="flex items-center justify-between mb-6">
                                    {/* Î™®Î∞îÏùº Î≤ÑÏ†Ñ */}
                                    <h2 className="mobile-only text-sm font-bold items-center gap-2" style={{ whiteSpace: 'nowrap' }}>
                                        <div className="p-1 bg-green-500/20 rounded-lg">
                                            <Icon icon={Calendar} size={20} style={{ color: '#00FF88' }} />
                                        </div>
                                        {viewMode === 'daily' ? 'ÏùºÎ≥Ñ' : viewMode === 'weekly' ? 'Ï£ºÎ≥Ñ' : 'ÏõîÎ≥Ñ'}
                                    </h2>

                                    {/* PC Î≤ÑÏ†Ñ */}
                                    <h2 className="desktop-only text-xl md:text-2xl font-bold items-center gap-3">
                                        <div className="p-2 bg-green-500/20 rounded-lg">
                                            <Icon icon={Calendar} size={28} style={{ color: '#00FF88' }} />
                                        </div>
                                        {viewMode === 'daily' ? 'ÏùºÎ≥Ñ Îß§Ï∂ú ÌòÑÌô©' : viewMode === 'weekly' ? 'Ï£ºÎ≥Ñ Îß§Ï∂ú ÌòÑÌô©' : 'ÏõîÎ≥Ñ Îß§Ï∂ú ÌòÑÌô©'}
                                    </h2>
                                    {viewMode === 'daily' && (
                                        <div className="flex gap-2">
                                            <div className="relative group">
                                                <button
                                                    onClick={() => {
                                                        const today = new Date();
                                                        const todayDate = today.getDate();
                                                        const isCurrentMonth = today.getMonth() === selectedMonth && today.getFullYear() === selectedYear;

                                                        if (isCurrentMonth) {
                                                            // ÌòÑÏû¨ Îã¨Ïù¥Î©¥ Ïò§Îäò ÎÇ†ÏßúÎ°ú Ïä§ÌÅ¨Î°§
                                                            const todayElement = document.getElementById(`day-${todayDate}`);
                                                            if (todayElement) {
                                                                todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                                            }
                                                            // Ïò§Îäò ÎÇ†ÏßúÏùò Îß§Ï∂ú ÏûÖÎ†• Î™®Îã¨ Ïó¥Í∏∞
                                                            openAddSaleModal(todayDate);
                                                        } else {
                                                            // Îã§Î•∏ Îã¨Ïù¥Î©¥ 1ÏùºÎ°ú Ïù¥Îèô
                                                            openAddSaleModal(1);
                                                        }
                                                    }}
                                                    className="glass-effect rounded-full p-3 border-blue-500 hover:border-blue-400 transition-all hover:shadow-lg"
                                                >
                                                    <Icon icon={Plus} size={24} style={{ color: 'white' }} />
                                                </button>
                                                <div className="absolute right-0 top-full mt-2 bg-gray-800 text-white text-sm px-3 py-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                                                    Ïò§Îäò Îß§Ï∂ú ÏûÖÎ†•ÌïòÍ∏∞
                                                </div>
                                            </div>

                                            {/* Ï†ïÏÇ∞Ï≤¥ÌÅ¨ Ìï¥Ï†ú Î∞è Îß§Ï∂ú Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäºÎì§ */}
                                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                                                <button
                                                    onClick={() => {
                                                        setCheckedDetails({});
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%)',
                                                        border: '2px solid rgba(59, 130, 246, 0.4)',
                                                        color: '#60A5FA'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500/20 to-purple-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>Ï†ïÏÇ∞Ï≤¥ÌÅ¨</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowHealthModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%)',
                                                        border: '2px solid rgba(34, 197, 94, 0.4)',
                                                        color: '#22C55E'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-green-500/20 to-emerald-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>Ìó¨Ïä§ Ïù¥Ïö©Í∂å</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowNeofitModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(56, 178, 172, 0.2) 100%)',
                                                        border: '2px solid rgba(78, 205, 196, 0.4)',
                                                        color: '#4ECDC4'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-teal-400/20 to-teal-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>ÎÑ§Ïò§Ìïè Îß§Ï∂ú</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowPtModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%)',
                                                        border: '2px solid rgba(245, 158, 11, 0.4)',
                                                        color: '#F59E0B'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-amber-500/20 to-yellow-600/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>1:1 PT Îß§Ï∂ú</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowPilatesModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(251, 113, 133, 0.2) 100%)',
                                                        border: '2px solid rgba(236, 72, 153, 0.4)',
                                                        color: '#F472B6'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-pink-500/20 to-rose-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>ÌïÑÎùºÌÖåÏä§ Îß§Ï∂ú</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowClothingLockerModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%)',
                                                        border: '2px solid rgba(168, 85, 247, 0.4)',
                                                        color: '#A855F7'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-violet-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>Ïö¥ÎèôÎ≥µ/ÎùΩÏª§</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowOtherModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(156, 163, 175, 0.2) 0%, rgba(107, 114, 128, 0.2) 100%)',
                                                        border: '2px solid rgba(156, 163, 175, 0.4)',
                                                        color: '#9CA3AF'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-gray-500/20 to-gray-600/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>Í∏∞ÌÉÄ Îß§Ï∂ú</span>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* ÏùºÎ≥Ñ Î∑∞ */}
                                {viewMode === 'daily' && (
                                    <>
                                        {/* Î™®Î∞îÏùº Ïª¥Ìå©Ìä∏ Í∑∏Î¶¨Îìú Î∑∞ */}
                                        {isMobile ? (
                                            <div ref={dailyViewRef} className="max-h-[650px] overflow-y-auto p-2">
                                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '8px' }}>
                                                    {Array.from({ length: getDaysInMonth() }, (_, i) => i + 1).map(day => {
                                                        const dateKey = getDateKey(day);
                                                        const dayData = normalizeSalesEntry(salesData[dateKey]);
                                                        const date = new Date(selectedYear, selectedMonth, day);
                                                        const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });
                                                        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                                                        const dayAmount = normalizeAmount(dayData.amount);
                                                        const detailCount = dayData.details?.length || 0;

                                                        return (
                                                            <div
                                                                key={day}
                                                                id={`day-${day}`}
                                                                onClick={() => setMobileExpandedDay(day)}
                                                                className="cursor-pointer transition-all duration-200 active:scale-95"
                                                                style={{
                                                                    background: dayData.approved
                                                                        ? 'linear-gradient(145deg, rgba(0,255,136,0.15), rgba(0,200,255,0.08))'
                                                                        : dayAmount > 0
                                                                            ? 'linear-gradient(145deg, rgba(59,130,246,0.15), rgba(139,92,246,0.08))'
                                                                            : 'rgba(30, 41, 59, 0.6)',
                                                                    borderRadius: '12px',
                                                                    padding: '10px 8px',
                                                                    border: dayData.approved
                                                                        ? '1px solid rgba(0,255,136,0.3)'
                                                                        : isWeekend
                                                                            ? '1px solid rgba(236,72,153,0.3)'
                                                                            : '1px solid rgba(75,85,99,0.3)',
                                                                    minHeight: '85px',
                                                                    display: 'flex',
                                                                    flexDirection: 'column',
                                                                    justifyContent: 'space-between'
                                                                }}
                                                            >
                                                                {/* ÎÇ†Ïßú Ìó§Îçî */}
                                                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '6px' }}>
                                                                    <span style={{
                                                                        fontSize: '13px',
                                                                        fontWeight: '700',
                                                                        color: isWeekend ? '#f472b6' : '#fff'
                                                                    }}>
                                                                        {day}Ïùº
                                                                    </span>
                                                                    <span style={{
                                                                        fontSize: '10px',
                                                                        padding: '2px 5px',
                                                                        borderRadius: '6px',
                                                                        backgroundColor: isWeekend ? 'rgba(236,72,153,0.2)' : 'rgba(75,85,99,0.4)',
                                                                        color: isWeekend ? '#f472b6' : '#9ca3af'
                                                                    }}>
                                                                        {dayName}
                                                                    </span>
                                                                </div>

                                                                {/* Í∏àÏï° */}
                                                                <div style={{
                                                                    fontSize: dayAmount >= 1000000 ? '11px' : '13px',
                                                                    fontWeight: '800',
                                                                    color: dayAmount > 0 ? '#00FF88' : '#6b7280',
                                                                    textAlign: 'center',
                                                                    marginBottom: '4px',
                                                                    lineHeight: '1.2'
                                                                }}>
                                                                    {dayAmount > 0 ? (
                                                                        dayAmount >= 10000
                                                                            ? `${Math.floor(dayAmount / 10000)}Îßå${dayAmount % 10000 > 0 ? Math.floor((dayAmount % 10000) / 1000) + 'Ï≤ú' : ''}`
                                                                            : dayAmount.toLocaleString() + 'Ïõê'
                                                                    ) : '-'}
                                                                </div>

                                                                {/* Îß§Ï∂ú Í±¥Ïàò */}
                                                                <div style={{
                                                                    fontSize: '10px',
                                                                    color: '#9ca3af',
                                                                    textAlign: 'center',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    gap: '3px'
                                                                }}>
                                                                    {detailCount > 0 ? (
                                                                        <>
                                                                            <span style={{ color: '#00C6FF' }}>{detailCount}Í±¥</span>
                                                                            {dayData.approved && <Icon icon={Check} size={12} style={{ color: '#00FF88' }} />}
                                                                        </>
                                                                    ) : (
                                                                        <span>-</span>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        ) : (
                                            /* Îç∞Ïä§ÌÅ¨ÌÉë Í∏∞Ï°¥ Î∑∞ */
                                            <div ref={dailyViewRef} className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-4 max-h-[650px] overflow-y-auto p-2" style={{ display: 'grid', gridTemplateColumns: 'repeat(3, minmax(0, 1fr))' }}>
                                                {Array.from({ length: getDaysInMonth() }, (_, i) => i + 1).map(day => {
                                                    const dateKey = getDateKey(day);
                                                    const dayData = normalizeSalesEntry(salesData[dateKey]);
                                                    const date = new Date(selectedYear, selectedMonth, day);
                                                    const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });
                                                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;

                                                    const dayAmount = normalizeAmount(dayData.amount);

                                                    return (
                                                        <div key={day} id={`day-${day}`} className={`glass-effect rounded-2xl p-4 sm:p-5 hover:scale-[1.02] transition-all duration-300 slide-in ${isWeekend ? 'border-pink-500/30' : ''}`}>
                                                            <div className="flex items-center justify-between mb-3 sm:mb-4">
                                                                <div className="flex items-center gap-2 sm:gap-3">
                                                                    <span className={`text-base sm:text-lg font-bold ${isWeekend ? 'text-pink-400' : 'text-white'}`}>
                                                                        {selectedMonth + 1}Ïõî {day}Ïùº
                                                                    </span>
                                                                    <span className={`text-xs sm:text-sm px-2 py-1 rounded-full ${isWeekend ? 'bg-pink-500/20 text-pink-400' : 'bg-gray-700 text-gray-400'}`}>
                                                                        {dayName}
                                                                    </span>
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    {dayData.approved && (
                                                                        <div className="flex items-center gap-2">
                                                                            <Icon icon={Check} size={20} style={{ color: '#00FF88' }} />
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </div>

                                                            <div className={`rounded-xl p-3 sm:p-4 mb-3 sm:mb-4 ${dayAmount > 0 ? 'bg-gradient-to-r from-green-500/10 to-blue-500/10' : 'bg-gray-800/50'}`}>
                                                                <div className={`font-black mb-1 ${(() => {
                                                                    const amountText = dayAmount.toLocaleString() + 'Ïõê';
                                                                    const length = amountText.length;
                                                                    if (length <= 10) return 'text-2xl sm:text-3xl';
                                                                    if (length <= 13) return 'text-xl sm:text-2xl';
                                                                    return 'text-lg sm:text-xl';
                                                                })()}`} style={{ color: dayAmount > 0 ? '#00FF88' : '#6b7280', whiteSpace: 'nowrap' }}>
                                                                    {dayAmount.toLocaleString()}Ïõê
                                                                </div>
                                                                <div className="text-xs sm:text-sm text-gray-400 flex items-center gap-2">
                                                                    <Icon icon={Package} size={14} />
                                                                    {dayData.details?.length || 0}Í±¥Ïùò Îß§Ï∂ú
                                                                </div>
                                                            </div>

                                                            {/* Îß§Ï∂ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ */}
                                                            {dayData.details && dayData.details.length > 0 && (
                                                                <div className="mb-4">
                                                                    <div className="flex flex-col gap-2 mb-3">
                                                                        <div className="text-sm font-semibold text-gray-300 flex items-center gap-2">
                                                                            <Icon icon={DollarSign} size={16} />
                                                                            Îß§Ï∂ú ÎÇ¥Ïó≠ ({dayData.details.length}Í±¥)
                                                                        </div>
                                                                        <div className="flex items-center justify-start gap-1 text-xs overflow-x-auto">
                                                                            <span className="flex items-center gap-1 whitespace-nowrap">
                                                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#95E1D3' }}></span>
                                                                                <span className="text-gray-500 text-[10px]">~10</span>
                                                                            </span>
                                                                            <span className="flex items-center gap-1 whitespace-nowrap">
                                                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#4ECDC4' }}></span>
                                                                                <span className="text-gray-500 text-[10px]">10~</span>
                                                                            </span>
                                                                            <span className="flex items-center gap-1 whitespace-nowrap">
                                                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#6BCF7F' }}></span>
                                                                                <span className="text-gray-500 text-[10px]">30~</span>
                                                                            </span>
                                                                            <span className="flex items-center gap-1 whitespace-nowrap">
                                                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#FFD93D' }}></span>
                                                                                <span className="text-gray-500 text-[10px]">50~</span>
                                                                            </span>
                                                                            <span className="flex items-center gap-1 whitespace-nowrap">
                                                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#FF6B6B' }}></span>
                                                                                <span className="text-gray-500 text-[10px]">100~</span>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    <div className="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                                                                        {dayData.details.map((detail, index) => {
                                                                            const detailAmount = normalizeAmount(detail.price);

                                                                            return (
                                                                                <div key={detail.id} className="relative">
                                                                                    <div
                                                                                        className="glass-effect rounded-xl p-4 hover:scale-[1.01] transition-all border border-gray-700/50 hover:border-green-500/30 cursor-pointer focus:outline-none"
                                                                                        role="button"
                                                                                        tabIndex={0}
                                                                                        onClick={() => openSaleDetail(day, dateKey, detail, dayData)}
                                                                                        onKeyDown={(e) => {
                                                                                            if (e.key === 'Enter' || e.key === ' ') {
                                                                                                e.preventDefault();
                                                                                                openSaleDetail(day, dateKey, detail, dayData);
                                                                                            }
                                                                                        }}
                                                                                    >
                                                                                        <div className="flex justify-between items-start gap-3">
                                                                                            <div className="flex-1">
                                                                                                <div className="flex items-start justify-between mb-2">
                                                                                                    <div className="flex items-center gap-2">
                                                                                                        <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                                                                                                            <span className="text-xs font-bold text-green-400">{index + 1}</span>
                                                                                                        </div>
                                                                                                        <div>
                                                                                                            <div className="font-semibold text-white text-sm">
                                                                                                                {detail.customerName}
                                                                                                            </div>
                                                                                                            <div className="text-gray-500 text-xs">
                                                                                                                {detail.timestamp}
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div className="flex items-center gap-2">
                                                                                                        <input
                                                                                                            type="checkbox"
                                                                                                            checked={checkedDetails[`${dateKey}_${detail.id}`] || false}
                                                                                                            onChange={(e) => {
                                                                                                                setCheckedDetails(prev => ({
                                                                                                                    ...prev,
                                                                                                                    [`${dateKey}_${detail.id}`]: e.target.checked
                                                                                                                }));
                                                                                                            }}
                                                                                                            onClick={(e) => e.stopPropagation()}
                                                                                                            className="w-4 h-4 rounded cursor-pointer"
                                                                                                            style={{
                                                                                                                accentColor: '#00FF88'
                                                                                                            }}
                                                                                                        />
                                                                                                        <div className="font-bold text-lg" style={{ color: getPriceColor(detailAmount) }}>
                                                                                                            {detailAmount.toLocaleString()}Ïõê
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div className="bg-gray-800/50 rounded-lg px-3 py-2 text-xs text-gray-300">
                                                                                                    {detail.product}
                                                                                                </div>
                                                                                            </div>
                                                                                            {!dayData.approved && (
                                                                                                <div className="flex flex-col gap-2 items-end">
                                                                                                    <button
                                                                                                        type="button"
                                                                                                        onClick={(e) => {
                                                                                                            e.stopPropagation();
                                                                                                            removeSaleDetail(day, detail.id);
                                                                                                        }}
                                                                                                        className="relative flex flex-col items-center justify-center gap-1 px-2 py-1.4 rounded-lg text-[10px] font-semibold transition-all"
                                                                                                        style={{
                                                                                                            minWidth: '62px',
                                                                                                            background: 'linear-gradient(145deg, rgba(251,113,133,0.75), rgba(124,58,237,0.15))',
                                                                                                            color: 'rgba(255,241,242,0.9)',
                                                                                                            boxShadow: '0 8px 18px rgba(251,113,133,0.18)',
                                                                                                            border: '1px solid rgba(251,113,133,0.4)',
                                                                                                            textShadow: '0 1px 6px rgba(0,0,0,0.25)'
                                                                                                        }}
                                                                                                        aria-label="Îß§Ï∂ú ÎÇ¥Ïó≠ ÏÇ≠Ï†ú"
                                                                                                    >
                                                                                                        <span className="absolute inset-0 rounded-xl" style={{
                                                                                                            background: 'linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0))',
                                                                                                            opacity: 0.55,
                                                                                                            pointerEvents: 'none'
                                                                                                        }}></span>
                                                                                                        <Icon icon={Trash2} size={11} style={{ filter: 'drop-shadow(0 0 4px rgba(251,113,133,0.45))' }} />
                                                                                                        <span style={{ fontSize: '10px', fontWeight: 600, textAlign: 'center' }}>ÏÇ≠Ï†ú</span>
                                                                                                    </button>
                                                                                                    <button
                                                                                                        type="button"
                                                                                                        onClick={(e) => {
                                                                                                            e.stopPropagation();
                                                                                                            openAddSaleModal(day, detail, dateKey);
                                                                                                        }}
                                                                                                        className="relative flex flex-col items-center justify-center gap-1 px-2 py-1.4 rounded-lg text-[10px] font-semibold transition-all"
                                                                                                        style={{
                                                                                                            minWidth: '62px',
                                                                                                            background: 'linear-gradient(145deg, rgba(45,212,191,0.75), rgba(56,189,248,0.18))',
                                                                                                            color: 'rgba(240,253,250,0.92)',
                                                                                                            boxShadow: '0 8px 18px rgba(45,212,191,0.18)',
                                                                                                            border: '1px solid rgba(45,212,191,0.4)',
                                                                                                            textShadow: '0 1px 6px rgba(0,0,0,0.25)'
                                                                                                        }}
                                                                                                        aria-label="Îß§Ï∂ú ÎÇ¥Ïó≠ ÏàòÏ†ï"
                                                                                                    >
                                                                                                        <span className="absolute inset-0 rounded-xl" style={{
                                                                                                            background: 'linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0))',
                                                                                                            opacity: 0.55,
                                                                                                            pointerEvents: 'none'
                                                                                                        }}></span>
                                                                                                        <Icon icon={Edit} size={11} style={{ filter: 'drop-shadow(0 0 4px rgba(56,189,248,0.4))' }} />
                                                                                                        <span style={{ fontSize: '10px', fontWeight: 600, textAlign: 'center' }}>ÏàòÏ†ï</span>
                                                                                                    </button>
                                                                                                </div>
                                                                                            )}
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {/* Îß§Ï∂úÏù¥ ÏóÜÏùÑ Îïå ÏïàÎÇ¥ */}
                                                            {(!dayData.details || dayData.details.length === 0) && dayAmount === 0 && (
                                                                <div className="text-center py-6 text-gray-500 text-sm glass-effect rounded-xl mb-4">
                                                                    <Icon icon={DollarSign} size={24} className="mx-auto mb-2 opacity-30" />
                                                                    Îì±Î°ùÎêú Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§
                                                                </div>
                                                            )}

                                                            {/* Îß§Ï∂ú ÏûÖÎ†• Î≤ÑÌäº */}
                                                            {!dayData.approved && (
                                                                <button
                                                                    onClick={() => openAddSaleModal(day)}
                                                                    className="w-full glass-effect border-blue-500 hover:border-blue-400 rounded-xl py-3 text-sm font-semibold transition-all flex items-center justify-center gap-2 mb-4"
                                                                    style={{
                                                                        color: '#00C6FF',
                                                                        textShadow: '0 0 10px #00C6FF, 0 0 20px #00C6FF, 0 0 30px #00C6FF, 0 0 40px #00C6FF',
                                                                        boxShadow: '0 0 20px rgba(0, 198, 255, 0.5), inset 0 0 20px rgba(0, 198, 255, 0.1)',
                                                                        animation: 'neonBluePulse 2s ease-in-out infinite'
                                                                    }}
                                                                >
                                                                    <Icon icon={Plus} size={18} style={{ filter: 'drop-shadow(0 0 8px #00C6FF)' }} />
                                                                    Îπ†Î•∏ Îß§Ï∂ú ÏûÖÎ†•
                                                                </button>
                                                            )}

                                                            {/* Îß§Ï∂ú ÏûÖÎ†• Ìèº */}
                                                            {expandedDays[day] && !dayData.approved && (
                                                                <div className="glass-effect rounded-xl p-5 mb-4 space-y-4 slide-in">
                                                                    <div className="text-sm font-bold text-green-400 mb-4 flex items-center gap-2">
                                                                        <Icon icon={Edit} size={16} />
                                                                        {selectedMonth + 1}Ïõî {day}Ïùº Îß§Ï∂ú ÏûÖÎ†•
                                                                    </div>

                                                                    {/* ÌöåÏõêÎ™Ö ÏûÖÎ†• */}
                                                                    <div>
                                                                        <label className="block text-xs font-semibold mb-2 text-gray-300 flex items-center gap-2">
                                                                            <Icon icon="user" size={14} />
                                                                            ÌöåÏõêÎ™Ö
                                                                        </label>
                                                                        <input
                                                                            type="text"
                                                                            value={customerName[day] || ''}
                                                                            onChange={(e) => setCustomerName(prev => ({
                                                                                ...prev,
                                                                                [day]: e.target.value
                                                                            }))}
                                                                            placeholder="ÌöåÏõêÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none text-sm transition-all"
                                                                        />
                                                                    </div>

                                                                    {/* ÏÉÅÌíà ÏÑ†ÌÉù */}
                                                                    <div>
                                                                        <label className="block text-xs font-semibold mb-2 text-gray-300 flex items-center gap-2">
                                                                            <Icon icon={Package} size={14} />
                                                                            ÏÉÅÌíà
                                                                        </label>
                                                                        <select
                                                                            value={selectedProducts[day] || ''}
                                                                            onChange={(e) => setSelectedProducts(prev => ({
                                                                                ...prev,
                                                                                [day]: e.target.value
                                                                            }))}
                                                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none text-sm transition-all"
                                                                        >
                                                                            <option value="">ÏÉÅÌíàÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                                                            {products.map(product => (
                                                                                <option key={product} value={product}>{product}</option>
                                                                            ))}
                                                                        </select>
                                                                    </div>

                                                                    {/* Í∞ÄÍ≤© ÏûÖÎ†• */}
                                                                    <div>
                                                                        <label className="block text-xs font-semibold mb-2 text-gray-300 flex items-center gap-2">
                                                                            <Icon icon={CreditCard} size={14} />
                                                                            Í∞ÄÍ≤©
                                                                        </label>
                                                                        <input
                                                                            type="number"
                                                                            value={customPrices[day] || ''}
                                                                            onChange={(e) => setCustomPrices(prev => ({
                                                                                ...prev,
                                                                                [day]: e.target.value
                                                                            }))}
                                                                            placeholder="Í∞ÄÍ≤©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none text-sm transition-all"
                                                                        />
                                                                    </div>

                                                                    {/* Îì±Î°ù Î≤ÑÌäº */}
                                                                    <button
                                                                        onClick={() => addSaleDetail(day)}
                                                                        className="w-full glass-effect border-green-500 hover:border-green-400 rounded-lg py-3 font-semibold text-sm transition-all hover:shadow-lg text-white"
                                                                    >
                                                                        Îß§Ï∂ú Îì±Î°ù
                                                                    </button>
                                                                </div>
                                                            )}

                                                            {!dayData.approved ? (
                                                                <div className="flex gap-1 sm:gap-2 items-center w-full">
                                                                    <input
                                                                        type="password"
                                                                        value={approvalPasswords[dateKey] || ''}
                                                                        onChange={(e) => {
                                                                            const newValue = e.target.value;
                                                                            setApprovalPasswords(prev => ({
                                                                                ...prev,
                                                                                [dateKey]: newValue
                                                                            }));
                                                                        }}
                                                                        placeholder="PW"
                                                                        className="glass-effect rounded-xl px-2 py-3 w-full max-w-[100px] sm:max-w-[150px] focus:border-green-400 focus:outline-none text-xs sm:text-base transition-all text-center"
                                                                        style={{ fontSize: '16px' }}
                                                                        onKeyPress={(e) => {
                                                                            if (e.key === 'Enter') {
                                                                                handleAdminApproval(day);
                                                                            }
                                                                        }}
                                                                    />
                                                                    <button
                                                                        onClick={() => handleAdminApproval(day)}
                                                                        className="glass-effect border-blue-500 hover:border-blue-400 rounded-xl px-3 sm:px-6 py-3 text-xs sm:text-base font-semibold transition-all whitespace-nowrap hover:shadow-lg text-white flex-shrink-0"
                                                                    >
                                                                        ÏäπÏù∏
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <div className="space-y-3">
                                                                    <button
                                                                        className="glass-effect border-green-500 rounded-xl px-4 py-3 text-base font-semibold cursor-default flex items-center gap-2 w-full justify-center"
                                                                        style={{
                                                                            color: '#00FF88',
                                                                            textShadow: '0 0 10px #00FF88, 0 0 20px #00FF88, 0 0 30px #00FF88, 0 0 40px #00FF88',
                                                                            boxShadow: '0 0 20px rgba(0, 255, 136, 0.5), inset 0 0 20px rgba(0, 255, 136, 0.1)',
                                                                            animation: 'neonGreenPulse 2s ease-in-out infinite'
                                                                        }}
                                                                        disabled
                                                                    >
                                                                        <Icon icon={Check} size={18} style={{ filter: 'drop-shadow(0 0 8px #00FF88)' }} />
                                                                        Ï†ïÏÇ∞ÏôÑÎ£å
                                                                    </button>
                                                                    <div className="flex gap-1 sm:gap-2 items-center w-full">
                                                                        <input
                                                                            type="password"
                                                                            value={editPasswords[dateKey] || ''}
                                                                            onChange={(e) => {
                                                                                const newValue = e.target.value;
                                                                                setEditPasswords(prev => ({
                                                                                    ...prev,
                                                                                    [dateKey]: newValue
                                                                                }));
                                                                            }}
                                                                            placeholder="PW"
                                                                            className="glass-effect rounded-xl px-2 py-3 w-full max-w-[100px] sm:max-w-[150px] focus:border-orange-400 focus:outline-none text-xs sm:text-base transition-all text-center"
                                                                            style={{ fontSize: '16px' }}
                                                                            onKeyPress={(e) => {
                                                                                if (e.key === 'Enter') {
                                                                                    handleEditMode(day);
                                                                                }
                                                                            }}
                                                                        />
                                                                        <button
                                                                            onClick={() => handleEditMode(day)}
                                                                            className="glass-effect border-orange-500 hover:border-orange-400 rounded-xl px-2 sm:px-6 py-3 text-xs sm:text-base font-semibold transition-all whitespace-nowrap flex items-center gap-1 hover:shadow-lg text-white flex-shrink-0"
                                                                        >
                                                                            <Icon icon={Edit} size={16} />
                                                                            <span className="hidden sm:inline">ÏàòÏ†ï</span>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}

                                        {/* Î™®Î∞îÏùº ÏùºÎ≥Ñ ÏÉÅÏÑ∏ Î™®Îã¨ */}
                                        {mobileExpandedDay && isMobile && (() => {
                                            const day = mobileExpandedDay;
                                            const dateKey = getDateKey(day);
                                            const dayData = normalizeSalesEntry(salesData[dateKey]);
                                            const date = new Date(selectedYear, selectedMonth, day);
                                            const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });
                                            const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                                            const dayAmount = normalizeAmount(dayData.amount);

                                            return (
                                                <div
                                                    className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-end justify-center z-50"
                                                    onClick={() => setMobileExpandedDay(null)}
                                                >
                                                    <div
                                                        className="w-full max-h-[85vh] overflow-y-auto rounded-t-3xl slide-in"
                                                        style={{
                                                            backgroundColor: 'rgba(17, 24, 39, 0.98)',
                                                            borderTop: '1px solid rgba(0,255,136,0.3)'
                                                        }}
                                                        onClick={(e) => e.stopPropagation()}
                                                    >
                                                        {/* Î™®Îã¨ Ìï∏Îì§ */}
                                                        <div style={{
                                                            display: 'flex',
                                                            justifyContent: 'center',
                                                            padding: '12px 0 8px'
                                                        }}>
                                                            <div style={{
                                                                width: '40px',
                                                                height: '4px',
                                                                backgroundColor: '#4b5563',
                                                                borderRadius: '2px'
                                                            }}></div>
                                                        </div>

                                                        {/* Î™®Îã¨ Ìó§Îçî */}
                                                        <div style={{
                                                            padding: '0 20px 16px',
                                                            borderBottom: '1px solid rgba(75,85,99,0.3)',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'space-between'
                                                        }}>
                                                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                                                <span style={{
                                                                    fontSize: '20px',
                                                                    fontWeight: '700',
                                                                    color: isWeekend ? '#f472b6' : '#fff'
                                                                }}>
                                                                    {selectedMonth + 1}Ïõî {day}Ïùº
                                                                </span>
                                                                <span style={{
                                                                    fontSize: '14px',
                                                                    padding: '4px 10px',
                                                                    borderRadius: '8px',
                                                                    backgroundColor: isWeekend ? 'rgba(236,72,153,0.2)' : 'rgba(75,85,99,0.4)',
                                                                    color: isWeekend ? '#f472b6' : '#9ca3af'
                                                                }}>
                                                                    {dayName}
                                                                </span>
                                                                {dayData.approved && (
                                                                    <Icon icon={Check} size={20} style={{ color: '#00FF88' }} />
                                                                )}
                                                            </div>
                                                            <button
                                                                onClick={() => setMobileExpandedDay(null)}
                                                                style={{
                                                                    width: '32px',
                                                                    height: '32px',
                                                                    borderRadius: '8px',
                                                                    backgroundColor: 'rgba(75,85,99,0.4)',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    border: 'none',
                                                                    cursor: 'pointer'
                                                                }}
                                                            >
                                                                <Icon icon={X} size={18} style={{ color: '#9ca3af' }} />
                                                            </button>
                                                        </div>

                                                        {/* Ï¥ù Îß§Ï∂ú Í∏àÏï° */}
                                                        <div style={{
                                                            padding: '20px',
                                                            background: dayAmount > 0
                                                                ? 'linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,200,255,0.05))'
                                                                : 'rgba(30,41,59,0.5)',
                                                            margin: '16px',
                                                            borderRadius: '16px'
                                                        }}>
                                                            <div style={{
                                                                fontSize: '32px',
                                                                fontWeight: '800',
                                                                color: dayAmount > 0 ? '#00FF88' : '#6b7280',
                                                                textAlign: 'center',
                                                                marginBottom: '8px'
                                                            }}>
                                                                {dayAmount.toLocaleString()}Ïõê
                                                            </div>
                                                            <div style={{
                                                                fontSize: '14px',
                                                                color: '#9ca3af',
                                                                textAlign: 'center',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '6px'
                                                            }}>
                                                                <Icon icon={Package} size={16} />
                                                                {dayData.details?.length || 0}Í±¥Ïùò Îß§Ï∂ú
                                                            </div>
                                                        </div>

                                                        {/* Îß§Ï∂ú ÏÉÅÏÑ∏ ÎÇ¥Ïó≠ */}
                                                        {dayData.details && dayData.details.length > 0 && (
                                                            <div style={{ padding: '0 16px 16px' }}>
                                                                <div style={{
                                                                    fontSize: '14px',
                                                                    fontWeight: '600',
                                                                    color: '#d1d5db',
                                                                    marginBottom: '12px',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    gap: '8px'
                                                                }}>
                                                                    <Icon icon={DollarSign} size={16} />
                                                                    Îß§Ï∂ú ÎÇ¥Ïó≠ ({dayData.details.length}Í±¥)
                                                                </div>
                                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                                                                    {dayData.details.map((detail, index) => {
                                                                        const detailAmount = normalizeAmount(detail.price);
                                                                        return (
                                                                            <div
                                                                                key={detail.id}
                                                                                style={{
                                                                                    backgroundColor: 'rgba(30,41,59,0.6)',
                                                                                    borderRadius: '12px',
                                                                                    padding: '14px',
                                                                                    border: '1px solid rgba(75,85,99,0.3)'
                                                                                }}
                                                                                onClick={() => openSaleDetail(day, dateKey, detail, dayData)}
                                                                            >
                                                                                <div style={{
                                                                                    display: 'flex',
                                                                                    justifyContent: 'space-between',
                                                                                    alignItems: 'flex-start',
                                                                                    marginBottom: '8px'
                                                                                }}>
                                                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                                                                        <div style={{
                                                                                            width: '28px',
                                                                                            height: '28px',
                                                                                            borderRadius: '50%',
                                                                                            backgroundColor: 'rgba(0,255,136,0.2)',
                                                                                            display: 'flex',
                                                                                            alignItems: 'center',
                                                                                            justifyContent: 'center'
                                                                                        }}>
                                                                                            <span style={{ fontSize: '12px', fontWeight: '700', color: '#00FF88' }}>{index + 1}</span>
                                                                                        </div>
                                                                                        <div>
                                                                                            <div style={{ fontSize: '14px', fontWeight: '600', color: '#fff' }}>
                                                                                                {detail.customerName}
                                                                                            </div>
                                                                                            <div style={{ fontSize: '11px', color: '#6b7280' }}>
                                                                                                {detail.timestamp}
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div style={{
                                                                                        fontSize: '16px',
                                                                                        fontWeight: '700',
                                                                                        color: getPriceColor(detailAmount)
                                                                                    }}>
                                                                                        {detailAmount.toLocaleString()}Ïõê
                                                                                    </div>
                                                                                </div>
                                                                                <div style={{
                                                                                    backgroundColor: 'rgba(0,0,0,0.3)',
                                                                                    borderRadius: '8px',
                                                                                    padding: '8px 12px',
                                                                                    fontSize: '12px',
                                                                                    color: '#9ca3af'
                                                                                }}>
                                                                                    {detail.product}
                                                                                </div>
                                                                            </div>
                                                                        );
                                                                    })}
                                                                </div>
                                                            </div>
                                                        )}

                                                        {/* Îß§Ï∂úÏù¥ ÏóÜÏùÑ Îïå */}
                                                        {(!dayData.details || dayData.details.length === 0) && dayAmount === 0 && (
                                                            <div style={{
                                                                textAlign: 'center',
                                                                padding: '40px 20px',
                                                                color: '#6b7280'
                                                            }}>
                                                                <Icon icon={DollarSign} size={32} style={{ marginBottom: '12px', opacity: 0.3 }} />
                                                                <div>Îì±Î°ùÎêú Îß§Ï∂úÏù¥ ÏóÜÏäµÎãàÎã§</div>
                                                            </div>
                                                        )}

                                                        {/* ÌïòÎã® Î≤ÑÌäºÎì§ */}
                                                        <div style={{ padding: '16px', paddingBottom: '32px' }}>
                                                            {!dayData.approved ? (
                                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                                                    <button
                                                                        onClick={() => {
                                                                            setMobileExpandedDay(null);
                                                                            openAddSaleModal(day);
                                                                        }}
                                                                        style={{
                                                                            width: '100%',
                                                                            padding: '14px',
                                                                            borderRadius: '12px',
                                                                            border: 'none',
                                                                            backgroundColor: 'rgba(0,198,255,0.2)',
                                                                            color: '#00C6FF',
                                                                            fontSize: '15px',
                                                                            fontWeight: '600',
                                                                            cursor: 'pointer',
                                                                            display: 'flex',
                                                                            alignItems: 'center',
                                                                            justifyContent: 'center',
                                                                            gap: '8px'
                                                                        }}
                                                                    >
                                                                        <Icon icon={Plus} size={18} />
                                                                        Îß§Ï∂ú ÏûÖÎ†•
                                                                    </button>
                                                                    <div style={{ display: 'flex', gap: '10px' }}>
                                                                        <input
                                                                            type="password"
                                                                            value={approvalPasswords[dateKey] || ''}
                                                                            onChange={(e) => {
                                                                                setApprovalPasswords(prev => ({
                                                                                    ...prev,
                                                                                    [dateKey]: e.target.value
                                                                                }));
                                                                            }}
                                                                            placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                                                                            style={{
                                                                                flex: 1,
                                                                                padding: '14px',
                                                                                borderRadius: '12px',
                                                                                border: '1px solid rgba(75,85,99,0.4)',
                                                                                backgroundColor: 'rgba(30,41,59,0.6)',
                                                                                color: '#fff',
                                                                                fontSize: '15px',
                                                                                textAlign: 'center'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            onClick={() => {
                                                                                handleAdminApproval(day);
                                                                                setMobileExpandedDay(null);
                                                                            }}
                                                                            style={{
                                                                                padding: '14px 24px',
                                                                                borderRadius: '12px',
                                                                                border: 'none',
                                                                                backgroundColor: 'rgba(59,130,246,0.3)',
                                                                                color: '#60a5fa',
                                                                                fontSize: '15px',
                                                                                fontWeight: '600',
                                                                                cursor: 'pointer'
                                                                            }}
                                                                        >
                                                                            ÏäπÏù∏
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                                                    <div style={{
                                                                        width: '100%',
                                                                        padding: '14px',
                                                                        borderRadius: '12px',
                                                                        backgroundColor: 'rgba(0,255,136,0.15)',
                                                                        color: '#00FF88',
                                                                        fontSize: '15px',
                                                                        fontWeight: '600',
                                                                        textAlign: 'center',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        justifyContent: 'center',
                                                                        gap: '8px'
                                                                    }}>
                                                                        <Icon icon={Check} size={18} />
                                                                        Ï†ïÏÇ∞ÏôÑÎ£å
                                                                    </div>
                                                                    <div style={{ display: 'flex', gap: '10px' }}>
                                                                        <input
                                                                            type="password"
                                                                            value={editPasswords[dateKey] || ''}
                                                                            onChange={(e) => {
                                                                                setEditPasswords(prev => ({
                                                                                    ...prev,
                                                                                    [dateKey]: e.target.value
                                                                                }));
                                                                            }}
                                                                            placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                                                                            style={{
                                                                                flex: 1,
                                                                                padding: '14px',
                                                                                borderRadius: '12px',
                                                                                border: '1px solid rgba(75,85,99,0.4)',
                                                                                backgroundColor: 'rgba(30,41,59,0.6)',
                                                                                color: '#fff',
                                                                                fontSize: '15px',
                                                                                textAlign: 'center'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            onClick={() => {
                                                                                handleEditMode(day);
                                                                                setMobileExpandedDay(null);
                                                                            }}
                                                                            style={{
                                                                                padding: '14px 24px',
                                                                                borderRadius: '12px',
                                                                                border: 'none',
                                                                                backgroundColor: 'rgba(251,146,60,0.3)',
                                                                                color: '#fb923c',
                                                                                fontSize: '15px',
                                                                                fontWeight: '600',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                gap: '6px'
                                                                            }}
                                                                        >
                                                                            <Icon icon={Edit} size={16} />
                                                                            ÏàòÏ†ï
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })()}
                                    </>
                                )}

                                {/* Ï£ºÎ≥Ñ Î∑∞ */}
                                {viewMode === 'weekly' && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {calculateWeeklySales().map((week, index) => {
                                            // week.daysÍ∞Ä ÏóÜÍ±∞ÎÇò ÎπÑÏñ¥ÏûàÏúºÎ©¥ Í±¥ÎÑàÎõ∞Í∏∞
                                            if (!week || !week.days || week.days.length === 0) {
                                                return null;
                                            }

                                            return (
                                                <div key={index} className="glass-effect rounded-2xl p-6 hover:scale-[1.02] transition-all">
                                                    <h3 className="text-xl font-bold mb-4 flex items-center justify-between">
                                                        <span>{week.days[0]}Ïùº - {week.days[week.days.length - 1]}Ïùº</span>
                                                        <span className="text-2xl" style={{ color: '#00C6FF' }}>
                                                            {(week.total || 0).toLocaleString()}Ïõê
                                                        </span>
                                                    </h3>
                                                    <div className="space-y-2">
                                                        {week.days.map(day => {
                                                            const dateKey = getDateKey(day);
                                                            const dayData = normalizeSalesEntry(salesData[dateKey]);
                                                            const dayAmount = normalizeAmount(dayData.amount);
                                                            return (
                                                                <div key={day} className="flex justify-between items-center py-2 border-b border-gray-700">
                                                                    <span className="text-gray-400">{selectedMonth + 1}Ïõî {day}Ïùº</span>
                                                                    <span className={dayData.approved ? 'text-green-400' : 'text-gray-500'}>
                                                                        {dayAmount.toLocaleString()}Ïõê
                                                                    </span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}

                                {/* ÏõîÎ≥Ñ Î∑∞ */}
                                {viewMode === 'monthly' && (
                                    <div className="glass-effect rounded-2xl p-8">
                                        <div className="text-center">
                                            <h3 className="text-3xl font-bold mb-2">{selectedYear}ÎÖÑ {selectedMonth + 1}Ïõî</h3>
                                            <p className="text-5xl font-black mb-4" style={{ color: '#00FF88' }}>
                                                {monthlyTotal.toLocaleString()}Ïõê
                                            </p>
                                            <div className="grid grid-cols-2 gap-4 mt-8">
                                                <div className="bg-gray-800/50 rounded-xl p-4">
                                                    <p className="text-gray-400 mb-2">ÏäπÏù∏Îêú Îß§Ï∂ú</p>
                                                    <p className="text-2xl font-bold text-green-400">
                                                        {Object.entries(salesData).filter(([_, data]) => data.approved).length}Í±¥
                                                    </p>
                                                </div>
                                                <div className="bg-gray-800/50 rounded-xl p-4">
                                                    <p className="text-gray-400 mb-2">ÌèâÍ∑† ÏùºÎß§Ï∂ú</p>
                                                    <p className="text-2xl font-bold">
                                                        {Math.floor(monthlyTotal / getDaysInMonth()).toLocaleString()}Ïõê
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Ï£ºÍ∞Ñ Îß§Ï∂ú Ìï©Í≥Ñ */}
                        <div className="gradient-border mb-8">
                            <div>
                                <h2 className="text-2xl font-bold mb-6 flex items-center gap-3">
                                    <div className="p-2 bg-blue-500/20 rounded-lg">
                                        <Icon icon={TrendingUp} size={28} style={{ color: '#00C6FF' }} />
                                    </div>
                                    Ï£ºÍ∞Ñ Îß§Ï∂ú Ìï©Í≥Ñ
                                </h2>

                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                                    {weeklySales.map((week, index) => {
                                        // week.daysÍ∞Ä ÏóÜÍ±∞ÎÇò ÎπÑÏñ¥ÏûàÏúºÎ©¥ Í±¥ÎÑàÎõ∞Í∏∞
                                        if (!week || !week.days || week.days.length === 0) {
                                            return null;
                                        }
                                        const weekProgress = ((week.total || 0) / 10000000) * 100;

                                        return (
                                            <div key={index} className="card-3d glass-premium rounded-2xl p-5 hover-lift" style={{ borderColor: 'rgba(0, 198, 255, 0.2)' }}>
                                                <div className="flex flex-col">
                                                    <span style={{ fontSize: '10px', letterSpacing: '0.1em', textTransform: 'uppercase', color: '#9ca3af', fontWeight: '600', marginBottom: '4px' }}>
                                                        Ï£ºÏ∞® {index + 1}
                                                    </span>
                                                    <span className="text-sm text-gray-500 mb-3">
                                                        {week.days[0]}Ïùº - {week.days[week.days.length - 1]}Ïùº
                                                    </span>
                                                    <span className="text-xl sm:text-2xl font-black count-up" style={{ color: '#00C6FF', marginBottom: '8px' }}>
                                                        {(week.total || 0).toLocaleString()}Ïõê
                                                    </span>
                                                    <div className="progress-bar">
                                                        <div className="progress-fill" style={{ width: `${Math.min(weekProgress, 100)}%`, background: 'linear-gradient(90deg, #00C6FF, #3b82f6)' }}></div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        {/* ÏõîÎ≥Ñ Îß§Ï∂ú Î¶¨Ìè¨Ìä∏ ÌÜµÍ≥Ñ */}
                        <div className="gradient-border mb-8">
                            <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50">
                                <h2 className="text-2xl font-bold mb-6 flex flex-wrap items-center gap-3">
                                    <div className="p-2 bg-purple-500/20 rounded-lg">
                                        üìä
                                    </div>
                                    ÏõîÎ≥Ñ Îß§Ï∂ú Î¶¨Ìè¨Ìä∏
                                </h2>

                                {/* ÏõîÎ≥Ñ Îß§Ï∂ú Î¶¨Ìè¨Ìä∏ */}
                                <div className="glass-effect rounded-2xl p-6 mb-6">
                                    <div className="flex flex-wrap items-center justify-between gap-4 mb-6">
                                        <div className="flex flex-wrap items-center gap-3">
                                            <h3 className="text-lg font-semibold text-gray-200 flex items-center gap-2">
                                                <span>üìÖ</span>
                                                <span>{headlineLabel} Îß§Ï∂ú ÌòÑÌô©</span>
                                            </h3>
                                            <div
                                                className="inline-flex"
                                                style={{
                                                    alignItems: 'center',
                                                    gap: '14px',
                                                    padding: '7px 22px',
                                                    borderRadius: '9999px',
                                                    border: '1px solid rgba(139, 92, 246, 0.55)',
                                                    background: 'linear-gradient(120deg, rgba(99,102,241,0.25), rgba(236,72,153,0.18), rgba(14,165,233,0.22))',
                                                    boxShadow: '0 10px 26px rgba(99,102,241,0.22)'
                                                }}
                                            >
                                                <span
                                                    style={{
                                                        display: 'inline-flex',
                                                        alignItems: 'center',
                                                        gap: '8px',
                                                        fontSize: '11px',
                                                        fontWeight: 600,
                                                        letterSpacing: '0.24em',
                                                        textTransform: 'uppercase',
                                                        color: 'rgba(224, 231, 255, 0.9)'
                                                    }}
                                                >
                                                    <span
                                                        style={{
                                                            display: 'inline-flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            width: '18px',
                                                            height: '18px',
                                                            borderRadius: '6px',
                                                            background: 'linear-gradient(140deg, rgba(236,72,153,0.85), rgba(99,102,241,0.65))',
                                                            color: 'white',
                                                            fontSize: '10px',
                                                            boxShadow: '0 0 12px rgba(236,72,153,0.45)'
                                                        }}
                                                    >
                                                        ‚ú¶
                                                    </span>
                                                    Ï¥ùÌï©
                                                </span>
                                                <span
                                                    style={{
                                                        width: '1px',
                                                        height: '22px',
                                                        background: 'linear-gradient(180deg, rgba(255,255,255,0), rgba(192,132,252,0.75), rgba(255,255,255,0))'
                                                    }}
                                                ></span>
                                                <span
                                                    style={{
                                                        fontSize: '19px',
                                                        fontWeight: 700,
                                                        color: 'rgba(244, 247, 255, 0.96)',
                                                        textShadow: '0 5px 18px rgba(99,102,241,0.38)'
                                                    }}
                                                >
                                                    {headlineTotal.toLocaleString()}Ïõê
                                                </span>
                                                {(() => {
                                                    const { percentage, isIncrease } = headlineDelta;
                                                    if (percentage === null || Number.isNaN(percentage)) {
                                                        return (
                                                            <span
                                                                style={{
                                                                    fontSize: '11px',
                                                                    fontWeight: 500,
                                                                    color: 'rgba(226,232,240,0.55)'
                                                                }}
                                                            >
                                                                ÎπÑÍµê Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå
                                                            </span>
                                                        );
                                                    }

                                                    const formatted = `${Math.abs(percentage).toFixed(1)}%`;
                                                    const badgeColor = isIncrease
                                                        ? 'rgba(74, 222, 128, 0.18)'
                                                        : 'rgba(248, 113, 113, 0.18)';
                                                    const borderColor = isIncrease
                                                        ? 'rgba(34, 197, 94, 0.55)'
                                                        : 'rgba(248, 113, 113, 0.55)';
                                                    const arrow = isIncrease ? '‚ñ≤' : '‚ñº';
                                                    const textColor = isIncrease
                                                        ? 'rgba(187, 247, 208, 0.9)'
                                                        : 'rgba(254, 202, 202, 0.9)';

                                                    return (
                                                        <span
                                                            style={{
                                                                marginLeft: '12px',
                                                                display: 'inline-flex',
                                                                alignItems: 'center',
                                                                gap: '4px',
                                                                color: textColor,
                                                                fontSize: '12px',
                                                                fontWeight: 600
                                                            }}
                                                        >
                                                            <span style={{ fontSize: '11px' }}>{arrow}</span>
                                                            <span>{formatted}</span>
                                                            <span style={{ color: 'rgba(226,232,240,0.6)', fontWeight: 500 }}>
                                                                vs {previousMonthLabel}
                                                            </span>
                                                        </span>
                                                    );
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                    <MonthlyRevenueChart
                                        selectedYear={selectedYear}
                                        selectedMonth={selectedMonth}
                                        calculateMonthlyCategorySales={calculateMonthlyCategorySales}
                                    />
                                </div>
                                {/* Ï£ºÏöî Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ï∂ú ÎπÑÍµê */}
                                <div className="glass-effect rounded-2xl p-6">
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className="text-lg font-semibold text-gray-300">üéØ Ï£ºÏöî Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ï∂ú</h3>
                                        <span className="text-xs text-gray-500">{benchmarkLabel}</span>
                                    </div>
                                    <div className="category-chart-container">
                                        {/* Ï¢åÏ∏°: ÏõêÌòï Ï∞®Ìä∏ (Î∞ïÏä§ Ï†úÍ±∞, ÌÅ¨Í∏∞ Ï¶ùÍ∞Ä) */}
                                        <div className="chart-wrapper">
                                            <div className="chart-canvas-wrapper">
                                                <canvas id="categoryPieChart"></canvas>
                                            </div>
                                        </div>
                                        {/* Ïö∞Ï∏°: Ïπ¥ÌÖåÍ≥†Î¶¨ Ïπ¥Îìú 1Ïó¥ (Ïö∞Ï∏° Ï†ïÎ†¨) */}
                                        <div className="category-cards-wrapper">
                                            {categorySnapshots.map((category) => {
                                                const shareValue = Number.isFinite(category.share) ? category.share : 0;
                                                const shareLabel = shareValue.toFixed(1);

                                                // Ï†ÑÏõîÎåÄÎπÑ ÌÖçÏä§Ìä∏ ÏÉâÏÉÅÎßå Ï†ÅÏö©
                                                let textColor = '#9ca3af'; // ÌöåÏÉâ

                                                if (category.trend.changeText.includes('+')) {
                                                    textColor = '#34d399'; // Í∑∏Î¶∞
                                                } else if (category.trend.changeText.includes('-') && !category.trend.changeText.includes('100%')) {
                                                    textColor = '#fb7185'; // Î†àÎìú
                                                }

                                                return (
                                                    <div
                                                        key={category.key}
                                                        className="category-card relative overflow-hidden rounded-lg border border-slate-800/60 bg-gradient-to-br from-slate-950/50 via-slate-900/50 to-slate-950/50 p-3 transition-all hover:scale-[1.02] hover:shadow-lg"
                                                        style={{
                                                            backdropFilter: 'blur(8px)'
                                                        }}
                                                    >
                                                        <div className={`absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r ${category.accent} opacity-60`}></div>
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center gap-2 flex-1">
                                                                <span className="text-xl">{category.icon}</span>
                                                                <div className="flex-1">
                                                                    <p className="text-xs font-semibold text-gray-200">{category.label}</p>
                                                                    <p className="text-lg font-bold mt-0.5" style={{ color: category.color }}>
                                                                        {category.total.toLocaleString()}Ïõê
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div className="flex flex-col items-end gap-1">
                                                                <span
                                                                    className="text-[10px] font-semibold whitespace-nowrap"
                                                                    style={{ color: textColor }}
                                                                >
                                                                    {category.trend.changeText}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* ÏõîÍ∞Ñ Ï¥ùÍ≥Ñ Î∞è Ïù∏ÏÑºÌã∞Î∏å */}
                        <div className="gradient-border glow-green">
                            <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50">
                                <h2 className="text-3xl sm:text-4xl font-black mb-10 text-center gradient-text-gold">
                                    ÏõîÍ∞Ñ Í∏âÏó¨ Í≥ÑÏÇ∞
                                </h2>

                                {/* Î©îÏù∏ Ïπ¥Îìú - ÏõîÍ∞Ñ Ï¥ùÎß§Ï∂ú */}
                                <div className="mb-10">
                                    <div className="card-3d glass-premium rounded-3xl p-8 sm:p-10 text-center shadow-2xl relative overflow-hidden" style={{ borderColor: 'rgba(255, 107, 53, 0.3)' }}>
                                        <div className="absolute inset-0 bg-gradient-to-br from-orange-500/10 via-red-500/5 to-transparent"></div>
                                        <div className="absolute -top-20 -right-20 w-64 h-64 bg-gradient-to-br from-orange-500/20 to-transparent rounded-full blur-3xl"></div>
                                        <div className="relative z-10">
                                            <p style={{ fontSize: '12px', letterSpacing: '0.15em', textTransform: 'uppercase', color: '#9ca3af', fontWeight: '600', marginBottom: '16px' }}>üìä ÏõîÍ∞Ñ Ï¥ùÎß§Ï∂ú</p>
                                            <p className="text-5xl sm:text-6xl lg:text-7xl font-black mb-4 count-up" style={{
                                                color: '#FF6B35',
                                                textShadow: '0 0 30px rgba(255, 107, 53, 0.6), 0 0 50px rgba(255, 107, 53, 0.3)'
                                            }}>{(monthlyTotal || 0).toLocaleString()}Ïõê</p>
                                            <div className="progress-bar" style={{ maxWidth: '300px', margin: '16px auto 0' }}>
                                                <div className="progress-fill shimmer-effect" style={{ width: `${Math.min((monthlyTotal / 50000000) * 100, 100)}%`, background: 'linear-gradient(90deg, #FF6B35, #f97316, #FF6B35)' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 text-center mb-8">
                                    <div className="card-3d glass-premium rounded-2xl p-6 sm:p-8" style={{ borderColor: 'rgba(0, 198, 255, 0.3)' }}>
                                        <div className="icon-container" style={{ background: 'rgba(0, 198, 255, 0.1)', padding: '12px', borderRadius: '12px', width: 'fit-content', margin: '0 auto 16px' }}>
                                            <Icon icon={TrendingUp} size={24} style={{ color: '#00C6FF' }} />
                                        </div>
                                        <p style={{ fontSize: '11px', letterSpacing: '0.1em', textTransform: 'uppercase', color: '#9ca3af', fontWeight: '600', marginBottom: '12px' }}>Ïù∏ÏÑºÌã∞Î∏åÏú® ({employeeType === 'full' ? 'Ï†ïÏßÅÏõê' : 'ÌååÌä∏ÌÉÄÏûÑ'})</p>
                                        <p className="text-3xl sm:text-4xl font-black count-up" style={{ color: '#00C6FF' }}>{incentiveRate || 0}%</p>
                                        <div className="progress-bar" style={{ marginTop: '16px' }}>
                                            <div className="progress-fill" style={{ width: `${(incentiveRate / 10) * 100}%`, background: 'linear-gradient(90deg, #00C6FF, #3b82f6)' }}></div>
                                        </div>
                                    </div>

                                    <div className="card-3d glass-premium rounded-2xl p-6 sm:p-8 glow-animation" style={{ borderColor: 'rgba(0, 255, 136, 0.3)' }}>
                                        <div className="icon-container" style={{ background: 'rgba(0, 255, 136, 0.1)', padding: '12px', borderRadius: '12px', width: 'fit-content', margin: '0 auto 16px' }}>
                                            <Icon icon={DollarSign} size={24} style={{ color: '#00FF88' }} />
                                        </div>
                                        <p style={{ fontSize: '11px', letterSpacing: '0.1em', textTransform: 'uppercase', color: '#9ca3af', fontWeight: '600', marginBottom: '12px' }}>Ïù∏ÏÑºÌã∞Î∏å Í∏àÏï°</p>
                                        <p className="text-3xl sm:text-4xl font-black count-up" style={{ color: '#00FF88', textShadow: '0 0 20px rgba(0, 255, 136, 0.5)' }}>
                                            {Math.floor(incentiveAmount || 0).toLocaleString()}Ïõê
                                        </p>
                                        <div className="progress-bar" style={{ marginTop: '16px' }}>
                                            <div className="progress-fill shimmer-effect" style={{ width: `${Math.min((incentiveAmount / 5000000) * 100, 100)}%`, background: 'linear-gradient(90deg, #00FF88, #10b981)' }}></div>
                                        </div>
                                    </div>
                                </div>

                                {/* Ïù∏ÏÑºÌã∞Î∏å Í∏∞Ï§ÄÌëú */}
                                <div className="glass-effect rounded-2xl p-6">
                                    <p className="text-lg font-bold text-center mb-4 text-gray-300">
                                        Ïù∏ÏÑºÌã∞Î∏å Í∏∞Ï§ÄÌëú ({employeeType === 'full' ? 'Ï†ïÏßÅÏõê' : 'ÌååÌä∏ÌÉÄÏûÑ'})
                                    </p>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3 text-xs text-center">
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(0) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">1,500ÎßåÏõê ÎØ∏Îßå</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#888888' }}>{employeeType === 'full' ? '0%' : '0%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(15000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">1,500ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#FF6B6B' }}>{employeeType === 'full' ? '2%' : '1%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(18000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">1,800ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#FF9F40' }}>{employeeType === 'full' ? '3%' : '1.5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(22000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">2,200ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#FFD93D' }}>{employeeType === 'full' ? '4%' : '2%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(25000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">2,500ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#6BCF7F' }}>{employeeType === 'full' ? '5%' : '2.5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(30000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">3,000ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#4ECDC4' }}>{employeeType === 'full' ? '6%' : '3%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(35000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">3,500ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#45B7D1' }}>{employeeType === 'full' ? '7%' : '3.5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all" style={isTierActive(40000000) ? activeTierStyle : {}}>
                                            <p className="text-gray-400 mb-1 text-xs">4,000ÎßåÏõê Ïù¥ÏÉÅ</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#5D5FEF' }}>{employeeType === 'full' ? '8%' : '4%'}</p>
                                        </div>
                                    </div>

                                    {/* Ï†ïÏßÅÏõê/ÌååÌä∏ÌÉÄÏûÑ ÎπÑÍµêÌëú */}
                                    <div className="mt-6 glass-effect rounded-2xl p-6">
                                        <p className="text-lg font-bold mb-4 text-center">ÌòÑÏû¨ Îß§Ï∂ú Í∏∞Ï§Ä Ïù∏ÏÑºÌã∞Î∏å ÎπÑÍµê</p>
                                        <div className="grid grid-cols-2 gap-4 text-center">
                                            <div
                                                className={`rounded-xl p-4 cursor-pointer transition-all duration-300 ${employeeType === 'full'
                                                    ? 'scale-105 shadow-lg text-white'
                                                    : 'glass-effect hover:scale-105 hover:border-gray-400'
                                                    }`}
                                                style={employeeType === 'full' ? {
                                                    backgroundColor: '#0a4a2c',
                                                    border: '2px solid #00FF88',
                                                    boxShadow: '0 0 20px rgba(0, 255, 136, 0.6), inset 0 0 20px rgba(0, 255, 136, 0.2)'
                                                } : {}}
                                                onClick={() => setEmployeeType('full')}
                                            >
                                                <p className={`text-sm font-semibold mb-2 ${employeeType === 'full' ? 'text-green-400' : ''}`}>Ï†ïÏßÅÏõê</p>
                                                <p className={`font-black text-2xl mb-2 ${employeeType === 'full' ? 'text-green-400' : ''}`} style={employeeType === 'full' ? { textShadow: '0 0 10px rgba(0, 255, 136, 0.8)' } : {}}>{getIncentiveRate(monthlyTotal, 'full')}%</p>
                                                <p className={`text-sm ${employeeType === 'full' ? 'text-green-400' : 'opacity-80'}`}>
                                                    {Math.floor((monthlyTotal || 0) * (getIncentiveRate(monthlyTotal, 'full') / 100)).toLocaleString()}Ïõê
                                                </p>
                                            </div>
                                            <div
                                                className={`rounded-xl p-4 cursor-pointer transition-all duration-300 ${employeeType === 'part'
                                                    ? 'scale-105 shadow-lg text-white'
                                                    : 'glass-effect hover:scale-105 hover:border-gray-400'
                                                    }`}
                                                style={employeeType === 'part' ? {
                                                    backgroundColor: '#0a4a2c',
                                                    border: '2px solid #00FF88',
                                                    boxShadow: '0 0 20px rgba(0, 255, 136, 0.6), inset 0 0 20px rgba(0, 255, 136, 0.2)'
                                                } : {}}
                                                onClick={() => setEmployeeType('part')}
                                            >
                                                <p className={`text-sm font-semibold mb-2 ${employeeType === 'part' ? 'text-green-400' : ''}`}>ÌååÌä∏ÌÉÄÏûÑ</p>
                                                <p className={`font-black text-2xl mb-2 ${employeeType === 'part' ? 'text-green-400' : ''}`} style={employeeType === 'part' ? { textShadow: '0 0 10px rgba(0, 255, 136, 0.8)' } : {}}>{getIncentiveRate(monthlyTotal, 'part')}%</p>
                                                <p className={`text-sm ${employeeType === 'part' ? 'text-green-400' : 'opacity-80'}`}>
                                                    {Math.floor((monthlyTotal || 0) * (getIncentiveRate(monthlyTotal, 'part') / 100)).toLocaleString()}Ïõê
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<NeoFitPayCalc />);
    </script>

    <script>
        // optgroup ÎÑ§Ïò® Ìö®Í≥º Ï†ÅÏö©ÏùÑ ÏúÑÌïú Ïä§ÌÅ¨Î¶ΩÌä∏
        function applyNeonEffectToOptgroups() {
            const optgroups = document.querySelectorAll('select optgroup');
            optgroups.forEach(optgroup => {
                // Ïù∏ÎùºÏù∏ Ïä§ÌÉÄÏùºÎ°ú ÏßÅÏ†ë Ï†ÅÏö©
                optgroup.style.color = '#00FF88';
                optgroup.style.fontWeight = 'bold';
                optgroup.style.textShadow = '0 0 10px #00FF88, 0 0 20px #00FF88, 0 0 30px #00FF88';
                optgroup.style.backgroundColor = 'rgba(0, 255, 136, 0.1)';
                optgroup.style.display = 'block';
                optgroup.style.padding = '8px';
                optgroup.style.margin = '4px 0';
            });
        }

        // DOMÏù¥ Î°úÎìúÎêú ÌõÑ Ïã§Ìñâ
        document.addEventListener('DOMContentLoaded', applyNeonEffectToOptgroups);

        // React Î†åÎçîÎßÅ ÌõÑÏóêÎèÑ Ïã§Ìñâ (ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÎäî ÏöîÏÜåÎ•º ÏúÑÌï¥)
        setTimeout(applyNeonEffectToOptgroups, 1000);

        // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ ÎïåÎßàÎã§ Ï†ÅÏö©
        const observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                if (mutation.addedNodes.length) {
                    applyNeonEffectToOptgroups();
                }
            });
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    </script>
</body>

</html>
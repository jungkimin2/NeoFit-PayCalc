<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoFit PayCalc - 네오핏 급여 계산기</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" crossorigin="anonymous"></script>
    
    <!-- Firebase SDK 추가 -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        * {
            font-family: 'Pretendard', sans-serif;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .glow-green {
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.4), 0 0 60px rgba(0, 255, 136, 0.2);
        }

        .hover-glow:hover {
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.5);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 1;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }


        .gradient-border {
            position: relative;
            background: transparent;
            border: 1px solid #00FF88;
            border-radius: 1.5rem;
        }

        .gradient-border > div {
            background: transparent;
            padding: 2rem;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #00FF88, #00C66E);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #00FF88, #00FF88);
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 136, 0.5);
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 136, 0.8);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes neonGreenPulse {
            0%, 100% {
                text-shadow: 0 0 10px #00FF88, 0 0 20px #00FF88, 0 0 30px #00FF88, 0 0 40px #00FF88;
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.5), inset 0 0 20px rgba(0, 255, 136, 0.1);
            }
            50% {
                text-shadow: 0 0 15px #00FF88, 0 0 25px #00FF88, 0 0 35px #00FF88, 0 0 50px #00FF88;
                box-shadow: 0 0 30px rgba(0, 255, 136, 0.7), inset 0 0 30px rgba(0, 255, 136, 0.2);
            }
        }
        
        @keyframes neonBluePulse {
            0%, 100% {
                text-shadow: 0 0 10px #00C6FF, 0 0 20px #00C6FF, 0 0 30px #00C6FF, 0 0 40px #00C6FF;
                box-shadow: 0 0 20px rgba(0, 198, 255, 0.5), inset 0 0 20px rgba(0, 198, 255, 0.1);
            }
            50% {
                text-shadow: 0 0 15px #00C6FF, 0 0 25px #00C6FF, 0 0 35px #00C6FF, 0 0 50px #00C6FF;
                box-shadow: 0 0 30px rgba(0, 198, 255, 0.7), inset 0 0 30px rgba(0, 198, 255, 0.2);
            }
        }
        
        /* 드롭다운 optgroup 그린 네온 효과 스타일 - 모든 카테고리 라벨에 적용 */
        select optgroup {
            color: #00FF88 !important;
            font-weight: 700 !important;
            text-shadow: 0 0 5px #00FF88, 
                         0 0 10px #00FF88, 
                         0 0 15px #00FF88, 
                         0 0 20px #00FF88,
                         0 0 30px #00FF88 !important;
            background: rgba(0, 255, 136, 0.1) !important;
        }
        
        /* 모든 optgroup 라벨에 네온 효과 강제 적용 */
        optgroup[label] {
            color: #00FF88 !important;
            text-shadow: 0 0 8px #00FF88, 
                         0 0 16px #00FF88, 
                         0 0 24px #00FF88 !important;
            font-weight: bold !important;
        }
        
        /* Webkit 브라우저용 특별 스타일 */
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            select optgroup {
                color: #00FF88 !important;
                -webkit-text-fill-color: #00FF88 !important;
                font-weight: bold !important;
                text-shadow: 0 0 10px #00FF88 !important;
            }
        }
        
        /* Firefox용 스타일 */
        @-moz-document url-prefix() {
            select optgroup {
                color: #00FF88 !important;
                font-weight: bold !important;
                text-shadow: 0 0 10px #00FF88 !important;
            }
        }
        
        /* 첫번째 optgroup은 상단 border 제거 */
        select optgroup:first-of-type {
            border-top: none !important;
        }
        
        /* 드롭다운 전체 스타일 개선 */
        select.glass-effect {
            background: rgba(10, 14, 26, 0.95) !important;
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #fff;
        }
        
        /* disabled option을 카테고리 라벨로 스타일링 */
        select option:disabled {
            color: #00FF88 !important;
            font-weight: bold !important;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.05)) !important;
            text-align: center !important;
            padding: 10px !important;
            font-size: 0.95em !important;
        }
        
        select.glass-effect:focus {
            border-color: #00FF88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            outline: none;
        }
        
        select option {
            background: rgba(10, 14, 26, 0.98);
            color: #fff;
            padding: 8px;
        }
        
        select option:hover {
            background: rgba(0, 255, 136, 0.2);
        }
        
        .fixed {
            position: fixed;
        }
        
        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
        
        .z-50 {
            z-index: 50;
        }

        /* Tailwind-like utility classes */
        .min-h-screen { min-height: 100vh; }
        .bg-gradient-to-br { 
            background: #0a0e1a;
            background-attachment: fixed;
        }
        .text-gray-100 { color: #f3f4f6; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-500 { color: #6b7280; }
        .text-white { color: #ffffff; }
        .text-pink-400 { color: #f472b6; }
        .text-green-400 { color: #4ade80; }
        .text-red-400 { color: #f87171; }
        .text-red-300 { color: #fca5a5; }
        .p-4 { padding: 1rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-5 { padding: 1.25rem; }
        .p-6 { padding: 1.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .px-8 { padding-left: 2rem; padding-right: 2rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-10 { margin-bottom: 2.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-6 { margin-top: 1.5rem; }
        .ml-3 { margin-left: 0.75rem; }
        .ml-5 { margin-left: 1.25rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .max-w-7xl { max-width: 80rem; }
        .text-center { text-align: center; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-5xl { font-size: 3rem; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-black { font-weight: 900; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        .flex { display: flex; }
        .grid { display: grid; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-1 { flex: 1 1 0%; }
        .w-full { width: 100%; }
        .max-h-40 { max-height: 10rem; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-x-hidden { overflow-x: hidden; }
        .bg-gray-800 { background-color: rgba(31, 41, 55, 0.7); }
        .bg-gray-700 { background-color: rgba(55, 65, 81, 0.7); }
        .bg-gray-800\/50 { background-color: rgba(31, 41, 55, 0.5); }
        .bg-green-500\/20 { background-color: rgba(34, 197, 94, 0.2); }
        .bg-blue-500\/20 { background-color: rgba(59, 130, 246, 0.2); }
        .bg-pink-500\/20 { background-color: rgba(236, 72, 153, 0.2); }
        .bg-red-500\/10 { background-color: rgba(239, 68, 68, 0.1); }
        .bg-red-500\/20 { background-color: rgba(239, 68, 68, 0.2); }
        .bg-gradient-to-r { background: linear-gradient(to right, var(--tw-gradient-stops)); }
        .from-green-500 { --tw-gradient-from: #22c55e; }
        .from-green-600 { --tw-gradient-from: #16a34a; }
        .from-green-700 { --tw-gradient-from: #15803d; }
        .from-blue-600 { --tw-gradient-from: #2563eb; }
        .from-blue-700 { --tw-gradient-from: #1d4ed8; }
        .from-orange-600 { --tw-gradient-from: #ea580c; }
        .from-orange-700 { --tw-gradient-from: #c2410c; }
        .to-green-600 { --tw-gradient-to: #16a34a; }
        .to-green-700 { --tw-gradient-to: #15803d; }
        .to-blue-700 { --tw-gradient-to: #1d4ed8; }
        .to-orange-700 { --tw-gradient-to: #c2410c; }
        .from-green-500\/10 { --tw-gradient-from: rgba(34, 197, 94, 0.1); }
        .to-blue-500\/10 { --tw-gradient-to: rgba(59, 130, 246, 0.1); }
        .hover\:from-green-500:hover { --tw-gradient-from: #22c55e; }
        .hover\:from-blue-500:hover { --tw-gradient-from: #2563eb; }
        .hover\:from-orange-500:hover { --tw-gradient-from: #f97316; }
        .hover\:to-green-600:hover { --tw-gradient-to: #16a34a; }
        .hover\:to-blue-600:hover { --tw-gradient-to: #2563eb; }
        .hover\:to-orange-600:hover { --tw-gradient-to: #ea580c; }
        .hover\:bg-gray-700:hover { background-color: #374151; }
        .hover\:bg-red-500\/20:hover { background-color: rgba(239, 68, 68, 0.2); }
        .hover\:text-red-300:hover { color: #fca5a5; }
        .hover\:scale-105:hover { transform: scale(1.05); }
        .hover\:scale-\[1\.02\]:hover { transform: scale(1.02); }
        .scale-105 { transform: scale(1.05); }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-300 { transition-duration: 300ms; }
        .opacity-30 { opacity: 0.3; }
        .opacity-80 { opacity: 0.8; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .hover\:shadow-xl:hover { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .cursor-default { cursor: default; }
        .cursor-pointer { cursor: pointer; }
        .whitespace-nowrap { white-space: nowrap; }
        .chart-category-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 9999px;
            padding: 0.35rem 0.9rem;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(71, 85, 105, 0.6);
            background: rgba(15, 23, 42, 0.8);
            color: rgba(148, 163, 184, 0.9);
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35), 0 4px 12px rgba(15, 23, 42, 0.45);
        }
        .chart-category-btn:hover {
            border-color: rgba(16, 185, 129, 0.35);
            color: rgba(226, 232, 240, 0.95);
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.45), 0 6px 18px rgba(16, 185, 129, 0.15);
        }
        .chart-category-btn.active {
            border-color: rgba(16, 185, 129, 0.6);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(6, 95, 70, 0.35));
            color: rgba(240, 253, 244, 0.95);
            box-shadow: inset 0 0 0 1px rgba(16, 185, 129, 0.35), 0 10px 24px rgba(16, 185, 129, 0.25);
        }
        .chart-category-dot {
            display: inline-flex;
            height: 0.5rem;
            width: 0.5rem;
            border-radius: 9999px;
            box-shadow: 0 0 8px currentColor;
        }
        .chart-mode-btn {
            border-radius: 9999px;
            padding: 0.35rem 0.9rem;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(71, 85, 105, 0.6);
            background: rgba(15, 23, 42, 0.8);
            color: rgba(148, 163, 184, 0.9);
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35), 0 4px 12px rgba(15, 23, 42, 0.45);
        }
        .chart-mode-btn:hover {
            border-color: rgba(96, 165, 250, 0.35);
            color: rgba(226, 232, 240, 0.95);
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.45), 0 6px 18px rgba(59, 130, 246, 0.15);
        }
        .chart-mode-btn.active {
            border-color: rgba(96, 165, 250, 0.6);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(37, 99, 235, 0.35));
            color: rgba(239, 246, 255, 0.95);
            box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.35), 0 10px 24px rgba(59, 130, 246, 0.25);
        }
        .chart-reset-btn {
            margin-left: auto;
            border-radius: 9999px;
            border: 1px solid rgba(71, 85, 105, 0.6);
            background: rgba(15, 23, 42, 0.8);
            padding: 0.35rem 0.9rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(203, 213, 225, 0.9);
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.35), 0 4px 12px rgba(15, 23, 42, 0.45);
        }
        .chart-reset-btn:hover {
            border-color: rgba(16, 185, 129, 0.45);
            color: rgba(236, 253, 245, 0.95);
            box-shadow: inset 0 0 0 1px rgba(16, 185, 129, 0.3), 0 6px 18px rgba(16, 185, 129, 0.18);
        }
        .transform { transform: translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .rotate-180 { --tw-rotate: 180deg; }
        .block { display: block; }
        .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\:border-green-400:focus { border-color: #4ade80; }
        .focus\:border-orange-400:focus { border-color: #fb923c; }
        .border-pink-500\/30 { border-color: rgba(236, 72, 153, 0.3); }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        @media (min-width: 640px) {
            .sm\:mb-3 { margin-bottom: 0.75rem; }
            .sm\:mb-4 { margin-bottom: 1rem; }
            .sm\:mb-8 { margin-bottom: 2rem; }
            .sm\:mb-10 { margin-bottom: 2.5rem; }
            .sm\:p-3 { padding: 0.75rem; }
            .sm\:p-4 { padding: 1rem; }
            .sm\:p-5 { padding: 1.25rem; }
            .sm\:p-6 { padding: 1.5rem; }
            .sm\:px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
            .sm\:px-8 { padding-left: 2rem; padding-right: 2rem; }
            .sm\:gap-3 { gap: 0.75rem; }
            .sm\:gap-6 { gap: 1.5rem; }
            .sm\:text-sm { font-size: 0.875rem; }
            .sm\:text-base { font-size: 1rem; }
            .sm\:text-lg { font-size: 1.125rem; }
            .sm\:text-2xl { font-size: 1.5rem; }
            .sm\:text-3xl { font-size: 1.875rem; }
            .sm\:text-5xl { font-size: 3rem; }
            .sm\:flex-row { flex-direction: row; }
            .sm\:flex-initial { flex: 0 1 auto; }
            .sm\:w-auto { width: auto; }
        }
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) {
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        select, input {
            background-color: transparent;
            color: #f3f4f6;
        }
        select option {
            background-color: #1f2937;
            color: #f3f4f6;
        }
        button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .max-h-\[650px\] { max-height: 650px; }
        .bg-gradient-to-br.from-gray-800\/50.to-gray-900\/50 {
            background: linear-gradient(to bottom right, rgba(31, 41, 55, 0.5), rgba(17, 24, 39, 0.5));
        }
        .group { position: relative; }
        .group:hover .group-hover\:opacity-100 { opacity: 1; }
        .pointer-events-none { pointer-events: none; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .top-full { top: 100%; }
        .right-0 { right: 0; }
        .mt-2 { margin-top: 0.5rem; }
        .opacity-0 { opacity: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const useState = React.useState;
        const useRef = React.useRef;
        const Calendar = "calendar";
        const DollarSign = "dollar-sign";
        const Check = "check";
        const TrendingUp = "trending-up";
        const Edit = "edit";
        const Plus = "plus";
        const Trash2 = "trash-2";
        const User = "user";
        const Package = "package";
        const CreditCard = "credit-card";
        const X = "x";
        const Info = "info";
        const Clock = "clock";

        // Firebase 초기화
        const firebaseConfig = {
            apiKey: "AIzaSyC9Nqji4jQe8po0BFfMo8czGSkXLuI2H3U",
            authDomain: "neofit-paycalc.firebaseapp.com",
            projectId: "neofit-paycalc",
            storageBucket: "neofit-paycalc.firebasestorage.app",
            messagingSenderId: "1072136228278",
            appId: "1:1072136228278:web:5d3be856d357b273900517",
            measurementId: "G-YWWC4R2EP4"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 인증 서비스
        const authService = {
            loginWithEmail: async (email, password) => {
                try {
                    const result = await auth.signInWithEmailAndPassword(email, password);
                    return { success: true, user: result.user };
                } catch (error) {
                    console.error('Login error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            signUpWithEmail: async (email, password) => {
                try {
                    const result = await auth.createUserWithEmailAndPassword(email, password);
                    return { success: true, user: result.user };
                } catch (error) {
                    console.error('SignUp error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            logout: async () => {
                try {
                    await auth.signOut();
                    return { success: true };
                } catch (error) {
                    console.error('Logout error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            subscribeToAuthChanges: (callback) => {
                return auth.onAuthStateChanged(callback);
            }
        };

        // 매출 서비스
        const salesService = {
            saveSalesData: async (dateKey, data) => {
                try {
                    await db.collection('sales').doc(dateKey).set({
                        ...data,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { success: true };
                } catch (error) {
                    console.error('Save error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            loadSalesData: async (dateKey) => {
                try {
                    const doc = await db.collection('sales').doc(dateKey).get();
                    if (doc.exists) {
                        return doc.data();
                    }
                    return null;
                } catch (error) {
                    console.error('Load error:', error);
                    return null;
                }
            },
            
            subscribeToMonthData: (year, month, callback) => {
                const startDate = `${year}-${String(month + 1).padStart(2, '0')}-01`;
                const endDate = `${year}-${String(month + 1).padStart(2, '0')}-31`;
                
                return db.collection('sales')
                    .where('date', '>=', startDate)
                    .where('date', '<=', endDate)
                    .onSnapshot((snapshot) => {
                        const data = {};
                        snapshot.forEach(doc => {
                            data[doc.id] = doc.data();
                        });
                        callback(data);
                    });
            }
        };

        const hexToRgb = (hex) => {
            if (!hex) return { r: 255, g: 255, b: 255 };
            let normalized = hex.replace('#', '');
            if (normalized.length === 3) {
                normalized = normalized.split('').map(char => char + char).join('');
            }
            const intVal = parseInt(normalized, 16);
            return {
                r: (intVal >> 16) & 255,
                g: (intVal >> 8) & 255,
                b: intVal & 255
            };
        };

        const withAlpha = (hex, alpha) => {
            const { r, g, b } = hexToRgb(hex);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        };

        const getClothingAmount = (productName) => {
            if (!productName) return null;
            const normalized = productName.toString();

            const matchNamed = normalized.match(/락커\s*:?\s*(\d+)개월|운동복\s*:?\s*(\d+)개월/);
            if (matchNamed) {
                const months = parseInt(matchNamed[1] || matchNamed[2], 10);
                if (Number.isFinite(months) && months > 0) {
                    return months * 10000;
                }
            }

            const general = normalized.match(/(락커|운동복)[^0-9]*([0-9]{1,3})\s*개월/);
            if (general) {
                const months = parseInt(general[2], 10);
                if (Number.isFinite(months) && months > 0) {
                    return months * 10000;
                }
            }

            return null;
        };

        const MONTH_CHART_OFFSETS = [-5, -4, -3, -2, -1, 0];
        const CATEGORY_KEYS = ['health', 'neofit', 'pt', 'pilates', 'clothing', 'etc'];
        const DISCOUNT_ELIGIBLE_CATEGORIES = new Set(['health', 'neofit', 'pt', 'pilates', 'etc']);
        const DISCOUNT_PALETTE = {
            health: {
                accent: '#34d399',
                cardBg: 'linear-gradient(135deg, rgba(16,185,129,0.22), rgba(6,182,212,0.10))',
                cardBorder: 'rgba(52,211,153,0.45)',
                cardShadow: '0 10px 26px rgba(16,185,129,0.18)',
                inputBg: 'rgba(16,185,129,0.15)',
                inputBorder: 'rgba(52,211,153,0.35)',
            },
            neofit: {
                accent: '#60a5fa',
                cardBg: 'linear-gradient(135deg, rgba(96,165,250,0.22), rgba(59,130,246,0.12))',
                cardBorder: 'rgba(96,165,250,0.45)',
                cardShadow: '0 10px 26px rgba(37,99,235,0.18)',
                inputBg: 'rgba(96,165,250,0.15)',
                inputBorder: 'rgba(59,130,246,0.35)',
            },
            pt: {
                accent: '#fbbf24',
                cardBg: 'linear-gradient(135deg, rgba(251,191,36,0.22), rgba(245,158,11,0.12))',
                cardBorder: 'rgba(251,191,36,0.45)',
                cardShadow: '0 10px 26px rgba(251,191,36,0.18)',
                inputBg: 'rgba(251,191,36,0.18)',
                inputBorder: 'rgba(245,158,11,0.35)',
            },
            pilates: {
                accent: '#fb7185',
                cardBg: 'linear-gradient(135deg, rgba(251,113,133,0.20), rgba(244,114,182,0.12))',
                cardBorder: 'rgba(251,113,133,0.35)',
                cardShadow: '0 10px 26px rgba(244,114,182,0.16)',
                inputBg: 'rgba(251,113,133,0.12)',
                inputBorder: 'rgba(251,113,133,0.28)',
            },
            clothing: {
                accent: '#a855f7',
                cardBg: 'linear-gradient(135deg, rgba(168,85,247,0.20), rgba(139,92,246,0.12))',
                cardBorder: 'rgba(168,85,247,0.35)',
                cardShadow: '0 10px 26px rgba(139,92,246,0.16)',
                inputBg: 'rgba(168,85,247,0.10)',
                inputBorder: 'rgba(168,85,247,0.25)',
            },
            etc: {
                accent: '#94a3b8',
                cardBg: 'linear-gradient(135deg, rgba(148,163,184,0.20), rgba(100,116,139,0.12))',
                cardBorder: 'rgba(148,163,184,0.35)',
                cardShadow: '0 10px 26px rgba(100,116,139,0.16)',
                inputBg: 'rgba(148,163,184,0.12)',
                inputBorder: 'rgba(148,163,184,0.25)',
            },
            default: {
                accent: '#a5b4fc',
                cardBg: 'linear-gradient(135deg, rgba(129,140,248,0.18), rgba(165,180,252,0.12))',
                cardBorder: 'rgba(129,140,248,0.35)',
                cardShadow: '0 10px 26px rgba(99,102,241,0.16)',
                inputBg: 'rgba(129,140,248,0.12)',
                inputBorder: 'rgba(129,140,248,0.25)',
            },
        };
        const CHART_CATEGORY_META = [
            { key: 'health', label: '헬스', icon: '🏃‍♂️', color: '#34d399' },
            { key: 'neofit', label: '네오핏', icon: '🔥', color: '#60a5fa' },
            { key: 'pt', label: 'PT', icon: '🏋️', color: '#fbbf24' },
            { key: 'pilates', label: '필라테스', icon: '🧘‍♀️', color: '#fb7185' },
            { key: 'etc', label: '기타', icon: '🧾', color: '#94a3b8' }
        ];

        const MonthlyRevenueChart = React.memo(({ selectedYear, selectedMonth, calculateMonthlyCategorySales }) => {
            const canvasRef = React.useRef(null);
            const chartRef = React.useRef(null);
            const [chartMode, setChartMode] = React.useState('area');
            const [activeKeys, setActiveKeys] = React.useState(CHART_CATEGORY_META.map(category => category.key));

            const chartData = React.useMemo(() => {
                const safeYear = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
                const safeMonth = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
                const baseDate = new Date(safeYear, safeMonth, 1);

                const labels = [];
                const datasets = {};
                CHART_CATEGORY_META.forEach(category => {
                    datasets[category.key] = [];
                });
                const totalsPerMonth = [];

                MONTH_CHART_OFFSETS.forEach(offset => {
                    const targetDate = new Date(baseDate.getFullYear(), baseDate.getMonth() + offset, 1);
                    const year = targetDate.getFullYear();
                    const monthNumber = targetDate.getMonth() + 1;
                    labels.push(`${monthNumber}월`);

                    let monthSum = 0;
                    CHART_CATEGORY_META.forEach(category => {
                        const value = Math.max(0, Number(calculateMonthlyCategorySales(year, monthNumber, category.key, true)) || 0);
                        datasets[category.key].push(value);
                        monthSum += value;
                    });
                    totalsPerMonth.push(monthSum);
                });

                const rawMax = Math.max(...Object.values(datasets).flat(), 0);

                return { labels, datasets, totalsPerMonth, maxValue: rawMax };
            }, [selectedYear, selectedMonth, calculateMonthlyCategorySales]);

            React.useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas || !(window.Chart || window.ChartJS)) {
                    return;
                }
                const ctx = canvas.getContext('2d');

                if (chartRef.current) {
                    chartRef.current.destroy();
                }

                const activeSet = new Set(activeKeys);
                const includedCategories = chartMode === 'stacked'
                    ? CHART_CATEGORY_META
                    : CHART_CATEGORY_META.filter(category => activeSet.has(category.key));

                if (includedCategories.length === 0 || chartData.labels.length === 0) {
                    chartRef.current = null;
                    return () => {};
                }

                const maxVisibleValue = includedCategories.reduce((max, category) => {
                    const series = chartData.datasets[category.key] || [];
                    const adjustedSeries = (chartMode === 'stacked' && !activeSet.has(category.key))
                        ? series.map(() => 0)
                        : series;
                    const seriesMax = adjustedSeries.length > 0 ? Math.max(...adjustedSeries) : 0;
                    return Math.max(max, seriesMax);
                }, 0);

                const suggestedMax = maxVisibleValue > 0
                    ? Math.max(Math.ceil((maxVisibleValue * 1.1) / 500000) * 500000, 500000)
                    : 500000;

                const buildGradient = (color, hidden) => {
                    const height = canvas.parentElement?.clientHeight || 280;
                    const gradient = ctx.createLinearGradient(0, 0, 0, height);
                    gradient.addColorStop(0, withAlpha(color, hidden ? 0.15 : 0.3));
                    gradient.addColorStop(1, withAlpha(color, 0));
                    return gradient;
                };

                const visibleTotalsPerMonth = chartData.labels.map((_, index) =>
                    includedCategories.reduce((sum, category) => {
                        const series = chartData.datasets[category.key] || [];
                        const value = series[index] || 0;
                        if (chartMode === 'stacked') {
                            return activeSet.has(category.key) ? sum + value : sum;
                        }
                        return sum + value;
                    }, 0)
                );

                const datasets = CHART_CATEGORY_META.map(category => {
                    const baseSeries = chartData.datasets[category.key] || [];
                    const isActive = activeSet.has(category.key);

                    if (chartMode === 'stacked') {
                        const data = isActive ? baseSeries : baseSeries.map(() => 0);
                        return {
                            type: 'bar',
                            stack: 'total',
                            label: `${category.icon} ${category.label}`,
                            data,
                            backgroundColor: withAlpha(category.color, isActive ? 0.75 : 0.18),
                            borderColor: 'transparent',
                            borderWidth: 0,
                            hidden: false
                        };
                    }

                    if (!isActive) {
                        return null;
                    }

                    return {
                        type: 'line',
                        label: `${category.icon} ${category.label}`,
                        data: baseSeries,
                        borderColor: withAlpha(category.color, 1),
                        borderWidth: 2.6,
                        tension: 0.35,
                        pointRadius: chartMode === 'area' ? 3.5 : 4,
                        pointHoverRadius: 6,
                        fill: chartMode === 'area',
                        backgroundColor: chartMode === 'area' ? buildGradient(category.color, false) : withAlpha(category.color, 0.12),
                        spanGaps: true
                    };
                }).filter(Boolean);

                const config = {
                    type: chartMode === 'stacked' ? 'bar' : 'line',
                    data: {
                        labels: chartData.labels,
                        datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#F9FAFB',
                                bodyColor: '#E5E7EB',
                                borderColor: '#374151',
                                borderWidth: 1,
                                displayColors: false,
                                callbacks: {
                                    title: (items) => (items.length ? items[0].label : ''),
                                    label: (context) => {
                                        const value = context.parsed.y || 0;
                                        const total = visibleTotalsPerMonth[context.dataIndex] || 0;
                                        const share = total ? ` · ${(value / total * 100).toFixed(1)}%` : '';
                                        return `${context.dataset.label}: ${value.toLocaleString()}원${share}`;
                                    },
                                    labelTextColor: (context) => {
                                        const datasetLabel = context.dataset?.label || '';
                                        const matched = CHART_CATEGORY_META.find(meta => `${meta.icon} ${meta.label}` === datasetLabel);
                                        return matched ? matched.color : '#E5E7EB';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(100, 116, 139, 0.14)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#cbd5f5',
                                    font: {
                                        family: 'Pretendard, sans-serif',
                                        size: 12,
                                        weight: '500'
                                    }
                                },
                                stacked: chartMode === 'stacked'
                            },
                            y: {
                                beginAtZero: true,
                                suggestedMax,
                                grid: {
                                    color: 'rgba(100, 116, 139, 0.14)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#cbd5f5',
                                    font: {
                                        family: 'Pretendard, sans-serif',
                                        size: 12,
                                        weight: '500'
                                    },
                                    callback: (value) => {
                                        if (!Number.isFinite(value)) {
                                            return value;
                                        }

                                        if (value >= 100000000) {
                                            const billions = Math.floor(value / 100000000);
                                            const remainder = value % 100000000;
                                            if (remainder === 0) {
                                                return `${billions.toLocaleString()}억`;
                                            }
                                            return `${billions.toLocaleString()}억 ${(remainder / 10000).toLocaleString()}만`;
                                        }

                                        if (value >= 10000000) {
                                            const tenMillions = Math.floor(value / 10000000);
                                            const remainder = value % 10000000;
                                            if (remainder === 0) {
                                                return `${tenMillions}천만`;
                                            }
                                            if (remainder >= 1000000 && remainder % 1000000 === 0) {
                                                return `${tenMillions}천만 ${remainder / 1000000}백만`;
                                            }
                                            return `${(value / 10000).toLocaleString()}만`;
                                        }

                                        if (value >= 1000000) {
                                            const millions = Math.floor(value / 1000000);
                                            const remainder = value % 1000000;
                                            if (remainder === 0) {
                                                return `${millions}백만`;
                                            }
                                            return `${(value / 10000).toLocaleString()}만`;
                                        }

                                        if (value >= 10000) {
                                            const tenThousands = value / 10000;
                                            return `${Number.isInteger(tenThousands) ? tenThousands.toLocaleString() : tenThousands.toFixed(1)}만`;
                                        }

                                        return value.toLocaleString();
                                    }
                                },
                                stacked: chartMode === 'stacked'
                            }
                        }
                    }
                };

                const ChartCtor = window.Chart || window.ChartJS;
                chartRef.current = new ChartCtor(ctx, config);

                return () => {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                        chartRef.current = null;
                    }
                };
            }, [activeKeys, chartData, chartMode]);

            const toggleCategory = (key) => {
                setActiveKeys(prev => {
                    if (prev.includes(key)) {
                        const next = prev.filter(item => item !== key);
                        return next.length === 0 ? prev : next;
                    }
                    return [...prev, key];
                });
            };

            return (
                <div className="relative bg-gradient-to-br from-slate-950/80 via-slate-900/70 to-slate-950/80 rounded-xl border border-slate-800/60 p-6">
                    <div className="flex flex-wrap items-center gap-2 mb-4">
                        {CHART_CATEGORY_META.map(category => {
                            const isActive = activeKeys.includes(category.key);
                            return (
                                <button
                                    key={category.key}
                                    type="button"
                                    onClick={() => toggleCategory(category.key)}
                                    className={`chart-category-btn${isActive ? ' active' : ''}`}
                                >
                                    <span className="chart-category-dot" style={{ backgroundColor: category.color }}></span>
                                    <span>{category.icon} {category.label}</span>
                                </button>
                            );
                        })}
                        <button
                            type="button"
                            onClick={() => setActiveKeys(CHART_CATEGORY_META.map(category => category.key))}
                            className="chart-reset-btn"
                        >
                            전체 보기
                        </button>
                    </div>
                    <div className="flex flex-wrap items-center gap-2 mb-4 text-xs text-slate-400">
                        <span>차트 유형:</span>
                        {[
                            { value: 'area', label: '에어리어' },
                            { value: 'line', label: '라인' },
                            { value: 'stacked', label: '스택' }
                        ].map(mode => (
                            <button
                                key={mode.value}
                                type="button"
                                onClick={() => setChartMode(mode.value)}
                                className={`chart-mode-btn${chartMode === mode.value ? ' active' : ''}`}
                            >
                                {mode.label}
                            </button>
                        ))}
                    </div>
                    <div className="relative h-72">
                        <canvas ref={canvasRef}></canvas>
                    </div>
                </div>
            );
        });

        // 환경 변수 또는 설정
        const CONFIG = {
            ADMIN_PASSWORD: '4405', // 관리자 비밀번호
            INCENTIVE_RATES: {
                full: {
                    60000000: 12,
                    50000000: 10,
                    45000000: 9,
                    40000000: 8,
                    35000000: 7,
                    30000000: 6,
                    25000000: 5,
                    0: 4
                },
                part: {
                    60000000: 6,
                    50000000: 5,
                    45000000: 4.5,
                    40000000: 4,
                    35000000: 3.5,
                    30000000: 3,
                    25000000: 2.5,
                    0: 2
                }
            }
        };

        const NeoFitPayCalc = () => {
            const [salesData, setSalesData] = useState({});
            const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
            const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
            const [approvalPasswords, setApprovalPasswords] = useState({});
            const [editPasswords, setEditPasswords] = useState({});
            const [employeeType, setEmployeeType] = useState('full');
            const [customerName, setCustomerName] = useState({});
            const [selectedProducts, setSelectedProducts] = useState({});
            const [customPrices, setCustomPrices] = useState({});
            const [expandedDays, setExpandedDays] = useState({});
            const [checkedDetails, setCheckedDetails] = useState({});
            const [showAddSaleModal, setShowAddSaleModal] = useState(false);
            const [selectedModalDay, setSelectedModalDay] = useState(null);
            const [editingDetailContext, setEditingDetailContext] = useState(null);
            const [viewMode, setViewMode] = useState('daily'); // 'daily', 'weekly', 'monthly'
            const dailyViewRef = React.useRef(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [showSearchResultModal, setShowSearchResultModal] = useState(false);
            const [searchResults, setSearchResults] = useState([]);
            const [showCalendarModal, setShowCalendarModal] = useState(false);
            const [showPilatesModal, setShowPilatesModal] = useState(false);
            const [showHealthModal, setShowHealthModal] = useState(false);
            const [showNeofitModal, setShowNeofitModal] = useState(false);
            const [showClothingLockerModal, setShowClothingLockerModal] = useState(false);
            const [showPtModal, setShowPtModal] = useState(false);
            const [showOtherModal, setShowOtherModal] = useState(false);
            const [showDetailModal, setShowDetailModal] = useState(false);
            const [selectedDetailEntry, setSelectedDetailEntry] = useState(null);
            
            // Firebase 인증 상태
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            // dailySales 상태 추가 - 월별 리포트 차트를 위한 데이터
            const [dailySales, setDailySales] = useState([]);

            // 전체 연도 데이터 (월별 리포트 차트용)
            const [yearlyDailySales, setYearlyDailySales] = useState([]);

            const [dataRefreshToken, setDataRefreshToken] = useState(0);
            
            const normalizeAmount = (value) => {
                try {
                    if (typeof value === 'number') {
                        return Number.isFinite(value) ? value : 0;
                    }

                    if (typeof value === 'string') {
                        const cleaned = value.replace(/[^0-9.-]/g, '');
                        if (!cleaned) return 0;
                        const numeric = Number(cleaned);
                        return Number.isFinite(numeric) ? numeric : 0;
                    }

                    if (value && typeof value.toString === 'function') {
                        const cleaned = value.toString().replace(/[^0-9.-]/g, '');
                        if (!cleaned) return 0;
                        const numeric = Number(cleaned);
                        return Number.isFinite(numeric) ? numeric : 0;
                    }

                    return 0;
                } catch (error) {
                    console.error('normalizeAmount error:', error);
                    return 0;
                }
            };

            const EMPTY_DAY_TEMPLATE = {
                amount: 0,
                approved: false,
                details: [],
            };

            const normalizeDetailList = (details) => {
                if (!Array.isArray(details)) {
                    return [];
                }

                return details.map(detail => {
                    const hasOriginalTotal = detail.originalTotal !== undefined && detail.originalTotal !== null;
                    const hasDiscountTotal = detail.discountTotal !== undefined && detail.discountTotal !== null;

                    const normalizedLineItems = Array.isArray(detail.lineItems)
                        ? detail.lineItems.map(item => {
                            const originalPrice = item.originalPrice !== undefined && item.originalPrice !== null
                                ? normalizeAmount(item.originalPrice)
                                : normalizeAmount(item.displayPrice ?? item.price);
                            const finalPrice = item.finalPrice !== undefined && item.finalPrice !== null
                                ? normalizeAmount(item.finalPrice)
                                : normalizeAmount(item.price ?? originalPrice);
                            const discountAmount = item.discountAmount !== undefined && item.discountAmount !== null
                                ? normalizeAmount(item.discountAmount)
                                : Math.max(0, originalPrice - finalPrice);

                            return {
                                ...item,
                                product: item.product || item.displayName || item.name || '',
                                categoryKey: item.categoryKey || item.category || '',
                                originalPrice,
                                finalPrice,
                                discountAmount,
                                discountEligible: item.discountEligible ?? DISCOUNT_ELIGIBLE_CATEGORIES.has(item.categoryKey || item.category || '')
                            };
                        })
                        : undefined;

                    const normalizedOriginalTotal = hasOriginalTotal
                        ? normalizeAmount(detail.originalTotal)
                        : (normalizedLineItems ? normalizedLineItems.reduce((sum, item) => sum + (item.originalPrice || 0), 0) : undefined);

                    const normalizedDiscountTotal = hasDiscountTotal
                        ? normalizeAmount(detail.discountTotal)
                        : (normalizedLineItems ? normalizedLineItems.reduce((sum, item) => sum + (item.discountAmount || 0), 0) : undefined);

                    const normalizedDetail = {
                        ...detail,
                        price: normalizeAmount(detail?.price)
                    };

                    if (normalizedLineItems && normalizedLineItems.length > 0) {
                        normalizedDetail.lineItems = normalizedLineItems;
                    } else {
                        delete normalizedDetail.lineItems;
                    }

                    if (normalizedOriginalTotal !== undefined && normalizedOriginalTotal !== null) {
                        normalizedDetail.originalTotal = normalizedOriginalTotal;
                    } else {
                        delete normalizedDetail.originalTotal;
                    }

                    if (normalizedDiscountTotal !== undefined && normalizedDiscountTotal !== null) {
                        normalizedDetail.discountTotal = normalizedDiscountTotal;
                    } else {
                        delete normalizedDetail.discountTotal;
                    }

                    return normalizedDetail;
                });
            };

            const normalizeSalesEntry = (entry = {}) => {
                const details = normalizeDetailList(entry.details);
                const detailsTotal = details.reduce((sum, detail) => sum + (detail.price || 0), 0);
                const amount = detailsTotal > 0 ? detailsTotal : normalizeAmount(entry.amount);

                return {
                    ...EMPTY_DAY_TEMPLATE,
                    ...entry,
                    amount,
                    details,
                };
            };

            const normalizeSalesMap = (data = {}) => Object.entries(data || {}).reduce((acc, [dateKey, rawEntry]) => {
                const normalizedEntry = normalizeSalesEntry(rawEntry);
                acc[dateKey] = {
                    ...normalizedEntry,
                    date: normalizedEntry.date || dateKey,
                };
                return acc;
            }, {});

            function calculateIndividualProductPrice(productName) {
                if (!productName) {
                    return 0;
                }

                if (productPrices && productPrices[productName]) {
                    return productPrices[productName];
                }

                const clothingRegex = /(운동복|락커)[^0-9]*([0-9]{1,3})\s*개월/;
                const clothingMatchGeneral = productName.match(clothingRegex);
                if (clothingMatchGeneral) {
                    const months = parseInt(clothingMatchGeneral[2], 10);
                    if (Number.isFinite(months) && months > 0) {
                        return months * 10000;
                    }
                }

                const lockerMatch = productName.match(/락커\s*:?\s*(\d+)개월/);
                if (lockerMatch) {
                    const lockerKey = `락커 ${lockerMatch[1]}개월`;
                    return productPrices?.[lockerKey] || 0;
                }

                const clothingMatch = productName.match(/운동복\s*:?\s*(\d+)개월/);
                if (clothingMatch) {
                    const clothingKey = `운동복 ${clothingMatch[1]}개월`;
                    return productPrices?.[clothingKey] || 0;
                }

                if (productName.includes('필라테스:')) {
                    const cleanName = productName.replace('필라테스:', '').trim();
                    return productPrices?.[cleanName] || 0;
                }

                if (productName.includes('네오핏:')) {
                    const cleanName = productName.replace('네오핏:', '').trim();
                    return productPrices?.[`네오핏 ${cleanName}`] || productPrices?.[cleanName] || 0;
                }

                if (productName.includes('헬스:')) {
                    const cleanName = productName.replace('헬스:', '').trim();
                    return productPrices?.[cleanName] || 0;
                }

                if (productName.includes('PT:')) {
                    const cleanName = productName.replace('PT:', '').trim();
                    return productPrices?.[cleanName] || 0;
                }

                if (productName.includes('체험') && !productName.includes('네오핏')) {
                    const direct = productPrices?.[productName];
                    if (direct) return direct;

                    const match = productName.match(/(\d+회)\s*체험|체험(\d+회)/);
                    if (match) {
                        const key = `${match[1] || match[2]} 체험`;
                        return productPrices?.[key] || 0;
                    }
                }

                if (productName.includes('근인일일권')) {
                    return productPrices?.['근인일일권'] || 10000;
                }

                if (productName.includes('일일권')) {
                    return productPrices?.['일일권'] || 10000;
                }

                const numberMatch = productName.match(/(\d+)/);
                if (numberMatch && numberMatch[1]) {
                    const extracted = parseInt(numberMatch[1], 10);
                    if (Number.isFinite(extracted) && extracted >= 1000 && extracted <= 5000000) {
                        return extracted;
                    }
                }

                return 0;
            }

            function splitProductEntries(detail, dayData, dateKey) {
                if (!detail) {
                    return [];
                }

                const rawProduct = (detail.product || '').toString().trim();
                if (!rawProduct) {
                    return [];
                }

                const clothingAmountOverride = getClothingAmount(rawProduct);
                const normalizedDetailPrice = normalizeAmount(detail.price);
                const baseEntry = {
                    date: dateKey,
                    category: detail.category || '',
                    type: detail.type || '',
                    customerName:
                        detail.customerName ||
                        detail.name ||
                        detail.customer ||
                        (dayData && (dayData.customerName || dayData.customer)) ||
                        '',
                    name:
                        detail.customerName ||
                        detail.name ||
                        detail.customer ||
                        (dayData && (dayData.customerName || dayData.customer)) ||
                        '',
                    approved: dayData.approved || false,
                    timestamp: detail.timestamp || dayData.timestamp || ''
                };

                if (Array.isArray(detail.lineItems) && detail.lineItems.length > 0) {
                    return detail.lineItems.map(item => {
                        const productName = (item.product || item.displayName || item.productName || rawProduct || '').toString();
                        const originalPrice = item.originalPrice !== undefined && item.originalPrice !== null
                            ? normalizeAmount(item.originalPrice)
                            : normalizeAmount(item.displayPrice ?? item.price);
                        const finalPrice = item.finalPrice !== undefined && item.finalPrice !== null
                            ? normalizeAmount(item.finalPrice)
                            : normalizeAmount(item.price ?? originalPrice);
                        const discountAmount = item.discountAmount !== undefined && item.discountAmount !== null
                            ? normalizeAmount(item.discountAmount)
                            : Math.max(0, originalPrice - finalPrice);
                        const categoryKey = item.categoryKey || deriveCategoryKey({ product: productName });

                        return {
                            ...baseEntry,
                            product: productName,
                            category: categoryKey || baseEntry.category,
                            price: finalPrice > 0 ? finalPrice : 0,
                            displayPrice: originalPrice > 0 ? originalPrice : (finalPrice > 0 ? finalPrice : 0),
                            originalPrice,
                            discountAmount,
                            discountEligible: item.discountEligible ?? DISCOUNT_ELIGIBLE_CATEGORIES.has(categoryKey || ''),
                            source: 'line-item'
                        };
                    });
                }

                const productParts = rawProduct
                    .split(',')
                    .flatMap(part => part.split('+'))
                    .map(part => part.trim())
                    .filter(Boolean);

                if (productParts.length <= 1) {
                    const basePrice = clothingAmountOverride !== null
                        ? clothingAmountOverride
                        : normalizeAmount(calculateIndividualProductPrice(rawProduct));
                    const effectivePrice = normalizedDetailPrice > 0 ? normalizedDetailPrice : basePrice;
                    const price = effectivePrice > 0 ? effectivePrice : 0;
                    const originalPrice = basePrice > 0 ? basePrice : price;
                    return [{
                        ...baseEntry,
                        product: rawProduct,
                        price,
                        originalPrice,
                        displayPrice: originalPrice,
                        source: 'detail'
                    }];
                }

                const components = productParts.map(part => {
                    const clothingComponentAmount = getClothingAmount(part);
                    const basePrice = clothingComponentAmount !== null
                        ? clothingComponentAmount
                        : normalizeAmount(calculateIndividualProductPrice(part));
                    return {
                        name: part,
                        basePrice,
                    };
                });

                const baseSum = components.reduce((sum, component) => sum + (component.basePrice > 0 ? component.basePrice : 0), 0);
                const targetTotal = normalizedDetailPrice > 0 ? normalizedDetailPrice : baseSum;

                let prices;
                if (baseSum > 0 && targetTotal > 0) {
                    const factor = targetTotal / baseSum;
                    let accumulated = 0;
                    prices = components.map((component, index) => {
                        if (index === components.length - 1) {
                            return Math.max(0, targetTotal - accumulated);
                        }
                        const adjusted = Math.max(0, Math.round(component.basePrice * factor));
                        accumulated += adjusted;
                        return adjusted;
                    });
                } else if (targetTotal > 0) {
                    const equalShare = Math.floor(targetTotal / components.length);
                    let remainder = targetTotal - equalShare * components.length;
                    prices = components.map((_, index) => {
                        const value = equalShare + (index === components.length - 1 ? remainder : 0);
                        return value > 0 ? value : 0;
                    });
                } else {
                    prices = components.map(() => 0);
                }

                return components.map((component, index) => {
                    const price = prices[index] > 0 ? prices[index] : 0;
                    const originalPrice = component.basePrice > 0 ? component.basePrice : price;
                    return {
                        ...baseEntry,
                        product: component.name,
                        price,
                        originalPrice,
                        displayPrice: originalPrice,
                        source: 'component'
                    };
                });
            }

            const ensureNumeric = (value, fallback) => (typeof value === 'number' && Number.isFinite(value) ? value : fallback);
            const getActiveYearMonth = () => {
                const today = new Date();
                const year = ensureNumeric(selectedYear, today.getFullYear());
                const monthIndex = ensureNumeric(selectedMonth, today.getMonth());
                return { year, monthIndex };
            };

            const extractSaleYearMonth = (sale) => {
                if (!sale) {
                    return null;
                }
                const rawDate = sale.date || sale.dateKey || sale.dateString || sale.createdAt;
                if (!rawDate) {
                    return null;
                }
                if (rawDate instanceof Date && !Number.isNaN(rawDate.getTime())) {
                    return {
                        year: rawDate.getFullYear(),
                        monthIndex: rawDate.getMonth(),
                    };
                }
                if (typeof rawDate === 'string') {
                    const normalized = rawDate.trim();
                    const match = normalized.match(/(\d{4})[-\/.](\d{1,2})/);
                    if (match) {
                        const year = parseInt(match[1], 10);
                        const monthIndex = parseInt(match[2], 10) - 1;
                        if (Number.isFinite(year) && Number.isFinite(monthIndex)) {
                            return { year, monthIndex };
                        }
                    }
                    const parsed = new Date(normalized);
                    const time = parsed.getTime();
                    if (!Number.isNaN(time)) {
                        return {
                            year: parsed.getFullYear(),
                            monthIndex: parsed.getMonth(),
                        };
                    }
                }
                return null;
            };

            const saleMatchesMonth = (sale, year, monthIndex) => {
                const parsed = extractSaleYearMonth(sale);
                return parsed ? (parsed.year === year && parsed.monthIndex === monthIndex) : false;
            };

            const FALLBACK_CATEGORY_KEY = 'etc';
            const CATEGORY_KEY_LOOKUP = {
                health: 'health',
                '헬스': 'health',
                '헬스장': 'health',
                '헬스권': 'health',
                gym: 'health',
                fitness: 'health',
                membership: 'health',
                neofit: 'neofit',
                '네오핏': 'neofit',
                neo: 'neofit',
                pt: 'pt',
                '피티': 'pt',
                'pt권': 'pt',
                personal: 'pt',
                trainer: 'pt',
                training: 'pt',
                pilates: 'pilates',
                '필라테스': 'pilates',
                etc: 'etc',
                misc: 'etc',
                기타: 'etc',
                clothing: 'etc',
                locker: 'etc',
                storage: 'etc'
            };

            const deriveCategoryKey = (detail) => {
                if (!detail) {
                    return FALLBACK_CATEGORY_KEY;
                }

                const explicit = (detail.category || detail.type || '').toString().trim().toLowerCase();
                if (explicit) {
                    const mapped = CATEGORY_KEY_LOOKUP[explicit];
                    if (mapped) {
                        return mapped;
                    }
                    if (explicit.includes('pilates')) return 'pilates';
                    if (explicit.includes('neo')) return 'neofit';
                    if (explicit.includes('pt') || explicit.includes('trainer')) return 'pt';
                    if (explicit.includes('health') || explicit.includes('fitness')) return 'health';
                }

                const product = (detail.product || '').toString().trim().toLowerCase();
                if (!product) {
                    return FALLBACK_CATEGORY_KEY;
                }

                if (product.includes('필라테스')) {
                    return 'pilates';
                }

                if (product.includes('네오핏') || product.includes('neofit') || product.includes('neo-fit')) {
                    return 'neofit';
                }

                if (
                    product.includes('pt') ||
                    product.includes('피티') ||
                    product.includes('personal') ||
                    product.includes('트레이닝') ||
                    product.includes('개인') ||
                    product.includes('trainer')
                ) {
                    return 'pt';
                }

                if (product.includes('운동복') || product.includes('락커') || product.includes('보관함')) {
                    return 'clothing';
                }

                if (product.includes('기타 조정') || product.includes('조정') || product.includes('adjust') || product.includes('조정분')) {
                    return 'etc';
                }

                if (product.includes('헬스')) {
                    return 'health';
                }

                if (product.includes('개월')) {
                    return 'etc';
                }

                return FALLBACK_CATEGORY_KEY;
            };

            // Firebase에서 실시간 데이터 구독
            React.useEffect(() => {
                if (!user) return;
                
                // 월이 변경될 때 데이터 초기화
                setSalesData({});
                
                // 현재 월 데이터 실시간 구독
                const unsubscribe = salesService.subscribeToMonthData(
                    selectedYear, 
                    selectedMonth, 
                    (data) => {
                        const normalized = normalizeSalesMap(data);
                        setSalesData(prevData => ({
                            ...prevData,
                            ...normalized
                        }));
                    }
                );
                
                // 전월 데이터 구독 제거 - 월별 매출 중복 계산 방지
                
                return () => {
                    // 구독 해제
                    setSalesData({});
                    if (unsubscribe) unsubscribe();
                };
            }, [user, selectedYear, selectedMonth]);
            const [loginError, setLoginError] = useState('');
            const [isSignUpMode, setIsSignUpMode] = useState(false);
            
            // Firebase 인증 상태 모니터링
            React.useEffect(() => {
                const unsubscribe = authService.subscribeToAuthChanges((user) => {
                    setUser(user);
                    setIsLoading(false);
                });
                
                return () => unsubscribe();
            }, []);

            // salesData에서 dailySales 배열 생성 (월별 리포트 차트용)
            React.useEffect(() => {
                const newDailySales = [];

                Object.keys(salesData).forEach(dateKey => {
                    const dayData = normalizeSalesEntry(salesData[dateKey]);
                    if (!dayData) return;

                    const dayEntries = [];
                    let detailSum = 0;

                    if (Array.isArray(dayData.details)) {
                        dayData.details.forEach(detail => {
                            const entries = splitProductEntries(detail, dayData, dateKey);
                            entries.forEach(entry => {
                                const priceValue = normalizeAmount(entry.price);
                                detailSum += priceValue;
                                dayEntries.push(entry);
                            });
                        });
                    }

                    const recordedAmount = normalizeAmount(dayData.amount);
                    const difference = recordedAmount - detailSum;

                // if (Math.abs(difference) > 0.1) {
                //     console.log('[NeoFit] 다른 금액과의 차이 발견', {
                //         dateKey,
                //         recordedAmount,
                //         calculatedSum: detailSum,
                //         difference,
                //         entries: dayEntries
                //     });
                // }

                    newDailySales.push(...dayEntries);
                });

                setDailySales(newDailySales);
                console.log('dailySales 업데이트됨:', newDailySales.length, '개 항목');
            }, [salesData]);

            // 전체 연도 데이터 로드 (월별 리포트 차트용)
            React.useEffect(() => {
                if (!user) return;

                const anchorDate = new Date(
                    isNaN(selectedYear) ? new Date().getFullYear() : selectedYear,
                    isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth,
                    1
                );
                const unsubscribes = [];

                // 월 변경 시 이전 데이터 초기화
                setYearlyDailySales([]);

                // 선택된 월 기준으로 이전 5개월부터 이후 4개월까지 데이터 로드
                const loadYearlyData = () => {

                    for (let i = -5; i <= 4; i++) {
                        const targetDate = new Date(anchorDate.getFullYear(), anchorDate.getMonth() + i, 1);
                        const year = targetDate.getFullYear();
                        const month = targetDate.getMonth();

                        try {
                            // 해당 월의 모든 데이터를 실시간 구독
                            const unsubscribe = salesService.subscribeToMonthData(
                                year,
                                month,
                                (monthData) => {
                                    const normalizedMonthData = normalizeSalesMap(monthData);

                                    // 월별 데이터를 dailySales 형태로 변환
                                    const monthDailySales = [];
                                    const monthPrefix = `${year}-${String(month + 1).padStart(2, '0')}`;
                                    Object.keys(normalizedMonthData).forEach(dateKey => {
                                        const dayData = normalizedMonthData[dateKey];
                                        if (dayData && dayData.details && Array.isArray(dayData.details)) {
                                            dayData.details.forEach(detail => {
                                                const entries = splitProductEntries(detail, dayData, dateKey);
                                                entries.forEach(entry => {
                                                    monthDailySales.push(entry);
                                                });
                                            });
                                        }
                                    });
                                    // Firestore에 기록된 amount 기준으로 상세 합계와 차이가 나면 보정
                                    const firestoreTotal = Object.values(normalizedMonthData).reduce((sum, day) => {
                                        return sum + normalizeAmount(day?.amount);
                                    }, 0);
                                    const detailSum = monthDailySales.reduce((sum, sale) => sum + normalizeAmount(sale.price), 0);
                                    if (firestoreTotal > detailSum) {
                                        monthDailySales.push({
                                            date: `${monthPrefix}-01`,
                                            product: '기타 조정',
                                            price: firestoreTotal - detailSum,
                                            category: 'etc',
                                            type: '',
                                            customerName: '',
                                            approved: true
                                        });
                                    }

                                    // 기존 데이터에서 해당 월 데이터 제거 후 새 데이터 추가
                                    setYearlyDailySales(prevData => {
                                        const filteredData = prevData.filter(sale => !sale.date.startsWith(monthPrefix));
                                        return [...filteredData, ...monthDailySales];
                                    });
                                }
                            );

                            if (unsubscribe) unsubscribes.push(unsubscribe);
                        } catch (error) {
                            console.error(`${year}년 ${month + 1}월 데이터 로드 오류:`, error);
                        }
                    }
                };

                loadYearlyData();

                // cleanup 함수
                return () => {
                    unsubscribes.forEach(unsubscribe => {
                        if (unsubscribe) unsubscribe();
                    });
                };
            }, [user, selectedYear, selectedMonth]);

            // Firebase 데이터 동기화
            React.useEffect(() => {
                if (user) {
                    const unsubscribe = salesService.subscribeToMonthData(
                        selectedYear,
                        selectedMonth,
                        (data) => {
                            const normalized = normalizeSalesMap(data);
                            setSalesData(prevData => ({
                                ...prevData,
                                ...normalized
                            }));
                        }
                    );
                    
                    return () => unsubscribe();
                }
            }, [user, selectedYear, selectedMonth]);

            // 상품 목록
            const healthProducts = ['1개월', '3개월', '6개월', '12개월'];
            const ptProducts = ['1회 체험', '5회 체험'];
            const pilatesProducts = [
                '3개월 (24회 주 2회)', 
                '6개월 (48회 주 2회)', 
                '12개월 (96회 주 2회)',
                '3개월 (36회 주 3회)',
                '6개월 (72회 주 3회)',
                '12개월 (144회 주 3회)'
            ];
            const neofitProducts = [
                '네오핏 3회 체험권',
                '네오핏 12회 단독 상품',
                '30일 기간권',
                '180일 기간권',
                '90일 기간권',
                '8회 주 2회',
                '24회 주 2회',
                '48회 주 2회',
                '12회 주 3회',
                '36회 주 3회',
                '72회 주 3회'
            ];
            const lockerProducts = ['운동복', '락커'];
            const lockerPeriods = ['1개월', '2개월', '3개월', '4개월', '5개월', '6개월', '7개월', '8개월', '9개월', '10개월', '11개월', '12개월'];
            
            // 상품 가격표
            const productPrices = {
                // 헬스 이용권
                '1개월': 110000,
                '3개월': 270000,
                '6개월': 420000,
                '12개월': 600000,
                // 1:1 PT 이용권
                '1회 체험': 45000,
                '5회 체험': 225000,
                // 일일권
                '일일권': 10000,
                '근인일일권': 10000,
                // 네오핏 이용권
                '네오핏 3회 체험권': 60000,
                '네오핏 12회 단독 상품': 264000,
                '30일 기간권': 390000,
                '180일 기간권': 1980000,
                '90일 기간권': 1080000,
                '8회 주 2회': 264000,
                '24회 주 2회': 744000,
                '48회 주 2회': 1392000,
                '12회 주 3회': 348000,
                '36회 주 3회': 972000,
                '72회 주 3회': 1800000,
                '3개월 (24회 주 2회)': 384000,
                '6개월 (48회 주 2회)': 624000,
                '12개월 (96회 주 2회)': 960000,
                '3개월 (36회 주 3회)': 540000,
                '6개월 (72회 주 3회)': 864000,
                '12개월 (144회 주 3회)': 1296000,
                // 운동복/락커 가격 (1개월부터 12개월까지)
                '운동복 1개월': 10000,
                '운동복 2개월': 20000,
                '운동복 3개월': 30000,
                '운동복 4개월': 40000,
                '운동복 5개월': 50000,
                '운동복 6개월': 60000,
                '운동복 7개월': 70000,
                '운동복 8개월': 80000,
                '운동복 9개월': 90000,
                '운동복 10개월': 100000,
                '운동복 11개월': 110000,
                '운동복 12개월': 120000,
                '락커 1개월': 10000,
                '락커 2개월': 20000,
                '락커 3개월': 30000,
                '락커 4개월': 40000,
                '락커 5개월': 50000,
                '락커 6개월': 60000,
                '락커 7개월': 70000,
                '락커 8개월': 80000,
                '락커 9개월': 90000,
                '락커 10개월': 100000,
                '락커 11개월': 110000,
                '락커 12개월': 120000
            };

            // 날짜 키 생성
            const getDateKey = (day) => {
                // NaN 체크 및 기본값 처리
                const year = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
                const month = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
                const dayNum = isNaN(day) ? 1 : day;
                
                // 유효성 검사
                if (year < 2000 || year > 3000 || month < 0 || month > 11 || dayNum < 1 || dayNum > 31) {
                    console.error('Invalid date values:', { year, month, dayNum });
                    // 기본값 반환
                    const today = new Date();
                    return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                }
                
                return `${year}-${String(month + 1).padStart(2, '0')}-${String(dayNum).padStart(2, '0')}`;
            };

            // 날짜별 입력 폼 토글
            const toggleDayExpansion = (day) => {
                setExpandedDays(prev => ({
                    ...prev,
                    [day]: !prev[day]
                }));
            };

            const openSaleDetail = (day, dateKey, detail, dayData) => {
                if (!detail) {
                    return;
                }

                setSelectedDetailEntry({
                    day,
                    dateKey,
                    detail,
                    approved: dayData?.approved || false,
                    dayLabel: `${selectedMonth + 1}월 ${day}일`,
                    amount: normalizeAmount(detail.price)
                });
                setShowDetailModal(true);
            };

            const closeSaleDetail = () => {
                setShowDetailModal(false);
                setSelectedDetailEntry(null);
            };
            
            // 매출 입력 모달 열기
            const openAddSaleModal = (day, detail = null, explicitDateKey = null) => {
                setSelectedModalDay(day);

                if (detail) {
                    const resolvedDateKey = explicitDateKey || getDateKey(day);
                    setEditingDetailContext({
                        day,
                        dateKey: resolvedDateKey,
                        detailId: detail.id,
                        detail
                    });
                } else {
                    setEditingDetailContext(null);
                }

                setShowAddSaleModal(true);
            };

            const closeSaleModal = () => {
                setShowAddSaleModal(false);
                setEditingDetailContext(null);
            };

            // 매출 상세 내역 추가
            const addSaleDetail = async (day) => {
                const dayCustomerName = customerName[day] || '';
                const daySelectedProduct = selectedProducts[day] || '';
                const dayCustomPrice = customPrices[day] || 0;

                if (!dayCustomerName.trim() || !daySelectedProduct || !dayCustomPrice) {
                    alert('회원명, 상품, 가격을 모두 입력해주세요.');
                    return;
                }

                const dateKey = getDateKey(day);
                const newDetail = {
                    id: Date.now() + Math.random(),
                    customerName: dayCustomerName.trim(),
                    product: daySelectedProduct,
                    price: normalizeAmount(dayCustomPrice),
                    timestamp: new Date().toLocaleTimeString('ko-KR', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    })
                };

                // Firebase에 저장
                const currentData = normalizeSalesEntry(salesData[dateKey]);
                const newDetails = [...currentData.details, newDetail];
                const newTotalAmount = newDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);
                
                const updatedData = {
                    ...currentData,
                    details: normalizeDetailList(newDetails),
                    amount: newTotalAmount,
                    date: dateKey
                };
                
                await salesService.saveSalesData(dateKey, updatedData);

                // 해당 날짜 입력 필드 초기화
                setCustomerName(prev => ({ ...prev, [day]: '' }));
                setSelectedProducts(prev => ({ ...prev, [day]: '' }));
                setCustomPrices(prev => ({ ...prev, [day]: '' }));
                
                alert('매출이 성공적으로 등록되었습니다!');
            };

            // 매출 상세 삭제
            const removeSaleDetail = async (day, detailId) => {
                const dateKey = getDateKey(day);
                const currentData = normalizeSalesEntry(salesData[dateKey]);
                const newDetails = currentData.details.filter(detail => detail.id !== detailId);
                const newTotalAmount = newDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);
                
                const updatedData = {
                    ...currentData,
                    details: normalizeDetailList(newDetails),
                    amount: newTotalAmount,
                    date: dateKey
                };
                
                await salesService.saveSalesData(dateKey, updatedData);
            };

            // 관리자 승인 처리
            const handleAdminApproval = async (day) => {
                const dateKey = getDateKey(day);
                const password = approvalPasswords[dateKey] || '';
                
                if (password === CONFIG.ADMIN_PASSWORD) {
                    const currentData = salesData[dateKey] || {};
                    const updatedData = {
                        ...currentData,
                        approved: true,
                        date: dateKey
                    };
                    
                    await salesService.saveSalesData(dateKey, updatedData);
                    
                    setApprovalPasswords(prev => ({
                        ...prev,
                        [dateKey]: ''
                    }));
                } else {
                    alert('비밀번호가 올바르지 않습니다.');
                }
            };

            // 수정 모드 처리
            const handleEditMode = async (day) => {
                const dateKey = getDateKey(day);
                const password = editPasswords[dateKey] || '';
                
                if (password === CONFIG.ADMIN_PASSWORD) {
                    const currentData = salesData[dateKey] || {};
                    const updatedData = {
                        ...currentData,
                        approved: false,
                        date: dateKey
                    };
                    
                    // Firebase에 저장
                    await salesService.saveSalesData(dateKey, updatedData);
                    
                    setEditPasswords(prev => ({
                        ...prev,
                        [dateKey]: ''
                    }));
                } else {
                    alert('비밀번호가 올바르지 않습니다.');
                }
            };

            // 월의 일수 계산
            const getDaysInMonth = () => {
                try {
                    // 기본값 처리
                    const year = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
                    const month = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
                    
                    // 유효성 검사
                    if (year < 2000 || year > 3000 || month < 0 || month > 11) {
                        console.error('Invalid year or month:', { year, month });
                        return 31; // 기본값 반환
                    }
                    
                    const days = new Date(year, month + 1, 0).getDate();
                    return isNaN(days) ? 31 : days;
                } catch (error) {
                    console.error('Error in getDaysInMonth:', error);
                    return 31;
                }
            };

            // 주간 매출 계산 (승인된 매출만 계산)
            const calculateWeeklySales = () => {
                try {
                    const weeks = [];
                    
                    // selectedYear과 selectedMonth 유효성 검사
                    if (isNaN(selectedYear) || isNaN(selectedMonth) || selectedYear < 2000 || selectedYear > 3000 || selectedMonth < 0 || selectedMonth > 11) {
                        console.warn('Invalid year or month for weekly calculation:', { selectedYear, selectedMonth });
                        return [];
                    }
                    
                    const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
                    
                    if (!daysInMonth || daysInMonth <= 0 || isNaN(daysInMonth)) {
                        return [];
                    }

                    let currentWeek = [];
                    let weekTotal = 0;

                    for (let day = 1; day <= daysInMonth; day++) {
                        // 안전한 dateKey 생성
                        const dateKey = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        
                        if (salesData && salesData[dateKey]) {
                            const dayData = salesData[dateKey];
                            // 승인된 매출만 계산
                            if (dayData.approved) {
                                const amountValue = normalizeAmount(dayData.amount);
                                if (amountValue > 0) {
                                    weekTotal += amountValue;
                                }
                            }
                        }
                        
                        currentWeek.push(day);

                        // 주 마감 또는 월 마지막 날
                        if (currentWeek.length === 7 || day === daysInMonth) {
                            if (currentWeek.length > 0) {
                                weeks.push({
                                    days: [...currentWeek],
                                    total: weekTotal
                                });
                            }
                            currentWeek = [];
                            weekTotal = 0;
                        }
                    }

                    return weeks;
                } catch (error) {
                    console.error('Error in calculateWeeklySales:', error);
                    return [];
                }
            };

            const matchSnapshotCategory = (value) => {
                if (!value) {
                    return null;
                }

                const lower = value.toString().trim().toLowerCase();
                if (!lower) {
                    return null;
                }

                if (
                    lower === 'health' ||
                    lower === '헬스' ||
                    lower === '헬스장' ||
                    lower === '헬스권' ||
                    lower === 'gym' ||
                    lower === 'fitness' ||
                    lower === 'membership'
                ) {
                    return 'health';
                }

                if (lower === 'neofit' || lower === '네오핏' || lower === 'neo-fit') {
                    return 'neofit';
                }

                if (lower === 'pt' || lower === '피티' || lower === 'personal' || lower === 'trainer' || lower === 'training') {
                    return 'pt';
                }

                if (lower === 'pilates' || lower === '필라테스') {
                    return 'pilates';
                }

                if (lower === 'clothing' || lower === '운동복' || lower === '락커' || lower === '보관함') {
                    return 'clothing';
                }

                if (lower === 'etc' || lower === '기타' || lower === 'misc') {
                    return 'etc';
                }

                if (lower.includes('운동복') || lower.includes('락커') || lower.includes('보관함')) {
                    return 'clothing';
                }

                if (lower.includes('체험')) {
                    if (lower.includes('네오핏')) {
                        return 'neofit';
                    }
                    if (lower.includes('필라테스')) {
                        return 'pilates';
                    }
                    return 'pt';
                }

                if (lower.includes('필라테스')) {
                    return 'pilates';
                }

                if (lower.includes('네오핏') || lower.includes('neofit') || lower.includes('neo-fit') || lower.includes('neo fit')) {
                    return 'neofit';
                }

                if (
                    lower.includes('pt') ||
                    lower.includes('피티') ||
                    lower.includes('personal') ||
                    lower.includes('트레이닝') ||
                    lower.includes('개인') ||
                    lower.includes('trainer')
                ) {
                    return 'pt';
                }

                if (lower.includes('헬스')) {
                    return 'health';
                }

                if (lower.includes('개월') && !lower.includes('필라테스') && !lower.includes('운동복') && !lower.includes('락커')) {
                    return 'health';
                }

                if (lower.includes('기타') || lower.includes('조정') || lower.includes('adjust') || lower.includes('조정분')) {
                    return 'etc';
                }

                return null;
            };

            const resolveSnapshotCategory = (sale) => {
                if (!sale) {
                    return 'etc';
                }

                const candidates = [sale.category, sale.type, sale.product];
                for (const candidate of candidates) {
                    const matched = matchSnapshotCategory(candidate);
                    if (matched) {
                        return matched;
                    }
                }

                return 'etc';
            };

            const isDateInActiveMonth = React.useCallback((dateString) => {
                if (!dateString) {
                    return false;
                }

                const { year, monthIndex } = getActiveYearMonth();
                const [saleYearStr, saleMonthStr] = dateString.split('-');
                const saleYear = Number(saleYearStr);
                const saleMonth = Number(saleMonthStr);

                if (!Number.isFinite(saleYear) || !Number.isFinite(saleMonth)) {
                    return false;
                }

                return saleYear === year && saleMonth === monthIndex + 1;
            }, [selectedYear, selectedMonth]);

            const snapshotSalesEntries = React.useMemo(() => {
                const activeMonthSales = Array.isArray(dailySales)
                    ? dailySales.filter(sale => sale && isDateInActiveMonth(sale.date))
                    : [];

                if (activeMonthSales.length > 0) {
                    return activeMonthSales;
                }

                const aggregated = [];

                Object.entries(salesData || {}).forEach(([dateKey, rawEntry]) => {
                    if (!isDateInActiveMonth(dateKey)) {
                        return;
                    }

                    const dayData = normalizeSalesEntry(rawEntry);
                    if (!dayData || !dayData.approved) {
                        return;
                    }

                    let detailTotal = 0;

                    if (Array.isArray(dayData.details) && dayData.details.length > 0) {
                        dayData.details.forEach(detail => {
                            const entries = splitProductEntries(detail, dayData, dateKey);
                            entries.forEach(entry => {
                                detailTotal += normalizeAmount(entry.price);
                                aggregated.push(entry);
                            });
                        });
                    }

                    const dayAmount = normalizeAmount(dayData.amount);
                    if (dayAmount > detailTotal) {
                        aggregated.push({
                            date: dateKey,
                            product: '기타 조정',
                            category: '기타',
                            type: '',
                            price: dayAmount - detailTotal,
                            approved: true,
                            source: 'adjustment'
                        });
                    }
                });

                return aggregated.filter(sale => sale && isDateInActiveMonth(sale.date));
            }, [dailySales, salesData, isDateInActiveMonth]);

            const snapshotCategoryTotals = React.useMemo(() => {
                const totals = {
                    health: 0,
                    neofit: 0,
                    pt: 0,
                    pilates: 0,
                    clothing: 0,
                    etc: 0,
                    total: 0,
                };

                if (!Array.isArray(snapshotSalesEntries) || snapshotSalesEntries.length === 0) {
                    return totals;
                }

                snapshotSalesEntries.forEach(sale => {
                    if (!sale || !sale.approved) {
                        return;
                    }

                    if (!isDateInActiveMonth(sale.date)) {
                        return;
                    }

                    const amount = normalizeAmount(sale.price);
                    if (!Number.isFinite(amount) || amount <= 0) {
                        return;
                    }

                    const categoryKey = resolveSnapshotCategory(sale);
                    if (totals[categoryKey] === undefined) {
                        totals.etc += amount;
                    } else {
                        totals[categoryKey] += amount;
                    }

                    totals.total += amount;
                });

                return totals;
            }, [snapshotSalesEntries]);

            const formatDateKey = (dateKey) => {
                if (!dateKey || typeof dateKey !== 'string') {
                    return dateKey || '';
                }

                const parts = dateKey.split('-').map(Number);
                if (parts.length < 3 || parts.some(part => !Number.isFinite(part))) {
                    return dateKey;
                }

                const [, month, day] = parts;
                return `${month}월 ${day}일`;
            };

            const normalizeDateKeyString = (input) => {
                if (!input) return '';

                if (input instanceof Date && !Number.isNaN(input.getTime())) {
                    return `${input.getFullYear()}-${String(input.getMonth() + 1).padStart(2, '0')}-${String(input.getDate()).padStart(2, '0')}`;
                }

                if (typeof input === 'string') {
                    const trimmed = input.trim();
                    const simpleMatch = trimmed.match(/^(\d{4})[-\/.]?(\d{1,2})[-\/.]?(\d{1,2})$/);
                    if (simpleMatch) {
                        const [, y, m, d] = simpleMatch;
                        const year = Number(y);
                        const month = Number(m);
                        const day = Number(d);
                        if (
                            Number.isFinite(year) &&
                            Number.isFinite(month) &&
                            Number.isFinite(day) &&
                            month >= 1 && month <= 12 &&
                            day >= 1 && day <= 31
                        ) {
                            return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        }
                    }

                    const parsed = new Date(trimmed);
                    if (!Number.isNaN(parsed.getTime())) {
                        return `${parsed.getFullYear()}-${String(parsed.getMonth() + 1).padStart(2, '0')}-${String(parsed.getDate()).padStart(2, '0')}`;
                    }
                }

                return '';
            };

            const getCategoryDetailEntries = (categoryKey) => {
                if (!Array.isArray(snapshotSalesEntries) || snapshotSalesEntries.length === 0) {
                    return [];
                }

               return snapshotSalesEntries
                    .filter(entry => entry && entry.approved && resolveSnapshotCategory(entry) === categoryKey)
                    .map(entry => {
                        const actualPrice = normalizeAmount(entry.price);
                        const originalPrice = normalizeAmount(
                            entry.originalPrice !== undefined
                                ? entry.originalPrice
                                : (entry.displayPrice !== undefined ? entry.displayPrice : entry.price)
                        );
                        const discountAllowed = DISCOUNT_ELIGIBLE_CATEGORIES.has(categoryKey);
                        const discountAmount = discountAllowed ? Math.max(0, originalPrice - actualPrice) : 0;
                        return {
                            ...entry,
                            price: actualPrice,
                            displayPrice: originalPrice,
                            originalPrice,
                            discountAmount,
                            discountEligible: discountAllowed,
                            dateKey: entry.date,
                            date: formatDateKey(entry.date),
                        };
                    })
                    .sort((a, b) => (b.dateKey || '').localeCompare(a.dateKey || ''));
            };

            const categoryDetailsCache = React.useMemo(() => {
                const cache = {};
                CATEGORY_KEYS.forEach(key => {
                    cache[key] = getCategoryDetailEntries(key);
                });
                return cache;
            }, [snapshotSalesEntries, selectedYear, selectedMonth]);

            const categoryTotals = React.useMemo(() => {
                const totals = { total: 0 };
                CATEGORY_KEYS.forEach(key => {
                    const entries = categoryDetailsCache[key] || [];
                    const sum = entries.reduce((sum, item) => sum + ((item.price || 0)), 0);
                    totals[key] = sum;
                    totals.total += sum;
                });
                return totals;
            }, [categoryDetailsCache]);

            React.useEffect(() => {
                if (Array.isArray(snapshotSalesEntries) && snapshotSalesEntries.length > 0) {
                    const mixedEntries = snapshotSalesEntries
                        .filter(sale => {
                            const product = (sale?.product || '').toString();
                            return product.includes(',') || /\b(운동복|락커|헬스|네오핏|필라테스|PT)\b/i.test(product) && product.split(',').length > 1;
                        })
                        .slice(0, 20)
                        .map(sale => ({
                            date: sale.date,
                            product: sale.product,
                            price: sale.price,
                            category: resolveSnapshotCategory(sale),
                        }));

                    console.log('[NeoFit] 복합 상품 샘플', mixedEntries);
                }
            }, [snapshotSalesEntries]);

            React.useEffect(() => {
                if (!snapshotCategoryTotals) {
                    return;
                }

                const categorySum =
                    (snapshotCategoryTotals.health || 0) +
                    (snapshotCategoryTotals.neofit || 0) +
                    (snapshotCategoryTotals.pt || 0) +
                    (snapshotCategoryTotals.pilates || 0) +
                    (snapshotCategoryTotals.clothing || 0) +
                    (snapshotCategoryTotals.etc || 0);

                console.log('[NeoFit] 카테고리 합계 디버그', {
                    selectedYear,
                    selectedMonth,
                    totals: snapshotCategoryTotals,
                    categorySum,
                    difference: (snapshotCategoryTotals.total || 0) - categorySum,
                    entryCount: Array.isArray(snapshotSalesEntries) ? snapshotSalesEntries.length : 0,
                });

                if (Array.isArray(snapshotSalesEntries) && snapshotSalesEntries.length > 0) {
                    const debugSummary = snapshotSalesEntries.reduce((acc, sale) => {
                        const amount = normalizeAmount(sale.price);
                        const key = resolveSnapshotCategory(sale);

                        acc.all.byCategory[key] = (acc.all.byCategory[key] || 0) + amount;
                        acc.all.total += amount;

                        if (sale.approved) {
                            acc.approved.byCategory[key] = (acc.approved.byCategory[key] || 0) + amount;
                            acc.approved.total += amount;
                        } else {
                            acc.unapproved.byCategory[key] = (acc.unapproved.byCategory[key] || 0) + amount;
                            acc.unapproved.total += amount;
                        }

                        return acc;
                    }, {
                        all: { total: 0, byCategory: {} },
                        approved: { total: 0, byCategory: {} },
                        unapproved: { total: 0, byCategory: {} },
                    });

                    console.log('[NeoFit] 카테고리 세부 디버그', debugSummary);
                }
            }, [snapshotCategoryTotals, selectedYear, selectedMonth, snapshotSalesEntries]);
            // 월별 카테고리 매출 계산 함수들 (수정된 버전)
            const calculateMonthlyCategorySales = (year, month, categoryType, useYearlyData = false) => {
                try {
                    const isSelectedMonth = year === selectedYear && month === (selectedMonth + 1);

                    if (isSelectedMonth) {
                        if (categoryType === 'total') {
                            return categoryTotals.total || 0;
                        }

                        if (CATEGORY_KEYS.includes(categoryType)) {
                            return categoryTotals[categoryType] || 0;
                        }
                    }

                    const dataSource = useYearlyData ? yearlyDailySales : dailySales;

                    if (!dataSource || !Array.isArray(dataSource) || dataSource.length === 0) {
                        return 0;
                    }

                    const targetMonth = `${year}-${String(month).padStart(2, '0')}`;
                    let total = 0;

                    dataSource.forEach(sale => {
                        try {
                            if (!sale || !sale.date || !sale.price) {
                                return;
                            }

                            const saleDateParts = sale.date.split('-');
                            if (saleDateParts.length < 2) {
                                return;
                            }

                            const saleYear = parseInt(saleDateParts[0]);
                            const saleMonth = parseInt(saleDateParts[1]);
                            if (saleYear !== year || saleMonth !== month) {
                                return;
                            }

                            if (!sale.approved) {
                                return;
                            }

                            const derivedCategory = deriveCategoryKey(sale);
                            const targetCategory = categoryType === 'etc' ? 'etc' : categoryType;

                            if (targetCategory === 'total') {
                                const price = normalizeAmount(sale.price);
                                total += price;
                                return;
                            }

                            if (derivedCategory === targetCategory) {
                                const price = normalizeAmount(sale.price);
                                total += price;
                            }
                        } catch (e) {
                            // 개별 항목 오류는 무시하고 계속
                            console.warn('개별 매출 항목 처리 오류:', e);
                        }
                    });

                    return total;
                } catch (error) {
                    console.error('월별 카테고리 매출 계산 오류:', error);
                    return 0;
                }
            };

            const CATEGORY_TREND_OFFSETS = [-5, -4, -3, -2, -1, 0];

            const buildCategoryMonthlySeries = (categoryType, offsets = CATEGORY_TREND_OFFSETS) => {
                try {
                    const anchorDate = new Date(
                        isNaN(selectedYear) ? new Date().getFullYear() : selectedYear,
                        isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth,
                        1
                    );

                    return offsets.map(offset => {
                        const targetDate = new Date(anchorDate.getFullYear(), anchorDate.getMonth() + offset, 1);
                        const year = targetDate.getFullYear();
                        const monthNumber = targetDate.getMonth() + 1;
                        const total = calculateMonthlyCategorySales(year, monthNumber, categoryType, true);
                        return { year, month: monthNumber, total, offset };
                    });
                } catch (error) {
                    console.error('카테고리 월별 시계열 계산 오류:', error);
                    return [];
                }
            };

            const getCategorySixMonthTrend = (categoryType) => {
                const series = buildCategoryMonthlySeries(categoryType);
                if (series.length === 0) {
                    return {
                        series,
                        currentTotal: 0,
                        average: 0,
                        percentChange: null,
                        changeText: '최근 6개월 데이터 없음',
                        toneClass: 'text-gray-500',
                        rangeLabel: ''
                    };
                }

                const currentEntry = series.find(entry => entry.offset === 0) || series[series.length - 1];
                const currentTotal = currentEntry ? currentEntry.total || 0 : 0;
                const previousEntries = series.filter(entry => entry.offset < 0);
                const previousWithData = previousEntries.filter(entry => (entry.total || 0) > 0);

                const averageSource = previousWithData.length > 0 ? previousWithData : previousEntries;
                const average = averageSource.length > 0
                    ? averageSource.reduce((sum, entry) => sum + (entry.total || 0), 0) / averageSource.length
                    : 0;

                let percentChange = null;
                let changeText = '최근 6개월 평균과 동일';
                let toneClass = 'text-gray-400';

                const hasHistory = averageSource.some(entry => (entry.total || 0) > 0);

                if (!hasHistory && currentTotal === 0) {
                    changeText = '최근 6개월 데이터 없음';
                    toneClass = 'text-gray-500';
                } else if (!hasHistory && currentTotal > 0) {
                    changeText = '최근 6개월 평균 대비 신규 매출';
                    toneClass = 'text-emerald-400';
                } else if (average === 0) {
                    changeText = '최근 6개월 평균과 동일';
                } else {
                    const rawChange = ((currentTotal - average) / average) * 100;
                    percentChange = Number(rawChange.toFixed(1));

                    if (Math.abs(percentChange) < 0.1) {
                        changeText = '최근 6개월 평균과 유사';
                    } else if (percentChange > 0) {
                        changeText = `최근 6개월 평균 대비 +${percentChange}%`;
                        toneClass = 'text-emerald-400';
                    } else {
                        changeText = `최근 6개월 평균 대비 ${percentChange}%`;
                        toneClass = 'text-rose-400';
                    }
                }

                const rangeEntries = [...averageSource, currentEntry]
                    .filter(entry => entry && typeof entry.month === 'number')
                    .sort((a, b) => (a.offset || 0) - (b.offset || 0));
                const rangeLabel = rangeEntries.length > 0
                    ? `${rangeEntries[0].month}월~${rangeEntries[rangeEntries.length - 1].month}월`
                    : '';

                return {
                    series,
                    currentTotal,
                    average,
                    percentChange,
                    changeText,
                    toneClass,
                    rangeLabel
                };
            };

            // 네오핏 매출만 계산 (안전한 방식)

            const getPilatesDetails = () => categoryDetailsCache.pilates || [];
            const getHealthDetails = () => categoryDetailsCache.health || [];
            const getNeofitDetails = () => categoryDetailsCache.neofit || [];
            const getClothingLockerDetails = () => categoryDetailsCache.clothing || [];
            const getPtDetails = () => categoryDetailsCache.pt || [];
            const getOtherDetails = () => categoryDetailsCache.etc || [];

            // 인센티브 비율 계산 (직원 타입별)
            const getIncentiveRate = (totalSales, type = null) => {
                const employeeTypeToUse = type || employeeType;
                const rates = CONFIG.INCENTIVE_RATES;

                const thresholds = Object.keys(rates[employeeTypeToUse])
                    .map(Number)
                    .sort((a, b) => b - a);

                for (const threshold of thresholds) {
                    if (totalSales >= threshold) {
                        return rates[employeeTypeToUse][threshold];
                    }
                }
                
                return rates[employeeTypeToUse][0];
            };

            const headlineMonthIndex = isNaN(selectedMonth) ? new Date().getMonth() : selectedMonth;
            const headlineYear = isNaN(selectedYear) ? new Date().getFullYear() : selectedYear;
            const headlineLabel = `${headlineMonthIndex + 1}월`;
            const headlineTotal = categoryTotals.total || 0;
            const previousMonthLabel = (() => {
                const prevMonthDate = new Date(headlineYear, headlineMonthIndex - 1, 1);
                const prevMonth = prevMonthDate.getMonth();
                return `${prevMonth + 1}월`;
            })();

            const previousMonthTotal = (() => {
                const prevMonthDate = new Date(headlineYear, headlineMonthIndex - 1, 1);
                const prevYear = prevMonthDate.getFullYear();
                const prevMonth = prevMonthDate.getMonth() + 1;
                return calculateMonthlyCategorySales(prevYear, prevMonth, 'total', true) || 0;
            })();

            const headlineDelta = (() => {
                if (previousMonthTotal <= 0) {
                    return { isIncrease: true, percentage: null, difference: headlineTotal };
                }
                const diff = headlineTotal - previousMonthTotal;
                const percentage = (diff / previousMonthTotal) * 100;
                return {
                    isIncrease: diff >= 0,
                    percentage,
                    difference: diff
                };
            })();
           const monthlyTotal = headlineTotal;
            const incentiveRate = getIncentiveRate(monthlyTotal);
            const incentiveAmount = isNaN(monthlyTotal * (incentiveRate / 100)) ? 0 : monthlyTotal * (incentiveRate / 100);
            const weeklySales = calculateWeeklySales();

            const categoryMeta = [
                {
                    key: 'health',
                    label: '헬스 이용권',
                    icon: '🏃‍♂️',
                    color: '#34d399',
                    accent: 'from-emerald-400 to-emerald-500'
                },
                {
                    key: 'neofit',
                    label: '네오핏',
                    icon: '🔥',
                    color: '#60a5fa',
                    accent: 'from-sky-400 to-blue-500'
                },
                {
                    key: 'pt',
                    label: '1:1 PT',
                    icon: '🏋️',
                    color: '#fbbf24',
                    accent: 'from-amber-400 to-amber-500'
                },
                {
                    key: 'pilates',
                    label: '필라테스',
                    icon: '🧘‍♀️',
                    color: '#fb7185',
                    accent: 'from-rose-400 to-pink-500'
                },
                {
                    key: 'clothing',
                    label: '운동복/락커',
                    icon: '👕',
                    color: '#a855f7',
                    accent: 'from-violet-400 to-fuchsia-500'
                },
                {
                    key: 'etc',
                    label: '기타',
                    icon: '🧾',
                    color: '#94a3b8',
                    accent: 'from-slate-400 to-slate-500'
                }
            ];

            const categorySnapshots = categoryMeta.map((category) => {
                const total = Math.max(0, Number(categoryTotals[category.key] || 0));
                const trend = getCategorySixMonthTrend(category.key);
                const averageAmount = Math.round(trend.average || 0);
                const share = monthlyTotal > 0 ? Math.round((total / monthlyTotal) * 1000) / 10 : 0;

                return {
                    ...category,
                    total,
                    trend,
                    averageAmount,
                    averageLabel: `${averageAmount.toLocaleString()}원`,
                    share,
                    rangeLabel: trend.rangeLabel
                };
            });

            React.useEffect(() => {
                console.log('[NeoFit] 카드 스냅샷 디버그', categorySnapshots.map(snapshot => ({
                    key: snapshot.key,
                    total: snapshot.total,
                    share: snapshot.share,
                })), 'monthlyTotal:', monthlyTotal);
            }, [JSON.stringify(categorySnapshots), monthlyTotal]);

            const today = new Date();
            const benchmarkLabel = `${String(today.getMonth() + 1).padStart(2, '0')}.${String(today.getDate()).padStart(2, '0')}일 기준`;
            
            // 오늘 매출 계산
            const [todaySales, setTodaySales] = React.useState(0);

            const getTodaySales = React.useCallback(() => todaySales, [todaySales]);

            React.useEffect(() => {
                const today = new Date();
                if (today.getMonth() !== selectedMonth || today.getFullYear() !== selectedYear) {
                    setTodaySales(0);
                    return;
                }

                const todayKey = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

                let total = 0;
                CATEGORY_KEYS.forEach(key => {
                    const details = categoryDetailsCache[key] || [];
                    total += details
                        .filter(entry => entry && entry.dateKey === todayKey)
                        .reduce((sum, item) => sum + (item.price || 0), 0);
                });

                if (total > 0) {
                    setTodaySales(total);
                    return;
                }

                total = (snapshotSalesEntries || [])
                    .filter(entry => entry && entry.date === todayKey)
                    .reduce((sum, entry) => sum + normalizeAmount(entry.price), 0);

                if (total > 0) {
                    setTodaySales(total);
                    return;
                }

                let todayData = salesData[todayKey];

                if (!todayData) {
                    const matchedEntry = Object.entries(salesData).find(([key, value]) => {
                        const normalizedKey = normalizeDateKeyString(key);
                        if (normalizedKey === todayKey) return true;
                        if (value && typeof value === 'object') {
                            const candidate = normalizeDateKeyString(value.date || value.dateKey || value.dateString);
                            if (candidate === todayKey) return true;
                        }
                        return false;
                    });
                    if (matchedEntry) {
                        todayData = matchedEntry[1];
                    }
                }

                if (!todayData && Array.isArray(dailySales) && dailySales.length > 0) {
                    const dailyMatches = dailySales.filter(entry => {
                        const normalized = normalizeDateKeyString(entry?.date || entry?.dateKey);
                        return normalized === todayKey;
                    });
                    if (dailyMatches.length > 0) {
                        const sum = dailyMatches.reduce((sum, entry) => sum + normalizeAmount(entry.price), 0);
                        if (sum > 0) {
                            setTodaySales(sum);
                            return;
                        }
                    }
                }

                if (todayData) {
                    const normalizedToday = normalizeSalesEntry(todayData);
                    const detailSum = (normalizedToday.details || []).reduce((sum, detail) => sum + (detail.price || 0), 0);
                    const fallbackAmount = normalizeAmount(normalizedToday.amount);
                    setTodaySales(detailSum > 0 ? detailSum : fallbackAmount);
                } else {
                    setTodaySales(0);
                }
            }, [categoryDetailsCache, snapshotSalesEntries, dailySales, salesData, selectedMonth, selectedYear]);
            
            // 이번주 매출 계산
            const getThisWeekSales = React.useCallback(() => {
                const today = new Date();
                // 현재 선택된 년월이 오늘과 같은지 확인
                if (today.getMonth() === selectedMonth && today.getFullYear() === selectedYear) {
                    const currentWeek = weeklySales.find(week => {
                        return week && week.days && Array.isArray(week.days) && week.days.includes(today.getDate());
                    });
                    return currentWeek && !isNaN(currentWeek.total) ? currentWeek.total : 0;
                }
                return 0;
            }, [weeklySales, selectedMonth, selectedYear]);

            // SVG 아이콘 컴포넌트
            const Icon = ({ icon: iconName, size = 24, style = {}, className = "" }) => {
                const svgIcons = {
                    "calendar": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    ),
                    "dollar-sign": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    ),
                    "check": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    ),
                    "trending-up": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                    ),
                    "edit": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    ),
                    "plus": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    ),
                    "trash-2": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    ),
                    "user": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    ),
                    "package": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                        </svg>
                    ),
                    "credit-card": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                    ),
                    "search": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    ),
                    "x": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    ),
                    "info": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12" y2="8"></line>
                        </svg>
                    ),
                    "clock": (
                        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className} style={style}>
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    )
                };
                
                return svgIcons[iconName] || <span>•</span>;
            };

            // 숫자에 천 단위 콤마 추가 함수
            const formatNumberWithCommas = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            };
            
            // 콤마가 있는 숫자에서 콤마 제거 함수
            const removeCommas = (str) => {
                return str.replace(/,/g, '');
            };
            
            // 금액에 따른 색상 반환 함수
            const getPriceColor = (price) => {
                if (price >= 1000000) return '#FF6B6B'; // 100만원 이상: 빨간색
                if (price >= 500000) return '#FFD93D'; // 50만원 이상: 노란색
                if (price >= 300000) return '#6BCF7F'; // 30만원 이상: 초록색
                if (price >= 100000) return '#4ECDC4'; // 10만원 이상: 청록색
                return '#95E1D3'; // 10만원 미만: 연한 민트색
            };
            
            // 오늘 날짜로 스크롤하는 함수
            const scrollToToday = () => {
                const today = new Date();
                if (today.getMonth() === selectedMonth && today.getFullYear() === selectedYear) {
                    const todayDay = today.getDate();
                    const todayElement = document.getElementById(`day-${todayDay}`);
                    if (todayElement) {
                        todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                } else {
                    // 현재 월이 아니면 현재 월로 변경
                    setSelectedMonth(today.getMonth());
                    setSelectedYear(today.getFullYear());
                    setTimeout(() => {
                        const todayDay = today.getDate();
                        const todayElement = document.getElementById(`day-${todayDay}`);
                        if (todayElement) {
                            todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 500);
                }
            };
            
            // 회원 검색 함수
            const searchCustomer = () => {
                if (!searchQuery.trim()) {
                    alert('검색할 회원명을 입력해주세요.');
                    return;
                }
                
                const results = [];
                
                // 모든 날짜의 매출 데이터를 검색
                Object.entries(salesData).forEach(([dateKey, dayData]) => {
                    if (dayData.details && Array.isArray(dayData.details)) {
                        dayData.details.forEach(detail => {
                            if (detail.customerName && detail.customerName.toLowerCase().includes(searchQuery.toLowerCase())) {
                                results.push({
                                    ...detail,
                                    date: dateKey
                                });
                            }
                        });
                    }
                });
                
                if (results.length === 0) {
                    alert('검색 결과가 없습니다.');
                    return;
                }
                
                setSearchResults(results);
                setShowSearchResultModal(true);
            };
            
            // 매출 입력 모달 컴포넌트
            const createEmptyModalState = () => ({
                customerName: '',
                healthProduct: '',
                ptProduct: '',
                pilatesProduct: '',
                neofitProduct: '',
                lockerProduct: '',
                lockerType: '',
                lockerPeriod: '',
                price: '',
                discounts: {},
                manualPriceEdit: false,
                otherItemName: '',
                otherItemPrice: ''
            });

            const deriveModalStateFromDetail = (detail) => {
                const state = createEmptyModalState();

                if (!detail) {
                    return state;
                }

                state.customerName = detail.customerName || '';

                const normalizedPrice = normalizeAmount(detail.price);
                state.price = normalizedPrice > 0 ? formatNumberWithCommas(normalizedPrice) : '';
                state.manualPriceEdit = true;

                let recognizedLineItem = false;
                const discounts = {};

                if (Array.isArray(detail.lineItems) && detail.lineItems.length > 0) {
                    detail.lineItems.forEach(item => {
                        if (!item) return;

                        const itemKey = item.key || item.categoryKey;
                        const productName = item.productName || item.product || '';
                        const discountAmount = normalizeAmount(item.discountAmount);

                        if (discountAmount > 0 && itemKey) {
                            discounts[itemKey] = formatNumberWithCommas(discountAmount);
                        }

                        switch (itemKey) {
                            case 'health':
                                if (productPrices[productName] !== undefined) {
                                    state.healthProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'pt':
                                if (productPrices[productName] !== undefined) {
                                    state.ptProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'pilates':
                                if (productPrices[productName] !== undefined) {
                                    state.pilatesProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'neofit':
                                if (productPrices[productName] !== undefined) {
                                    state.neofitProduct = productName;
                                    recognizedLineItem = true;
                                }
                                break;
                            case 'locker':
                            case 'clothing': {
                                if (productName) {
                                    const [type, period] = productName.split(' ');
                                    if (type && period) {
                                        state.lockerType = type;
                                        state.lockerPeriod = period;
                                        recognizedLineItem = true;
                                    }
                                }
                                break;
                            }
                            default:
                                break;
                        }
                    });

                    if (recognizedLineItem) {
                        state.manualPriceEdit = false;
                        state.price = normalizedPrice > 0 ? formatNumberWithCommas(normalizedPrice) : '';
                    }
                }

                if (Object.keys(discounts).length > 0) {
                    state.discounts = discounts;
                }

                if (!recognizedLineItem) {
                    state.manualPriceEdit = true;
                    state.otherItemName = detail.product || '';
                    state.otherItemPrice = normalizedPrice > 0 ? formatNumberWithCommas(normalizedPrice) : '';
                    state.discounts = {};
                }

                return state;
            };

            const AddSaleModal = () => {
                const isEditing = Boolean(editingDetailContext);

                const [modalData, setModalData] = useState(() => (
                    isEditing && editingDetailContext
                        ? deriveModalStateFromDetail(editingDetailContext.detail)
                        : createEmptyModalState()
                ));

                React.useEffect(() => {
                    if (!showAddSaleModal) {
                        return;
                    }

                    if (isEditing && editingDetailContext) {
                        setModalData(deriveModalStateFromDetail(editingDetailContext.detail));
                    } else {
                        setModalData(createEmptyModalState());
                    }
                }, [showAddSaleModal, isEditing, editingDetailContext]);

                const selectedLineItems = React.useMemo(() => {
                    const discounts = modalData.discounts || {};
                    const items = [];

                    const buildItem = ({ key, label, productName, categoryKey, originalPrice, discountEligible = false, displayName }) => {
                        if (!productName || !Number.isFinite(originalPrice)) {
                            return;
                        }

                        const rawDiscount = discounts[key] ? parseInt(removeCommas(discounts[key])) || 0 : 0;
                        const sanitizedDiscount = discountEligible
                            ? Math.min(originalPrice, Math.max(0, rawDiscount))
                            : 0;

                        items.push({
                            key,
                            label,
                            productName,
                            categoryKey,
                            originalPrice,
                            discountAmount: sanitizedDiscount,
                            finalPrice: Math.max(0, originalPrice - sanitizedDiscount),
                            displayName,
                            discountInput: discounts[key] || '',
                            discountEligible
                        });
                    };

                    if (modalData.healthProduct) {
                        const productName = modalData.healthProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'health',
                            label: '헬스 이용권',
                            productName,
                            categoryKey: 'health',
                            originalPrice,
                            discountEligible: true,
                            displayName: `헬스: ${productName}`
                        });
                    }

                    if (modalData.ptProduct) {
                        const productName = modalData.ptProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'pt',
                            label: '1:1 PT 이용권',
                            productName,
                            categoryKey: 'pt',
                            originalPrice,
                            discountEligible: true,
                            displayName: `PT: ${productName}`
                        });
                    }

                    if (modalData.pilatesProduct) {
                        const productName = modalData.pilatesProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'pilates',
                            label: '필라테스 이용권',
                            productName,
                            categoryKey: 'pilates',
                            originalPrice,
                            discountEligible: true,
                            displayName: `필라테스: ${productName}`
                        });
                    }

                    if (modalData.neofitProduct) {
                        const productName = modalData.neofitProduct;
                        const originalPrice = productPrices[productName] || 0;
                        buildItem({
                            key: 'neofit',
                            label: '네오핏 이용권',
                            productName,
                            categoryKey: 'neofit',
                            originalPrice,
                            discountEligible: true,
                            displayName: `네오핏: ${productName}`
                        });
                    }

                    if (modalData.lockerType && modalData.lockerPeriod) {
                        const lockerKey = `${modalData.lockerType} ${modalData.lockerPeriod}`;
                        const originalPrice = productPrices[lockerKey] || 0;
                        buildItem({
                            key: 'locker',
                            label: `${modalData.lockerType}`,
                            productName: `${modalData.lockerType} ${modalData.lockerPeriod}`,
                            categoryKey: 'clothing',
                            originalPrice,
                            discountEligible: false,
                            displayName: `${modalData.lockerType}: ${modalData.lockerPeriod}`
                        });
                    }

                    return items;
                }, [modalData.healthProduct, modalData.ptProduct, modalData.pilatesProduct, modalData.neofitProduct, modalData.lockerType, modalData.lockerPeriod, modalData.discounts]);

                const lineItemTotals = React.useMemo(() => {
                    const originalSum = selectedLineItems.reduce((sum, item) => sum + (item.originalPrice || 0), 0);
                    const discountSum = selectedLineItems.reduce((sum, item) => sum + (item.discountEligible ? item.discountAmount : 0), 0);
                    const finalSum = selectedLineItems.reduce((sum, item) => sum + (item.finalPrice || 0), 0);
                    return { originalSum, discountSum, finalSum };
                }, [selectedLineItems]);

                React.useEffect(() => {
                    if (selectedLineItems.length > 0 && modalData.manualPriceEdit) {
                        setModalData(prev => ({ ...prev, manualPriceEdit: false }));
                    }
                }, [selectedLineItems.length]);

                React.useEffect(() => {
                    if (!modalData.manualPriceEdit) {
                        const formatted = selectedLineItems.length > 0
                            ? formatNumberWithCommas(lineItemTotals.finalSum)
                            : (lineItemTotals.finalSum > 0 ? formatNumberWithCommas(lineItemTotals.finalSum) : '');
                        setModalData(prev => (prev.price === formatted ? prev : { ...prev, price: formatted }));
                    }
                }, [lineItemTotals.finalSum, modalData.manualPriceEdit, selectedLineItems.length]);

                React.useEffect(() => {
                    const activeKeys = new Set(selectedLineItems.map(item => item.key));
                    setModalData(prev => {
                        const nextDiscounts = Object.entries(prev.discounts || {}).reduce((acc, [key, value]) => {
                            if (activeKeys.has(key) && value !== '') {
                                acc[key] = value;
                            }
                            return acc;
                        }, {});

                        if (JSON.stringify(nextDiscounts) === JSON.stringify(prev.discounts || {})) {
                            return prev;
                        }

                        return { ...prev, discounts: nextDiscounts };
                    });
                }, [selectedLineItems]);

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    const selectedProducts = [];
                    if (selectedLineItems.length > 0) {
                        selectedLineItems.forEach(item => {
                            const discountText = item.discountEligible && item.discountAmount > 0
                                ? ` (할인 ${item.discountAmount.toLocaleString()}원)`
                                : '';
                            selectedProducts.push(`${item.displayName}${discountText}`);
                        });
                    }
                    const manualProductLabel = (modalData.otherItemName || '').trim();
                    if (selectedLineItems.length === 0 && manualProductLabel) {
                        selectedProducts.push(manualProductLabel);
                    }

                    const finalAmount = selectedLineItems.length > 0
                        ? lineItemTotals.finalSum
                        : normalizeAmount(removeCommas(modalData.price));
                    const hasPrice = finalAmount > 0;
                    let finalCustomerName = (modalData.customerName || '').trim();

                    // 일반 매출은 회원명과 상품이 필요하지만, 가격만 있어도 등록 가능
                    if (!finalCustomerName && selectedProducts.length === 0 && !hasPrice) {
                        alert('매출 정보를 입력해주세요.');
                        return;
                    }
                    
                    if (!finalCustomerName && hasPrice) {
                        finalCustomerName = '직접입력';
                    }

                    if (!finalCustomerName) {
                        alert('회원명을 입력해주세요.');
                        return;
                    }

                    if (selectedLineItems.length === 0 && !hasPrice) {
                        alert('금액을 입력해주세요.');
                        return;
                    }

                    if (selectedProducts.length === 0) {
                        if (hasPrice) {
                            selectedProducts.push(manualProductLabel || '직접입력');
                        } else {
                            alert('상품 또는 금액을 입력해주세요.');
                            return;
                        }
                    }
                    
                    const dateKey = (isEditing && editingDetailContext?.dateKey)
                        ? editingDetailContext.dateKey
                        : getDateKey(selectedModalDay);

                    const detailLineItems = selectedLineItems.map(item => ({
                        key: item.key,
                        categoryKey: item.categoryKey,
                        product: item.displayName,
                        productName: item.productName,
                        originalPrice: item.originalPrice,
                        finalPrice: item.finalPrice,
                        discountAmount: item.discountEligible ? item.discountAmount : 0,
                        discountEligible: item.discountEligible
                    }));

                    const baseDetail = isEditing && editingDetailContext?.detail ? editingDetailContext.detail : {};
                    const targetDetailId = isEditing && editingDetailContext?.detailId
                        ? editingDetailContext.detailId
                        : Date.now() + Math.random();

                    const timestamp = baseDetail.timestamp
                        ? baseDetail.timestamp
                        : new Date().toLocaleTimeString('ko-KR', {
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        });

                    const updatedDetail = {
                        ...baseDetail,
                        id: targetDetailId,
                        customerName: finalCustomerName,
                        product: selectedProducts.join(', '),
                        price: finalAmount,
                        timestamp
                    };

                    if (detailLineItems.length > 0) {
                        const originalTotal = detailLineItems.reduce((sum, item) => sum + (item.originalPrice || 0), 0);
                        const discountTotal = detailLineItems.reduce((sum, item) => sum + (item.discountAmount || 0), 0);
                        updatedDetail.lineItems = detailLineItems;
                        updatedDetail.originalTotal = originalTotal;
                        updatedDetail.discountTotal = discountTotal;
                    } else {
                        delete updatedDetail.lineItems;
                        delete updatedDetail.originalTotal;
                        updatedDetail.discountTotal = 0;
                    }

                    // Firebase에 저장
                    const currentData = normalizeSalesEntry(salesData[dateKey]);
                    let newDetails;

                    if (isEditing) {
                        let replaced = false;
                        newDetails = currentData.details.map(detail => {
                            if (!replaced && detail.id === targetDetailId) {
                                replaced = true;
                                return updatedDetail;
                            }
                            return detail;
                        });

                        if (!replaced) {
                            newDetails = [...newDetails, updatedDetail];
                        }
                    } else {
                        newDetails = [...currentData.details, updatedDetail];
                    }

                    const normalizedDetails = normalizeDetailList(newDetails);
                    const newTotalAmount = normalizedDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);

                    const updatedData = {
                        ...currentData,
                        details: normalizedDetails,
                        amount: newTotalAmount,
                        date: dateKey
                    };
                    
                    try {
                        await salesService.saveSalesData(dateKey, updatedData);
                        console.log('매출 데이터 Firebase 저장 완료:', dateKey);
                    } catch (error) {
                        console.error('Firebase 저장 실패:', error);
                        alert('데이터 저장에 실패했습니다. 다시 시도해주세요.');
                        return;
                    }
                    
                    closeSaleModal();
                    setModalData(createEmptyModalState());

                    // 오늘 날짜로 스크롤
                    setTimeout(() => {
                        const dayElement = document.getElementById(`day-${selectedModalDay}`);
                        if (dayElement && dailyViewRef.current) {
                            dayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 100);
                };
                
                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={closeSaleModal}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '500px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#00FF88' }}>
                                {selectedMonth + 1}월 {selectedModalDay}일 {isEditing ? '매출 수정' : '매출 입력'}
                            </h3>
                            
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">회원명</label>
                                    <input
                                        type="text"
                                        value={modalData.customerName}
                                        onChange={(e) => setModalData({...modalData, customerName: e.target.value})}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                        placeholder="회원명을 입력하세요"
                                        autoFocus
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">헬스 이용권</label>
                                    <select
                                        value={modalData.healthProduct}
                                        onChange={(e) => setModalData({...modalData, healthProduct: e.target.value})}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">헬스 이용권 선택</option>
                                        {healthProducts.map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">1:1 PT 이용권</label>
                                    <select
                                        value={modalData.ptProduct}
                                        onChange={(e) => setModalData({...modalData, ptProduct: e.target.value})}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">1:1 PT 이용권 선택</option>
                                        {ptProducts.map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">필라테스 이용권</label>
                                    <select
                                        value={modalData.pilatesProduct}
                                        onChange={(e) => setModalData({...modalData, pilatesProduct: e.target.value})}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">필라테스 이용권 선택</option>
                                        <option disabled style={{color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)'}}>
                                            ─────── 주 2회 상품 ───────
                                        </option>
                                        {pilatesProducts.slice(0, 3).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                        <option disabled style={{color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)'}}>
                                            ─────── 주 3회 상품 ───────
                                        </option>
                                        {pilatesProducts.slice(3, 6).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">네오핏 이용권</label>
                                    <select
                                        value={modalData.neofitProduct}
                                        onChange={(e) => setModalData({...modalData, neofitProduct: e.target.value})}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">네오핏 이용권 선택</option>
                                        <option value={neofitProducts[0]}>
                                            {neofitProducts[0]} - {productPrices[neofitProducts[0]].toLocaleString()}원
                                        </option>
                                        <option value={neofitProducts[1]}>
                                            {neofitProducts[1]} - {productPrices[neofitProducts[1]].toLocaleString()}원
                                        </option>
                                        <option disabled style={{color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)'}}>
                                            ─────── 네오핏 무제한권 ───────
                                        </option>
                                        {neofitProducts.slice(2, 5).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                        <option disabled style={{color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)'}}>
                                            ─────── 네오핏 주 2회 ───────
                                        </option>
                                        {neofitProducts.slice(5, 8).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                        <option disabled style={{color: '#00FF88', fontWeight: 'bold', backgroundColor: 'rgba(0, 255, 136, 0.1)'}}>
                                            ─────── 네오핏 주 3회 ───────
                                        </option>
                                        {neofitProducts.slice(8, 11).map(product => (
                                            <option key={product} value={product}>
                                                {product} - {productPrices[product].toLocaleString()}원
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">운동복/락커 선택</label>
                                    <select
                                        value={modalData.lockerType}
                                        onChange={(e) => setModalData({...modalData, lockerType: e.target.value, lockerPeriod: ''})}
                                        className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                    >
                                        <option value="">운동복/락커 선택</option>
                                        {lockerProducts.map(product => (
                                            <option key={product} value={product}>{product}</option>
                                        ))}
                                    </select>
                                </div>
                                
                                {modalData.lockerType && (
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-300">{modalData.lockerType} 이용 기간</label>
                                        <select
                                            value={modalData.lockerPeriod}
                                            onChange={(e) => setModalData({...modalData, lockerPeriod: e.target.value})}
                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none"
                                        >
                                            <option value="">기간 선택</option>
                                            {lockerPeriods.map(period => {
                                                const priceKey = `${modalData.lockerType} ${period}`;
                                                const price = productPrices[priceKey] || 0;
                                                return (
                                                    <option key={period} value={period}>
                                                        {period} - {price.toLocaleString()}원
                                                    </option>
                                                );
                                            })}
                                        </select>
                                    </div>
                                )}
                                
                                {/* 기타 매출 입력 섹션 */}
                                <div style={{borderTop: '1px solid rgba(139, 92, 246, 0.3)', paddingTop: '1rem', marginTop: '1rem'}}>
                                    <label className="block text-sm font-semibold mb-2" style={{color: '#c084fc'}}>기타 매출</label>
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
                                        <input
                                            type="text"
                                            value={modalData.otherItemName || ''}
                                            onChange={(e) => setModalData({...modalData, otherItemName: e.target.value})}
                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-purple-400 focus:outline-none"
                                            placeholder="항목명을 입력하세요 (예: PT수업, 개인레슨)"
                                            style={{ fontSize: '16px' }}
                                        />
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={modalData.otherItemPrice || ''}
                                            onChange={(e) => {
                                                const value = e.target.value.replace(/[^0-9]/g, '');
                                                if (value === '') {
                                                    setModalData({...modalData, otherItemPrice: ''});
                                                } else {
                                                    setModalData({...modalData, otherItemPrice: formatNumberWithCommas(value)});
                                                }
                                            }}
                                            className="glass-effect rounded-lg px-4 py-3 w-full focus:border-purple-400 focus:outline-none"
                                            placeholder="금액을 입력하세요"
                                            style={{ fontSize: '16px' }}
                                        />
                                        <button
                                            type="button"
                                            onClick={async () => {
                                                if (isEditing) {
                                                    alert('수정 모드에서는 기타 매출 추가 기능을 사용할 수 없습니다.');
                                                    return;
                                                }
                                                if (modalData.otherItemName && modalData.otherItemPrice) {
                                                    const otherPrice = normalizeAmount(modalData.otherItemPrice);
                                                    const dateKey = `${selectedYear}-${String(selectedMonth + 1).padStart(2, '0')}-${String(selectedModalDay).padStart(2, '0')}`;
                                                    
                                                    const newDetail = {
                                                        id: Date.now() + Math.random(),
                                                        customerName: '기타',
                                                        product: modalData.otherItemName,
                                                        price: otherPrice,
                                                        timestamp: new Date().toLocaleTimeString('ko-KR', { 
                                                            hour: '2-digit', 
                                                            minute: '2-digit',
                                                            second: '2-digit'
                                                        })
                                                    };
                                                    
                                                    // 현재 데이터 가져오기
                                                    const currentData = normalizeSalesEntry(salesData[dateKey]);
                                                    const newDetails = [...currentData.details, newDetail];
                                                    const newTotalAmount = newDetails.reduce((sum, detail) => sum + normalizeAmount(detail.price), 0);
                                                    
                                                    const updatedData = {
                                                        ...currentData,
                                                        date: dateKey,
                                                        amount: newTotalAmount,
                                                        details: normalizeDetailList(newDetails),
                                                        approved: false
                                                    };
                                                    
                                                    // Firebase에 저장
                                                    const result = await salesService.saveSalesData(dateKey, updatedData);
                                                    
                                                    if (!result.success) {
                                                        console.error('[NeoFit] 기타 매출 저장 실패', result.error);
                                                        console.warn('Firebase에 저장되지 않았습니다. 로컬 데이터만 업데이트합니다.');
                                                    }

                                                    // 로컬 상태 업데이트 (Firebase 실패 시에도 반영)
                                                    setSalesData(prev => ({
                                                        ...prev,
                                                        [dateKey]: normalizeSalesEntry(updatedData)
                                                    }));
                                                    
                                                    // 입력 필드 초기화
                                                    setModalData({
                                                        ...modalData,
                                                        otherItemName: '',
                                                        otherItemPrice: ''
                                                    });
                                                    
                                                    // 모달 닫기
                                                    closeSaleModal();
                                                    alert('기타 매출이 추가되었습니다!');
                                                } else {
                                                    alert('항목명과 금액을 모두 입력해주세요.');
                                                }
                                            }}
                                            disabled={isEditing}
                                            className={`glass-effect border-purple-500 hover:border-purple-400 rounded-lg py-3 font-semibold transition-all hover:shadow-lg text-white ${isEditing ? 'opacity-60 cursor-not-allowed' : ''}`}
                                            style={{background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(168, 85, 247, 0.3))'}}
                                        >
                                            기타 매출 추가
                                        </button>
                                    </div>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">상품별 할인</label>
                                    {selectedLineItems.length === 0 ? (
                                        <div className="glass-effect rounded-lg px-4 py-3 text-sm text-gray-400">
                                            상품을 선택하면 적용 가능한 할인 금액을 입력할 수 있습니다.
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {selectedLineItems.map((item) => {
                                                const palette = DISCOUNT_PALETTE[item.key] || DISCOUNT_PALETTE[item.categoryKey] || DISCOUNT_PALETTE.default;
                                                const discountPresets = [5, 10, 15, 20, 25];
                                                const activeDiscountAmount = normalizeAmount(modalData.discounts?.[item.key] || 0);
                                                return (
                                                    <div
                                                        key={item.key}
                                                        className="relative rounded-xl px-4 py-3 flex flex-col gap-2"
                                                        style={{
                                                            background: palette.cardBg,
                                                            border: `1px solid ${palette.cardBorder}`,
                                                            boxShadow: palette.cardShadow
                                                        }}
                                                    >
                                                        <button
                                                            type="button"
                                                            onClick={() => {
                                                                setModalData(prev => {
                                                                    const next = { ...prev };
                                                                    const updates = {};
                                                                    if (item.key === 'health') updates.healthProduct = '';
                                                                    if (item.key === 'pt') updates.ptProduct = '';
                                                                    if (item.key === 'pilates') updates.pilatesProduct = '';
                                                                    if (item.key === 'neofit') updates.neofitProduct = '';
                                                                    if (item.key === 'locker') {
                                                                        updates.lockerType = '';
                                                                        updates.lockerPeriod = '';
                                                                    }

                                                                    const nextDiscounts = { ...(next.discounts || {}) };
                                                                    delete nextDiscounts[item.key];

                                                                    return {
                                                                        ...next,
                                                                        ...updates,
                                                                        discounts: nextDiscounts,
                                                                        manualPriceEdit: false
                                                                    };
                                                                });
                                                            }}
                                                            className="absolute w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold transition-all"
                                                            style={{
                                                                bottom: '12px',
                                                                right: '12px',
                                                                background: palette.accent,
                                                                color: '#0f172a',
                                                                boxShadow: '0 0 12px rgba(15,23,42,0.35)',
                                                                border: '1px solid rgba(15,23,42,0.35)',
                                                                cursor: 'pointer'
                                                            }}
                                                        >
                                                            ×
                                                        </button>
                                                        <div className="flex items-center justify-between gap-3">
                                                            <div>
                                                                <p className="font-semibold text-sm" style={{ color: palette.accent }}>{item.displayName}</p>
                                                                <p className="text-xs" style={{ color: 'rgba(226,232,240,0.65)' }}>
                                                                    정가 {item.originalPrice.toLocaleString()}원 · 할인 후 <span style={{ color: palette.accent }}>{item.finalPrice.toLocaleString()}원</span>
                                                                </p>
                                                            </div>
                                                            {item.discountEligible ? (
                                                                <div className="flex flex-col gap-2" style={{ width: '180px' }}>
                                                                    <input
                                                                        type="text"
                                                                        inputMode="numeric"
                                                                        value={modalData.discounts?.[item.key] || ''}
                                                                        onChange={(e) => {
                                                                            const digits = e.target.value.replace(/[^0-9]/g, '');
                                                                            const formatted = digits ? formatNumberWithCommas(digits) : '';
                                                                            setModalData((prev) => ({
                                                                                ...prev,
                                                                                discounts: {
                                                                                    ...(prev.discounts || {}),
                                                                                    [item.key]: formatted
                                                                                },
                                                                                manualPriceEdit: false
                                                                            }));
                                                                        }}
                                                                        placeholder="0"
                                                                        className="rounded-lg px-3 py-2 w-full text-right text-sm focus:outline-none"
                                                                        style={{
                                                                            background: palette.inputBg,
                                                                            border: `1px solid ${palette.inputBorder}`,
                                                                            color: palette.accent
                                                                        }}
                                                                    />
                                                                    <div className="flex flex-wrap gap-1.5">
                                                                        {discountPresets.map((percent) => {
                                                                            const presetAmount = Math.min(item.originalPrice, Math.round(item.originalPrice * (percent / 100)));
                                                                            const isActive = presetAmount === activeDiscountAmount && activeDiscountAmount > 0;

                                                                            return (
                                                                                <button
                                                                                    type="button"
                                                                                    key={`${item.key}-preset-${percent}`}
                                                                                    onClick={() => {
                                                                                        const formatted = presetAmount > 0 ? formatNumberWithCommas(presetAmount) : '';
                                                                                        setModalData((prev) => ({
                                                                                            ...prev,
                                                                                            discounts: {
                                                                                                ...(prev.discounts || {}),
                                                                                                [item.key]: formatted
                                                                                            },
                                                                                            manualPriceEdit: false
                                                                                        }));
                                                                                    }}
                                                                                    className={`px-2 py-1 rounded-full text-[11px] transition-colors ${isActive ? 'text-slate-900 font-semibold' : ''}`}
                                                                                    style={{
                                                                                        background: isActive ? palette.accent : 'rgba(15,23,42,0.35)',
                                                                                        border: `1px solid ${palette.inputBorder}`,
                                                                                        color: isActive ? '#0f172a' : palette.accent
                                                                                    }}
                                                                                >
                                                                                    {percent}%
                                                                                </button>
                                                                            );
                                                                        })}
                                                                        <button
                                                                            type="button"
                                                                            onClick={() => {
                                                                                setModalData((prev) => ({
                                                                                    ...prev,
                                                                                    discounts: {
                                                                                        ...(prev.discounts || {}),
                                                                                        [item.key]: ''
                                                                                    },
                                                                                    manualPriceEdit: false
                                                                                }));
                                                                            }}
                                                                            className="px-2 py-1 rounded-full text-[11px] transition-colors"
                                                                            style={{
                                                                                background: 'rgba(15,23,42,0.25)',
                                                                                border: `1px dashed ${palette.inputBorder}`,
                                                                                color: 'rgba(203,213,225,0.8)'
                                                                            }}
                                                                        >
                                                                            할인 미적용
                                                                        </button>
                                                                    </div>
                                                                    <p className="text-[10px] mt-1" style={{ color: 'rgba(226,232,240,0.45)' }}>최대 {item.originalPrice.toLocaleString()}원</p>
                                                                </div>
                                                            ) : (
                                                                <span className="text-[11px] px-2 py-1 rounded-full border" style={{ borderColor: palette.cardBorder, color: palette.accent }}>할인 적용 불가</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            <div className="flex items-center justify-between text-xs text-gray-400 px-1">
                                                <span>총 할인 금액</span>
                                                <span className="text-emerald-300 font-semibold">
                                                    {lineItemTotals.discountSum > 0
                                                        ? `-${lineItemTotals.discountSum.toLocaleString()}원`
                                                        : '0원'}
                                                </span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold mb-2 text-gray-300">최종 가격</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        value={modalData.price}
                                        readOnly={selectedLineItems.length > 0}
                                        onChange={(e) => {
                                            if (selectedLineItems.length > 0) {
                                                return;
                                            }
                                            const value = e.target.value.replace(/[^0-9]/g, '');
                                            if (value === '') {
                                                setModalData(prev => ({ ...prev, price: '', manualPriceEdit: true }));
                                            } else {
                                                setModalData(prev => ({ ...prev, price: formatNumberWithCommas(value), manualPriceEdit: true }));
                                            }
                                        }}
                                        className={`glass-effect rounded-lg px-4 py-3 w-full font-bold text-lg focus:border-green-400 focus:outline-none ${selectedLineItems.length > 0 ? 'text-emerald-200 cursor-not-allowed opacity-90' : 'text-green-400'}`}
                                        placeholder="상품을 선택하거나 직접 입력하세요"
                                        style={{ fontSize: '16px' }}
                                    />
                                    {selectedLineItems.length > 0 && (
                                        <p className="text-xs text-gray-500 mt-2">
                                            선택한 상품 정가와 할인 금액을 기준으로 자동 계산됩니다.
                                        </p>
                                    )}
                                </div>
                                
                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={closeSaleModal}
                                        className="flex-1 glass-effect hover:border-gray-400 rounded-lg py-3 font-semibold transition-all text-gray-300 hover:text-white"
                                    >
                                        취소
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 glass-effect border-green-500 hover:border-green-400 rounded-lg py-3 font-semibold transition-all hover:shadow-lg text-white"
                                    >
                                        {isEditing ? '수정 완료' : '등록'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };
            
            // 검색 결과 모달 컴포넌트
            const SearchResultModal = () => {
                const totalAmount = searchResults.reduce((sum, item) => sum + ((item.price || 0)), 0);
                const groupedByDate = searchResults.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});
                
                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowSearchResultModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#00FF88' }}>
                                '{searchQuery}' 검색 결과
                            </h3>
                            
                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{searchResults.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 결제 금액</p>
                                    <p className="text-3xl font-bold" style={{ color: '#00FF88' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>
                            
                            <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                    <div key={date} className="glass-effect rounded-xl p-4">
                                        <div className="font-semibold text-gray-300 mb-3">{date}</div>
                                        <div className="space-y-2">
                                            {items.map((item, index) => {
                                                const amount = item.price || 0;
                                                const originalAmount = item.originalPrice || amount;
                                                const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                const discountAmount = discountAllowed
                                                    ? (item.discountAmount !== undefined
                                                        ? item.discountAmount
                                                        : Math.max(0, originalAmount - amount))
                                                    : 0;
                                                const hasDiscount = discountAllowed && discountAmount > 0;
                                                return (
                                                    <div key={index} className="flex justify-between items-start p-3 bg-gray-800/50 rounded-lg">
                                                        <div className="flex-1 pr-3">
                                                            <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                            <div className="text-xs text-gray-500 mt-1">{item.product}</div>
                                                            {hasDiscount && (
                                                                <div className="text-xs text-rose-300 mt-1">
                                                                    할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="text-right">
                                                            {hasDiscount && (
                                                                <div className="text-[11px] text-gray-500 line-through">{originalAmount.toLocaleString()}원</div>
                                                            )}
                                                            <div className="font-bold" style={{ color: getPriceColor(amount) }}>
                                                                {amount.toLocaleString()}원
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            <div className="mt-6">
                                <button
                                    onClick={() => setShowSearchResultModal(false)}
                                    className="w-full glass-effect hover:border-gray-400 rounded-lg py-3 font-semibold transition-all text-white"
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const SaleDetailModal = () => {
                if (!selectedDetailEntry) {
                    return null;
                }

                const { detail, dayLabel, amount, dateKey, approved } = selectedDetailEntry;
                const lineItems = Array.isArray(detail.lineItems) ? detail.lineItems : [];

                const originalTotal = detail.originalTotal !== undefined && detail.originalTotal !== null
                    ? normalizeAmount(detail.originalTotal)
                    : (lineItems.length > 0 ? lineItems.reduce((sum, item) => sum + normalizeAmount(item.originalPrice), 0) : normalizeAmount(amount));

                const discountTotal = detail.discountTotal !== undefined && detail.discountTotal !== null
                    ? normalizeAmount(detail.discountTotal)
                    : (lineItems.length > 0 ? lineItems.reduce((sum, item) => sum + normalizeAmount(item.discountAmount), 0) : 0);

                const finalTotal = normalizeAmount(amount);
                const discountRate = originalTotal > 0 ? Math.round((discountTotal / originalTotal) * 1000) / 10 : 0;
                const productList = (() => {
                    if (Array.isArray(lineItems) && lineItems.length > 0) {
                        return lineItems
                            .map(item => (item?.product || item?.productName || item?.name || '').toString().trim())
                            .filter(Boolean);
                    }

                    const fallbackLabel = (detail.product || '').toString().trim();
                    return fallbackLabel ? [fallbackLabel] : [];
                })();

                const renderLineItem = (item, index) => {
                    const originalPrice = normalizeAmount(item.originalPrice);
                    const discountAmount = normalizeAmount(item.discountAmount);
                    const finalPrice = normalizeAmount(item.finalPrice);
                    const discountEligible = item.discountEligible ?? DISCOUNT_ELIGIBLE_CATEGORIES.has(item.categoryKey || '');

                    return (
                        <div
                            key={`${item.categoryKey || 'item'}-${index}`}
                            style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                padding: '12px 16px',
                                borderRadius: '18px',
                                border: '1px solid rgba(255, 255, 255, 0.12)',
                                background: 'rgba(255, 255, 255, 0.06)',
                                backdropFilter: 'blur(18px)'
                            }}
                        >
                            <div style={{ color: 'rgba(240, 245, 255, 0.88)' }}>
                                <p style={{ fontSize: '14px', fontWeight: 600 }}>{item.product || item.productName || '상품'}</p>
                                <p style={{ fontSize: '11px', color: 'rgba(148, 163, 184, 0.8)' }}>{item.categoryKey || '기타'} · 정가 {originalPrice.toLocaleString()}원</p>
                            </div>
                            <div style={{ textAlign: 'right', fontSize: '13px' }}>
                                {discountEligible && discountAmount > 0 ? (
                                    <div>
                                        <p style={{ fontSize: '11px', color: 'rgba(148, 163, 184, 0.6)', textDecoration: 'line-through' }}>{originalPrice.toLocaleString()}원</p>
                                        <p style={{ color: 'rgba(110, 231, 183, 0.9)', fontWeight: 600 }}>-{discountAmount.toLocaleString()}원</p>
                                        <p style={{ color: '#ffffff', fontWeight: 700 }}>{finalPrice.toLocaleString()}원</p>
                                    </div>
                                ) : (
                                    <p style={{ color: '#ffffff', fontWeight: 600 }}>{finalPrice.toLocaleString()}원</p>
                                )}
                            </div>
                        </div>
                    );
                };

                const summaryCards = [
                    {
                        title: '정가 총액',
                        value: originalTotal.toLocaleString() + '원',
                        accent: 'rgba(129, 140, 248, 0.8)',
                        background: 'linear-gradient(135deg, rgba(99,102,241,0.35), rgba(56,189,248,0.25))'
                    },
                    {
                        title: '할인 금액',
                        value: '-' + discountTotal.toLocaleString() + '원',
                        accent: 'rgba(16, 185, 129, 0.85)',
                        background: 'linear-gradient(135deg, rgba(16,185,129,0.35), rgba(20,184,166,0.2))',
                        subtitle: discountTotal > 0 ? `(${discountRate.toFixed(1)}%)` : '할인 없음'
                    },
                    {
                        title: '최종 결제',
                        value: finalTotal.toLocaleString() + '원',
                        accent: 'rgba(96, 165, 250, 0.85)',
                        background: 'linear-gradient(135deg, rgba(59,130,246,0.35), rgba(14,165,233,0.2))'
                    }
                ];

                return (
                    <div
                        style={{
                            position: 'fixed',
                            inset: 0,
                            zIndex: 120,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            padding: '40px 16px'
                        }}
                    >

                        <div
                            style={{
                                position: 'absolute',
                                inset: 0,
                                background: 'transparent'
                            }}
                            onClick={closeSaleDetail}
                        ></div>
                        <div
                            style={{ position: 'relative', width: '100%', maxWidth: '420px' }}
                            onClick={(e) => e.stopPropagation()}
                        >
                            <div
                                style={{
                                    position: 'absolute',
                                    inset: 0,
                                    borderRadius: '28px',
                                    background: 'linear-gradient(135deg, rgba(16,185,129,0.35), rgba(59,130,246,0.25))',
                                    filter: 'blur(35px)',
                                    opacity: 0.85,
                                    pointerEvents: 'none'
                                }}
                            ></div>
                            <div
                                style={{
                                    position: 'relative',
                                    borderRadius: '28px',
                                    border: '1px solid rgba(255,255,255,0.12)',
                                    background: 'rgba(10, 19, 41, 0.92)',
                                    boxShadow: '0 40px 120px rgba(2,6,23,0.75)',
                                    overflow: 'hidden'
                                }}
                            >
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '28px 28px 16px 28px', gap: '16px' }}>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                        <span style={{ display: 'inline-flex', alignItems: 'center', gap: '8px', fontSize: '11px', letterSpacing: '0.24em', textTransform: 'uppercase', color: 'rgba(167, 243, 208, 0.8)' }}>
                                            <Icon icon={Info} size={14} /> Sale Detail
                                        </span>
                                        <h3 style={{ fontSize: '24px', fontWeight: 700, color: '#ffffff' }}>{detail.customerName || '고객'}</h3>
                                        <p style={{ fontSize: '12px', color: 'rgba(148, 163, 184, 0.75)' }}>{dayLabel} · {detail.timestamp || '시간 정보 없음'}</p>
                                        <p style={{ fontSize: '11px', color: 'rgba(100, 116, 139, 0.7)' }}>문서 ID: {dateKey}</p>
                                        <div
                                            style={{
                                                display: 'grid',
                                                gridTemplateColumns: '24px auto',
                                                alignItems: 'center',
                                                columnGap: '8px',
                                                padding: '10px 12px',
                                                borderRadius: '14px',
                                                border: approved
                                                    ? '1px solid rgba(110, 231, 183, 0.45)'
                                                    : '1px solid rgba(251, 191, 36, 0.45)',
                                                background: approved
                                                    ? 'linear-gradient(135deg, rgba(16,185,129,0.28), rgba(5,150,105,0.18))'
                                                    : 'linear-gradient(135deg, rgba(251,191,36,0.28), rgba(217,119,6,0.18))',
                                                color: approved ? 'rgba(187, 247, 208, 0.95)' : 'rgba(255,237,213,0.95)',
                                                fontWeight: 600,
                                                width: 'fit-content'
                                            }}
                                        >
                                            <div
                                                style={{
                                                    height: '24px',
                                                    width: '24px',
                                                    borderRadius: '8px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    background: approved
                                                        ? 'linear-gradient(135deg, rgba(16,185,129,0.45), rgba(5,150,105,0.35))'
                                                        : 'linear-gradient(135deg, rgba(251,191,36,0.45), rgba(217,119,6,0.35))',
                                                    boxShadow: '0 6px 12px rgba(15,23,42,0.35)'
                                                }}
                                            >
                                                <Icon icon={approved ? Check : Clock} size={14} />
                                            </div>
                                            <div>
                                                <p style={{ fontSize: '13px' }}>{approved ? '승인 완료' : '승인 대기'}</p>
                                                <p style={{ fontSize: '11px', color: 'rgba(226, 232, 240, 0.7)', marginTop: '2px' }}>
                                                    {approved ? '확정된 거래입니다.' : '승인 후 정산에 반영됩니다.'}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <button
                                        onClick={closeSaleDetail}
                                        style={{
                                            display: 'inline-flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            border: '1px solid rgba(255,255,255,0.16)',
                                            color: 'rgba(226,232,240,0.88)',
                                            borderRadius: '999px',
                                            padding: '6px 18px',
                                            fontSize: '12px',
                                            fontWeight: 600,
                                            background: 'linear-gradient(135deg, rgba(67,56,202,0.42), rgba(79,70,229,0.32))',
                                            boxShadow: '0 10px 24px rgba(15,23,42,0.45)',
                                            letterSpacing: '0.16em',
                                            textTransform: 'uppercase',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        닫기
                                    </button>
                                </div>

                                <div style={{ padding: '0 28px 28px 28px', display: 'flex', flexDirection: 'column', gap: '18px' }}>
                                    <div
                                        style={{
                                            borderRadius: '22px',
                                            border: '1px solid rgba(255,255,255,0.08)',
                                            background: 'linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02))',
                                            padding: '20px'
                                        }}
                                    >
                                        <p style={{ fontSize: '12px', color: 'rgba(226, 232, 240, 0.7)', marginBottom: '12px' }}>상품 요약</p>
                                        {productList.length > 0 ? (
                                            <div
                                                style={{
                                                    display: 'flex',
                                                    flexWrap: 'wrap',
                                                    gap: '8px'
                                                }}
                                            >
                                                {productList.map((item, index) => (
                                                    <span
                                                        key={index}
                                                        style={{
                                                            padding: '6px 12px',
                                                            borderRadius: '999px',
                                                            border: '1px solid rgba(129, 230, 217, 0.35)',
                                                            background: 'rgba(45, 212, 191, 0.12)',
                                                            color: 'rgba(167, 255, 235, 0.9)',
                                                            fontSize: '12px',
                                                            whiteSpace: 'nowrap',
                                                            wordBreak: 'keep-all'
                                                        }}
                                                    >
                                                        {item}
                                                    </span>
                                                ))}
                                            </div>
                                        ) : (
                                            <p style={{ fontSize: '13px', color: 'rgba(148, 163, 184, 0.65)' }}>{detail.product || '상품 정보 없음'}</p>
                                        )}
                                    </div>

                                    <div style={{ display: 'grid', gap: '12px' }}>
                                        {summaryCards.map((card, index) => (
                                            <div
                                                key={index}
                                                style={{
                                                    borderRadius: '18px',
                                                    border: '1px solid rgba(255,255,255,0.08)',
                                                    background: card.background,
                                                    padding: '16px 18px'
                                                }}
                                            >
                                                <p style={{ fontSize: '11px', letterSpacing: '0.15em', textTransform: 'uppercase', color: 'rgba(226,232,240,0.7)' }}>{card.title}</p>
                                                <p style={{ marginTop: '6px', fontSize: '20px', fontWeight: 700, color: '#ffffff' }}>{card.value}</p>
                                                {card.subtitle && (
                                                    <p style={{ fontSize: '11px', color: 'rgba(226,232,240,0.75)' }}>{card.subtitle}</p>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    {lineItems.length > 0 && (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                                            <p style={{ fontSize: '12px', color: 'rgba(226,232,240,0.7)' }}>세부 구성</p>
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', maxHeight: '220px', overflowY: 'auto', paddingRight: '4px' }}>
                                                {lineItems.map(renderLineItem)}
                                            </div>
                                        </div>
                                    )}

                                    {discountTotal <= 0 && (
                                        <p style={{ fontSize: '11px', color: 'rgba(148, 163, 184, 0.65)' }}>할인이 적용되지 않은 거래입니다.</p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };
;

            // 필라테스 매출 모달 컴포넌트
            const PilatesModal = () => {
                const pilatesData = getPilatesDetails();
                const totalAmount = pilatesData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = pilatesData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowPilatesModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#FF69B4' }}>
                                📊 필라테스 매출 현황 ({selectedMonth + 1}월)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 필라테스 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{pilatesData.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 필라테스 매출</p>
                                    <p className="text-3xl font-bold" style={{ color: '#FF69B4' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>

                            {pilatesData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">🏃‍♀️</div>
                                    <p className="text-gray-400 text-lg">이번 달 필라테스 매출이 없습니다</p>
                                    <p className="text-gray-500 text-sm mt-2">필라테스 이용권 판매 시 여기에 표시됩니다</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                🗓️ {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-pink-900/20 rounded-lg border border-pink-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-pink-300 mt-1">🧘‍♀️ {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-rose-200 mt-1">
                                                                        할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-pink-200/70 line-through">{originalAmount.toLocaleString()}원</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#FF69B4' }}>
                                                                    {amount.toLocaleString()}원
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowPilatesModal(false)}
                                    className="w-full glass-effect hover:border-pink-400 rounded-lg py-3 font-semibold transition-all text-white border border-pink-500/50"
                                    style={{ borderColor: '#FF69B4' }}
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 헬스 이용권 매출 모달 컴포넌트
            const HealthModal = () => {
                const healthData = getHealthDetails();
                const totalAmount = healthData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = healthData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowHealthModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#22C55E' }}>
                                💪 헬스 이용권 매출 현황 ({selectedMonth + 1}월)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 헬스 이용권 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{healthData.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 헬스 이용권 매출</p>
                                    <p className="text-3xl font-bold" style={{ color: '#22C55E' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>

                            {healthData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">💪</div>
                                    <p className="text-gray-400 text-lg">이번 달 헬스 이용권 매출이 없습니다</p>
                                    <p className="text-gray-500 text-sm mt-2">헬스 이용권 판매 시 여기에 표시됩니다</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                🗓️ {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-green-900/20 rounded-lg border border-green-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-green-300 mt-1">💪 {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-emerald-200 mt-1">
                                                                        할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-emerald-200/70 line-through">{originalAmount.toLocaleString()}원</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#22C55E' }}>
                                                                    {amount.toLocaleString()}원
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowHealthModal(false)}
                                    className="w-full glass-effect hover:border-green-400 rounded-lg py-3 font-semibold transition-all text-white border border-green-500/50"
                                    style={{ borderColor: '#22C55E' }}
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 네오핏 매출 모달 컴포넌트
            const NeofitModal = () => {
                const neofitData = getNeofitDetails();
                const totalAmount = neofitData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = neofitData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowNeofitModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#4ECDC4' }}>
                                🔥 네오핏 매출 현황 ({selectedMonth + 1}월)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 네오핏 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{neofitData.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 네오핏 매출</p>
                                    <p className="text-3xl font-bold" style={{ color: '#4ECDC4' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>

                            {neofitData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">🔥</div>
                                    <p className="text-gray-400 text-lg">이번 달 네오핏 매출이 없습니다</p>
                                    <p className="text-gray-500 text-sm mt-2">네오핏 서비스 판매 시 여기에 표시됩니다</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                🗓️ {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-teal-900/20 rounded-lg border border-teal-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-teal-300 mt-1">🔥 {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-cyan-200 mt-1">
                                                                        할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-cyan-200/70 line-through">{originalAmount.toLocaleString()}원</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#4ECDC4' }}>
                                                                    {amount.toLocaleString()}원
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowNeofitModal(false)}
                                    className="w-full glass-effect hover:border-teal-400 rounded-lg py-3 font-semibold transition-all text-white border border-teal-500/50"
                                    style={{ borderColor: '#4ECDC4' }}
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 운동복/락커 매출 모달 컴포넌트
            const ClothingLockerModal = () => {
                const clothingLockerData = getClothingLockerDetails();
                const totalAmount = clothingLockerData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = clothingLockerData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowClothingLockerModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#A855F7' }}>
                                👕 운동복/락커 매출 현황 ({selectedMonth + 1}월)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 운동복/락커 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{clothingLockerData.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 운동복/락커 매출</p>
                                    <p className="text-3xl font-bold" style={{ color: '#A855F7' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>

                            {clothingLockerData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">👕</div>
                                    <p className="text-gray-400 text-lg">이번 달 운동복/락커 매출이 없습니다</p>
                                    <p className="text-gray-500 text-sm mt-2">운동복/락커 판매 시 여기에 표시됩니다</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                🗓️ {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-purple-900/20 rounded-lg border border-purple-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-purple-300 mt-1">👕 {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-fuchsia-200 mt-1">
                                                                        할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-fuchsia-200/70 line-through">{originalAmount.toLocaleString()}원</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#A855F7' }}>
                                                                    {amount.toLocaleString()}원
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowClothingLockerModal(false)}
                                    className="w-full glass-effect hover:border-purple-400 rounded-lg py-3 font-semibold transition-all text-white border border-purple-500/50"
                                    style={{ borderColor: '#A855F7' }}
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 1:1 PT 매출 모달 컴포넌트
            const PtModal = () => {
                const ptData = getPtDetails();
                const totalAmount = ptData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = ptData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowPtModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#F59E0B' }}>
                                🏋️ 1:1 PT 매출 현황 ({selectedMonth + 1}월)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 1:1 PT 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{ptData.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 1:1 PT 매출</p>
                                    <p className="text-3xl font-bold" style={{ color: '#F59E0B' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>

                            {ptData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">🏋️</div>
                                    <p className="text-gray-400 text-lg">이번 달 1:1 PT 매출이 없습니다</p>
                                    <p className="text-gray-500 text-sm mt-2">1:1 PT 서비스 판매 시 여기에 표시됩니다</p>
                                </div>
                            ) : (
                                <div className="max-h-96 overflow-y-auto">
                                    {Object.entries(groupedByDate).map(([date, items]) => (
                                        <div key={date} className="mb-6">
                                            <h4 className="text-lg font-semibold mb-3 text-center" style={{ color: '#F59E0B' }}>
                                                {date}
                                            </h4>
                                            <div className="space-y-3">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="glass-effect rounded-lg p-4 border border-orange-500/30">
                                                            <div className="flex justify-between items-start mb-2">
                                                                <div className="text-white font-medium">{item.name}</div>
                                                                <div className="text-right">
                                                                    {hasDiscount && (
                                                                        <div className="text-[11px] text-amber-200/80 line-through">{originalAmount.toLocaleString()}원</div>
                                                                    )}
                                                                    <div className="text-orange-400 font-bold text-lg">
                                                                        {amount.toLocaleString()}원
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="text-orange-300 text-sm font-medium mb-1">
                                                                {item.product}
                                                            </div>
                                                            {hasDiscount && (
                                                                <div className="text-xs text-amber-200 mb-1">
                                                                    할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                </div>
                                                            )}
                                                            {item.memo && (
                                                                <div className="text-gray-400 text-sm italic">
                                                                    메모: {item.memo}
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowPtModal(false)}
                                    className="w-full glass-effect hover:border-orange-400 rounded-lg py-3 font-semibold transition-all text-white border border-orange-500/50"
                                    style={{ borderColor: '#F59E0B' }}
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 기타 매출 모달 컴포넌트
            const OtherModal = () => {
                const otherData = getOtherDetails();
                const totalAmount = otherData.reduce((sum, item) => sum + (item.price || 0), 0);
                const groupedByDate = otherData.reduce((acc, item) => {
                    if (!acc[item.date]) acc[item.date] = [];
                    acc[item.date].push(item);
                    return acc;
                }, {});

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowOtherModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '600px', maxWidth: '90%', maxHeight: '90vh', overflowY: 'auto' }} onClick={(e) => e.stopPropagation()}>
                            <h3 className="text-2xl font-bold mb-6 text-center" style={{ color: '#9CA3AF' }}>
                                📊 기타 매출 현황 ({selectedMonth + 1}월)
                            </h3>

                            <div className="mb-6 text-center">
                                <div className="glass-effect rounded-xl p-4 mb-4">
                                    <p className="text-gray-400 text-sm mb-1">총 기타 결제 건수</p>
                                    <p className="text-3xl font-bold text-white">{otherData.length}건</p>
                                </div>
                                <div className="glass-effect rounded-xl p-4">
                                    <p className="text-gray-400 text-sm mb-1">총 기타 매출</p>
                                    <p className="text-3xl font-bold" style={{ color: '#9CA3AF' }}>
                                        {totalAmount.toLocaleString()}원
                                    </p>
                                </div>
                            </div>

                            {otherData.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="text-6xl mb-4">📊</div>
                                    <p className="text-gray-400 text-lg">이번 달 기타 매출이 없습니다</p>
                                    <p className="text-gray-500 text-sm mt-2">기타 상품 판매 시 여기에 표시됩니다</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                                    {Object.entries(groupedByDate).sort((a, b) => b[0].localeCompare(a[0])).map(([date, items]) => (
                                        <div key={date} className="glass-effect rounded-xl p-4">
                                            <div className="font-semibold text-gray-300 mb-3">
                                                🗓️ {date}
                                            </div>
                                            <div className="space-y-2">
                                                {items.map((item, index) => {
                                                    const amount = item.price || 0;
                                                    const originalAmount = item.originalPrice || amount;
                                                    const discountAllowed = item.discountEligible !== undefined ? item.discountEligible : true;
                                                    const discountAmount = discountAllowed
                                                        ? (item.discountAmount !== undefined
                                                            ? item.discountAmount
                                                            : Math.max(0, originalAmount - amount))
                                                        : 0;
                                                    const hasDiscount = discountAllowed && discountAmount > 0;
                                                    return (
                                                        <div key={index} className="flex justify-between items-start p-3 bg-gray-800/50 rounded-lg border border-gray-500/20">
                                                            <div className="flex-1 pr-3">
                                                                <div className="text-white font-medium">{item.customerName}</div>
                                                                <div className="text-sm text-gray-400">{item.timestamp}</div>
                                                                <div className="text-xs text-gray-300 mt-1">📊 {item.product}</div>
                                                                {hasDiscount && (
                                                                    <div className="text-xs text-gray-200 mt-1">
                                                                        할인 {discountAmount.toLocaleString()}원 적용 (기준 {originalAmount.toLocaleString()}원)
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-right">
                                                                {hasDiscount && (
                                                                    <div className="text-[11px] text-gray-300/70 line-through">{originalAmount.toLocaleString()}원</div>
                                                                )}
                                                                <div className="font-bold" style={{ color: '#9CA3AF' }}>
                                                                    {amount.toLocaleString()}원
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mt-6">
                                <button
                                    onClick={() => setShowOtherModal(false)}
                                    className="w-full glass-effect hover:border-gray-400 rounded-lg py-3 font-semibold transition-all text-white border border-gray-500/50"
                                    style={{ borderColor: '#9CA3AF' }}
                                >
                                    닫기
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // 달력 모달 컴포넌트
            const CalendarModal = () => {
                if (!showCalendarModal) return null;
                
                const [yearView, setYearView] = useState(selectedYear);
                const [searchDate, setSearchDate] = useState('');
                const [yearSalesData, setYearSalesData] = useState({});
                const [isLoading, setIsLoading] = useState(false);
                
                // 모달이 열릴 때 현재 연도로 초기화
                React.useEffect(() => {
                    if (showCalendarModal) {
                        setYearView(selectedYear);
                        setYearSalesData({}); // 초기화
                        setIsLoading(true); // 로딩 시작
                    }
                }, [showCalendarModal]);
                
                // salesData가 변경될 때마다 yearSalesData 업데이트
                React.useEffect(() => {
                    setYearSalesData(prevData => ({
                        ...prevData,
                        ...salesData
                    }));
                }, [salesData]);
                
                // 전체 연도 데이터 로드 (전월 포함) - Firebase 구독 사용
                React.useEffect(() => {
                    if (!showCalendarModal || !user) return;
                    
                    const unsubscribes = [];
                    setIsLoading(true);
                    
                    // 12개월 모든 데이터를 구독
                    for (let month = 0; month < 12; month++) {
                        // 현재 월 데이터 구독
                        const unsubscribe = salesService.subscribeToMonthData(
                            yearView,
                            month,
                            (data) => {
                                setYearSalesData(prevData => ({
                                    ...prevData,
                                    ...data
                                }));
                            }
                        );
                        if (unsubscribe) unsubscribes.push(unsubscribe);
                        
                        // 전월 데이터 구독 제거 - 월별 데이터 중복 방지
                    }
                    
                    // 로딩 완료
                    setTimeout(() => setIsLoading(false), 1000);
                    
                    // cleanup
                    return () => {
                        unsubscribes.forEach(unsubscribe => {
                            if (unsubscribe) unsubscribe();
                        });
                    };
                }, [yearView, showCalendarModal, user]);
                
                // 매출 금액에 따른 색상 결정 함수 (배경색 제거)
                const getAmountColor = (amount) => {
                    return ''; // 모든 배경색 제거
                };
                
                const getAmountTextColor = (amount) => {
                    if (amount === 0) return '#6b7280'; // 회색
                    if (amount < 500000) return '#93c5fd'; // 연한 파랑
                    if (amount < 1000000) return '#6ee7b7'; // 연한 초록
                    if (amount < 2000000) return '#fcd34d'; // 노랑
                    if (amount < 3000000) return '#fb923c'; // 주황
                    return '#f87171'; // 빨강
                };
                
                // 1년치 월별 캘린더 생성
                const renderMonthCalendar = (month) => {
                    const firstDay = new Date(yearView, month, 1).getDay();
                    const daysInMonth = new Date(yearView, month + 1, 0).getDate();
                    const weeks = [];
                    let currentWeek = [];
                    let monthTotal = 0;
                    let prevMonthTotal = 0;
                    
                    // 데이터 소스 결정 - yearSalesData가 있으면 사용, 없으면 salesData
                    const dataSource = Object.keys(yearSalesData).length > 0 ? yearSalesData : salesData;
                    
                    // 월 총 매출 계산 (승인된 것만)
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateKey = `${yearView}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const dayData = normalizeSalesEntry(dataSource[dateKey]);
                        if (dayData.approved) {
                            const amountValue = normalizeAmount(dayData.amount);
                            monthTotal += amountValue;
                        }
                    }
                    
                    // 전월 총 매출 계산 (승인된 것만)
                    const prevMonth = month === 0 ? 11 : month - 1;
                    const prevYear = month === 0 ? yearView - 1 : yearView;
                    const prevDaysInMonth = new Date(prevYear, prevMonth + 1, 0).getDate();
                    for (let day = 1; day <= prevDaysInMonth; day++) {
                        const dateKey = `${prevYear}-${String(prevMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const dayData = normalizeSalesEntry(dataSource[dateKey]);
                        if (dayData.approved) {
                            const amountValue = normalizeAmount(dayData.amount);
                            prevMonthTotal += amountValue;
                        }
                    }
                    
                    // 전월 대비 증감률 계산
                    let changePercent = 0;
                    if (prevMonthTotal > 0) {
                        changePercent = ((monthTotal - prevMonthTotal) / prevMonthTotal * 100).toFixed(1);
                    } else if (prevMonthTotal === 0 && monthTotal > 0) {
                        changePercent = 100; // 전월 매출이 0이고 당월 매출이 있으면 100% 증가로 표시
                    }
                    
                    // 첫 주의 빈 칸 추가
                    for (let i = 0; i < firstDay; i++) {
                        currentWeek.push(null);
                    }
                    
                    // 날짜를 주 단위로 그룹화
                    for (let day = 1; day <= daysInMonth; day++) {
                        currentWeek.push(day);
                        if (currentWeek.length === 7) {
                            weeks.push(currentWeek);
                            currentWeek = [];
                        }
                    }
                    
                    // 마지막 주 처리
                    if (currentWeek.length > 0) {
                        while (currentWeek.length < 7) {
                            currentWeek.push(null);
                        }
                        weeks.push(currentWeek);
                    }
                    
                    return (
                        <div style={{ backgroundColor: 'rgba(30, 41, 59, 0.5)', backdropFilter: 'blur(10px)', borderRadius: '8px', padding: '10px', border: '1px solid rgba(255, 255, 255, 0.1)', position: 'relative' }}>
                            <h4 style={{ fontSize: '14px', fontWeight: 'bold', marginBottom: '4px', textAlign: 'center', color: '#00FF88' }}>
                                {String(month + 1).padStart(2, '0')}월
                            </h4>
                            <div style={{ fontSize: '11px', color: '#fbbf24', textAlign: 'center', marginBottom: '2px', fontWeight: 'bold' }}>
                                {monthTotal > 0 ? `${monthTotal.toLocaleString()}원` : '0원'}
                            </div>
                            {(month === 0 && monthTotal > 0) ? (
                                <div style={{ 
                                    fontSize: '10px', 
                                    color: '#60a5fa', 
                                    textAlign: 'center', 
                                    marginBottom: '6px',
                                    fontWeight: 'bold'
                                }}>
                                    시작
                                </div>
                            ) : (prevMonthTotal > 0 || monthTotal > 0) && month > 0 ? (
                                <div style={{ 
                                    fontSize: '10px', 
                                    color: changePercent >= 0 ? '#10b981' : '#ef4444', 
                                    textAlign: 'center', 
                                    marginBottom: '6px',
                                    fontWeight: 'bold'
                                }}>
                                    {prevMonthTotal === 0 && monthTotal > 0 ? (
                                        <span style={{color: '#10b981'}}>신규</span>
                                    ) : monthTotal === 0 && prevMonthTotal > 0 ? (
                                        <span style={{color: '#ef4444'}}>▼ -100%</span>
                                    ) : prevMonthTotal > 0 ? (
                                        <span>{changePercent >= 0 ? '▲' : '▼'} {Math.abs(changePercent)}%</span>
                                    ) : null}
                                </div>
                            ) : <div style={{height: '16px'}}></div>}
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '2px', fontSize: '10px', marginBottom: '4px' }}>
                                {['일', '월', '화', '수', '목', '금', '토'].map((d, i) => (
                                    <div key={d} style={{ 
                                        textAlign: 'center', 
                                        fontWeight: '500',
                                        color: i === 0 ? '#f87171' : i === 6 ? '#60a5fa' : '#9ca3af'
                                    }}>{d}</div>
                                ))}
                            </div>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '2px' }}>
                                {weeks.map((week, weekIndex) => (
                                    week.map((day, dayIndex) => {
                                        if (day === null) {
                                            return <div key={`empty-${month}-${weekIndex}-${dayIndex}`} style={{ height: '35px' }} />;
                                        }
                                        
                                        const dateKey = `${yearView}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                        const currentDataSource = Object.keys(yearSalesData).length > 0 ? yearSalesData : salesData;
                                        const dayData = currentDataSource[dateKey] || { amount: 0, approved: false };
                                        const date = new Date(yearView, month, day);
                                        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                                        const isToday = new Date().toDateString() === date.toDateString();
                                        const dayAmount = dayData.approved ? normalizeAmount(dayData.amount) : 0;
                                        const hasApprovedData = dayAmount > 0;
                                        
                                        // 매출액 포맷팅 (일반 숫자 형식)
                                        const formatAmount = (amount) => {
                                            const value = normalizeAmount(amount);
                                            if (value >= 100000) {
                                                // 10만원 이상은 만원 단위로 표시
                                                return Math.floor(value / 10000) + '만';
                                            }
                                            return value.toLocaleString();
                                        };
                                        
                                        const bgColor = getAmountColor(dayAmount);
                                        const textColor = getAmountTextColor(dayAmount);
                                        
                                        const dayStyle = {
                                            height: '35px',
                                            display: 'flex',
                                            flexDirection: 'column',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            cursor: 'pointer',
                                            borderRadius: '3px',
                                            transition: 'all 0.2s',
                                            padding: '2px',
                                            backgroundColor: '',
                                            outline: isToday ? '1px solid #10b981' : 'none'
                                        };
                                        
                                        return (
                                            <div
                                                key={`${month}-${day}`}
                                                style={dayStyle}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.transform = 'scale(1.1)';
                                                    e.currentTarget.style.zIndex = '10';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.transform = 'scale(1)';
                                                    e.currentTarget.style.zIndex = '1';
                                                }}
                                                onClick={() => {
                                                    setSelectedYear(yearView);
                                                    setSelectedMonth(month);
                                                    setShowCalendarModal(false);
                                                    setViewMode('daily');
                                                    setTimeout(() => {
                                                        const element = document.getElementById(`day-${day}`);
                                                        element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                                    }, 100);
                                                }}
                                                title={hasApprovedData ? `${dayAmount.toLocaleString()}원` : ''}
                                            >
                                                <div style={{
                                                    fontSize: '11px',
                                                    fontWeight: hasApprovedData ? 'bold' : 'normal',
                                                    color: hasApprovedData ? '#22c55e' : (isWeekend ? (date.getDay() === 0 ? '#f87171' : '#60a5fa') : '#9ca3af')
                                                }}>
                                                    {day}
                                                </div>
                                                {hasApprovedData && (
                                                    <div style={{
                                                        fontSize: '8px',
                                                        color: textColor,
                                                        fontWeight: 'bold',
                                                        marginTop: '1px'
                                                    }}>
                                                        {formatAmount(dayAmount)}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })
                                ))}
                            </div>
                        </div>
                    );
                };
                
                // 날짜 검색 처리
                const handleDateSearch = () => {
                    if (!searchDate) return;
                    
                    const parts = searchDate.split('-');
                    if (parts.length === 3) {
                        const [year, month, day] = parts.map(p => parseInt(p));
                        if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {
                            setSelectedYear(year);
                            setSelectedMonth(month - 1);
                            setShowCalendarModal(false);
                            setViewMode('daily');
                            setTimeout(() => {
                                const element = document.getElementById(`day-${day}`);
                                element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        }
                    }
                };
                
                return (
                    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowCalendarModal(false)}>
                        <div className="glass-effect rounded-2xl p-6 slide-in" style={{ width: '100%', maxWidth: '1400px', maxHeight: '90vh', overflowY: 'auto', backgroundColor: 'rgba(17, 24, 39, 0.95)' }} onClick={(e) => e.stopPropagation()}>
                            {isLoading ? (
                                <div className="flex items-center justify-center py-20">
                                    <div className="text-green-400 text-xl">데이터 로딩 중...</div>
                                </div>
                            ) : (
                            <>
                            {/* 헤더 */}
                            <div className="flex items-center justify-between mb-6 pb-4 border-b border-gray-700">
                                <div className="flex items-center gap-4">
                                    <button
                                        onClick={() => setYearView(yearView - 1)}
                                        className="w-10 h-10 flex items-center justify-center glass-effect rounded-lg hover:border-green-400 transition-all text-gray-300"
                                    >
                                        ◀
                                    </button>
                                    <h3 className="text-3xl font-bold min-w-[100px] text-center" style={{ color: '#00FF88' }}>
                                        {yearView}
                                    </h3>
                                    <button
                                        onClick={() => setYearView(yearView + 1)}
                                        className="w-10 h-10 flex items-center justify-center glass-effect rounded-lg hover:border-green-400 transition-all text-gray-300"
                                    >
                                        ▶
                                    </button>
                                </div>
                                
                                <div className="flex items-center gap-4">
                                    <button
                                        onClick={() => setShowCalendarModal(false)}
                                        className="w-10 h-10 flex items-center justify-center hover:bg-white/12 rounded-lg transition-all"
                                    >
                                        <Icon icon={X} size={24} style={{ color: '#999' }} />
                                    </button>
                                </div>
                            </div>
                            
                            {/* 12개월 4x3 그리드 배열 */}
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '12px' }}>
                                {Array.from({ length: 12 }, (_, i) => renderMonthCalendar(i))}
                            </div>
                            
                            {/* 색상 범례 */}
                            <div style={{ marginTop: '20px', padding: '10px', backgroundColor: 'rgba(30, 41, 59, 0.5)', borderRadius: '8px' }}>
                                <div style={{ fontSize: '12px', color: '#9ca3af', marginBottom: '8px' }}>매출 금액별 색상 범례</div>
                                <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap', justifyContent: 'center' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                        <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(147, 197, 253, 0.3)', borderRadius: '3px' }}></div>
                                        <span style={{ fontSize: '11px', color: '#93c5fd' }}>~50만</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                        <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(110, 231, 183, 0.3)', borderRadius: '3px' }}></div>
                                        <span style={{ fontSize: '11px', color: '#6ee7b7' }}>50~100만</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                        <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(252, 211, 77, 0.3)', borderRadius: '3px' }}></div>
                                        <span style={{ fontSize: '11px', color: '#fcd34d' }}>100~200만</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                        <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(251, 146, 60, 0.3)', borderRadius: '3px', border: '1px solid rgba(251, 146, 60, 0.5)' }}></div>
                                        <span style={{ fontSize: '11px', color: '#fb923c' }}>200~300만</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                                        <div style={{ width: '20px', height: '20px', backgroundColor: 'rgba(248, 113, 113, 0.3)', borderRadius: '3px', border: '1px solid rgba(248, 113, 113, 0.5)' }}></div>
                                        <span style={{ fontSize: '11px', color: '#f87171' }}>300만~</span>
                                    </div>
                                </div>
                            </div>
                            </>
                            )}
                        </div>
                    </div>
                );
            };

            // 로그인 화면
            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br text-gray-100 flex items-center justify-center">
                        <div className="text-2xl">로딩 중...</div>
                    </div>
                );
            }
            
            if (!user) {
                return (
                    <div className="min-h-screen" style={{ backgroundColor: '#1a1a1a' }}>
                        <div className="flex items-center justify-center min-h-screen p-4">
                            <div className="w-full" style={{ maxWidth: '440px' }}>
                                <div style={{ 
                                    backgroundColor: '#2d2d2d',
                                    borderRadius: '16px',
                                    padding: '40px',
                                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.5)'
                                }}>
                                    <div className="text-center mb-8">
                                        <h1 className="text-3xl font-bold mb-1">
                                            <span style={{ color: '#00FF88' }}>NeoFit</span>
                                            <span className="text-white ml-1">PayCalc</span>
                                        </h1>
                                        <p className="text-gray-400 text-sm">네오핏 급여 계산기</p>
                                    </div>
                                {!isSignUpMode ? (
                                    // 로그인 폼
                                    <>
                                        <form onSubmit={async (e) => {
                                            e.preventDefault();
                                            setLoginError('');
                                            const email = e.target.email.value;
                                            const password = e.target.password.value;
                                            
                                            const result = await authService.loginWithEmail(email, password);
                                            if (!result.success) {
                                                let errorMsg = result.error;
                                                if (result.error.includes('user-not-found')) {
                                                    errorMsg = '등록되지 않은 이메일입니다.';
                                                } else if (result.error.includes('wrong-password')) {
                                                    errorMsg = '잘못된 비밀번호입니다.';
                                                } else if (result.error.includes('invalid-login-credentials')) {
                                                    errorMsg = '이메일 또는 비밀번호가 올바르지 않습니다.';
                                                }
                                                setLoginError(errorMsg);
                                            }
                                        }} className="space-y-5">
                                            <div>
                                                <label className="block text-sm font-medium mb-2 text-gray-300">이메일</label>
                                                <input
                                                    type="email"
                                                    name="email"
                                                    className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                    style={{
                                                        backgroundColor: '#3d3d3d',
                                                        borderRadius: '12px',
                                                        border: '1px solid #4d4d4d',
                                                        fontSize: '16px'
                                                    }}
                                                    placeholder="gio7603@gmail.com"
                                                    required
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2 text-gray-300">비밀번호</label>
                                                <input
                                                    type="password"
                                                    name="password"
                                                    className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                    style={{
                                                        backgroundColor: '#3d3d3d',
                                                        borderRadius: '12px',
                                                        border: '1px solid #4d4d4d',
                                                        fontSize: '16px'
                                                    }}
                                                    placeholder="비밀번호 입력"
                                                    required
                                                />
                                            </div>
                                            {loginError && (
                                                <div className="text-red-400 text-sm text-center py-2">
                                                    {loginError}
                                                </div>
                                            )}
                                            <button
                                                type="submit"
                                                className="w-full text-white font-medium py-3 px-4 transition-all duration-200 hover:opacity-90"
                                                style={{
                                                    backgroundColor: '#00FF88',
                                                    borderRadius: '12px',
                                                    fontSize: '16px',
                                                    border: 'none',
                                                    color: '#000',
                                                    marginTop: '24px'
                                                }}
                                            >
                                                로그인
                                            </button>
                                        </form>
                                        <div className="mt-6 pt-6" style={{ borderTop: '1px solid #3d3d3d' }}>
                                            <button
                                                onClick={() => setIsSignUpMode(true)}
                                                className="w-full py-3 px-4 transition-all duration-200 hover:opacity-80"
                                                style={{
                                                    backgroundColor: 'transparent',
                                                    border: '1px solid #4d4d4d',
                                                    borderRadius: '12px',
                                                    fontSize: '15px',
                                                    color: '#999'
                                                }}
                                            >
                                                회원가입
                                            </button>
                                        </div>
                                    </>
                                ) : (
                                    // 회원가입 폼
                                    <>
                                        <form onSubmit={async (e) => {
                                            e.preventDefault();
                                            setLoginError('');
                                            const email = e.target.email.value;
                                            const password = e.target.password.value;
                                            const confirmPassword = e.target.confirmPassword.value;
                                            
                                            if (password !== confirmPassword) {
                                                setLoginError('비밀번호가 일치하지 않습니다.');
                                                return;
                                            }
                                            
                                            if (password.length < 6) {
                                                setLoginError('비밀번호는 최소 6자 이상이어야 합니다.');
                                                return;
                                            }
                                            
                                            const result = await authService.signUpWithEmail(email, password);
                                            if (!result.success) {
                                                let errorMsg = result.error;
                                                if (result.error.includes('email-already-in-use')) {
                                                    errorMsg = '이미 사용 중인 이메일입니다.';
                                                } else if (result.error.includes('weak-password')) {
                                                    errorMsg = '비밀번호가 너무 약합니다.';
                                                } else if (result.error.includes('invalid-email')) {
                                                    errorMsg = '유효하지 않은 이메일 형식입니다.';
                                                }
                                                setLoginError(errorMsg);
                                            } else {
                                                alert('회원가입이 완료되었습니다!');
                                            }
                                        }} className="space-y-5">
                                            <div>
                                                <label className="block text-sm font-medium mb-2 text-gray-300">이메일</label>
                                                <input
                                                    type="email"
                                                    name="email"
                                                    className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                    style={{
                                                        backgroundColor: '#3d3d3d',
                                                        borderRadius: '12px',
                                                        border: '1px solid #4d4d4d',
                                                        fontSize: '16px'
                                                    }}
                                                    placeholder="새 이메일 입력"
                                                    required
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2 text-gray-300">비밀번호</label>
                                                <input
                                                    type="password"
                                                    name="password"
                                                    className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                    style={{
                                                        backgroundColor: '#3d3d3d',
                                                        borderRadius: '12px',
                                                        border: '1px solid #4d4d4d',
                                                        fontSize: '16px'
                                                    }}
                                                    placeholder="비밀번호 (6자 이상)"
                                                    required
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2 text-gray-300">비밀번호 확인</label>
                                                <input
                                                    type="password"
                                                    name="confirmPassword"
                                                    className="w-full px-4 py-3 text-white placeholder-gray-500 focus:outline-none transition-all"
                                                    style={{
                                                        backgroundColor: '#3d3d3d',
                                                        borderRadius: '12px',
                                                        border: '1px solid #4d4d4d',
                                                        fontSize: '16px'
                                                    }}
                                                    placeholder="비밀번호 다시 입력"
                                                    required
                                                />
                                            </div>
                                            {loginError && (
                                                <div className="text-red-400 text-sm text-center py-2">
                                                    {loginError}
                                                </div>
                                            )}
                                            <button
                                                type="submit"
                                                className="w-full text-white font-medium py-3 px-4 transition-all duration-200 hover:opacity-90"
                                                style={{
                                                    backgroundColor: '#00FF88',
                                                    borderRadius: '12px',
                                                    fontSize: '16px',
                                                    border: 'none',
                                                    color: '#000',
                                                    marginTop: '24px'
                                                }}
                                            >
                                                회원가입
                                            </button>
                                        </form>
                                        <div className="mt-6 pt-6" style={{ borderTop: '1px solid #3d3d3d' }}>
                                            <button
                                                onClick={() => setIsSignUpMode(false)}
                                                className="w-full py-3 px-4 transition-all duration-200 hover:opacity-80"
                                                style={{
                                                    backgroundColor: 'transparent',
                                                    border: '1px solid #4d4d4d',
                                                    borderRadius: '12px',
                                                    fontSize: '15px',
                                                    color: '#999'
                                                }}
                                            >
                                                로그인으로 돌아가기
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen bg-gradient-to-br text-gray-100 p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* 매출 입력 모달 */}
                        {showAddSaleModal && <AddSaleModal />}
                        {/* 검색 결과 모달 */}
                        {showSearchResultModal && <SearchResultModal />}
                        {/* 매출 상세 모달 */}
                        {showDetailModal && selectedDetailEntry && <SaleDetailModal />}
                        {/* 달력 모달 */}
                        <CalendarModal />
                        {/* 필라테스 매출 모달 */}
                        {showPilatesModal && <PilatesModal />}
                        {/* 헬스 이용권 매출 모달 */}
                        {showHealthModal && <HealthModal />}
                        {/* 네오핏 매출 모달 */}
                        {showNeofitModal && <NeofitModal />}
                        {/* 1:1 PT 매출 모달 */}
                        {showPtModal && <PtModal />}
                        {/* 운동복/락커 매출 모달 */}
                        {showClothingLockerModal && <ClothingLockerModal />}
                        {/* 기타 매출 모달 */}
                        {showOtherModal && <OtherModal />}
                        {/* 헤더 */}
                        <div className="text-center mb-8 sm:mb-10 relative">
                            <h1 className="text-3xl sm:text-5xl font-black mb-2 sm:mb-3" style={{ color: '#00FF88' }}>
                                NeoFit PayCalc
                            </h1>
                            <p className="text-gray-400 text-base sm:text-lg">네오핏 급여 계산기</p>
                            <button
                                onClick={() => authService.logout()}
                                className="absolute top-0 right-0 glass-effect hover:border-red-400 rounded-lg px-4 py-2 text-sm transition-all text-white"
                            >
                                로그아웃
                            </button>
                        </div>
                        
                        {/* 회원 검색 */}
                        <div className="mb-6 flex justify-center">
                            <div className="flex gap-2" style={{ maxWidth: '400px', width: '100%' }}>
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && searchCustomer()}
                                    placeholder="회원명을 검색하세요"
                                    className="flex-1 glass-effect rounded-lg px-4 py-3 focus:border-green-400 focus:outline-none"
                                />
                                <button
                                    onClick={searchCustomer}
                                    className="glass-effect border-green-500 hover:border-green-400 rounded-lg px-6 py-3 font-semibold transition-all hover:shadow-lg text-white"
                                >
                                    <Icon icon="search" size={20} />
                                </button>
                            </div>
                        </div>

                        {/* 뷰 모드 선택 */}
                        <div className="flex justify-center gap-2 mb-6">
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('daily');
                                }}
                                onTouchEnd={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('daily');
                                }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all glass-effect ${
                                    viewMode === 'daily' 
                                        ? 'text-green-400 border-green-500 shadow-lg scale-105' 
                                        : 'text-gray-400 hover:text-white hover:border-gray-400'
                                }`}
                                style={viewMode === 'daily' ? { 
                                    backgroundColor: '#0a4a2c',
                                    borderColor: '#00FF88',
                                    boxShadow: '0 0 15px rgba(0, 255, 136, 0.5)',
                                    WebkitTapHighlightColor: 'transparent'
                                } : { WebkitTapHighlightColor: 'transparent' }}
                            >
                                일별
                            </button>
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('weekly');
                                }}
                                onTouchEnd={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('weekly');
                                }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all glass-effect ${
                                    viewMode === 'weekly' 
                                        ? 'text-green-400 border-green-500 shadow-lg scale-105' 
                                        : 'text-gray-400 hover:text-white hover:border-gray-400'
                                }`}
                                style={viewMode === 'weekly' ? { 
                                    backgroundColor: '#0a4a2c',
                                    borderColor: '#00FF88',
                                    boxShadow: '0 0 15px rgba(0, 255, 136, 0.5)',
                                    WebkitTapHighlightColor: 'transparent'
                                } : { WebkitTapHighlightColor: 'transparent' }}
                            >
                                주별
                            </button>
                            <button
                                onClick={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('monthly');
                                }}
                                onTouchEnd={(e) => {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    setViewMode('monthly');
                                }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all glass-effect ${
                                    viewMode === 'monthly' 
                                        ? 'text-green-400 border-green-500 shadow-lg scale-105' 
                                        : 'text-gray-400 hover:text-white hover:border-gray-400'
                                }`}
                                style={viewMode === 'monthly' ? { 
                                    backgroundColor: '#0a4a2c',
                                    borderColor: '#00FF88',
                                    boxShadow: '0 0 15px rgba(0, 255, 136, 0.5)',
                                    WebkitTapHighlightColor: 'transparent'
                                } : { WebkitTapHighlightColor: 'transparent' }}
                            >
                                월별
                            </button>
                        </div>
                        
                        {/* 직원 유형 선택 및 월 선택 */}
                        <div className="flex flex-col sm:flex-row justify-center gap-4 mb-10 flex-wrap">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setEmployeeType('full')}
                                    className={`px-6 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base glass-effect ${
                                        employeeType === 'full' 
                                            ? 'text-white border-green-500 shadow-lg scale-105 bg-green-500/20' 
                                            : 'text-gray-400 hover:text-white hover:border-gray-400'
                                    }`}
                                >
                                    정직원
                                </button>
                                <button
                                    onClick={() => setEmployeeType('part')}
                                    className={`px-6 sm:px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-sm sm:text-base glass-effect ${
                                        employeeType === 'part' 
                                            ? 'text-white border-green-500 shadow-lg scale-105 bg-green-500/20' 
                                            : 'text-gray-400 hover:text-white hover:border-gray-400'
                                    }`}
                                >
                                    파트타임
                                </button>
                            </div>
                            
                            <div className="flex gap-3 w-full sm:w-auto items-center">
                                <select
                                    value={selectedMonth}
                                    onChange={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedMonth(value);
                                        }
                                    }}
                                    onInput={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedMonth(value);
                                        }
                                    }}
                                    className="glass-effect rounded-xl px-4 sm:px-6 py-3 focus:border-green-400 focus:outline-none font-medium transition-all hover:scale-105 text-sm sm:text-base flex-1 sm:flex-initial"
                                    style={{ borderColor: '#00C66E' }}
                                >
                                    {Array.from({ length: 12 }, (_, i) => (
                                        <option key={i} value={i}>
                                            {new Date(2024, i).toLocaleDateString('ko-KR', { month: 'long' })}
                                        </option>
                                    ))}
                                </select>
                                <select
                                    value={selectedYear}
                                    onChange={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedYear(value);
                                        }
                                    }}
                                    onInput={(e) => {
                                        const value = parseInt(e.target.value);
                                        if (!isNaN(value)) {
                                            setSelectedYear(value);
                                        }
                                    }}
                                    className="glass-effect rounded-xl px-4 sm:px-6 py-3 focus:border-green-400 focus:outline-none font-medium transition-all hover:scale-105 text-sm sm:text-base flex-1 sm:flex-initial"
                                    style={{ borderColor: '#00C66E' }}
                                >
                                    {[2024, 2025, 2026].map(year => (
                                        <option key={year} value={year}>{year}년</option>
                                    ))}
                                </select>
                                <button
                                    onClick={() => setShowCalendarModal(true)}
                                    className="glass-effect rounded-xl p-3 border-green-500 hover:border-green-400 transition-all hover:shadow-lg"
                                    title="연간 달력 보기"
                                >
                                    <Icon icon={Calendar} size={20} style={{ color: '#00FF88' }} />
                                </button>
                            </div>
                        </div>

                        {/* 통계 요약 */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <div className="glass-effect rounded-2xl p-4 text-center transition-all">
                                <p className="text-gray-400 text-sm mb-1">오늘 매출</p>
                                <p className="text-2xl font-bold text-white">
                                    {getTodaySales().toLocaleString()}원
                                </p>
                            </div>
                            <div className="glass-effect rounded-2xl p-4 text-center transition-all">
                                <p className="text-gray-400 text-sm mb-1">이번주 매출</p>
                                <p className="text-2xl font-bold" style={{ color: '#00C6FF' }}>
                                    {getThisWeekSales().toLocaleString()}원
                                </p>
                            </div>
                            <div className="glass-effect rounded-2xl p-4 text-center transition-all">
                                <p className="text-gray-400 text-sm mb-1">월 매출</p>
                                <p className="text-2xl font-bold" style={{
                                    color: '#FF6B35',
                                    textShadow: '0 0 10px rgba(255, 107, 53, 0.5), 0 0 20px rgba(255, 107, 53, 0.3), 0 0 30px rgba(255, 107, 53, 0.2)'
                                }}>
                                    {monthlyTotal.toLocaleString()}원
                                </p>
                            </div>
                            <div className="glass-effect rounded-2xl p-4 text-center transition-all">
                                <p className="text-gray-400 text-sm mb-1">예상 인센티브</p>
                                <p className="text-2xl font-bold" style={{ 
                                    color: '#00FF88',
                                    textShadow: '0 0 10px rgba(0, 255, 136, 0.8), 0 0 20px rgba(0, 255, 136, 0.6), 0 0 30px rgba(0, 255, 136, 0.4)'
                                }}>
                                    {Math.floor(incentiveAmount).toLocaleString()}원
                                </p>
                            </div>
                        </div>

                        {/* 매출 현황 */}
                        <div className="gradient-border mb-8">
                            <div>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold flex items-center gap-3">
                                        <div className="p-2 bg-green-500/20 rounded-lg">
                                            <Icon icon={Calendar} size={28} style={{ color: '#00FF88' }} />
                                        </div>
                                        {viewMode === 'daily' ? '일별 매출 현황' : viewMode === 'weekly' ? '주별 매출 현황' : '월별 매출 현황'}
                                    </h2>
                                    {viewMode === 'daily' && (
                                        <div className="flex gap-2">
                                            <div className="relative group">
                                                <button
                                                    onClick={() => {
                                                        const today = new Date();
                                                        const todayDate = today.getDate();
                                                        const isCurrentMonth = today.getMonth() === selectedMonth && today.getFullYear() === selectedYear;
                                                        
                                                        if (isCurrentMonth) {
                                                            // 현재 달이면 오늘 날짜로 스크롤
                                                            const todayElement = document.getElementById(`day-${todayDate}`);
                                                            if (todayElement) {
                                                                todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                                            }
                                                            // 오늘 날짜의 매출 입력 모달 열기
                                                            openAddSaleModal(todayDate);
                                                        } else {
                                                            // 다른 달이면 1일로 이동
                                                            openAddSaleModal(1);
                                                        }
                                                    }}
                                                    className="glass-effect rounded-full p-3 border-blue-500 hover:border-blue-400 transition-all hover:shadow-lg"
                                                >
                                                <Icon icon={Plus} size={24} style={{ color: 'white' }} />
                                            </button>
                                            <div className="absolute right-0 top-full mt-2 bg-gray-800 text-white text-sm px-3 py-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                                                오늘 매출 입력하기
                                            </div>
                                            </div>
                                            
                                            {/* 정산체크 해제 및 매출 카테고리 버튼들 */}
                                            <div className="flex flex-wrap gap-2">
                                                <button
                                                    onClick={() => {
                                                        setCheckedDetails({});
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%)',
                                                        border: '2px solid rgba(59, 130, 246, 0.4)',
                                                        color: '#60A5FA'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-blue-500/20 to-purple-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>정산체크</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowHealthModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%)',
                                                        border: '2px solid rgba(34, 197, 94, 0.4)',
                                                        color: '#22C55E'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-green-500/20 to-emerald-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>헬스 이용권</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowNeofitModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(56, 178, 172, 0.2) 100%)',
                                                        border: '2px solid rgba(78, 205, 196, 0.4)',
                                                        color: '#4ECDC4'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-teal-400/20 to-teal-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>네오핏 매출</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowPtModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%)',
                                                        border: '2px solid rgba(245, 158, 11, 0.4)',
                                                        color: '#F59E0B'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-amber-500/20 to-yellow-600/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>1:1 PT 매출</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowPilatesModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(251, 113, 133, 0.2) 100%)',
                                                        border: '2px solid rgba(236, 72, 153, 0.4)',
                                                        color: '#F472B6'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-pink-500/20 to-rose-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>필라테스 매출</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowClothingLockerModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%)',
                                                        border: '2px solid rgba(168, 85, 247, 0.4)',
                                                        color: '#A855F7'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-violet-500/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>운동복/락커</span>
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => {
                                                        setShowOtherModal(true);
                                                    }}
                                                    className="relative glass-effect rounded-xl px-6 py-3 font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl group"
                                                    style={{
                                                        fontSize: '10px',
                                                        background: 'linear-gradient(135deg, rgba(156, 163, 175, 0.2) 0%, rgba(107, 114, 128, 0.2) 100%)',
                                                        border: '2px solid rgba(156, 163, 175, 0.4)',
                                                        color: '#9CA3AF'
                                                    }}
                                                >
                                                    <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-gray-500/20 to-gray-600/20 opacity-0 group-hover:opacity-100 transition-all duration-300"></div>
                                                    <div className="relative">
                                                        <span>기타 매출</span>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                {/* 일별 뷰 */}
                                {viewMode === 'daily' && (
                                    <div ref={dailyViewRef} className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-4 max-h-[650px] overflow-y-auto p-2" style={{display: 'grid', gridTemplateColumns: window.innerWidth < 640 ? 'repeat(1, minmax(0, 1fr))' : 'repeat(3, minmax(0, 1fr))'}}>
                                        {Array.from({ length: getDaysInMonth() }, (_, i) => i + 1).map(day => {
                                        const dateKey = getDateKey(day);
                                        const dayData = normalizeSalesEntry(salesData[dateKey]);
                                        const date = new Date(selectedYear, selectedMonth, day);
                                        const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });
                                        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                                        
                                        const dayAmount = normalizeAmount(dayData.amount);

                                        return (
                                            <div key={day} id={`day-${day}`} className={`glass-effect rounded-2xl p-4 sm:p-5 hover:scale-[1.02] transition-all duration-300 slide-in ${isWeekend ? 'border-pink-500/30' : ''}`}>
                                                <div className="flex items-center justify-between mb-3 sm:mb-4">
                                                    <div className="flex items-center gap-2 sm:gap-3">
                                                        <span className={`text-base sm:text-lg font-bold ${isWeekend ? 'text-pink-400' : 'text-white'}`}>
                                                            {selectedMonth + 1}월 {day}일
                                                        </span>
                                                        <span className={`text-xs sm:text-sm px-2 py-1 rounded-full ${isWeekend ? 'bg-pink-500/20 text-pink-400' : 'bg-gray-700 text-gray-400'}`}>
                                                            {dayName}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        {dayData.approved && (
                                                            <div className="flex items-center gap-2">
                                                                <Icon icon={Check} size={20} style={{ color: '#00FF88' }} />
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                                
                                                <div className={`rounded-xl p-3 sm:p-4 mb-3 sm:mb-4 ${dayAmount > 0 ? 'bg-gradient-to-r from-green-500/10 to-blue-500/10' : 'bg-gray-800/50'}`}>
                                                    <div className="text-2xl sm:text-3xl font-black mb-1" style={{ color: dayAmount > 0 ? '#00FF88' : '#6b7280' }}>
                                                        {dayAmount.toLocaleString()}원
                                                    </div>
                                                    <div className="text-xs sm:text-sm text-gray-400 flex items-center gap-2">
                                                        <Icon icon={Package} size={14} />
                                                        {dayData.details?.length || 0}건의 매출
                                                    </div>
                                                </div>

                                                {/* 매출 상세 내역 */}
                                                {dayData.details && dayData.details.length > 0 && (
                                                    <div className="mb-4">
                                                        <div className="flex flex-col gap-2 mb-3">
                                                            <div className="text-sm font-semibold text-gray-300 flex items-center gap-2">
                                                                <Icon icon={DollarSign} size={16} />
                                                                매출 내역 ({dayData.details.length}건)
                                                            </div>
                                                            <div className="flex items-center justify-start gap-1 text-xs overflow-x-auto">
                                                                <span className="flex items-center gap-1 whitespace-nowrap">
                                                                    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#95E1D3' }}></span>
                                                                    <span className="text-gray-500 text-[10px]">~10</span>
                                                                </span>
                                                                <span className="flex items-center gap-1 whitespace-nowrap">
                                                                    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#4ECDC4' }}></span>
                                                                    <span className="text-gray-500 text-[10px]">10~</span>
                                                                </span>
                                                                <span className="flex items-center gap-1 whitespace-nowrap">
                                                                    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#6BCF7F' }}></span>
                                                                    <span className="text-gray-500 text-[10px]">30~</span>
                                                                </span>
                                                                <span className="flex items-center gap-1 whitespace-nowrap">
                                                                    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#FFD93D' }}></span>
                                                                    <span className="text-gray-500 text-[10px]">50~</span>
                                                                </span>
                                                                <span className="flex items-center gap-1 whitespace-nowrap">
                                                                    <span className="w-2 h-2 rounded-full" style={{ backgroundColor: '#FF6B6B' }}></span>
                                                                    <span className="text-gray-500 text-[10px]">100~</span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div className="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                                                            {dayData.details.map((detail, index) => {
                                                                const detailAmount = normalizeAmount(detail.price);

                                                                return (
                                                                    <div key={detail.id} className="relative">
                                                                    <div
                                                                        className="glass-effect rounded-xl p-4 hover:scale-[1.01] transition-all border border-gray-700/50 hover:border-green-500/30 cursor-pointer focus:outline-none"
                                                                        role="button"
                                                                        tabIndex={0}
                                                                        onClick={() => openSaleDetail(day, dateKey, detail, dayData)}
                                                                        onKeyDown={(e) => {
                                                                            if (e.key === 'Enter' || e.key === ' ') {
                                                                                e.preventDefault();
                                                                                openSaleDetail(day, dateKey, detail, dayData);
                                                                            }
                                                                        }}
                                                                    >
                                                                        <div className="flex justify-between items-start gap-3">
                                                                            <div className="flex-1">
                                                                                <div className="flex items-start justify-between mb-2">
                                                                                    <div className="flex items-center gap-2">
                                                                                        <div className="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                                                                                            <span className="text-xs font-bold text-green-400">{index + 1}</span>
                                                                                        </div>
                                                                                        <div>
                                                                                            <div className="font-semibold text-white text-sm">
                                                                                                {detail.customerName}
                                                                                            </div>
                                                                                            <div className="text-gray-500 text-xs">
                                                                                                {detail.timestamp}
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div className="flex items-center gap-2">
                                                                                        <input
                                                                                            type="checkbox"
                                                                                            checked={checkedDetails[`${dateKey}_${detail.id}`] || false}
                                                                                            onChange={(e) => {
                                                                                                setCheckedDetails(prev => ({
                                                                                                    ...prev,
                                                                                                    [`${dateKey}_${detail.id}`]: e.target.checked
                                                                                                }));
                                                                                            }}
                                                                                            onClick={(e) => e.stopPropagation()}
                                                                                            className="w-4 h-4 rounded cursor-pointer"
                                                                                            style={{
                                                                                                accentColor: '#00FF88'
                                                                                            }}
                                                                                        />
                                                                                        <div className="font-bold text-lg" style={{ color: getPriceColor(detailAmount) }}>
                                                                                            {detailAmount.toLocaleString()}원
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div className="bg-gray-800/50 rounded-lg px-3 py-2 text-xs text-gray-300">
                                                                                    {detail.product}
                                                                                </div>
                                                                            </div>
                                                                            {!dayData.approved && (
                                                                                <div className="flex flex-col gap-2 items-end">
                                                                                    <button
                                                                                        type="button"
                                                                                        onClick={(e) => {
                                                                                            e.stopPropagation();
                                                                                            removeSaleDetail(day, detail.id);
                                                                                        }}
                                                                                        className="relative flex flex-col items-center justify-center gap-1 px-2 py-1.4 rounded-lg text-[10px] font-semibold transition-all"
                                                                                        style={{
                                                                                            minWidth: '62px',
                                                                                            background: 'linear-gradient(145deg, rgba(251,113,133,0.75), rgba(124,58,237,0.15))',
                                                                                            color: 'rgba(255,241,242,0.9)',
                                                                                            boxShadow: '0 8px 18px rgba(251,113,133,0.18)',
                                                                                            border: '1px solid rgba(251,113,133,0.4)',
                                                                                            textShadow: '0 1px 6px rgba(0,0,0,0.25)'
                                                                                        }}
                                                                                        aria-label="매출 내역 삭제"
                                                                                    >
                                                                                        <span className="absolute inset-0 rounded-xl" style={{
                                                                                            background: 'linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0))',
                                                                                            opacity: 0.55,
                                                                                            pointerEvents: 'none'
                                                                                        }}></span>
                                                                                        <Icon icon={Trash2} size={11} style={{ filter: 'drop-shadow(0 0 4px rgba(251,113,133,0.45))' }} />
                                                                                        <span style={{ fontSize: '10px', fontWeight: 600, textAlign: 'center' }}>삭제</span>
                                                                                    </button>
                                                                                    <button
                                                                                        type="button"
                                                                                        onClick={(e) => {
                                                                                            e.stopPropagation();
                                                                                            openAddSaleModal(day, detail, dateKey);
                                                                                        }}
                                                                                        className="relative flex flex-col items-center justify-center gap-1 px-2 py-1.4 rounded-lg text-[10px] font-semibold transition-all"
                                                                                        style={{
                                                                                            minWidth: '62px',
                                                                                            background: 'linear-gradient(145deg, rgba(45,212,191,0.75), rgba(56,189,248,0.18))',
                                                                                            color: 'rgba(240,253,250,0.92)',
                                                                                            boxShadow: '0 8px 18px rgba(45,212,191,0.18)',
                                                                                            border: '1px solid rgba(45,212,191,0.4)',
                                                                                            textShadow: '0 1px 6px rgba(0,0,0,0.25)'
                                                                                        }}
                                                                                        aria-label="매출 내역 수정"
                                                                                    >
                                                                                        <span className="absolute inset-0 rounded-xl" style={{
                                                                                            background: 'linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0))',
                                                                                            opacity: 0.55,
                                                                                            pointerEvents: 'none'
                                                                                        }}></span>
                                                                                        <Icon icon={Edit} size={11} style={{ filter: 'drop-shadow(0 0 4px rgba(56,189,248,0.4))' }} />
                                                                                        <span style={{ fontSize: '10px', fontWeight: 600, textAlign: 'center' }}>수정</span>
                                                                                    </button>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* 매출이 없을 때 안내 */}
                                                {(!dayData.details || dayData.details.length === 0) && dayAmount === 0 && (
                                                    <div className="text-center py-6 text-gray-500 text-sm glass-effect rounded-xl mb-4">
                                                        <Icon icon={DollarSign} size={24} className="mx-auto mb-2 opacity-30" />
                                                        등록된 매출이 없습니다
                                                    </div>
                                                )}

                                                {/* 매출 입력 버튼 */}
                                                {!dayData.approved && (
                                                    <button
                                                        onClick={() => openAddSaleModal(day)}
                                                        className="w-full glass-effect border-blue-500 hover:border-blue-400 rounded-xl py-3 text-sm font-semibold transition-all flex items-center justify-center gap-2 mb-4"
                                                        style={{
                                                            color: '#00C6FF',
                                                            textShadow: '0 0 10px #00C6FF, 0 0 20px #00C6FF, 0 0 30px #00C6FF, 0 0 40px #00C6FF',
                                                            boxShadow: '0 0 20px rgba(0, 198, 255, 0.5), inset 0 0 20px rgba(0, 198, 255, 0.1)',
                                                            animation: 'neonBluePulse 2s ease-in-out infinite'
                                                        }}
                                                    >
                                                        <Icon icon={Plus} size={18} style={{ filter: 'drop-shadow(0 0 8px #00C6FF)' }} />
                                                        빠른 매출 입력
                                                    </button>
                                                )}

                                                {/* 매출 입력 폼 */}
                                                {expandedDays[day] && !dayData.approved && (
                                                    <div className="glass-effect rounded-xl p-5 mb-4 space-y-4 slide-in">
                                                        <div className="text-sm font-bold text-green-400 mb-4 flex items-center gap-2">
                                                            <Icon icon={Edit} size={16} />
                                                            {selectedMonth + 1}월 {day}일 매출 입력
                                                        </div>

                                                        {/* 회원명 입력 */}
                                                        <div>
                                                            <label className="block text-xs font-semibold mb-2 text-gray-300 flex items-center gap-2">
                                                                <Icon icon="user" size={14} />
                                                                회원명
                                                            </label>
                                                            <input
                                                                type="text"
                                                                value={customerName[day] || ''}
                                                                onChange={(e) => setCustomerName(prev => ({
                                                                    ...prev,
                                                                    [day]: e.target.value
                                                                }))}
                                                                placeholder="회원명을 입력하세요"
                                                                className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none text-sm transition-all"
                                                            />
                                                        </div>

                                                        {/* 상품 선택 */}
                                                        <div>
                                                            <label className="block text-xs font-semibold mb-2 text-gray-300 flex items-center gap-2">
                                                                <Icon icon={Package} size={14} />
                                                                상품
                                                            </label>
                                                            <select
                                                                value={selectedProducts[day] || ''}
                                                                onChange={(e) => setSelectedProducts(prev => ({
                                                                    ...prev,
                                                                    [day]: e.target.value
                                                                }))}
                                                                className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none text-sm transition-all"
                                                            >
                                                                <option value="">상품을 선택하세요</option>
                                                                {products.map(product => (
                                                                    <option key={product} value={product}>{product}</option>
                                                                ))}
                                                            </select>
                                                        </div>

                                                        {/* 가격 입력 */}
                                                        <div>
                                                            <label className="block text-xs font-semibold mb-2 text-gray-300 flex items-center gap-2">
                                                                <Icon icon={CreditCard} size={14} />
                                                                가격
                                                            </label>
                                                            <input
                                                                type="number"
                                                                value={customPrices[day] || ''}
                                                                onChange={(e) => setCustomPrices(prev => ({
                                                                    ...prev,
                                                                    [day]: e.target.value
                                                                }))}
                                                                placeholder="가격을 입력하세요"
                                                                className="glass-effect rounded-lg px-4 py-3 w-full focus:border-green-400 focus:outline-none text-sm transition-all"
                                                            />
                                                        </div>

                                                        {/* 등록 버튼 */}
                                                        <button
                                                            onClick={() => addSaleDetail(day)}
                                                            className="w-full glass-effect border-green-500 hover:border-green-400 rounded-lg py-3 font-semibold text-sm transition-all hover:shadow-lg text-white"
                                                        >
                                                            매출 등록
                                                        </button>
                                                    </div>
                                                )}
                                                
                                                {!dayData.approved ? (
                                                    <div className="flex gap-1 sm:gap-2 items-center w-full">
                                                        <input
                                                            type="password"
                                                            value={approvalPasswords[dateKey] || ''}
                                                            onChange={(e) => {
                                                                const newValue = e.target.value;
                                                                setApprovalPasswords(prev => ({
                                                                    ...prev,
                                                                    [dateKey]: newValue
                                                                }));
                                                            }}
                                                            placeholder="PW"
                                                            className="glass-effect rounded-xl px-2 py-3 w-full max-w-[100px] sm:max-w-[150px] focus:border-green-400 focus:outline-none text-xs sm:text-base transition-all text-center"
                                                            style={{ fontSize: '16px' }}
                                                            onKeyPress={(e) => {
                                                                if (e.key === 'Enter') {
                                                                    handleAdminApproval(day);
                                                                }
                                                            }}
                                                        />
                                                        <button
                                                            onClick={() => handleAdminApproval(day)}
                                                            className="glass-effect border-blue-500 hover:border-blue-400 rounded-xl px-3 sm:px-6 py-3 text-xs sm:text-base font-semibold transition-all whitespace-nowrap hover:shadow-lg text-white flex-shrink-0"
                                                        >
                                                            승인
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <div className="space-y-3">
                                                        <button
                                                            className="glass-effect border-green-500 rounded-xl px-4 py-3 text-base font-semibold cursor-default flex items-center gap-2 w-full justify-center"
                                                            style={{
                                                                color: '#00FF88',
                                                                textShadow: '0 0 10px #00FF88, 0 0 20px #00FF88, 0 0 30px #00FF88, 0 0 40px #00FF88',
                                                                boxShadow: '0 0 20px rgba(0, 255, 136, 0.5), inset 0 0 20px rgba(0, 255, 136, 0.1)',
                                                                animation: 'neonGreenPulse 2s ease-in-out infinite'
                                                            }}
                                                            disabled
                                                        >
                                                            <Icon icon={Check} size={18} style={{ filter: 'drop-shadow(0 0 8px #00FF88)' }} />
                                                            정산완료
                                                        </button>
                                                        <div className="flex gap-1 sm:gap-2 items-center w-full">
                                                            <input
                                                                type="password"
                                                                value={editPasswords[dateKey] || ''}
                                                                onChange={(e) => {
                                                                    const newValue = e.target.value;
                                                                    setEditPasswords(prev => ({
                                                                        ...prev,
                                                                        [dateKey]: newValue
                                                                    }));
                                                                }}
                                                                placeholder="PW"
                                                                className="glass-effect rounded-xl px-2 py-3 w-full max-w-[100px] sm:max-w-[150px] focus:border-orange-400 focus:outline-none text-xs sm:text-base transition-all text-center"
                                                                style={{ fontSize: '16px' }}
                                                                onKeyPress={(e) => {
                                                                    if (e.key === 'Enter') {
                                                                        handleEditMode(day);
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                onClick={() => handleEditMode(day)}
                                                                className="glass-effect border-orange-500 hover:border-orange-400 rounded-xl px-2 sm:px-6 py-3 text-xs sm:text-base font-semibold transition-all whitespace-nowrap flex items-center gap-1 hover:shadow-lg text-white flex-shrink-0"
                                                            >
                                                                <Icon icon={Edit} size={16} />
                                                                <span className="hidden sm:inline">수정</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                        })}
                                    </div>
                                )}
                                
                                {/* 주별 뷰 */}
                                {viewMode === 'weekly' && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {calculateWeeklySales().map((week, index) => {
                                            // week.days가 없거나 비어있으면 건너뛰기
                                            if (!week || !week.days || week.days.length === 0) {
                                                return null;
                                            }
                                            
                                            return (
                                                <div key={index} className="glass-effect rounded-2xl p-6 hover:scale-[1.02] transition-all">
                                                    <h3 className="text-xl font-bold mb-4 flex items-center justify-between">
                                                        <span>{week.days[0]}일 - {week.days[week.days.length - 1]}일</span>
                                                        <span className="text-2xl" style={{ color: '#00C6FF' }}>
                                                            {(week.total || 0).toLocaleString()}원
                                                        </span>
                                                    </h3>
                                                    <div className="space-y-2">
                                                        {week.days.map(day => {
                                                            const dateKey = getDateKey(day);
                                                            const dayData = normalizeSalesEntry(salesData[dateKey]);
                                                            const dayAmount = normalizeAmount(dayData.amount);
                                                            return (
                                                                <div key={day} className="flex justify-between items-center py-2 border-b border-gray-700">
                                                                    <span className="text-gray-400">{selectedMonth + 1}월 {day}일</span>
                                                                    <span className={dayData.approved ? 'text-green-400' : 'text-gray-500'}>
                                                                        {dayAmount.toLocaleString()}원
                                                                    </span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                                
                                {/* 월별 뷰 */}
                                {viewMode === 'monthly' && (
                                    <div className="glass-effect rounded-2xl p-8">
                                        <div className="text-center">
                                            <h3 className="text-3xl font-bold mb-2">{selectedYear}년 {selectedMonth + 1}월</h3>
                                            <p className="text-5xl font-black mb-4" style={{ color: '#00FF88' }}>
                                                {monthlyTotal.toLocaleString()}원
                                            </p>
                                            <div className="grid grid-cols-2 gap-4 mt-8">
                                                <div className="bg-gray-800/50 rounded-xl p-4">
                                                    <p className="text-gray-400 mb-2">승인된 매출</p>
                                                    <p className="text-2xl font-bold text-green-400">
                                                        {Object.entries(salesData).filter(([_, data]) => data.approved).length}건
                                                    </p>
                                                </div>
                                                <div className="bg-gray-800/50 rounded-xl p-4">
                                                    <p className="text-gray-400 mb-2">평균 일매출</p>
                                                    <p className="text-2xl font-bold">
                                                        {Math.floor(monthlyTotal / getDaysInMonth()).toLocaleString()}원
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* 주간 매출 합계 */}
                        <div className="gradient-border mb-8">
                            <div>
                                <h2 className="text-2xl font-bold mb-6 flex items-center gap-3">
                                    <div className="p-2 bg-blue-500/20 rounded-lg">
                                        <Icon icon={TrendingUp} size={28} style={{ color: '#00C6FF' }} />
                                    </div>
                                    주간 매출 합계
                                </h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {weeklySales.map((week, index) => {
                                        // week.days가 없거나 비어있으면 건너뛰기
                                        if (!week || !week.days || week.days.length === 0) {
                                            return null;
                                        }
                                        
                                        return (
                                            <div key={index} className="glass-effect rounded-2xl p-5 hover:scale-105 transition-all duration-300">
                                                <div className="flex flex-col">
                                                    <span className="text-sm text-gray-400 mb-2">
                                                        {week.days[0]}일 - {week.days[week.days.length - 1]}일
                                                    </span>
                                                    <span className="text-2xl font-black" style={{ color: '#00C6FF' }}>
                                                        {(week.total || 0).toLocaleString()}원
                                                    </span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        {/* 월별 매출 리포트 통계 */}
                        <div className="gradient-border mb-8">
                            <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50">
                                <h2 className="text-2xl font-bold mb-6 flex flex-wrap items-center gap-3">
                                    <div className="p-2 bg-purple-500/20 rounded-lg">
                                        📊
                                    </div>
                                    월별 매출 리포트
                                </h2>

                                {/* 월별 매출 리포트 */}
                                <div className="glass-effect rounded-2xl p-6 mb-6">
                                    <div className="flex flex-wrap items-center justify-between gap-4 mb-6">
                                        <div className="flex flex-wrap items-center gap-3">
                                            <h3 className="text-lg font-semibold text-gray-200 flex items-center gap-2">
                                                <span>📅</span>
                                                <span>{headlineLabel} 매출 현황</span>
                                            </h3>
                                            <div
                                                className="inline-flex"
                                                style={{
                                                    alignItems: 'center',
                                                    gap: '14px',
                                                    padding: '7px 22px',
                                                    borderRadius: '9999px',
                                                    border: '1px solid rgba(139, 92, 246, 0.55)',
                                                    background: 'linear-gradient(120deg, rgba(99,102,241,0.25), rgba(236,72,153,0.18), rgba(14,165,233,0.22))',
                                                    boxShadow: '0 10px 26px rgba(99,102,241,0.22)'
                                                }}
                                            >
                                                <span
                                                    style={{
                                                        display: 'inline-flex',
                                                        alignItems: 'center',
                                                        gap: '8px',
                                                        fontSize: '11px',
                                                        fontWeight: 600,
                                                        letterSpacing: '0.24em',
                                                        textTransform: 'uppercase',
                                                        color: 'rgba(224, 231, 255, 0.9)'
                                                    }}
                                                >
                                                    <span
                                                        style={{
                                                            display: 'inline-flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            width: '18px',
                                                            height: '18px',
                                                            borderRadius: '6px',
                                                            background: 'linear-gradient(140deg, rgba(236,72,153,0.85), rgba(99,102,241,0.65))',
                                                            color: 'white',
                                                            fontSize: '10px',
                                                            boxShadow: '0 0 12px rgba(236,72,153,0.45)'
                                                        }}
                                                    >
                                                        ✦
                                                    </span>
                                                    총합
                                                </span>
                                                <span
                                                    style={{
                                                        width: '1px',
                                                        height: '22px',
                                                        background: 'linear-gradient(180deg, rgba(255,255,255,0), rgba(192,132,252,0.75), rgba(255,255,255,0))'
                                                    }}
                                                ></span>
                                            <span
                                                style={{
                                                    fontSize: '19px',
                                                    fontWeight: 700,
                                                    color: 'rgba(244, 247, 255, 0.96)',
                                                    textShadow: '0 5px 18px rgba(99,102,241,0.38)'
                                                }}
                                            >
                                                {headlineTotal.toLocaleString()}원
                                            </span>
                                            {(() => {
                                                const { percentage, isIncrease } = headlineDelta;
                                                if (percentage === null || Number.isNaN(percentage)) {
                                                    return (
                                                        <span
                                                            style={{
                                                                fontSize: '11px',
                                                                fontWeight: 500,
                                                                color: 'rgba(226,232,240,0.55)'
                                                            }}
                                                        >
                                                            비교 데이터 없음
                                                        </span>
                                                    );
                                                }

                                                const formatted = `${Math.abs(percentage).toFixed(1)}%`;
                                                const badgeColor = isIncrease
                                                    ? 'rgba(74, 222, 128, 0.18)'
                                                    : 'rgba(248, 113, 113, 0.18)';
                                                const borderColor = isIncrease
                                                    ? 'rgba(34, 197, 94, 0.55)'
                                                    : 'rgba(248, 113, 113, 0.55)';
                                                const arrow = isIncrease ? '▲' : '▼';
                                                const textColor = isIncrease
                                                    ? 'rgba(187, 247, 208, 0.9)'
                                                    : 'rgba(254, 202, 202, 0.9)';

                                                    return (
                                                        <span
                                                            style={{
                                                                marginLeft: '12px',
                                                                display: 'inline-flex',
                                                                alignItems: 'center',
                                                                gap: '4px',
                                                            color: textColor,
                                                            fontSize: '12px',
                                                            fontWeight: 600
                                                        }}
                                                    >
                                                        <span style={{ fontSize: '11px' }}>{arrow}</span>
                                                        <span>{formatted}</span>
                                                        <span style={{ color: 'rgba(226,232,240,0.6)', fontWeight: 500 }}>
                                                            vs {previousMonthLabel}
                                                        </span>
                                                    </span>
                                                );
                                            })()}
                                            </div>
                                        </div>
                                    </div>
                                    <MonthlyRevenueChart
                                        selectedYear={selectedYear}
                                        selectedMonth={selectedMonth}
                                        calculateMonthlyCategorySales={calculateMonthlyCategorySales}
                                    />
                                </div>
                                {/* 주요 카테고리 매출 비교 */}
                                <div className="glass-effect rounded-2xl p-6">
                                    <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                                        <h3 className="text-lg font-semibold text-gray-300">🎯 주요 카테고리 매출</h3>
                                        <span className="text-xs text-gray-500">{benchmarkLabel}</span>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                                        {categorySnapshots.map((category) => {
                                            const shareValue = Number.isFinite(category.share) ? category.share : 0;
                                            const shareLabel = shareValue.toFixed(1);
                                            const shareWidth = Math.min(100, Math.max(0, shareValue));

                                            return (
                                                <div
                                                    key={category.key}
                                                    className="relative overflow-hidden rounded-2xl border border-slate-800/60 bg-gradient-to-br from-slate-950/70 via-slate-900/70 to-slate-950/70 p-6 transition-shadow hover:shadow-lg hover:shadow-emerald-500/10"
                                                >
                                                    <div className={`absolute inset-x-8 top-0 h-[2px] bg-gradient-to-r ${category.accent} opacity-80`}></div>
                                                    <div className="flex items-start justify-between mb-6">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-xl">{category.icon}</span>
                                                            <div>
                                                                <p className="text-sm font-semibold text-gray-200">{category.label}</p>
                                                                <p className="text-xs text-gray-500">총매출 대비 {shareLabel}%</p>
                                                            </div>
                                                        </div>
                                                        <span className={`text-[11px] px-2 py-1 rounded-full border border-slate-700/60 bg-slate-900/60 ${category.trend.toneClass}`}>
                                                            {category.trend.changeText}
                                                        </span>
                                                    </div>
                                                    <div className="text-3xl font-extrabold" style={{ color: category.color }}>
                                                        {category.total.toLocaleString()}원
                                                    </div>
                                                    <div className="mt-3 text-xs text-gray-400 flex items-center gap-2">
                                                        <span className="inline-flex h-2 w-2 rounded-full" style={{ backgroundColor: category.color }}></span>
                                                        {(category.rangeLabel ? `${category.rangeLabel} 평균` : '최근 6개월 평균')} {category.averageLabel}
                                                    </div>
                                                    <div className="mt-5">
                                                        <div className="flex items-center justify-between text-[11px] text-gray-500 mb-2">
                                                            <span>총매출 기여도</span>
                                                            <span>{shareLabel}%</span>
                                                        </div>
                                                        <div className="h-1.5 w-full rounded-full bg-slate-800">
                                                            <div
                                                                className="h-1.5 rounded-full transition-all duration-500"
                                                                style={{ width: `${shareWidth}%`, backgroundColor: category.color }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* 월간 총계 및 인센티브 */}
                        <div className="gradient-border glow-green">
                            <div className="bg-gradient-to-br from-gray-800/50 to-gray-900/50">
                                <h2 className="text-3xl font-black mb-8 text-center text-white">
                                    월간 급여 계산
                                </h2>
                                
                                {/* 메인 카드 - 월간 총매출 */}
                                <div className="mb-8">
                                    <div className="glass-effect rounded-3xl p-8 text-center hover:scale-105 transition-all duration-300 shadow-2xl relative overflow-hidden">
                                        <div className="absolute inset-0 bg-gradient-to-r from-orange-500/10 to-red-500/10 opacity-50"></div>
                                        <div className="relative z-10">
                                            <p className="text-gray-400 text-lg mb-4 font-semibold">📊 월간 총매출</p>
                                            <p className="text-4xl sm:text-5xl font-black mb-2" style={{
                                                color: '#FF6B35',
                                                textShadow: '0 0 20px rgba(255, 107, 53, 0.6), 0 0 30px rgba(255, 107, 53, 0.4), 0 0 40px rgba(255, 107, 53, 0.2)'
                                            }}>{(monthlyTotal || 0).toLocaleString()}원</p>
                                            <div className="flex justify-center space-x-2 text-sm text-gray-500">
                                                <span>💰 Total Revenue</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* 카테고리별 매출 그리드 */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                                    {categorySnapshots.map((category) => {
                                        const shareValue = Number.isFinite(category.share) ? category.share : 0;
                                        const shareLabel = shareValue.toFixed(1);
                                        const shareWidth = Math.min(100, Math.max(0, shareValue));

                                        return (
                                            <div
                                                key={category.key}
                                                className="glass-effect rounded-2xl p-6 hover:scale-[1.02] transition-all duration-300 relative overflow-hidden"
                                            >
                                                <div className={`absolute top-0 left-0 w-full h-1 bg-gradient-to-r ${category.accent} opacity-80`}></div>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex items-center gap-3">
                                                        <div className="text-lg">{category.icon}</div>
                                                        <div>
                                                            <p className="text-sm font-semibold text-gray-200">{category.label}</p>
                                                            <p className="text-xs text-gray-500">총매출 대비 {shareLabel}%</p>
                                                        </div>
                                                    </div>
                                                    <span className={`text-[11px] px-2 py-1 rounded-full border border-slate-700/60 bg-slate-900/60 ${category.trend.toneClass}`}>
                                                        {category.trend.changeText}
                                                    </span>
                                                </div>
                                                <div className="text-3xl font-black" style={{ color: category.color }}>
                                                    {category.total.toLocaleString()}원
                                                </div>
                                                <div className="mt-4 flex flex-col gap-3 text-xs">
                                                    <div className="flex items-center justify-between rounded-lg border border-slate-700/60 bg-slate-900/60 px-3 py-2">
                                                        <span className="text-[11px] text-gray-500">{category.rangeLabel ? `${category.rangeLabel} 평균` : '최근 6개월 평균'}</span>
                                                        <span className="font-semibold text-white">{category.averageLabel}</span>
                                                    </div>
                                                    <div>
                                                        <div className="flex items-center justify-between text-[11px] text-gray-500 mb-1">
                                                            <span>총매출 기여도</span>
                                                            <span>{shareLabel}%</span>
                                                        </div>
                                                        <div className="h-1.5 w-full rounded-full bg-slate-800">
                                                            <div
                                                                className="h-1.5 rounded-full transition-all duration-500"
                                                                style={{ width: `${shareWidth}%`, backgroundColor: category.color }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 text-center mb-6 sm:mb-8">
                                    <div className="glass-effect rounded-2xl p-4 sm:p-6 hover:scale-105 transition-all duration-300">
                                        <p className="text-gray-400 text-xs sm:text-sm mb-2 sm:mb-3 font-semibold">인센티브율 ({employeeType === 'full' ? '정직원' : '파트타임'})</p>
                                        <p className="text-2xl sm:text-3xl font-black" style={{ color: '#00C6FF' }}>{incentiveRate || 0}%</p>
                                    </div>

                                    <div className="glass-effect rounded-2xl p-4 sm:p-6 hover:scale-105 transition-all duration-300">
                                        <p className="text-gray-400 text-xs sm:text-sm mb-2 sm:mb-3 font-semibold">인센티브 금액</p>
                                        <p className="text-2xl sm:text-3xl font-black" style={{ color: '#00FF88' }}>
                                            {Math.floor(incentiveAmount || 0).toLocaleString()}원
                                        </p>
                                    </div>
                                </div>

                                {/* 인센티브 기준표 */}
                                <div className="glass-effect rounded-2xl p-6">
                                    <p className="text-lg font-bold text-center mb-4 text-gray-300">
                                        인센티브 기준표 ({employeeType === 'full' ? '정직원' : '파트타임'})
                                    </p>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3 text-xs text-center">
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">2,500만원 미만</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#FF6B6B' }}>{employeeType === 'full' ? '4%' : '2%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">2,500만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#FF9F40' }}>{employeeType === 'full' ? '5%' : '2.5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">3,000만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#FFD93D' }}>{employeeType === 'full' ? '6%' : '3%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">3,500만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#6BCF7F' }}>{employeeType === 'full' ? '7%' : '3.5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">4,000만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#4ECDC4' }}>{employeeType === 'full' ? '8%' : '4%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">4,500만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#45B7D1' }}>{employeeType === 'full' ? '9%' : '4.5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">5,000만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#5D5FEF' }}>{employeeType === 'full' ? '10%' : '5%'}</p>
                                        </div>
                                        <div className="glass-effect rounded-xl p-2 sm:p-3 hover:scale-105 transition-all">
                                            <p className="text-gray-400 mb-1 text-xs">6,000만원 이상</p>
                                            <p className="font-bold text-base sm:text-lg" style={{ color: '#A55FEB' }}>{employeeType === 'full' ? '12%' : '6%'}</p>
                                        </div>
                                    </div>
                                    
                                    {/* 정직원/파트타임 비교표 */}
                                    <div className="mt-6 glass-effect rounded-2xl p-6">
                                        <p className="text-lg font-bold mb-4 text-center">현재 매출 기준 인센티브 비교</p>
                                        <div className="grid grid-cols-2 gap-4 text-center">
                                            <div 
                                                className={`rounded-xl p-4 cursor-pointer transition-all duration-300 ${
                                                    employeeType === 'full' 
                                                        ? 'scale-105 shadow-lg text-white' 
                                                        : 'glass-effect hover:scale-105 hover:border-gray-400'
                                                }`}
                                                style={employeeType === 'full' ? { 
                                                    backgroundColor: '#0a4a2c', 
                                                    border: '2px solid #00FF88',
                                                    boxShadow: '0 0 20px rgba(0, 255, 136, 0.6), inset 0 0 20px rgba(0, 255, 136, 0.2)'
                                                } : {}}
                                                onClick={() => setEmployeeType('full')}
                                            >
                                                <p className={`text-sm font-semibold mb-2 ${employeeType === 'full' ? 'text-green-400' : ''}`}>정직원</p>
                                                <p className={`font-black text-2xl mb-2 ${employeeType === 'full' ? 'text-green-400' : ''}`} style={employeeType === 'full' ? { textShadow: '0 0 10px rgba(0, 255, 136, 0.8)' } : {}}>{getIncentiveRate(monthlyTotal, 'full')}%</p>
                                                <p className={`text-sm ${employeeType === 'full' ? 'text-green-400' : 'opacity-80'}`}>
                                                    {Math.floor((monthlyTotal || 0) * (getIncentiveRate(monthlyTotal, 'full') / 100)).toLocaleString()}원
                                                </p>
                                            </div>
                                            <div 
                                                className={`rounded-xl p-4 cursor-pointer transition-all duration-300 ${
                                                    employeeType === 'part' 
                                                        ? 'scale-105 shadow-lg text-white' 
                                                        : 'glass-effect hover:scale-105 hover:border-gray-400'
                                                }`}
                                                style={employeeType === 'part' ? { 
                                                    backgroundColor: '#0a4a2c', 
                                                    border: '2px solid #00FF88',
                                                    boxShadow: '0 0 20px rgba(0, 255, 136, 0.6), inset 0 0 20px rgba(0, 255, 136, 0.2)'
                                                } : {}}
                                                onClick={() => setEmployeeType('part')}
                                            >
                                                <p className={`text-sm font-semibold mb-2 ${employeeType === 'part' ? 'text-green-400' : ''}`}>파트타임</p>
                                                <p className={`font-black text-2xl mb-2 ${employeeType === 'part' ? 'text-green-400' : ''}`} style={employeeType === 'part' ? { textShadow: '0 0 10px rgba(0, 255, 136, 0.8)' } : {}}>{getIncentiveRate(monthlyTotal, 'part')}%</p>
                                                <p className={`text-sm ${employeeType === 'part' ? 'text-green-400' : 'opacity-80'}`}>
                                                    {Math.floor((monthlyTotal || 0) * (getIncentiveRate(monthlyTotal, 'part') / 100)).toLocaleString()}원
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<NeoFitPayCalc />);
    </script>
    
    <script>
        // optgroup 네온 효과 적용을 위한 스크립트
        function applyNeonEffectToOptgroups() {
            const optgroups = document.querySelectorAll('select optgroup');
            optgroups.forEach(optgroup => {
                // 인라인 스타일로 직접 적용
                optgroup.style.color = '#00FF88';
                optgroup.style.fontWeight = 'bold';
                optgroup.style.textShadow = '0 0 10px #00FF88, 0 0 20px #00FF88, 0 0 30px #00FF88';
                optgroup.style.backgroundColor = 'rgba(0, 255, 136, 0.1)';
                optgroup.style.display = 'block';
                optgroup.style.padding = '8px';
                optgroup.style.margin = '4px 0';
            });
        }
        
        // DOM이 로드된 후 실행
        document.addEventListener('DOMContentLoaded', applyNeonEffectToOptgroups);
        
        // React 렌더링 후에도 실행 (동적으로 생성되는 요소를 위해)
        setTimeout(applyNeonEffectToOptgroups, 1000);
        
        // 모달이 열릴 때마다 적용
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes.length) {
                    applyNeonEffectToOptgroups();
                }
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    </script>
</body>
</html>
